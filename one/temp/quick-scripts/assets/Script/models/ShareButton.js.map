{"version":3,"sources":["ShareButton.js"],"names":["cc","Class","extends","Component","properties","callButton","default","type","Button","onLoad","data","console","log","button","start","setShareData","setShareConfig","config","shareConfig","setSuccessCall","successCall","successCallBack","setButtonCallType","calltype","node","on","callBack","shareMiniApp","showWXVideo","setReactCall","reactcall","setErrorCall","errorCall","errorCallBack","setShareGroupCall","sgroupCall","shareGroupCallBack","self","tywx","IsWechatPlatform","param","success","res","fail","ado","Utils","showWXModal","error_callback","Constants","ShareConfig","GIFT_GIFT_BOX_SHARE","RECOVER_GAME_SHARE","content","end_str","showErrorGfitPop","window","wx","showShareMenu","withShareTicket","msg","getRandomShareConfigByShareTag","shareContent","sharePicUrl","sharePointId","shareSchemeId","ShareInterface","share","LOGE","JSON","stringify","shareTickets","undefined","length","RANK_SHARE","share2GroupByTicket"],"mappings":"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","file":"ShareButton.js","sourceRoot":"../../../../../assets/Script/models","sourcesContent":[" /*\n    游戏分享prefab\n    游戏的分享操作的主要逻辑在这个module里面编写\n    created by gyc on 2018-08-08.\n*/\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        callButton:{\n            default: null,\n            type: cc.Button,\n        }\n    },\n\n      /*\n        调用: 场景加载完成后的回调\n        功能: 场景加载完成后的一些UI逻辑处理\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 系统自带\n    */\n    onLoad () {\n        this.data = {};\n        \n        console.log(\"this.button\" + this.button);\n    },\n    /*\n        调用: 组件开始调用的时候调用\n        功能: 组件开始调用的时候的逻辑处理\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 系统自带\n    */\n    start () {\n \n    },\n    \n    /*\n        调用: 使用此model分享功能的时候 手动调用刷新分享的数据\n        功能: 设置即将要分享的数据\n        参数: [\n            data: 分享的数据\n        ]\n        返回值:[\n            无\n        ]\n        思路: 系统自带\n    */\n    setShareData:function(data){\n        this.data = data;\n    },\n    /**\n     * @description 设置分享配置\n     * @author lu ning\n     * @date 2018-08-23\n     * @param {Array<any>} config config[0]=tag;config[1]=是否强制分享到群,boolean\n     */\n    setShareConfig(config){\n        this.shareConfig = config;\n    },\n\n        /*\n        调用: 使用此model分享功能的时候 \n        功能: 手动设置分享成功后的回调函数\n        参数: [\n            successCall: 分享成功后的回调方法 类型Function\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n   setSuccessCall: function(successCall){\n        this.successCallBack = successCall;\n   },\n   \n   /** \n    * @description 切换按钮的调用类型 \n    * @param {Number} calltype  1 分享 2 视频\n   */\n   setButtonCallType: function (calltype) {\n         if(!this.calltype){\n            this.callButton.node.on('click', this.callBack, this);\n         }\n         this.calltype = calltype;\n   },\n\n   callBack:function(){\n      if (this.calltype == 1){\n          this.shareMiniApp();\n      }else{\n          this.showWXVideo();\n      }\n   },\n\n\n  \n\n    /*\n        调用: 使用此model分享功能的时候 \n        功能: 手动设置分享成功后的回调函数\n        参数: [\n            successCall: 分享成功后的回调方法 类型Function\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n    setReactCall: function(reactcall){\n        this.reactcall = reactcall;\n    },\n\n     /*\n        调用: 使用此model分享功能的时候 \n        功能: 手动设置分享失败后的回调函数\n        参数: [\n            errorCall: 分享失败后的回调方法 类型Function\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n    setErrorCall: function(errorCall){\n        this.errorCallBack = errorCall;\n    },\n\n    /*\n        调用: 使用此model分享功能的时候 \n        功能: 手动设置分享失败后的回调函数\n        参数: [\n            errorCall: 分享失败后的回调方法 类型Function\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n    setShareGroupCall: function(sgroupCall){\n        this.shareGroupCallBack = sgroupCall;\n    },\n    \n    \n    /**\n     * @description 播放微信视频广告\n     */\n    showWXVideo: function(){\n        var self = this;\n        if (this.reactcall) {\n            self.successCallBack(this);\n        } else {\n            if (tywx.IsWechatPlatform()) {\n\n                var param = {\n                    success:function(res){\n                         self.shareGroupCallBack && self.shareGroupCallBack(res);\n                    },\n                    fail: function (res) {\n                         tywx.ado.Utils.showWXModal('观看视频失败');\n                         self.errorCallBack && self.errorCallBack(null);\n                    },\n                    error_callback: ()=>{\n                        if(self.shareConfig === tywx.ado.Constants.ShareConfig.GIFT_GIFT_BOX_SHARE\n                            || self.shareConfig === tywx.ado.Constants.ShareConfig.RECOVER_GAME_SHARE)\n                        {\n                            let content = \n                                self.shareConfig === tywx.ado.Constants.ShareConfig.RECOVER_GAME_SHARE \n                                ? '免费复活机会' : '如意宝箱';\n                            let end_str = self.shareConfig === tywx.ado.Constants.ShareConfig.RECOVER_GAME_SHARE \n                            ? '一次' : '一个';\n                            content = `<color=#ffffff>赠送</c><color=#ff0000>${content}</color><color=#ffffff>${end_str}</c>`;\n                            tywx.ado.Utils.showErrorGfitPop(()=>{\n                                self.shareGroupCallBack && self.shareGroupCallBack(null);\n                            },content);\n                        }\n                    }\n                }\n                tywx.ado.Utils.showWXVideo(param);\n            }\n        }\n    },\n\n\n    /*\n        调用: 使用此model分享功能的时候 \n        功能: 给好友或者群分享小程序的相关信息\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n    shareMiniApp:function(){\n        var self = this;\n        console.log(\"当前分享\" + this.reactcall);\n        if(this.reactcall){\n           self.successCallBack(this);\n        }else{\n            if(tywx.IsWechatPlatform()){\n                window.wx.showShareMenu({withShareTicket: true});\n                let msg = tywx.ado.Utils.getRandomShareConfigByShareTag(this.shareConfig[0]);\n                if(!msg){\n                    msg = {};\n                    msg.shareContent = \"你知道\" + \"+1 吗？\";\n                    msg.sharePicUrl = \"https://marketqn.nalrer.cn/teris/share_image/jiayi/jy03.jpg\";\n                    msg.sharePointId = \"766\";\n                    msg.shareSchemeId = \"1155\";\n                }\n                if(msg){\n                    tywx.ShareInterface.share(\n                        msg.shareContent,\n                        msg.sharePicUrl,\n                        msg.sharePointId,\n                        msg.shareSchemeId,\n                        (res) => {\n                            tywx.LOGE(\"分享成功后的数据\"+JSON.stringify(res));\n                            // * is share to group\n                            if(self.shareConfig && self.shareConfig[1]){\n                                // * froce share to group\n                                if (res.shareTickets !== undefined && res.shareTickets.length > 0) {\n                                    if(self.shareConfig[0] === tywx.ado.Constants.ShareConfig.RANK_SHARE[0]){\n                                        self.shareGroupCallBack && self.shareGroupCallBack(res);                                                \n                                    }\n                                    else{\n                                        tywx.ado.Utils.share2GroupByTicket(\n                                            self.shareConfig[0], \n                                            res, \n                                            ()=>{ // * success callback\n                                                self.shareGroupCallBack && self.shareGroupCallBack(res);\n                                            },\n                                            ()=>{ // * failed callback\n                                                tywx.ado.Utils.showWXModal('请分享到不同群');\n                                                self.errorCallBack && self.errorCallBack(null);                                           \n                                            }\n                                        );\n                                    }\n                                }\n                                else{\n                                    // * failed\n                                    tywx.ado.Utils.showWXModal('请分享到群');\n                                    self.errorCallBack && self.errorCallBack(null);\n                                }\n                            }\n                            else{\n                                // * success\n                                self.successCallBack && self.successCallBack(res);\n                            }                          \n                         \n                        },\n                        function(data){\n                            tywx.LOGE(\"分享成功后的数2据\"+JSON.stringify(data));\n                            self.errorCallBack && self.errorCallBack(data);\n                        }\n                    );\n               }\n           }\n        }\n    }\n    // update (dt) {},\n});\n"]}