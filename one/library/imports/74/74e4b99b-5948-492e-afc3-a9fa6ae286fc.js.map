{"version":3,"sources":["../../../../../assets/Script/models/assets/Script/models/MoreTanNumber.js"],"names":["cc","Class","extends","Component","properties","showNumber","type","Label","default","shareNode","Node","numberBj","rootNode","yellowNumberLabel","curhcScoreLabel","curgzupNumberLabel","curgzItemNameLabel","showdbSprite","Sprite","backSprite","spriteFrames","SpriteFrame","jlLabel","setShowNumber","shownum","score","name","addscore","string","setDbByIndex","storePhoto","hadstorephotonumber","tywx","ado","Utils","showWXToast","contentsize","width","height","console","log","JSON","stringify","game","canvas","cw","ch","is_ipx","ds","size","dcs","rate_width","rate_height","d_x","d_y","rate_x","rate_y","w","h","x","y","node","position","self","toTempFilePath","destWidth","destHeight","quality","fileType","success","res","saveImage2PhoneByUrl","tempFilePath","fail","playAni","uiAni","close","showWXBanner","active","clossc","closeCall","gamecenter","shareDoubleScore","setCloseCall","doubleScore","init","commonScaleIn","onLoad","getComponent","setShareConfig","Constants","ShareConfig","FREE_GIFT_SHARE","on","event","getShareComponent","setStoreSucCallBack","succall","storesuccall","num","spriteFrame","btnRefreshBgPhotoCallback","photo_urls","config","PYQImg","MergeBigNumPhotos","showPicIndex","length","pngurl","SystemInfo","cdnPath","sprite","getChildByName","refreshSpriteByUrl"],"mappings":"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","file":"MoreTanNumber.js","sourceRoot":"../../../../../assets/Script/models","sourcesContent":[" cc.Class({\n     extends: cc.Component,\n\n     properties: {\n         showNumber: {\n             type: cc.Label,\n             default: null,\n         },\n         shareNode: {\n             type: cc.Node,\n             default: null,\n         },\n         numberBj: {\n             type: cc.Node,\n             default: null,\n         },\n         rootNode: {\n             type: cc.Node,\n             default: null,\n         },\n         yellowNumberLabel: {\n             default: null,\n             type: cc.Label\n         },\n\n         curhcScoreLabel: {\n             default: null,\n             type: cc.Label\n         },\n\n         curgzupNumberLabel: {\n             default: null,\n             type: cc.Label\n         },\n\n         curgzItemNameLabel: {\n             default: null,\n             type: cc.Label\n         },\n\n         showdbSprite: {\n             type: cc.Sprite,\n             default: null,\n         },\n         backSprite: {\n             type: cc.Sprite,\n             default: null,\n         },\n\n         spriteFrames: {\n             default: [],\n             type: cc.SpriteFrame,\n         },\n         jlLabel:{\n              default: null,\n              type: cc.Label\n         }\n\n     },\n\n     /**\n      * @description 刷新当前的试图\n      * @param {Number} shownum 当前合出来的偶数\n      * @param {Number} score 玩家当前的得分\n      * @param {String} 道具名称\n      */\n     setShowNumber: function (shownum, score, name) {\n         this.addscore = score;\n         this.showNumber.string = shownum;\n         this.jlLabel.string = \"奖励 \" + score + \"分\";\n         this.setDbByIndex(shownum, score, name);\n     },\n\n     /**\n      * @description 保存照片\n      */\n     storePhoto: function () {\n         if (this.hadstorephotonumber) {\n             tywx.ado.Utils.showWXToast(\"已经保存成功\", 500);\n             return;\n         }\n\n         // this.hadstorephotonumber = true;\n         var contentsize = {\n             width: this.numberBj.width,\n             height: this.numberBj.height\n         }\n         console.log(\"contentsize  + \" + JSON.stringify(contentsize));\n         let [cw, ch] = [cc.game.canvas.width, cc.game.canvas.height];\n         let is_ipx = ch / cw >= 1.9; // * 是否是2:1屏幕\n         let ds = cc.size(720, 1280);\n         let dcs = cc.size(contentsize.width, contentsize.height);\n         let [rate_width, rate_height] = [dcs.width / ds.width, dcs.height / ds.height];\n         let [d_x, d_y] = [(ds.width - dcs.width) / 2, (ds.height - dcs.height) / 2 - 102];\n         let [rate_x, rate_y] = [d_x / ds.width, d_y / ds.height];\n\n         let w = cw * rate_width;\n         let h = is_ipx ? w * (dcs.height / dcs.width) : ch * rate_height;\n         let x = cw * rate_x;\n         let y = is_ipx ? (ch - h) / 2 - this.showdbSprite.node.position.y : ch * rate_y;\n         var self = this;\n         canvas.toTempFilePath({\n             x: x,\n             y: y,\n             width: w,\n             height: h,\n             destWidth: contentsize.width,\n             destHeight: contentsize.height,\n             quality: 1,\n             fileType: \"jpg\",\n             success: function success(res) {\n                 //console.log(res);\n                 tywx.ado.Utils.saveImage2PhoneByUrl(res.tempFilePath, function () {\n                    //  self.hadstorephotonumber = true;\n                     // 注释保存图片宋道具\n                     // self.storesuccall && self.storesuccall();\n                    //  tywx.ado.Utils.showWXToast(\"领取成功\", 1000);\n                     tywx.ado.Utils.showWXToast(\"保存图片成功\", 1000);\n                 }, function () {\n                     self.hadstorephotonumber = false;\n                     tywx.ado.Utils.showWXToast(\"保存图片失败\");\n                 });\n             },\n             fail: function fail(res) {\n                 self.hadstorephotonumber = false;\n                 tywx.ado.Utils.showWXToast(\"保存图片失败\");\n             }\n         });\n     },\n\n\n     /**\n      * @description 播放当前界面的动画\n      */\n     playAni: function () {\n         //  this.node.getComponent(cc.Animation).play(\"huode1\");\n         this.uiAni();\n     },\n\n     /**\n      * @description 关闭当前的界面\n      */\n     close: function () {\n         tywx.ado.Utils.showWXBanner();\n         this.node.active = false;\n         this.hadstorephotonumber = false;\n         if (this.clossc) {\n             this.clossc();\n         }\n     },\n\n     closeCall:function(){\n        this.close();\n        if (tywx.gamecenter && tywx.gamecenter.shareDoubleScore) {\n            tywx.gamecenter.shareDoubleScore(this.addscore);\n        }\n     },\n\n     /**\n      * @description 设置关闭后的回调函数\n      * @param {Function} clossc 关闭回调函数\n      */\n     setCloseCall: function (clossc) {\n         this.clossc = clossc;\n     },\n\n     doubleScore:function(){\n          if (tywx.gamecenter && tywx.gamecenter.shareDoubleScore) {\n              tywx.gamecenter.shareDoubleScore(this.addscore * 2);\n          }\n     },\n\n     /**\n      * @description 手动初始化已经存储图片的开关\n      */\n     init: function () {\n         this.hadstorephotonumber = false;\n     },\n\n     /**\n      * @description 播放界面通用动画\n      */\n     uiAni: function () {\n         tywx.ado.Utils.commonScaleIn(this.rootNode);\n     },\n\n\n     /**\n      * @description 页面加载完成后的逻辑处理\n      */\n     onLoad() {\n         this.hadstorephotonumber = false;\n         // 设置分享点\n         this.shareNode.getComponent(\"ShareButton\").setShareConfig(tywx.ado.Constants.ShareConfig.FREE_GIFT_SHARE);\n         this.backSprite.node.on('touchstart', function (event) {\n             return true;\n         });\n        //  this.btnRefreshBgPhotoCallback();\n     },\n\n     /**\n      * @description 得到当前界面的分享按钮的脚本组件\n      */\n     getShareComponent: function () {\n         return this.shareNode.getComponent(\"ShareButton\");\n     },\n\n\n\n     /**\n      * @description 设置当前保存图片成功后的回调函数\n      * @param {Function} succall 保存图片成功的回调函数\n      */\n     setStoreSucCallBack: function (succall) {\n         this.storesuccall = succall;\n     },\n\n     /**\n      * @description 刷新当前页面的显示 保罗合出的最大数 和 当前得分 以及底板的显示 和当前得到的道具名称\n      * @param {Number} num 当前合出的最大数\n      * @param {Number} score 当前玩家的得分\n      * @param {Number} name 当前道具的名称\n      */\n     setDbByIndex: function (num, score, name) {\n         if (num == 8) {\n             this.showdbSprite.spriteFrame = this.spriteFrames[0];\n         } else if (num == 9) {\n             this.showdbSprite.spriteFrame = this.spriteFrames[1];\n         } else {\n             this.showdbSprite.spriteFrame = this.spriteFrames[2];\n         }\n         this.yellowNumberLabel.string = num;\n         this.curhcScoreLabel.string = score;\n         this.curgzupNumberLabel.string = num;\n         this.curgzItemNameLabel.string = name;\n     },\n\n     btnRefreshBgPhotoCallback() {\n         let photo_urls = tywx.config.PYQImg.MergeBigNumPhotos;\n         if (!this.showPicIndex || this.showPicIndex > (photo_urls.length - 1)) {\n             this.showPicIndex = 0;\n         }\n         let pngurl = tywx.SystemInfo.cdnPath + 'share_pyq/addone/' +\n             photo_urls[this.showPicIndex];\n         console.log(\"cdnpngurl = \" + pngurl);\n         let sprite = this.rootNode.getChildByName('numberbj1').getComponent(cc.Sprite);\n         tywx.ado.Utils.refreshSpriteByUrl(sprite, pngurl);\n         this.showPicIndex = this.showPicIndex + 1;\n     }\n\n\n\n });"]}