{"version":3,"sources":["../../../../../assets/Script/models/assets/Script/models/OpenRedPackView.js"],"names":["cc","Class","extends","Component","properties","kaibottomNode","default","type","Node","bottomNode","background","Sprite","shareButtonNode","isOpening","nodeWarn","labelWarn","Label","close","notneedshow","tywx","ado","Utils","showWXBanner","node","destroy","onLoad","on","event","active","showUI","commonScaleIn","setData","data","console","log","JSON","stringify","initOpenLogic","open","StateInfo","networkConnected","self","param","success","gamecenter","flushMoneyNumber","flushRedPacketBtns","showRedPacketTransferPop","formatCashFen2Yuan","RedPacketInfo","nextAmount","fail","requestAddRedPacket","openRedPackBtn","getComponent","setSuccessCall","playRotate","share_control","config","share_control_2","redpack","random","parseInt","Math","isMinGanIP","isCanWatchVideo","setShareConfig","Constants","ShareConfig","OPEN_RED_PACKET_SHARE_VIDEO","setButtonCallType","OPEN_RED_PACKET_SHARE","needShare","setReactCall","setShareGroupCall","scale1","scaleTo","scale2","callFunc","tcall","seq","sequence","runAction"],"mappings":";;;;;;AAACA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;;AAERC,uBAAe;AACXC,qBAAS,IADE;AAEXC,kBAAMP,GAAGQ;AAFE,SAFP;AAMRC,oBAAY;AACRH,qBAAS,IADD;AAERC,kBAAMP,GAAGQ;AAFD,SANJ;AAURE,oBAAY;AACRJ,qBAAS,IADD;AAERC,kBAAMP,GAAGW;AAFD,SAVJ;AAcRC,yBAAiB;AACbN,qBAAS,IADI;AAEbC,kBAAMP,GAAGQ;AAFI,SAdT;AAkBRK,mBAAW,KAlBH;AAmBRC,kBAAUd,GAAGQ,IAnBL;AAoBRO,mBAAWf,GAAGgB;AApBN,KAHP;;AA0BL;;;AAGAC,WAAO,eAAUC,WAAV,EAAuB;AAC1BC,aAAKC,GAAL,CAASC,KAAT,CAAeC,YAAf;AACA,aAAKC,IAAL,CAAUC,OAAV;AACH,KAhCI;;AAkCL;;;AAGAC,UArCK,oBAqCI;AACL,aAAKf,UAAL,CAAgBa,IAAhB,CAAqBG,EAArB,CAAwB,YAAxB,EAAsC,UAAUC,KAAV,EAAiB;AACnD,mBAAO,IAAP;AACH,SAFD;AAGA,aAAKb,QAAL,CAAcc,MAAd,GAAuB,KAAvB;AACA;AACA;AACH,KA5CI;;;AA8CL;;;AAGAC,YAAQ,kBAAY;AAChBV,aAAKC,GAAL,CAASC,KAAT,CAAeS,aAAf,CAA6B,KAAKrB,UAAlC;AACH,KAnDI;;AAqDL;;;;AAIAsB,WAzDK,mBAyDGC,IAzDH,EAyDS;AACV,aAAKA,IAAL,GAAYA,IAAZ;AACAC,gBAAQC,GAAR,CAAY,eAAeC,KAAKC,SAAL,CAAe,KAAKJ,IAApB,CAA3B;AACA;AACA,aAAKK,aAAL;AACH,KA9DI;;;AAgEL;;;AAGAC,UAAM,gBAAY;AACd,YAAI,CAACnB,KAAKoB,SAAL,CAAeC,gBAApB,EAAsC;AAClC;AACH;AACD,YAAIC,OAAO,IAAX;AACA,YAAIC,QAAQ;AACRC,qBAAS,mBAAY;AACjB,oBAAIxB,KAAKyB,UAAL,IAAmBzB,KAAKyB,UAAL,CAAgBC,gBAAvC,EAAyD;AACrD1B,yBAAKyB,UAAL,CAAgBC,gBAAhB;AACA1B,yBAAKyB,UAAL,CAAgBE,kBAAhB,CAAmC,CAAnC;AACH;AACD;AACAL,qBAAKxB,KAAL;AACAE,qBAAKC,GAAL,CAASC,KAAT,CAAe0B,wBAAf,CAAwC5B,KAAKC,GAAL,CAASC,KAAT,CAAe2B,kBAAf,CAAkC7B,KAAKC,GAAL,CAAS6B,aAAT,CAAuBC,UAAzD,CAAxC;AACH,aATO;AAURC,kBAAM,gBAAY;AACd;AACH;AAZO,SAAZ;AAcAhC,aAAKC,GAAL,CAASC,KAAT,CAAe+B,mBAAf,CAAmCV,KAAnC;AACH,KAvFI;;AAyFL;;;AAGAL,mBAAe,yBAAY;AACvB,YAAII,OAAO,IAAX;AACA,aAAKY,cAAL,GAAsB,KAAKzC,eAAL,CAAqB0C,YAArB,CAAkC,aAAlC,CAAtB;AACA,aAAKD,cAAL,CAAoBE,cAApB,CAAmC,YAAY;AAC3Cd,iBAAKe,UAAL;AACH,SAFD;AAGA,YAAMC,gBAAgBtC,KAAKuC,MAAL,CAAYC,eAAZ,CAA4BC,OAAlD;AACA,YAAIC,SAASC,SAASC,KAAKF,MAAL,KAAgB,GAAzB,CAAb;AACA;AACA,YAAI,CAACJ,cAAc,CAAd,KAAoB,OAApB,IAA+BtC,KAAKC,GAAL,CAAS4C,UAAzC,KAAwD7C,KAAKC,GAAL,CAAS6C,eAArE,EAAsF;AAClF,iBAAKZ,cAAL,CAAoBa,cAApB,CAAmC/C,KAAKC,GAAL,CAAS+C,SAAT,CAAmBC,WAAnB,CAA+BC,2BAAlE;AACA,gBAAIR,UAAUJ,cAAc,CAAd,CAAV,IAA8BtC,KAAKC,GAAL,CAAS4C,UAA3C,EAAuD;AACnD,qBAAKX,cAAL,CAAoBiB,iBAApB,CAAsC,CAAtC;AACH,aAFD,MAEO;AACH,qBAAKjB,cAAL,CAAoBa,cAApB,CAAmC/C,KAAKC,GAAL,CAAS+C,SAAT,CAAmBC,WAAnB,CAA+BG,qBAAlE;AACA,qBAAKlB,cAAL,CAAoBiB,iBAApB,CAAsC,CAAtC;AACH;AACJ,SARD,MAQO,IAAIb,cAAc,CAAd,KAAoB,OAApB,IAA+B,CAACtC,KAAKC,GAAL,CAAS6C,eAA7C,EAA8D;AACjE,iBAAKZ,cAAL,CAAoBa,cAApB,CAAmC/C,KAAKC,GAAL,CAAS+C,SAAT,CAAmBC,WAAnB,CAA+BG,qBAAlE;AACA,gBAAIV,UAAUJ,cAAc,CAAd,CAAd,EAAgC;AAC5B,qBAAKJ,cAAL,CAAoBiB,iBAApB,CAAsC,CAAtC;AACH,aAFD,MAEO;AACH,qBAAKjB,cAAL,CAAoBa,cAApB,CAAmC/C,KAAKC,GAAL,CAAS+C,SAAT,CAAmBC,WAAnB,CAA+BC,2BAAlE;AACA,qBAAKhB,cAAL,CAAoBiB,iBAApB,CAAsC,CAAtC;AACH;AACJ;;AAED,YAAI,KAAKtC,IAAL,CAAUwC,SAAV,IAAuB,KAA3B,EAAkC;AAC9B,iBAAKnB,cAAL,CAAoBoB,YAApB,CAAiC,IAAjC;AACH,SAFD,MAEO;AACH;AACA;AACA;AACA;AACA;AACA,iBAAKpB,cAAL,CAAoBqB,iBAApB,CAAsC,YAAY;AAC9CjC,qBAAKe,UAAL;AACH,aAFD;AAGA,iBAAKH,cAAL,CAAoBa,cAApB,CAAmC/C,KAAKC,GAAL,CAAS+C,SAAT,CAAmBC,WAAnB,CAA+BG,qBAAlE;AACH;AACJ,KApII;;AAuIL;;;AAGAf,gBAAY,sBAAY;AACpB,YAAI,KAAK3C,SAAT,EAAoB;AAChB;AACH;AACD,aAAKA,SAAL,GAAiB,IAAjB;AACA,YAAI4B,OAAO,IAAX;AACA,YAAIkC,SAAS3E,GAAG4E,OAAH,CAAW,IAAX,EAAiB,CAAjB,EAAoB,CAApB,CAAb;AACA,YAAIC,SAAS7E,GAAG4E,OAAH,CAAW,IAAX,EAAiB,CAAjB,EAAoB,CAApB,CAAb;AACA,YAAItC,OAAOtC,GAAG8E,QAAH,CAAY,YAAY;AAC/BrC,iBAAKpC,aAAL,CAAmBuB,MAAnB,GAA4B,KAA5B;AACA;AACA;AACA;AACA;AACAa,iBAAK5B,SAAL,GAAiB,KAAjB;AACH,SAPU,CAAX;AAQA,YAAIkE,QAAQ/E,GAAG8E,QAAH,CAAY,YAAY;AAChCrC,iBAAKH,IAAL;AACH,SAFW,CAAZ;AAGA,YAAI0C,MAAMhF,GAAGiF,QAAH,CAAYN,MAAZ,EAAoBE,MAApB,EAA4BvC,IAA5B,EAAkCyC,KAAlC,CAAV;AACA,aAAK1E,aAAL,CAAmB6E,SAAnB,CAA6BF,GAA7B;AACH;AA/JI,CAAT","file":"OpenRedPackView.js","sourceRoot":"../../../../../assets/Script/models","sourcesContent":[" cc.Class({\n     extends: cc.Component,\n\n     properties: {\n\n         kaibottomNode: {\n             default: null,\n             type: cc.Node,\n         },\n         bottomNode: {\n             default: null,\n             type: cc.Node,\n         },\n         background: {\n             default: null,\n             type: cc.Sprite,\n         },\n         shareButtonNode: {\n             default: null,\n             type: cc.Node,\n         },\n         isOpening: false,\n         nodeWarn: cc.Node,\n         labelWarn: cc.Label\n     },\n\n     /** \n      * @description \n      */\n     close: function (notneedshow) {\n         tywx.ado.Utils.showWXBanner();\n         this.node.destroy();\n     },\n\n     /**\n      * @description 加载完成后调用\n      */\n     onLoad() {\n         this.background.node.on('touchstart', function (event) {\n             return true;\n         });\n         this.nodeWarn.active = false;\n         //this.nodeWarn.active = tywx.ado.Configs.red_pack_share_warn.is_show;\n         //this.labelWarn.string = tywx.ado.Configs.red_pack_share_warn.content;\n     },\n\n     /** \n      * @description 界面弹出的时候调用\n      */\n     showUI: function () {\n         tywx.ado.Utils.commonScaleIn(this.bottomNode);\n     },\n\n     /**\n      * @description 加载完成后调用\n      * @param {Number} moneyNum 红包金额\n      */\n     setData(data) {\n         this.data = data;\n         console.log(\"当前的设置数据 = \" + JSON.stringify(this.data));\n         //  this.redPackNumberLabel.string = tywx.ado.Utils.formatCashFen2Yuan(this.data.nextAmount) + \" 元\"\n         this.initOpenLogic();\n     },\n\n     /**\n      * @description 点击开红包的时候调用\n      */\n     open: function () {\n         if (!tywx.StateInfo.networkConnected) {\n             return;\n         }\n         var self = this;\n         let param = {\n             success: function () {\n                 if (tywx.gamecenter && tywx.gamecenter.flushMoneyNumber) {\n                     tywx.gamecenter.flushMoneyNumber();\n                     tywx.gamecenter.flushRedPacketBtns(0);\n                 }\n                 //tywx.ado.Utils.showWXToast(\"领取红包成功\");\n                 self.close();\n                 tywx.ado.Utils.showRedPacketTransferPop(tywx.ado.Utils.formatCashFen2Yuan(tywx.ado.RedPacketInfo.nextAmount));\n             },\n             fail: function () {\n                 //  self.close();\n             }\n         }\n         tywx.ado.Utils.requestAddRedPacket(param);\n     },\n\n     /** \n      * @description 初始化开红包逻辑\n      */\n     initOpenLogic: function () {\n         var self = this;\n         this.openRedPackBtn = this.shareButtonNode.getComponent(\"ShareButton\");\n         this.openRedPackBtn.setSuccessCall(function () {\n             self.playRotate();\n         });\n         const share_control = tywx.config.share_control_2.redpack;\n         var random = parseInt(Math.random() * 100);\n         // 处理配置控制信息\n         if ((share_control[0] == \"video\" || tywx.ado.isMinGanIP) && tywx.ado.isCanWatchVideo) {\n             this.openRedPackBtn.setShareConfig(tywx.ado.Constants.ShareConfig.OPEN_RED_PACKET_SHARE_VIDEO);\n             if (random <= share_control[1] || tywx.ado.isMinGanIP) {\n                 this.openRedPackBtn.setButtonCallType(2);\n             } else {\n                 this.openRedPackBtn.setShareConfig(tywx.ado.Constants.ShareConfig.OPEN_RED_PACKET_SHARE);\n                 this.openRedPackBtn.setButtonCallType(1);\n             }\n         } else if (share_control[0] == \"share\" || !tywx.ado.isCanWatchVideo) {\n             this.openRedPackBtn.setShareConfig(tywx.ado.Constants.ShareConfig.OPEN_RED_PACKET_SHARE);\n             if (random <= share_control[1]) {\n                 this.openRedPackBtn.setButtonCallType(1);\n             } else {\n                 this.openRedPackBtn.setShareConfig(tywx.ado.Constants.ShareConfig.OPEN_RED_PACKET_SHARE_VIDEO);\n                 this.openRedPackBtn.setButtonCallType(2);\n             }\n         }\n\n         if (this.data.needShare == false) {\n             this.openRedPackBtn.setReactCall(true);\n         } else {\n             //  if (tywx.config.auditing == true) {\n             //     this.openRedPackBtn.setReactCall(true);\n             //  } else {\n             //     this.openRedPackBtn.setReactCall(false);\n             //  }\n             this.openRedPackBtn.setShareGroupCall(function () {\n                 self.playRotate();\n             });\n             this.openRedPackBtn.setShareConfig(tywx.ado.Constants.ShareConfig.OPEN_RED_PACKET_SHARE);\n         }\n     },\n\n\n     /** \n      * @description 播放旋转动画\n      */\n     playRotate: function () {\n         if (this.isOpening) {\n             return;\n         }\n         this.isOpening = true;\n         var self = this;\n         let scale1 = cc.scaleTo(0.25, 0, 1);\n         let scale2 = cc.scaleTo(0.25, 1, 1);\n         var open = cc.callFunc(function () {\n             self.kaibottomNode.active = false;\n             //  self.redPackNumberLabel.node.active = true;\n             //  let scale3 = cc.scaleTo(0.2, 0.8);\n             //  let scale4 = cc.scaleTo(0.2, 1);\n             //  self.redPackNumberLabel.node.runAction(cc.sequence(scale3, scale4));\n             self.isOpening = false;\n         })\n         var tcall = cc.callFunc(function () {\n             self.open();\n         });\n         var seq = cc.sequence(scale1, scale2, open, tcall);\n         this.kaibottomNode.runAction(seq);\n     },\n });"]}