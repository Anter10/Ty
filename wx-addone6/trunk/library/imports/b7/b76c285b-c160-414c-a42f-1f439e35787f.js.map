{"version":3,"sources":["../../../../../assets/Script/models/assets/Script/models/ado_view_invite_gift.js"],"names":["cc","Class","extends","Component","properties","onLoad","initRoot","director","getScene","_name","tywx","ado","Utils","hideGameClub","an","AdManager","getAdNodeByTag","hideAdNode","hideWXBanner","onDestroy","showGameClub","showAdNode","showWXBanner","start","root","commonScaleIn","btnInviteClick","console","log","shareConfig","Constants","ShareConfig","INVITE_FIREND_SHARE","msg","getRandomShareConfigByShareTag","DefaultShareConfig","ShareInterface","share","shareContent","sharePicUrl","sharePointId","shareSchemeId","res","JSON","stringify","data","motai","wx","postMessage","method","node","destroy","btnCloseClick","btnGetRewardClick","info","reward","showWXModal","requestInviteReward","init","InviteInfo","wait_time","i","tmp_item_name","tmp_item","getChildByName","is_invited","invite_users","node_head","btn_invite","btn_invite2","node_nick_name","invite_mask","active","usr_info","sp_head","getComponent","Sprite","tmp_texture","Texture2D","btn_invite_com","Button","interactable","setTimeout","window","sharedCanvas","width","height","openId","wxOpenId","openDataContext","getOpenDataContext","canvas","initWithElement","handleLoadedTexture","spriteFrame","SpriteFrame"],"mappings":"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","file":"ado_view_invite_gift.js","sourceRoot":"../../../../../assets/Script/models","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.initRoot();\n        if(cc.director.getScene()._name === 'gamestart'){\n            tywx.ado.Utils.hideGameClub();\n            let an = tywx.AdManager.getAdNodeByTag('GAME_START');\n            if(an) an.hideAdNode();\n        } else if (cc.director.getScene()._name === 'gamemain') {\n            tywx.ado.Utils.hideWXBanner();\n        }\n    },\n    onDestroy(){\n        if(cc.director.getScene()._name === 'gamestart'){\n            tywx.ado.Utils.showGameClub();\n            let an = tywx.AdManager.getAdNodeByTag('GAME_START');\n            if(an) an.showAdNode();\n            tywx.ado.Utils.hideWXBanner();\n        } else if (cc.director.getScene()._name === 'gamemain') {\n            tywx.ado.Utils.showWXBanner();\n        }\n    },\n\n    start () {\n        if(this.root){\n            tywx.ado.Utils.commonScaleIn(this.root);\n        }\n    },\n\n    //update (dt) {},\n    btnInviteClick(){\n        console.log('btnInviteClick');\n        let shareConfig = tywx.ado.Constants.ShareConfig.INVITE_FIREND_SHARE;\n        let msg = tywx.ado.Utils.getRandomShareConfigByShareTag(shareConfig[0]);\n        if(!msg){\n           msg = tywx.ado.Constants.DefaultShareConfig;\n        }\n        if(msg){\n            tywx.ShareInterface.share(\n                msg.shareContent,\n                msg.sharePicUrl,\n                msg.sharePointId,\n                msg.shareSchemeId,\n                (res) => {\n                    console.log(\"分享成功后的数据\"+JSON.stringify(res));\n                },\n                function(data){\n                    console.log(\"分享成功后的数2据\"+JSON.stringify(data));\n                }\n            );\n        }  \n    },\n    motai(){\n         wx.postMessage({\n             method: 9,\n         });\n        this.node.destroy();\n    },\n    btnCloseClick(){\n         wx.postMessage({\n             method: 9,\n         });\n        this.node.destroy();\n    },\n    btnGetRewardClick(){\n        console.log('btnGetRewardClick');\n        if(this.info.reward){\n            tywx.ado.Utils.showWXModal(\n                '已经领取过奖励',\n                '提示',\n                false);\n        }\n        else{\n            tywx.ado.Utils.requestInviteReward();\n        }\n    },\n    init(){\n        this.initRoot();\n        let info = tywx.ado.InviteInfo;\n        this.info = info;\n        let wait_time = 1000;\n        for(let i = 0; i < 5; ++i){\n            let tmp_item_name = `node_invite_${i}`;\n            let tmp_item = this.root.getChildByName(tmp_item_name);\n            let is_invited = info.invite_users[i] ? true : false;\n            //is_invited = true;\n            if(tmp_item){\n                let node_head = tmp_item.getChildByName('head_icon');\n                let btn_invite = tmp_item.getChildByName('btn_invite');\n                let btn_invite2 = tmp_item.getChildByName('head_bg');\n                let node_nick_name = tmp_item.getChildByName('nick_name');\n                let invite_mask = tmp_item.getChildByName('invite_mask');\n                //let label_nick_name = node_nick_name.getComponent(cc.Label);\n                if(!is_invited){\n                    node_nick_name.active = false;\n                }\n                else{\n                    let usr_info = info.invite_users[i];\n                    let sp_head = node_head.getComponent(cc.Sprite);\n                    let tmp_texture = new cc.Texture2D();\n                    btn_invite.active = false;\n                    btn_invite2.active = false;\n                    let btn_invite_com = btn_invite2.getComponent(cc.Button);\n                    invite_mask.active = true;\n                    if(btn_invite_com){\n                        btn_invite_com.interactable = false;\n                    }\n                    setTimeout(()=>{\n                        window.sharedCanvas.width = 160;\n                        window.sharedCanvas.height = 200;\n                        wx.postMessage({\n                            method: 'render_invite_usr_info',\n                            openId: usr_info.wxOpenId\n                        });\n                    },i * wait_time);\n                    setTimeout(()=>{\n                        var openDataContext = wx.getOpenDataContext();\n                        var sharedCanvas = openDataContext.canvas;\n                        tmp_texture.initWithElement(sharedCanvas);\n                        tmp_texture.handleLoadedTexture();\n                        sp_head.spriteFrame = new cc.SpriteFrame(tmp_texture);\n                        invite_mask.active = false;\n                    },i * wait_time + 800);\n                }\n            }\n        }\n    },\n    initRoot(){\n        if(!this.root) this.root = this.node.getChildByName('root');\n    },\n});\n"]}