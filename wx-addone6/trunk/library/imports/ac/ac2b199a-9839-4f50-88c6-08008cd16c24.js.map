{"version":3,"sources":["../../../../../assets/Script/models/assets/Script/models/LuckBox.js"],"names":["cc","Class","extends","Component","properties","luckboard","default","type","Node","luckitem","Prefab","luckitems","allframe","SpriteFrame","mflqBtn","hideLabel","Label","showLabel","needHelpNode","close","tywx","ado","Utils","showWXBanner","node","active","lqCall","toggleChecked","toggle","isChecked","string","getComponent","setShareConfig","Constants","ShareConfig","GIFT_GIFT_BOX_SHARE_VIDEO","setButtonCallType","GIFT_GIFT_SHARE_BOX_SHARE","isMinGanIP","onLoad","allitem","GameCenterConfig","items","ti","length","item","instantiate","itemsceipt","setParent","setItem","selectitem","parent","push","allluckitems","row","column","bottom","padingleft","margin","width","self","mflq","config","auditing","setReactCall","setSuccessCall","gamecenter","giveItems","produceItem","ryBoxBtn","sharedelaytime","Date","getTime","setShareGroupCall","init","select","unselected","share_control","share_control_2","ruyibox","random","parseInt","Math","isCanWatchVideo","videoGet","shareGet","getChildByName","check","uncheck","hideOtherSelected","selectItem","itemindex","tdata","getData","id","itemIndex","data","isSelected","produceitem","name","num"],"mappings":"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","file":"LuckBox.js","sourceRoot":"../../../../../assets/Script/models","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        luckboard: {\n            default: null,\n            type: cc.Node,\n        },\n        luckitem: {\n            default: null,\n            type: cc.Prefab,\n        },\n        luckitems: {\n            default: [],\n            type: cc.Node,\n        },\n        allframe: {\n            default: [],\n            type: cc.SpriteFrame,\n        },\n        mflqBtn: {\n            default: null,\n            type: cc.Node,\n        },\n        hideLabel: {\n            default: null,\n            type: cc.Label,\n        },\n        showLabel: {\n            default: null,\n            type: cc.Label,\n        },\n        needHelpNode: {\n            default: null,\n            type: cc.Node,\n        }\n\n    },\n\n\n    close: function () {\n        // this.luckitems[0].getComponent(\"luckitem\").selected();\n        tywx.ado.Utils.showWXBanner();\n        this.node.active = false;\n    },\n\n    lqCall: function () {\n\n    },\n\n    /**\n     * @description 复选框点击回调\n     * @param {Object} toggle 复选框本身\n     */\n    toggleChecked: function (toggle) {\n        if (!toggle.isChecked) {\n            this.hideLabel.string = \"视频领取\";\n            this.showLabel.string = \"视频领取\";\n            this.mflqBtn.getComponent(\"ShareButton\").setShareConfig(tywx.ado.Constants.ShareConfig.GIFT_GIFT_BOX_SHARE_VIDEO);\n            this.mflqBtn.getComponent(\"ShareButton\").setButtonCallType(2);\n        } else {\n            this.hideLabel.string = \"免费领取\";\n            this.showLabel.string = \"免费领取\";\n            this.mflqBtn.getComponent(\"ShareButton\").setShareConfig(tywx.ado.Constants.ShareConfig.GIFT_GIFT_SHARE_BOX_SHARE);\n            this.mflqBtn.getComponent(\"ShareButton\").setButtonCallType(1);\n        }\n        if (tywx.ado.isMinGanIP) {\n            this.mflqBtn.getComponent(\"ShareButton\").setShareConfig(tywx.ado.Constants.ShareConfig.GIFT_GIFT_BOX_SHARE_VIDEO);\n            this.mflqBtn.getComponent(\"ShareButton\").setButtonCallType(2);\n        }\n    },\n\n    onLoad() {\n        // 显示当前的所有道具\n        var allitem = tywx.ado.Constants.GameCenterConfig.allitem;\n        var items = [];\n        for (var ti = 0; ti < allitem.length; ti++) {\n            var item = cc.instantiate(this.luckitem);\n            let itemsceipt = item.getComponent(\"luckitem\");\n            itemsceipt.setParent(this);\n            itemsceipt.setItem(allitem[ti], this.allframe[ti]);\n            if (ti == 0) {\n                this.selectitem = itemsceipt;\n            }\n            item.parent = this.luckitems[ti];\n            // if (ti < allitem.length - 1){\n            //     itemsceipt.select();\n            // }\n            items.push(item);\n        }\n\n        this.allluckitems = items;\n\n        var [row, column, bottom, padingleft, margin, width] = [0, 0, 120, 60, 80, 162];\n\n        // this.selectitem.select();\n\n        var self = this;\n        // 设置免费领取的回调\n        let mflq = this.mflqBtn.getComponent(\"ShareButton\");\n        if (tywx.config.auditing == true) {\n            mflq.setReactCall(true);\n        } else {\n            mflq.setReactCall(false);\n        }\n        mflq.setSuccessCall(function () {\n            tywx.gamecenter.giveItems(false, self.produceItem());\n            tywx.gamecenter.ryBoxBtn.active = false;\n            tywx.gamecenter.sharedelaytime = (new Date()).getTime();\n\n            self.close();\n        });\n        mflq.setShareGroupCall(function () {\n            tywx.gamecenter.giveItems(false, self.produceItem());\n            tywx.gamecenter.ryBoxBtn.active = false;\n            tywx.gamecenter.sharedelaytime = (new Date()).getTime();\n\n            self.close();\n        });\n        this.init();\n    },\n\n    /** \n     * @description 初始化\n     */\n    init: function () {\n        for (var ti = 0; ti < this.allluckitems.length; ti++) {\n            let itemsceipt = this.allluckitems[ti].getComponent(\"luckitem\");\n            if (ti < (this.allluckitems.length - 1)) {\n                itemsceipt.select();\n            } else {\n                itemsceipt.unselected();\n            }\n        }\n        const share_control = tywx.config.share_control_2.ruyibox;\n        var random = parseInt(Math.random() * 100);\n        \n        if ((share_control[0] == \"video\" || tywx.ado.isMinGanIP) && tywx.ado.isCanWatchVideo) {\n            if (random <= share_control[1] || tywx.ado.isMinGanIP) {\n                this.videoGet();\n            } else {\n                this.shareGet();\n            }\n        } else if (share_control[0] == \"share\" || !tywx.ado.isCanWatchVideo) {\n            if (random <= share_control[1]) {\n                 this.shareGet();\n            } else {\n                 this.videoGet();\n            }\n        }\n\n        if (tywx.ado.isMinGanIP || !tywx.ado.isCanWatchVideo) {\n            this.needHelpNode.active = false;\n        } else {\n            this.needHelpNode.active = true;\n        }\n    },\n\n    shareGet: function () {\n        this.hideLabel.string = \"免费领取\";\n        this.showLabel.string = \"免费领取\";\n        this.node.getChildByName(\"luckboxroot\").getChildByName(\"checkbox\").getComponent(\"cc.Toggle\").check();\n        this.mflqBtn.getComponent(\"ShareButton\").setShareConfig(tywx.ado.Constants.ShareConfig.GIFT_GIFT_SHARE_BOX_SHARE);\n        this.mflqBtn.getComponent(\"ShareButton\").setButtonCallType(1);\n    },\n\n    videoGet: function () {\n        this.hideLabel.string = \"视频领取\";\n        this.showLabel.string = \"视频领取\";\n        this.node.getChildByName(\"luckboxroot\").getChildByName(\"checkbox\").getComponent(\"cc.Toggle\").uncheck();\n        this.mflqBtn.getComponent(\"ShareButton\").setShareConfig(tywx.ado.Constants.ShareConfig.GIFT_GIFT_BOX_SHARE_VIDEO);\n        this.mflqBtn.getComponent(\"ShareButton\").setButtonCallType(2);\n    },\n    /**\n     * @description 点击道具回调\n     */\n    hideOtherSelected: function (selectItem) {\n        for (var itemindex = 0; itemindex < this.allluckitems.length; itemindex++) {\n            var item = this.allluckitems[itemindex];\n            let itemsceipt = item.getComponent(\"luckitem\");\n            var tdata = itemsceipt.getData();\n            // console.log(\"tdata = \"+JSON.stringify(tdata));\n            if (tdata != \"undefined\" && tdata.id != selectItem.getData().id) {\n                itemsceipt.select();\n            }\n        }\n        selectItem.unselected();\n        this.selectitem = selectItem;\n    },\n\n    /** \n     * @description 成功后所给道具逻辑\n     */\n    produceItem: function () {\n        var allitem = [];\n        for (var itemIndex = 0; itemIndex < this.allluckitems.length; itemIndex++) {\n            var item = this.allluckitems[itemIndex];\n            let itemsceipt = item.getComponent(\"luckitem\");\n            var data = itemsceipt.getData();\n            if (itemsceipt.isSelected()) {\n                var produceitem = {};\n                produceitem.id = data.id;\n                produceitem.name = data.name;\n                produceitem.num = 1;\n                allitem.push(produceitem);\n            }\n        }\n        return allitem;\n    }\n\n});"]}