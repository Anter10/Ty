{"version":3,"sources":["../../../../../assets/Script/models/assets/Script/models/ShareButton.js"],"names":["cc","Class","extends","Component","properties","callButton","default","type","Button","onLoad","data","console","log","button","start","setShareData","setShareConfig","config","shareConfig","setSuccessCall","successCall","successCallBack","setButtonCallType","calltype","node","on","callBack","tywx","ado","isMinGanIP","showWXVideo","shareMiniApp","setReactCall","reactcall","setErrorCall","errorCall","errorCallBack","setShareGroupCall","sgroupCall","shareGroupCallBack","self","hadclicknumber","IsWechatPlatform","param","success","res","fail","Utils","showWXModal","error_callback","Constants","ShareConfig","GIFT_GIFT_BOX_SHARE_VIDEO","RECOVER_GAME_SHARE_VIDEO","content","RECOVER_GAME_SHARE","end_str","showErrorGfitPop","OPEN_RED_PACKET_SHARE_VIDEO","FREE_DOUBLE_SCORE_SHARE_VIDEO","FREE_GIFT_SHARE_VIDEO","window","wx","showShareMenu","withShareTicket","msg","getRandomShareConfigByShareTag","shareContent","sharePicUrl","sharePointId","shareSchemeId","ShareInterface","share","LOGE","JSON","stringify","shareTickets","undefined","length","RANK_SHARE","share2GroupByTicket"],"mappings":"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","file":"ShareButton.js","sourceRoot":"../../../../../assets/Script/models","sourcesContent":[" /*\n    游戏分享prefab\n    游戏的分享操作的主要逻辑在这个module里面编写\n    created by gyc on 2018-08-08.\n*/\n cc.Class({\n     extends: cc.Component,\n\n     properties: {\n         callButton: {\n             default: null,\n             type: cc.Button,\n         }\n     },\n\n     /*\n        调用: 场景加载完成后的回调\n        功能: 场景加载完成后的一些UI逻辑处理\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 系统自带\n    */\n     onLoad() {\n         this.data = {};\n\n         console.log(\"this.button\" + this.button);\n     },\n     /*\n         调用: 组件开始调用的时候调用\n         功能: 组件开始调用的时候的逻辑处理\n         参数: [\n             无\n         ]\n         返回值:[\n             无\n         ]\n         思路: 系统自带\n     */\n     start() {\n\n     },\n\n     /*\n         调用: 使用此model分享功能的时候 手动调用刷新分享的数据\n         功能: 设置即将要分享的数据\n         参数: [\n             data: 分享的数据\n         ]\n         返回值:[\n             无\n         ]\n         思路: 系统自带\n     */\n     setShareData: function (data) {\n         this.data = data;\n     },\n     /**\n      * @description 设置分享配置\n      * @author lu ning\n      * @date 2018-08-23\n      * @param {Array<any>} config config[0]=tag;config[1]=是否强制分享到群,boolean\n      */\n     setShareConfig(config) {\n         this.shareConfig = config;\n     },\n\n     /*\n        调用: 使用此model分享功能的时候 \n        功能: 手动设置分享成功后的回调函数\n        参数: [\n            successCall: 分享成功后的回调方法 类型Function\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n     setSuccessCall: function (successCall) {\n         this.successCallBack = successCall;\n     },\n\n     /** \n      * @description 切换按钮的调用类型 \n      * @param {Number} calltype  1 分享 2 视频\n      */\n     setButtonCallType: function (calltype) {\n         if (!this.calltype) {\n             this.callButton.node.on('click', this.callBack, this);\n         }\n         this.calltype = calltype;\n     },\n\n     callBack: function () {\n         if (tywx.ado.isMinGanIP || this.calltype == 2) {\n            this.showWXVideo();\n         }else if (this.calltype == 1) {\n             this.shareMiniApp();\n         } \n     },\n\n\n\n\n     /*\n         调用: 使用此model分享功能的时候 \n         功能: 手动设置分享成功后的回调函数\n         参数: [\n             successCall: 分享成功后的回调方法 类型Function\n         ]\n         返回值:[\n             无\n         ]\n         思路: 逻辑需要\n     */\n     setReactCall: function (reactcall) {\n         this.reactcall = reactcall;\n     },\n\n     /*\n        调用: 使用此model分享功能的时候 \n        功能: 手动设置分享失败后的回调函数\n        参数: [\n            errorCall: 分享失败后的回调方法 类型Function\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n     setErrorCall: function (errorCall) {\n         this.errorCallBack = errorCall;\n     },\n\n     /*\n         调用: 使用此model分享功能的时候 \n         功能: 手动设置分享失败后的回调函数\n         参数: [\n             errorCall: 分享失败后的回调方法 类型Function\n         ]\n         返回值:[\n             无\n         ]\n         思路: 逻辑需要\n     */\n     setShareGroupCall: function (sgroupCall) {\n         this.shareGroupCallBack = sgroupCall;\n     },\n\n\n     /**\n      * @description 播放微信视频广告\n      */\n     showWXVideo: function () {\n         var self = this;\n         if (!this.hadclicknumber || this.hadclicknumber == 0) {\n             this.hadclicknumber = 1;\n         } else {\n             return;\n         }\n        \n         if (this.reactcall) {\n             self.hadclicknumber = 0;\n             self.successCallBack(this);\n         } else {\n             if (tywx.IsWechatPlatform()) {\n\n                 var param = {\n                     success: function (res) {\n                         self.hadclicknumber = 0;\n                         self.shareGroupCallBack && self.shareGroupCallBack(res);\n                     },\n                     fail: function (res) {\n                         self.hadclicknumber = 0;\n                         tywx.ado.Utils.showWXModal('观看视频失败');\n                         self.errorCallBack && self.errorCallBack(null);\n                     },\n                     error_callback: () => {\n                         self.hadclicknumber = 0;\n                         if (self.shareConfig === tywx.ado.Constants.ShareConfig.GIFT_GIFT_BOX_SHARE_VIDEO ||\n                             self.shareConfig === tywx.ado.Constants.ShareConfig.RECOVER_GAME_SHARE_VIDEO) {\n                             let content =\n                                 self.shareConfig === tywx.ado.Constants.ShareConfig.RECOVER_GAME_SHARE ?\n                                 '免费复活机会' : '如意宝箱';\n                             let end_str = self.shareConfig === tywx.ado.Constants.ShareConfig.RECOVER_GAME_SHARE ?\n                                 '一次' : '一个';\n                             content = `<color=#ffffff>赠送</c><color=#ff0000>${content}</color><color=#ffffff>${end_str}</c>`;\n                             tywx.ado.Utils.showErrorGfitPop(() => {\n                                 self.shareGroupCallBack && self.shareGroupCallBack(null);\n                             }, content);\n                         } else if (self.shareConfig === tywx.ado.Constants.ShareConfig.OPEN_RED_PACKET_SHARE_VIDEO ||\n                             self.shareConfig === tywx.ado.Constants.ShareConfig.FREE_DOUBLE_SCORE_SHARE_VIDEO) {\n                             let content =\n                                 self.shareConfig === tywx.ado.Constants.ShareConfig.OPEN_RED_PACKET_SHARE_VIDEO ?\n                                 '免费红包' : '免费双倍加分';\n                             let end_str = self.shareConfig === tywx.ado.Constants.ShareConfig.FREE_DOUBLE_SCORE_SHARE_VIDEO ?\n                                 '一个' : '一次';\n                             content = `<color=#ffffff>赠送</c><color=#ff0000>${content}</color><color=#ffffff>${end_str}</c>`;\n                             tywx.ado.Utils.showErrorGfitPop(() => {\n                                 self.shareGroupCallBack && self.shareGroupCallBack(null);\n                             }, content);\n                         } else if (self.shareConfig === tywx.ado.Constants.ShareConfig.FREE_GIFT_SHARE_VIDEO) {\n                             let content = '免费道具';\n                             let end_str = \"一个\";\n                             content = `<color=#ffffff>赠送</c><color=#ff0000>${content}</color><color=#ffffff>${end_str}</c>`;\n                             tywx.ado.Utils.showErrorGfitPop(() => {\n                                 self.shareGroupCallBack && self.shareGroupCallBack(null);\n                             }, content);\n                         }\n\n\n                     }\n                 }\n                 tywx.ado.Utils.showWXVideo(param);\n             }\n         }\n     },\n\n\n     /*\n         调用: 使用此model分享功能的时候 \n         功能: 给好友或者群分享小程序的相关信息\n         参数: [\n             无\n         ]\n         返回值:[\n             无\n         ]\n         思路: 逻辑需要\n     */\n     shareMiniApp: function () {\n         var self = this;\n         console.log(\"当前分享\" + this.reactcall);\n         if (this.reactcall) {\n             self.successCallBack(this);\n         } else {\n             if (tywx.IsWechatPlatform()) {\n                 window.wx.showShareMenu({\n                     withShareTicket: true\n                 });\n                 let msg = tywx.ado.Utils.getRandomShareConfigByShareTag(this.shareConfig[0]);\n                 if (!msg) {\n                     msg = {};\n                     msg.shareContent = \"你知道\" + \"+1 吗？\";\n                     msg.sharePicUrl = \"https://elsfkws.nalrer.cn/teris/share_image/jiayi/jy03.jpg\";\n                     msg.sharePointId = \"766\";\n                     msg.shareSchemeId = \"1155\";\n                 }\n                 if (msg) {\n                     tywx.ShareInterface.share(\n                         msg.shareContent,\n                         msg.sharePicUrl,\n                         msg.sharePointId,\n                         msg.shareSchemeId,\n                         (res) => {\n                             tywx.LOGE(\"分享成功后的数据\" + JSON.stringify(res));\n                             // * is share to group\n                             if (self.shareConfig && self.shareConfig[1]) {\n                                 // * froce share to group\n                                 if (res.shareTickets !== undefined && res.shareTickets.length > 0) {\n                                     if (self.shareConfig[0] === tywx.ado.Constants.ShareConfig.RANK_SHARE[0]) {\n                                         self.shareGroupCallBack && self.shareGroupCallBack(res);\n                                     } else {\n                                         tywx.ado.Utils.share2GroupByTicket(\n                                             self.shareConfig[0],\n                                             res,\n                                             () => { // * success callback\n                                                 self.shareGroupCallBack && self.shareGroupCallBack(res);\n                                             },\n                                             () => { // * failed callback\n                                                 tywx.ado.Utils.showWXModal('请分享到不同群');\n                                                 self.errorCallBack && self.errorCallBack(null);\n                                             }\n                                         );\n                                     }\n                                 } else {\n                                     // * failed\n                                     tywx.ado.Utils.showWXModal('请分享到群');\n                                     self.errorCallBack && self.errorCallBack(null);\n                                 }\n                             } else {\n                                 // * success\n                                 self.successCallBack && self.successCallBack(res);\n                             }\n\n                         },\n                         function (data) {\n                             tywx.LOGE(\"分享成功后的数2据\" + JSON.stringify(data));\n                             self.errorCallBack && self.errorCallBack(data);\n                         }\n                     );\n                 }\n             }\n         }\n     }\n     // update (dt) {},\n });\n"]}