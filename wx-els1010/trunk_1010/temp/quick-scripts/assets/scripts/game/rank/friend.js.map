{"version":3,"sources":["friend.js"],"names":["friend_path","self","friend","cc","Class","extends","Component","properties","friendIcon","Sprite","onLoad","tex","Texture2D","window","sharedCanvas","width","height","totaltime","updatetime","score","setStop","stop","tywx","tt","Utils","sendWXMsg","method","updateFriendCanvas","wx","openDataContext","getOpenDataContext","canvas","initWithElement","handleLoadedTexture","spriteFrame","SpriteFrame","node","active","isrestart","setScoreFlush","start","update","dt","statics","iconnode","iconscript","addIcon","pos","loader","loadRes","err","prefab","ranknode","instantiate","friend_script","getComponent","addChild","setScore","module","exports"],"mappings":"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","file":"friend.js","sourceRoot":"../../../../../../assets/scripts/game/rank","sourcesContent":[" let friend_path = \"prefabs/friend\"; \n var self = null;\n const friend = cc.Class({\n     extends: cc.Component,\n\n     properties: {\n         friendIcon: cc.Sprite,\n     },\n\n     // LIFE-CYCLE CALLBACKS:\n     \n     onLoad() {\n         \n         this.tex = new cc.Texture2D();\n         window.sharedCanvas.width = 211;\n         window.sharedCanvas.height = 98;\n         this.totaltime = 5;\n         this.updatetime = this.totaltime;\n         this.score = 0;\n         self = this;\n     },\n     \n\n     /**\n      * @设置是否停止刷新好友的数据\n      * @param {Boolean} stop 停止刷新的标示\n      */\n     setStop:function(stop){\n         this.stop = stop;\n         if(!stop){\n              tywx.tt.Utils.sendWXMsg({\n                  method: 9,\n              });\n              window.sharedCanvas.width = 211;\n              window.sharedCanvas.height = 98;\n         }\n     },\n\n     /**\n      * @description: 刷新子域即将超越的玩家Canvas\n      */\n     updateFriendCanvas: function () {\n         //return;\n         if (!this.tex || !window.wx) {\n             return;\n         }\n         var openDataContext = wx.getOpenDataContext();\n         var sharedCanvas = openDataContext.canvas;\n         this.tex.initWithElement(sharedCanvas);\n         this.tex.handleLoadedTexture();\n         this.friendIcon.spriteFrame = new cc.SpriteFrame(this.tex);\n         this.friendIcon.node.active = true;\n         tywx.tt.Utils.sendWXMsg({\n             method: 5,\n             isrestart: true,\n             score: this.score,\n         });\n     },\n\n     /**\n      * 设置当前玩家的分数 \n      * @param {Number} score 设置当前玩家的分数刷新当前显示的好友分数\n      */\n     setScoreFlush: function (score) {\n         this.score = score || 0;\n         this.updateFriendCanvas();\n     },\n\n\n     start() {\n\n     },\n\n     update(dt) {\n         if (this.stop){\n             return;\n         }\n         this.updatetime = this.updatetime - dt;\n         if (this.updatetime < 0) {\n             this.updatetime = this.totaltime;\n             tywx.tt.Utils.sendWXMsg({\n                 method: 5,\n                 isrestart: true,\n                 score: this.score,\n             });\n         }\n         if(this.updatetime > this.totaltime - 1){\n            this.updateFriendCanvas();\n         }\n     },\n\n     statics: {\n         iconnode: null,\n         iconscript: null,\n         addIcon: function (node, score, pos) {\n             cc.loader.loadRes(friend_path, (err, prefab) => {\n                 if (!err) {\n                     let ranknode = cc.instantiate(prefab);\n                     let friend_script = ranknode.getComponent('friend');\n                     friend_script.setScoreFlush(friend_script);\n                     friend.iconscript = friend_script;\n                     friend.iconnode = ranknode;\n                     node.addChild(ranknode);\n                 }\n             });\n         },\n         setScore: function (score) {\n             if (friend.iconscript) {\n                 friend.iconscript.setScoreFlush(score);\n             }\n         },\n         setStop: function (stop) {\n             if (friend.iconscript) {\n                 friend.iconscript.setStop(stop);\n             }\n         },\n\n     }\n });\n\n module.exports = friend;"]}