{"version":3,"sources":["ShareButton.js"],"names":["cc","Class","extends","Component","properties","callButton","default","type","Button","onLoad","data","tywx","tt","log","button","start","setShareData","setShareConfig","config","shareConfig","setSuccessCall","successCall","successCallBack","setButtonCallType","calltype","node","on","callBack","isMinGanIP","isCanWatchVideo","showWXVideo","shareMiniApp","setReactCall","reactcall","setErrorCall","errorCall","errorCallBack","setShareGroupCall","sgroupCall","shareGroupCallBack","self","hadclicknumber","IsWechatPlatform","param","success","res","fail","Utils","showWXModal","error_callback","constants","ShareConfig","GIFT_GIFT_BOX_SHARE_VIDEO","RECOVER_GAME_SHARE_VIDEO","content","RECOVER_GAME_SHARE","end_str","showErrorGfitPop","OPEN_RED_PACKET_SHARE_VIDEO","FREE_DOUBLE_SCORE_SHARE_VIDEO","FREE_GIFT_SHARE_VIDEO","window","wx","showShareMenu","withShareTicket","msg","getRandomShareConfigByShareTag","DefaultShareConfig","ShareInterface","share","shareContent","sharePicUrl","sharePointId","shareSchemeId","LOGE","JSON","stringify","shareTickets","undefined","length","RANK_SHARE","share2GroupByTicket"],"mappings":"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","file":"ShareButton.js","sourceRoot":"../../../../../../assets/scripts/game/model","sourcesContent":[" /*\n    游戏分享prefab\n    游戏的分享操作的主要逻辑在这个module里面编写\n    created by gyc on 2018-08-08.\n*/\n cc.Class({\n     extends: cc.Component,\n\n     properties: {\n         callButton: {\n             default: null,\n             type: cc.Button,\n         }\n     },\n\n     /*\n        调用: 场景加载完成后的回调\n        功能: 场景加载完成后的一些UI逻辑处理\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 系统自带\n    */\n     onLoad() {\n         this.data = {};\n\n         tywx.tt.log(\"this.button\" + this.button);\n     },\n     /*\n         调用: 组件开始调用的时候调用\n         功能: 组件开始调用的时候的逻辑处理\n         参数: [\n             无\n         ]\n         返回值:[\n             无\n         ]\n         思路: 系统自带\n     */\n     start() {\n\n     },\n\n     /*\n         调用: 使用此model分享功能的时候 手动调用刷新分享的数据\n         功能: 设置即将要分享的数据\n         参数: [\n             data: 分享的数据\n         ]\n         返回值:[\n             无\n         ]\n         思路: 系统自带\n     */\n     setShareData: function (data) {\n         this.data = data;\n     },\n     /**\n      * @description 设置分享配置\n      * @author lu ning\n      * @date 2018-08-23\n      * @param {Array<any>} config config[0]=tag;config[1]=是否强制分享到群,boolean\n      */\n     setShareConfig(config) {\n         this.shareConfig = config;\n     },\n\n     /*\n        调用: 使用此model分享功能的时候 \n        功能: 手动设置分享成功后的回调函数\n        参数: [\n            successCall: 分享成功后的回调方法 类型Function\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n     setSuccessCall: function (successCall) {\n         this.successCallBack = successCall;\n     },\n\n     /** \n      * @description 切换按钮的调用类型 \n      * @param {Number} calltype  1 分享 2 视频\n      */\n     setButtonCallType: function (calltype) {\n         if (!this.calltype) {\n             this.callButton.node.on('click', this.callBack, this);\n         }\n         this.calltype = calltype;\n     },\n\n     callBack: function () {\n         if ((tywx.tt.isMinGanIP || this.calltype == 2) && tywx.tt.isCanWatchVideo) {\n            this.showWXVideo();\n         } else if (this.calltype == 1 || !tywx.tt.isCanWatchVideo) {\n             this.shareMiniApp();\n         } \n     },\n\n\n\n\n     /*\n         调用: 使用此model分享功能的时候 \n         功能: 手动设置分享成功后的回调函数\n         参数: [\n             successCall: 分享成功后的回调方法 类型Function\n         ]\n         返回值:[\n             无\n         ]\n         思路: 逻辑需要\n     */\n     setReactCall: function (reactcall) {\n         this.reactcall = reactcall;\n     },\n\n     /*\n        调用: 使用此model分享功能的时候 \n        功能: 手动设置分享失败后的回调函数\n        参数: [\n            errorCall: 分享失败后的回调方法 类型Function\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n     setErrorCall: function (errorCall) {\n         this.errorCallBack = errorCall;\n     },\n\n     /*\n         调用: 使用此model分享功能的时候 \n         功能: 手动设置分享失败后的回调函数\n         参数: [\n             errorCall: 分享失败后的回调方法 类型Function\n         ]\n         返回值:[\n             无\n         ]\n         思路: 逻辑需要\n     */\n     setShareGroupCall: function (sgroupCall) {\n         this.shareGroupCallBack = sgroupCall;\n     },\n\n\n     /**\n      * @description 播放微信视频广告\n      */\n     showWXVideo: function () {\n         var self = this;\n         if (!this.hadclicknumber || this.hadclicknumber == 0) {\n             this.hadclicknumber = 1;\n         } else {\n             return;\n         }\n        \n         if (this.reactcall) {\n             self.hadclicknumber = 0;\n             self.successCallBack(this);\n         } else {\n             if (tywx.IsWechatPlatform()) {\n\n                 var param = {\n                     success: function (res) {\n                         self.hadclicknumber = 0;\n                         self.successCallBack && self.successCallBack(res);\n                     },\n                     fail: function (res) {\n                         self.hadclicknumber = 0;\n                         tywx.tt.Utils.showWXModal('观看视频失败');\n                         self.errorCallBack && self.errorCallBack(null);\n                     },\n                     error_callback: () => {\n                         self.hadclicknumber = 0;\n                         if (self.shareConfig === tywx.tt.constants.ShareConfig.GIFT_GIFT_BOX_SHARE_VIDEO ||\n                             self.shareConfig === tywx.tt.constants.ShareConfig.RECOVER_GAME_SHARE_VIDEO) {\n                             let content =\n                                 self.shareConfig === tywx.tt.constants.ShareConfig.RECOVER_GAME_SHARE ?\n                                 '免费复活机会' : '如意宝箱';\n                             let end_str = self.shareConfig === tywx.tt.constants.ShareConfig.RECOVER_GAME_SHARE ?\n                                 '一次' : '一个';\n                             content = `<color=#ffffff>赠送</c><color=#ff0000>${content}</color><color=#ffffff>${end_str}</c>`;\n                             tywx.tt.Utils.showErrorGfitPop(() => {\n                                 self.successCallBack && self.successCallBack(null);\n                             }, content);\n                         } else if (self.shareConfig === tywx.tt.constants.ShareConfig.OPEN_RED_PACKET_SHARE_VIDEO ||\n                             self.shareConfig === tywx.tt.constants.ShareConfig.FREE_DOUBLE_SCORE_SHARE_VIDEO) {\n                             let content =\n                                 self.shareConfig === tywx.tt.constants.ShareConfig.OPEN_RED_PACKET_SHARE_VIDEO ?\n                                 '免费红包' : '免费双倍加分';\n                             let end_str = self.shareConfig === tywx.tt.constants.ShareConfig.FREE_DOUBLE_SCORE_SHARE_VIDEO ?\n                                 '一个' : '一次';\n                             content = `<color=#ffffff>赠送</c><color=#ff0000>${content}</color><color=#ffffff>${end_str}</c>`;\n                             tywx.tt.Utils.showErrorGfitPop(() => {\n                                 self.successCallBack && self.successCallBack(null);\n                             }, content);\n                         } else if (self.shareConfig === tywx.tt.constants.ShareConfig.FREE_GIFT_SHARE_VIDEO) {\n                             let content = '免费道具';\n                             let end_str = \"一个\";\n                             content = `<color=#ffffff>赠送</c><color=#ff0000>${content}</color><color=#ffffff>${end_str}</c>`;\n                             tywx.tt.Utils.showErrorGfitPop(() => {\n                                 self.successCallBack && self.successCallBack(null);\n                             }, content);\n                         }\n\n\n                     }\n                 }\n                 tywx.tt.Utils.showWXVideo(param);\n             }\n         }\n     },\n\n\n     /*\n         调用: 使用此model分享功能的时候 \n         功能: 给好友或者群分享小程序的相关信息\n         参数: [\n             无\n         ]\n         返回值:[\n             无\n         ]\n         思路: 逻辑需要\n     */\n     shareMiniApp: function () {\n         var self = this;\n         tywx.tt.log(\"当前分享\" + this.reactcall);\n         if (this.reactcall) {\n             self.successCallBack(this);\n         } else {\n             if (tywx.IsWechatPlatform()) {\n                 window.wx.showShareMenu({\n                     withShareTicket: true\n                 });\n                 let msg = tywx.tt.Utils.getRandomShareConfigByShareTag(this.shareConfig[0]);\n                 if (!msg) {\n                     msg = tywx.tt.constants.DefaultShareConfig;\n                 }\n                 if (msg) {\n                     tywx.ShareInterface.share(\n                         msg.shareContent,\n                         msg.sharePicUrl,\n                         msg.sharePointId,\n                         msg.shareSchemeId,\n                         (res) => {\n                             tywx.LOGE(\"分享成功后的数据\" + JSON.stringify(res));\n                             // * is share to group\n                             if (self.shareConfig && self.shareConfig[1]) {\n                                 // * froce share to group\n                                 if (res.shareTickets !== undefined && res.shareTickets.length > 0) {\n                                     if (self.shareConfig[0] === tywx.tt.constants.ShareConfig.RANK_SHARE[0]) {\n                                         self.successCallBack && self.successCallBack(res);\n                                     } else {\n                                         tywx.tt.Utils.share2GroupByTicket(\n                                             self.shareConfig[0],\n                                             res,\n                                             () => { // * success callback\n                                                 self.successCallBack && self.successCallBack(res);\n                                             },\n                                             () => { // * failed callback\n                                                //  tywx.tt.Utils.showWXModal('请分享到不同群');\n                                                 self.errorCallBack && self.errorCallBack(null);\n                                             }\n                                         );\n                                     }\n                                 } else {\n                                     // * failed\n                                    //  tywx.tt.Utils.showWXModal('请分享到群');\n                                     self.errorCallBack && self.errorCallBack(null);\n                                 }\n                             } else {\n                                 // * success\n                                 self.successCallBack && self.successCallBack(res);\n                             }\n\n                         },\n                         function (data) {\n                             tywx.LOGE(\"分享成功后的数2据\" + JSON.stringify(data));\n                             self.errorCallBack && self.errorCallBack(data);\n                         }\n                     );\n                 }\n             }\n         }\n     }\n     // update (dt) {},\n });\n"]}