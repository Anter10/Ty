{"version":3,"sources":["lottery_get_view.js"],"names":["lotery_get_view_path","LOCAL_STOREITEM_KEY","lottery_get_view","cc","Class","extends","Component","properties","nameLabel","Label","icon","Sprite","mfjbBtnNode","Node","close","get_view_node","removeFromParent","addDoubleJL","self","tywx","tt","log","JSON","stringify","data","gift_id","items","parse","Utils","loadItem","allitems","length","findit","itIndex","item","id","num","push","titem","getAddItem","saveItem","console","requestAddRedPacket","success","res","showWXToast","fail","number","name","onLoad","videoBtnScript","getComponent","share_control","configManager","recovergame","calltype","shareVideoCtr","setButtonCallType","config","constants","ShareConfig","ZPADDDOUBLE_SHARE","ZPADDDOUBLE_VIDEO","setShareConfig","setSuccessCall","start","setData","flushNameLabel","flushIconLabel","string","loader","load","err","texture","new_sprite_frame","SpriteFrame","spriteFrame","node","setContentSize","size","statics","show","tdata","loadRes","prefab","getlotterynode","instantiate","ads_script","x","y","director","getScene","addChild","module","exports"],"mappings":"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","file":"lottery_get_view.js","sourceRoot":"../../../../../../assets/scripts/game/lottery","sourcesContent":[" const lotery_get_view_path = \"prefabs/lottery_get_view\";\n let LOCAL_STOREITEM_KEY = \"tt-items\";\n\n const lottery_get_view = cc.Class({\n     extends: cc.Component,\n\n     properties: {\n         nameLabel: cc.Label,\n         icon: cc.Sprite,\n         mfjbBtnNode: cc.Node,\n     },\n\n\n     close: function () {\n         lottery_get_view.get_view_node.removeFromParent(true);\n         lottery_get_view.get_view_node = null;\n     },\n\n\n     // 加倍领取奖励\n     addDoubleJL: function () {\n         var self = this;\n         tywx.tt.log(\"加倍奖励哦\" + JSON.stringify(this.data));\n         if (this.data.gift_id == 2 || this.data.gift_id == 4 || this.data.gift_id == 6) {\n             var items = JSON.parse(tywx.tt.Utils.loadItem(LOCAL_STOREITEM_KEY, \"[]\"));\n             var allitems = [];\n             if (items.length > 0) {\n                 var findit = false;\n                 for (var itIndex = 0; itIndex < items.length; itIndex++) {\n                     const item = items[itIndex];\n                     if (item.id == this.data.gift_id) {\n                         findit = true;\n                         item.num = item.num + 1;\n                     }\n                     allitems.push(item);\n                 }\n                 if (!findit) {\n                     const titem = this.getAddItem();\n                     allitems[allitems.length] = titem;\n                 }\n             } else {\n                 var titem = this.getAddItem();\n                 allitems[0] = titem;\n             }\n             tywx.tt.Utils.saveItem(LOCAL_STOREITEM_KEY, JSON.stringify(allitems), false);\n             this.close();\n             console.log(\"关闭了 close 吗\");\n         } else {\n             tywx.tt.Utils.requestAddRedPacket({\n                 success: function (res) {\n                     self.close();\n                     tywx.tt.Utils.showWXToast(\"恭喜获得\");\n                 },\n                 fail: function () {\n                     self.close();\n                     tywx.tt.Utils.showWXToast(\"请求失败\");\n                 }\n             });\n         }\n\n     },\n\n     getAddItem: function () {\n         var titem = {};\n         titem.id = this.data.gift_id;\n         titem.num = this.data.number || 1;\n         titem.name = this.data.name;\n         titem.icon = this.data.icon;\n         return titem;\n     },\n\n     onLoad() {\n         var self = this;\n         // 视频抽奖\n         const videoBtnScript = this.mfjbBtnNode.getComponent(\"ShareButton\");\n         const share_control = tywx.tt.configManager.share_control.recovergame;\n         const calltype = tywx.tt.Utils.shareVideoCtr(share_control);\n         console.log(\"calltype = \" + calltype);\n         videoBtnScript.setButtonCallType(calltype);\n         const config = calltype == 1 ? tywx.tt.constants.ShareConfig.ZPADDDOUBLE_SHARE : tywx.tt.constants.ShareConfig.ZPADDDOUBLE_VIDEO;\n         videoBtnScript.setShareConfig(config);\n         videoBtnScript.setSuccessCall(function () {\n             self.addDoubleJL();\n         });\n     },\n\n     start() {\n\n     },\n\n     setData: function (data) {\n         this.data = data;\n         tywx.tt.log(\"this = data = \" + JSON.stringify(this.data));\n         this.flushNameLabel();\n         this.flushIconLabel();\n     },\n\n     flushNameLabel: function () {\n         this.nameLabel.string = this.data.name;\n     },\n\n     flushIconLabel: function () {\n         var self = this;\n         cc.loader.load(\n             'https://elsfkws.nalrer.cn/teris/lottery/' + this.data.icon,\n             (err, texture) => {\n                 if (!err) {\n                     let new_sprite_frame = new cc.SpriteFrame(texture);\n                     self.icon.spriteFrame = new_sprite_frame;\n                     self.icon.node.setContentSize(cc.size(90, 90));\n                 } else {\n\n                 }\n             });\n     },\n\n     statics: {\n         get_view_node: null,\n         show: function (tdata) {\n             const data = tdata;\n             cc.loader.loadRes(lotery_get_view_path, (err, prefab) => {\n                 if (!err) {\n                     let getlotterynode = cc.instantiate(prefab);\n                     let ads_script = getlotterynode.getComponent('lottery_get_view');\n                     getlotterynode.x = 360;\n                     getlotterynode.y = 640;\n                     ads_script.setData(data);\n                     lottery_get_view.get_view_node = getlotterynode;\n                     cc.director.getScene().addChild(getlotterynode);\n                 }\n             });\n         }\n     }\n\n     // update (dt) {},\n });\n\n\n module.exports = lottery_get_view;"]}