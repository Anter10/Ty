{"version":3,"sources":["lottery_view.js"],"names":["TAG","lotterygetview","require","LOCAL_STOREITEM_KEY","cc","Class","extends","Component","properties","nodeDisk","Node","lottery_item","Prefab","background","alltnode","type","default","allbtnnode","videoBtn","shareBtn","freeBtn","centerNode","videoLabel","Label","chouJiangCall","isLottering","lottery","onLoad","self","videoBtnScript","getComponent","setButtonCallType","setShareConfig","tywx","tt","constants","ShareConfig","HOME_ZP_GET_VIDEO","setSuccessCall","isCanWatchVideo","HOME_ZP_GET_SHARE","string","configManager","getInstance","auditing","setReactCall","shareBtnScript","isMinGanIP","freeBtnScript","HOME_ZP_FREE_SHARE","game","canvas","width","height","cw","ch","top_y","position","y","setTouchEndCall","closeView","start","setData","data","initUI","error","closeing","removeLotteryView","pre","ti","lotteryItem","instantiate","rotation","item_script","items","addChild","initUiButton","buttypes","button_types","buttonindex","buttontype","buttons","split","log","JSON","stringify","typebtn","btntype","tin","length","active","btnStartLottery","getCjType","RedPacketInfo","aims","czaim","hbaim","hyhaim","aim_id","Math","random","parseInt","nextAmount","item","current_rotate","runAction","sequence","rotateBy","easing","easeIn","easeOut","callFunc","storeCurrentItem","finishcall","init","parse","Utils","loadItem","allitems","findit","itIndex","id","gift_id","num","push","titem","getAddItem","saveItem","show","requestAddRedPacket","success","res","name","fail","showWXToast","number","icon","setFinishCall","call"],"mappings":"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","file":"lottery_view.js","sourceRoot":"../../../../../../assets/scripts/game/lottery","sourcesContent":[" let TAG = '[game/lottery/lottery_view.js]]';\n\n let lotterygetview = require('./lottery_get_view'); //* 大转盘管理\n let LOCAL_STOREITEM_KEY = \"tt-items\";\n cc.Class({\n     extends: cc.Component,\n     properties: {\n         nodeDisk: cc.Node,\n         lottery_item: cc.Prefab,\n         background: cc.Node,\n         alltnode: {\n             type: cc.Node,\n             default: [],\n         },\n         allbtnnode: {\n             type: cc.Node,\n             default: [],\n         },\n         videoBtn: cc.Node,\n         shareBtn: cc.Node,\n         freeBtn: cc.Node,\n         centerNode: cc.Node,\n         videoLabel: cc.Label,\n     },\n\n     chouJiangCall: function () {\n         if (this.isLottering) return;\n         this.lottery();\n     },\n\n     onLoad() {\n         const self = this;\n\n         // 初始化按钮的事件\n         // 视频抽奖\n         const videoBtnScript = this.videoBtn.getComponent(\"ShareButton\")\n         videoBtnScript.setButtonCallType(2);\n         videoBtnScript.setShareConfig(tywx.tt.constants.ShareConfig.HOME_ZP_GET_VIDEO);\n         videoBtnScript.setSuccessCall(function () {\n             self.chouJiangCall();\n         });\n         if (!tywx.tt.isCanWatchVideo) {\n             videoBtnScript.setButtonCallType(1);\n             videoBtnScript.setShareConfig(tywx.tt.constants.ShareConfig.HOME_ZP_GET_SHARE);\n             this.videoLabel.string = \"免费领取\";\n         }\n         if (tywx.tt.configManager.getInstance().auditing == true) {\n             videoBtnScript.setReactCall(true);\n             this.videoLabel.string = \"免费领取\";\n         }\n         // 分享抽奖\n         const shareBtnScript = this.shareBtn.getComponent(\"ShareButton\")\n         shareBtnScript.setButtonCallType(1);\n         shareBtnScript.setShareConfig(tywx.tt.constants.ShareConfig.HOME_ZP_GET_SHARE);\n         shareBtnScript.setSuccessCall(function () {\n             self.chouJiangCall();\n         });\n\n         if (tywx.tt.isMinGanIP && tywx.tt.isCanWatchVideo) {\n             shareBtnScript.setButtonCallType(2);\n             shareBtnScript.setShareConfig(tywx.tt.constants.ShareConfig.HOME_ZP_GET_VIDEO);\n         }\n         if (tywx.tt.configManager.getInstance().auditing == true) {\n             shareBtnScript.setReactCall(true);\n         }\n         // 免费抽奖\n         const freeBtnScript = this.freeBtn.getComponent(\"ShareButton\")\n         freeBtnScript.setButtonCallType(1);\n         freeBtnScript.setReactCall(true);\n         freeBtnScript.setShareConfig(tywx.tt.constants.ShareConfig.HOME_ZP_FREE_SHARE);\n         freeBtnScript.setSuccessCall(function () {\n             self.chouJiangCall();\n         });\n         //   this.freeBtn.active = true;\n\n         let [cw, ch] = [cc.game.canvas.width, cc.game.canvas.height];\n         let top_y = (80 / 1280) * ch;\n         this.centerNode.position.y = top_y;\n\n         this.background.getComponent(\"background\").setTouchEndCall(function () {\n             self.closeView();\n         });\n     },\n\n     start() {\n\n     },\n\n     setData: function (data) {\n         if (data) {\n             this.data = data;\n             this.initUI();\n         } else {\n             tywx.tt.error(TAG, \"没有抽奖数据\");\n         }\n     },\n\n     closeView: function () {\n         if (this.closeing) {\n             return;\n         }\n         this.closeing = true;\n         tywx.tt.lottery.removeLotteryView();\n     },\n\n     initUI: function () {\n         // 初始化道具UI\n         var pre = 0;\n         for (var ti = 0; ti < 6; ti++) {\n             let lotteryItem = cc.instantiate(this.lottery_item);\n             pre = ti * 60;\n             lotteryItem.rotation = pre;\n             let item_script = lotteryItem.getComponent('lottery_item');\n             var data = this.data.items[ti];\n             item_script.setData(data);\n             this.alltnode[ti].addChild(lotteryItem);\n         }\n         // 初始化按钮UI\n         this.initUiButton();\n     },\n\n     /**\n      * @description 控制按钮的显示\n      */\n     initUiButton: function () {\n         const buttypes = this.data.button_types;\n         const buttonindex = buttypes[0];\n         const buttontype = buttypes[1][buttonindex];\n         const buttons = buttontype.split(\"_\");\n\n         tywx.tt.log(\"当前显示的buttons = \" + JSON.stringify(buttons));\n         var typebtn = [];\n         var btntype = buttons[0];\n\n         for (var tin = 0; tin < buttons.length; tin++) {\n             if (buttons[tin] == \"share\") {\n                 typebtn[tin] = this.shareBtn;\n                 this.shareBtn.active = true;\n             } else if (buttons[tin] == \"video\") {\n                 typebtn[tin] = this.videoBtn;\n                 this.videoBtn.active = true;\n             } else if (buttons[tin] == \"free\") {\n                 typebtn[tin] = this.freeBtn;\n                 this.freeBtn.active = true;\n             }\n         }\n         if (typebtn.length == 1) {\n             typebtn[0].position = this.allbtnnode[1];\n         }\n         if (typebtn.length == 2) {\n             typebtn[0].position = this.allbtnnode[0];\n             typebtn[1].position = this.allbtnnode[2];\n         }\n\n\n\n     },\n\n     // update (dt) {},\n     btnStartLottery() {\n         if (this.isLottering) return;\n         this.lottery();\n     },\n\n     // 确定当前抽到的是红包还是道具\n     getCjType: function () {\n\n     },\n\n\n     lottery() {\n         tywx.tt.log(TAG, \"当前的红包数据 = \" + JSON.stringify(tywx.tt.RedPacketInfo));\n         let aims = [0, 1, 2, 3, 4, 5];\n         let czaim = [1, 3];\n         let hbaim = [0, 2, 4];\n         let hyhaim = [5];\n         let aim_id = Math.random() > 0.5 ? 5 : czaim[parseInt(Math.random() * czaim.length)];\n         let random = Math.random();\n         if (tywx.tt.RedPacketInfo && tywx.tt.RedPacketInfo.nextAmount > 0 && random > 1 - random) {\n             aim_id = hbaim[parseInt(Math.random() * hbaim.length)];\n         }\n\n         this.item = this.data.items[aim_id];\n         let self = this;\n         let current_rotate = this.nodeDisk.rotation % 360;\n         //let last_aim_id = parseInt(current_rotate / 60);\n         this.isLottering = true;\n         this.nodeDisk.runAction(\n             cc.sequence(\n                 cc.rotateBy(1, 360 * 2 - current_rotate).easing(cc.easeIn(2.0)),\n                 cc.rotateBy(2, 360 * 3),\n                 cc.rotateBy(1, 360 * 2 - aim_id * 60).easing(cc.easeOut(1.0)),\n                 cc.callFunc(() => {\n                     self.storeCurrentItem();\n                     self.isLottering = false;\n                     this.finishcall && this.finishcall();\n                 })\n             )\n         );\n     },\n\n     init() {\n         //  this.aim_id = 0;\n         //  for (let i = 0; i < 6; ++i) {\n         //      let lable_name = `label_${i}`;\n         //      let label_node = this.nodeLabelRoot.getChildByName(lable_name);\n         //      if (label_node) {\n         //          label_node.getComponent(cc.Label).string = `礼物${i}`;\n         //      }\n         //  }\n     },\n\n     /**\n      * @description 存储当前的转到的道具\n      */\n     storeCurrentItem: function () {\n         var items = JSON.parse(tywx.tt.Utils.loadItem(LOCAL_STOREITEM_KEY, \"[]\"));\n         var allitems = [];\n         if (items.length > 0) {\n             var findit = false;\n             for (var itIndex = 0; itIndex < items.length; itIndex++) {\n                 const item = items[itIndex];\n                 if (item.id == this.item.gift_id) {\n                     findit = true;\n                     item.num = item.num + 1;\n                 }\n                 allitems.push(item);\n             }\n             if (!findit) {\n                 const titem = this.getAddItem();\n                 allitems[allitems.length] = titem;\n             }\n         } else {\n             var titem = this.getAddItem();\n             allitems[0] = titem;\n         }\n         tywx.tt.Utils.saveItem(LOCAL_STOREITEM_KEY, JSON.stringify(allitems), false);\n\n         const self = this;\n         if (this.item.gift_id == 2 || this.item.gift_id == 4 || this.item.gift_id == 6) {\n             lotterygetview.show(this.item);\n         } else {\n             tywx.tt.Utils.requestAddRedPacket({\n                 success: function (res) {\n                     //  console.log(\"qing求数据 = \" + JSON.stringify(res));\n                     self.item.name = res + \"元\";\n                     lotterygetview.show(self.item)\n                 },\n                 fail: function () {\n                     tywx.tt.Utils.showWXToast(\"请求失败\");\n                 }\n             });\n         }\n\n         tywx.tt.log(\"当前所转到的道具数据  = \" + JSON.stringify(allitems));\n     },\n\n     getAddItem: function () {\n         var titem = {};\n         titem.id = this.item.gift_id;\n         titem.num = this.item.number || 1;\n         titem.name = this.item.name;\n         titem.icon = this.item.icon;\n         return titem;\n     },\n\n     setFinishCall: function (call) {\n         this.finishcall = call;\n     },\n\n\n\n\n\n\n\n });"]}