{"version":3,"sources":["../../../../../../assets/scripts/game/rank/assets/scripts/game/rank/friend.js"],"names":["friend_path","self","friend","cc","Class","extends","Component","properties","friendIcon","Sprite","onLoad","tex","Texture2D","window","sharedCanvas","width","height","updatetime","score","setStop","stop","updateFriendCanvas","wx","openDataContext","getOpenDataContext","canvas","initWithElement","handleLoadedTexture","spriteFrame","SpriteFrame","node","active","setScoreFlush","start","update","dt","tywx","tt","Utils","sendWXMsg","method","isrestart","statics","iconnode","iconscript","addIcon","pos","loader","loadRes","err","prefab","ranknode","instantiate","friend_script","getComponent","addChild","setScore","module","exports"],"mappings":";;;;;;AAAC,IAAIA,cAAc,gBAAlB;AACA,IAAIC,OAAO,IAAX;AACA,IAAMC,SAASC,GAAGC,KAAH,CAAS;AACpBC,aAASF,GAAGG,SADQ;;AAGpBC,gBAAY;AACRC,oBAAYL,GAAGM;AADP,KAHQ;;AAOpB;;AAEAC,UAToB,oBASX;AACL,aAAKC,GAAL,GAAW,IAAIR,GAAGS,SAAP,EAAX;AACAC,eAAOC,YAAP,CAAoBC,KAApB,GAA4B,GAA5B;AACAF,eAAOC,YAAP,CAAoBE,MAApB,GAA6B,EAA7B;AACA,aAAKC,UAAL,GAAkB,EAAlB;AACA,aAAKC,KAAL,GAAa,CAAb;AACAjB,eAAO,IAAP;AACH,KAhBmB;;;AAmBpB;;;;AAIAkB,aAAQ,iBAASC,IAAT,EAAc;AAClB,aAAKA,IAAL,GAAYA,IAAZ;AACA,YAAG,CAACA,IAAJ,EAAS;AACJP,mBAAOC,YAAP,CAAoBC,KAApB,GAA4B,GAA5B;AACAF,mBAAOC,YAAP,CAAoBE,MAApB,GAA6B,EAA7B;AACJ;AACJ,KA7BmB;;AA+BpB;;;AAGAK,wBAAoB,8BAAY;AAC5B;AACA,YAAI,CAAC,KAAKV,GAAN,IAAa,CAACW,EAAlB,EAAsB;AAClB;AACH;AACD,YAAIC,kBAAkBD,GAAGE,kBAAH,EAAtB;AACA,YAAIV,eAAeS,gBAAgBE,MAAnC;AACA,aAAKd,GAAL,CAASe,eAAT,CAAyBZ,YAAzB;AACA,aAAKH,GAAL,CAASgB,mBAAT;AACA,aAAKnB,UAAL,CAAgBoB,WAAhB,GAA8B,IAAIzB,GAAG0B,WAAP,CAAmB,KAAKlB,GAAxB,CAA9B;AACA,aAAKH,UAAL,CAAgBsB,IAAhB,CAAqBC,MAArB,GAA8B,IAA9B;AACH,KA7CmB;;AA+CpB;;;;AAIAC,mBAAe,uBAAUd,KAAV,EAAiB;AAC5B,aAAKA,KAAL,GAAaA,SAAS,CAAtB;AACA,aAAKG,kBAAL;AACH,KAtDmB;;AAyDpBY,SAzDoB,mBAyDZ,CAEP,CA3DmB;AA6DpBC,UA7DoB,kBA6DbC,EA7Da,EA6DT;AACP,YAAI,KAAKf,IAAT,EAAc;AACV;AACH;AACD,aAAKH,UAAL,GAAkB,KAAKA,UAAL,GAAkBkB,EAApC;AACA,YAAI,KAAKlB,UAAL,GAAkB,CAAtB,EAAyB;AACrB,iBAAKA,UAAL,GAAkB,EAAlB;AACAmB,iBAAKC,EAAL,CAAQC,KAAR,CAAcC,SAAd,CAAwB;AACpBC,wBAAQ,CADY;AAEpBC,2BAAW,IAFS;AAGpBvB,uBAAOjB,KAAKiB;AAHQ,aAAxB;AAKH;AACD,YAAG,KAAKD,UAAL,GAAkB,CAArB,EAAuB;AACpB,iBAAKI,kBAAL;AACF;AACJ,KA7EmB;;;AA+EpBqB,aAAS;AACLC,kBAAU,IADL;AAELC,oBAAY,IAFP;AAGLC,iBAAS,iBAAUf,IAAV,EAAgBZ,KAAhB,EAAuB4B,GAAvB,EAA4B;AACjC3C,eAAG4C,MAAH,CAAUC,OAAV,CAAkBhD,WAAlB,EAA+B,UAACiD,GAAD,EAAMC,MAAN,EAAiB;AAC5C,oBAAI,CAACD,GAAL,EAAU;AACN,wBAAIE,WAAWhD,GAAGiD,WAAH,CAAeF,MAAf,CAAf;AACA,wBAAIG,gBAAgBF,SAASG,YAAT,CAAsB,QAAtB,CAApB;AACAD,kCAAcrB,aAAd,CAA4BqB,aAA5B;AACAnD,2BAAO0C,UAAP,GAAoBS,aAApB;AACAnD,2BAAOyC,QAAP,GAAkBQ,QAAlB;AACArB,yBAAKyB,QAAL,CAAcJ,QAAd;AACH;AACJ,aATD;AAUH,SAdI;AAeLK,kBAAU,kBAAUtC,KAAV,EAAiB;AACvB,gBAAIhB,OAAO0C,UAAX,EAAuB;AACnB1C,uBAAO0C,UAAP,CAAkBZ,aAAlB,CAAgCd,KAAhC;AACH;AACJ,SAnBI;AAoBLC,iBAAS,iBAAUC,IAAV,EAAgB;AACrB,gBAAIlB,OAAO0C,UAAX,EAAuB;AACnB1C,uBAAO0C,UAAP,CAAkBzB,OAAlB,CAA0BC,IAA1B;AACH;AACJ;;AAxBI;AA/EW,CAAT,CAAf;;AA4GAqC,OAAOC,OAAP,GAAiBxD,MAAjB","file":"friend.js","sourceRoot":"../../../../../../assets/scripts/game/rank","sourcesContent":[" let friend_path = \"prefabs/friend\"; \n var self = null;\n const friend = cc.Class({\n     extends: cc.Component,\n\n     properties: {\n         friendIcon: cc.Sprite,\n     },\n\n     // LIFE-CYCLE CALLBACKS:\n     \n     onLoad() {\n         this.tex = new cc.Texture2D();\n         window.sharedCanvas.width = 211;\n         window.sharedCanvas.height = 98;\n         this.updatetime = 10;\n         this.score = 0;\n         self = this;\n     },\n     \n\n     /**\n      * @设置是否停止刷新好友的数据\n      * @param {Boolean} stop 停止刷新的标示\n      */\n     setStop:function(stop){\n         this.stop = stop;\n         if(!stop){\n              window.sharedCanvas.width = 211;\n              window.sharedCanvas.height = 98;\n         }\n     },\n\n     /**\n      * @description: 刷新子域即将超越的玩家Canvas\n      */\n     updateFriendCanvas: function () {\n         //return;\n         if (!this.tex || !wx) {\n             return;\n         }\n         var openDataContext = wx.getOpenDataContext();\n         var sharedCanvas = openDataContext.canvas;\n         this.tex.initWithElement(sharedCanvas);\n         this.tex.handleLoadedTexture();\n         this.friendIcon.spriteFrame = new cc.SpriteFrame(this.tex);\n         this.friendIcon.node.active = true;\n     },\n\n     /**\n      * 设置当前玩家的分数 \n      * @param {Number} score 设置当前玩家的分数刷新当前显示的好友分数\n      */\n     setScoreFlush: function (score) {\n         this.score = score || 0;\n         this.updateFriendCanvas();\n     },\n\n\n     start() {\n\n     },\n\n     update(dt) {\n         if (this.stop){\n             return;\n         }\n         this.updatetime = this.updatetime - dt;\n         if (this.updatetime < 0) {\n             this.updatetime = 10;\n             tywx.tt.Utils.sendWXMsg({\n                 method: 5,\n                 isrestart: true,\n                 score: self.score,\n             });\n         }\n         if(this.updatetime > 7){\n            this.updateFriendCanvas();\n         }\n     },\n\n     statics: {\n         iconnode: null,\n         iconscript: null,\n         addIcon: function (node, score, pos) {\n             cc.loader.loadRes(friend_path, (err, prefab) => {\n                 if (!err) {\n                     let ranknode = cc.instantiate(prefab);\n                     let friend_script = ranknode.getComponent('friend');\n                     friend_script.setScoreFlush(friend_script);\n                     friend.iconscript = friend_script;\n                     friend.iconnode = ranknode;\n                     node.addChild(ranknode);\n                 }\n             });\n         },\n         setScore: function (score) {\n             if (friend.iconscript) {\n                 friend.iconscript.setScoreFlush(score);\n             }\n         },\n         setStop: function (stop) {\n             if (friend.iconscript) {\n                 friend.iconscript.setStop(stop);\n             }\n         },\n\n     }\n });\n\n module.exports = friend;"]}