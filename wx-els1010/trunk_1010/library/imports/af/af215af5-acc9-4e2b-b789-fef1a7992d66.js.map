{"version":3,"sources":["../../../../../../assets/scripts/game/gameover/assets/scripts/game/gameover/fuhuo_view.js"],"names":["fuhuo_view_path","fuhuo_view","cc","Class","extends","Component","djsLabel","Label","properties","scoreLabel","fhBtn","Node","djsTimeLabel","jcdlNode","background","root","progress","ProgressBar","restartGame","closeCall","curnode","removeFromParent","tywx","tt","gameover","show","data","onLoad","fuhuoScript","getComponent","self","share_control","configManager","getInstance","recovergame","calltype","Utils","shareVideoCtr","config","constants","ShareConfig","GAMEOVER_FUHUO_SHARE","GAMEOVER_FUHUO_VIDEO","setShareConfig","setButtonCallType","setSuccessCall","fuHuoCall","hideWXBanner","setTouchEndCall","auditing","setReactCall","canadd","ads","addAdsNode","v2","startDjs","startZhuan","alltime","speed","repeate","total","actions","callFunc","per","delay","delayTime","repeatea","repeat","node","runAction","djstime","tdjs","string","totalPassTime","totalrepeate","djsCall","scale","AudioManager","playSound","SOUNDS","COMBO","ttdjs","scaleTo","call","console","log","tseq","sequence","delay1","seq","stopAllActions","BoardView","recoverGame","setData","score","start","statics","loader","loadRes","err","prefab","fuhuonode","instantiate","ani","Animation","play","ads_script","commonScaleIn","director","getScene","addChild","module","exports"],"mappings":"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","file":"fuhuo_view.js","sourceRoot":"../../../../../../assets/scripts/game/gameover","sourcesContent":[" const fuhuo_view_path = \"prefabs/fuhuo_view\"\n\n\n const fuhuo_view = cc.Class({\n     extends: cc.Component,\n     djsLabel: cc.Label,\n     properties: {\n         scoreLabel: cc.Label,\n         fhBtn: cc.Node,\n         djsTimeLabel: cc.Label,\n         jcdlNode: cc.Node,\n         background: cc.Node,\n         root: cc.Node,\n         progress: cc.ProgressBar,\n     },\n\n\n     restartGame: function () {\n         this.closeCall();\n     },\n\n     closeCall: function () {\n         //  this.node.getComponent(cc.Animation).play(\"fuhuo_view_hide\");\n         fuhuo_view.curnode.removeFromParent(true);\n         fuhuo_view.curnode = null;\n         tywx.tt.gameover.show(this.data);\n     },\n\n     onLoad() {\n         // 初始化复活按钮的相关设置\n         this.fuhuoScript = this.fhBtn.getComponent(\"ShareButton\")\n         var self = this;\n         const share_control = tywx.tt.configManager.getInstance().share_control ? tywx.tt.configManager.getInstance().share_control.recovergame : [\"share\", 50];\n         const calltype = tywx.tt.Utils.shareVideoCtr(share_control);\n         const config = calltype == 1 ? tywx.tt.constants.ShareConfig.GAMEOVER_FUHUO_SHARE : tywx.tt.constants.ShareConfig.GAMEOVER_FUHUO_VIDEO;\n         this.fuhuoScript.setShareConfig(config);\n         this.fuhuoScript.setButtonCallType(calltype);\n         this.fuhuoScript.setSuccessCall(function () {\n             self.fuHuoCall();\n         });\n         tywx.tt.Utils.hideWXBanner();\n         this.background.getComponent(\"background\").setTouchEndCall(function () {\n             self.restartGame();\n         });\n         if (tywx.tt.configManager.getInstance().auditing == true) {\n             this.fuhuoScript.setReactCall(true);\n         }\n         // 添加交叉倒流节点\n         var canadd = true;\n         canadd && tywx.tt.ads.addAdsNode(\"blink_play\", this.jcdlNode, cc.v2(0, 0));\n         // 开始倒计时\n         this.startDjs();\n         // 圈开始转\n         this.startZhuan();\n     },\n     startZhuan:function(){\n        let alltime = 4 * 1.5;\n        let speed = 400;\n        let repeate = 1 / speed;\n        let self = this;\n        let total = 0;\n        let actions = cc.callFunc(function(){\n            total = total + repeate;\n            let per = 1 - total;\n            self.progress.progress = per;\n        })\n        let delay = cc.delayTime(repeate);\n        let repeatea = cc.repeat(actions, delay, speed / alltime);\n        this.node.runAction(repeatea);\n     },\n\n     startDjs: function () {\n         this.djstime = 5;\n         var self = this;\n         var tdjs = 5;\n         self.djsTimeLabel.string = tdjs;\n         var totalPassTime = 0;\n         var totalrepeate = 5;\n\n         var djsCall = cc.callFunc(\n             function () {\n                 self.djsTimeLabel.node.scale = 1;\n                 totalPassTime++;\n                 tdjs = tdjs - 1;\n                 if (tdjs == 0) {\n                     tdjs = 5;\n                     if (totalPassTime < totalrepeate) {\n                         self.djsTimeLabel.string = \"\" + tdjs;\n                     }\n                    //  self.progress.progress = 0;\n                     self.restartGame();\n                 } else {\n                     tywx.tt.AudioManager.getInstance().playSound(tywx.tt.constants.SOUNDS.COMBO[4]);\n                     let ttdjs = 1 - (5 - tdjs) / 5;\n                      \n                    //  self.progress.progress = ttdjs;\n                     self.djsTimeLabel.string = tdjs;\n                     \n                 }\n                 if (totalPassTime == totalrepeate) {\n                     // 显示UI\n                     self.djsTimeLabel.string = \"\";\n\n                 }\n                 let scale = cc.scaleTo(0.3, 0);\n                 let delay = cc.delayTime(1);\n                 let call = cc.callFunc(function () {\n                     if (totalPassTime == totalrepeate - 1) {\n                         self.djsTimeLabel.string = \"\";\n                         tywx.tt.AudioManager.getInstance().playSound(tywx.tt.constants.SOUNDS.COMBO[4]);\n                     } else {\n                         if (totalPassTime != totalrepeate - 1) {\n                             self.djsTimeLabel.string = tdjs - 1;\n                             let ttdjs = 1 - (5 - tdjs) / 5;\n                             console.log(\"ttdjsttdjsttdjs  =\", ttdjs);\n                            //  self.progress.progress = ttdjs;\n                         }\n                     }\n                     self.djsTimeLabel.node.scale = 1;\n                 });\n                 let tseq = cc.sequence(delay, scale, call);\n                 self.djsTimeLabel.node.runAction(tseq);\n             }\n         );\n\n         let scale = cc.scaleTo(0.3, 0);\n         let delay1 = cc.delayTime(1);\n         tywx.tt.AudioManager.getInstance().playSound(tywx.tt.constants.SOUNDS.COMBO[4]);\n\n         let call = cc.callFunc(function () {\n             self.djsTimeLabel.string = 4;\n             self.djsTimeLabel.node.scale = 1;\n         });\n         let tseq = cc.sequence(delay1, scale, call);\n         this.djsTimeLabel.node.runAction(tseq);\n\n         let delay = cc.delayTime(1.5);\n         let seq = cc.sequence(delay, djsCall);\n         let repeate = cc.repeat(seq, this.djstime);\n         this.node.stopAllActions();\n         this.node.runAction(repeate);\n     },\n\n     fuHuoCall: function () {\n         tywx.tt.BoardView.recoverGame();\n         fuhuo_view.curnode.removeFromParent(true);\n         fuhuo_view.curnode = null;\n     },\n\n     setData(data) {\n         this.data = data;\n         this.scoreLabel.string = data.score;\n     },\n\n     start() {\n\n     },\n\n     statics: {\n         curnode: null,\n         /**\n          * @description 显示gameOver的视图\n          * @param {Object} data gameover的显示数据\n          */\n         show: function (data) {\n             if (!fuhuo_view.curnode) {\n                 cc.loader.loadRes(fuhuo_view_path, (err, prefab) => {\n                     if (!err) {\n                         let fuhuonode = cc.instantiate(prefab);\n                         let ani = fuhuonode.getComponent(cc.Animation);\n                         ani.play(\"show_hide\");\n                         let ads_script = fuhuonode.getComponent('fuhuo_view');\n                         ads_script.setData(data);\n                         fuhuo_view.curnode = fuhuonode;\n                         tywx.tt.Utils.commonScaleIn(ads_script.root);\n                         cc.director.getScene().addChild(fuhuonode);\n                     }\n                 });\n             }\n         }\n     },\n });\n\n\n module.exports = fuhuo_view;"]}