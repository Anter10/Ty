{"version":3,"sources":["../../../../../assets/scripts/common_frame/assets/scripts/common_frame/ShareInterface.js"],"names":["tywx","ShareInterface","OnShareAppMessageInfo","ShareTimeStamp","IsWaitingCallback","setOnShareAppMessageInfo","title","imageUrl","sharePointId","shareSchemeId","getOnShareAppMessageInfo","getRandomOnShareAppMessageInfo","shareKeys","_key","PropagateInterface","_cachedShareConfig","push","length","randomIndex","Math","floor","random","sharePointKey","sharePointInfo","config","shareContent","sharePicUrl","share","successCallback","failCallback","extraInfo","share2","IsWechatPlatform","BiLog","clickStat","clickStatEventType","clickStatEventTypeUserShare","query","UserInfo","userId","userName","Date","getTime","CurrentShareParams","wx","shareAppMessage","success","result","console","log","fail","complete","err","LOGE","JSON","stringify","shareBack","time_stack","wait_time","shareParams","tt","configManager","getInstance","ShareLimit","min_time","max_time","commonFialedCallback","auditing","isMinGanIP","ShareToast","show","Utils","showWXModal","content","onShareAppMessageInit","onShareAppMessage","shareTickets","groupMsgInfos"],"mappings":"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","file":"ShareInterface.js","sourceRoot":"../../../../../assets/scripts/common_frame","sourcesContent":["/**\n * Created by xiaochuntian on 2018/5/3.\n */\n\ntywx.ShareInterface = {\n    OnShareAppMessageInfo: null, //右上角转发对应的分享点信息\n    ShareTimeStamp: 0,\n    IsWaitingCallback: false,\n    /**\n     * 设置右上角\"转发\"对应的分享信息\n     * @param title\n     * @param imageUrl\n     * @param sharePointId\n     * @param shareSchemeId\n     */\n    setOnShareAppMessageInfo: function (title, imageUrl, sharePointId, shareSchemeId) {\n        this.OnShareAppMessageInfo = {\n            title: title,\n            imageUrl: imageUrl,\n            sharePointId: sharePointId,\n            shareSchemeId: shareSchemeId\n        }\n    },\n\n    /**\n     * 获取右上角\"转发\"对应的分享信息\n     * @returns {null}\n     */\n    getOnShareAppMessageInfo: function () {\n        return this.OnShareAppMessageInfo;\n    },\n\n    /**\n     * 随机获取一个分享点作为\"转发\"对应的分享信息\n     * @returns {*}\n     */\n    getRandomOnShareAppMessageInfo: function () {\n        var shareKeys = [];\n\n        for (var _key in tywx.PropagateInterface._cachedShareConfig) {\n            shareKeys.push(_key);\n        }\n        if (shareKeys && shareKeys.length > 0) {\n            var randomIndex = (Math.floor(Math.random() * 10000)) % shareKeys.length;\n            var sharePointKey = shareKeys[randomIndex];\n            var sharePointInfo = tywx.PropagateInterface._cachedShareConfig[sharePointKey];\n            if (sharePointInfo && sharePointInfo.length > 0) {\n                randomIndex = (Math.floor(Math.random() * 10000)) % sharePointInfo.length;\n                var config = {\n                    title: sharePointInfo[randomIndex].shareContent,\n                    imageUrl: sharePointInfo[randomIndex].sharePicUrl,\n                    sharePointId: sharePointInfo[randomIndex].sharePointId,\n                    shareSchemeId: sharePointInfo[randomIndex].shareSchemeId\n                }\n                return config;\n            }\n        }\n        return null;\n    },\n\n    /**\n     * 根据分享信息调用分享接口,并封装了必要的打点和处理\n     * @param title\n     * @param imageUrl\n     * @param sharePointId\n     * @param shareSchemeId\n     * @param successCallback\n     * @param failCallback\n     * @param extraInfo 额外信息\n     */\n    share: function (title, imageUrl, sharePointId, shareSchemeId, successCallback, failCallback, extraInfo) {\n        return tywx.ShareInterface.share2(title, imageUrl, sharePointId, shareSchemeId, successCallback, failCallback, extraInfo);\n        /** \n        try {\n            if (tywx.IsWechatPlatform()) {\n                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare, [sharePointId, 1, shareSchemeId]);\n                let query = 'inviteCode=' + tywx.UserInfo.userId + '&sourceCode=' + sharePointId + \"&inviteName=\" + tywx.UserInfo.userName + \"&imageType=\" + shareSchemeId + \"&extraInfo=\" + (extraInfo ? extraInfo : ''); \n                wx.shareAppMessage({\n                    title: title,\n                    imageUrl: imageUrl,\n                    query: query,\n                    success: function (result) {\n                        //分享成功相关处理\n                        if (successCallback) {\n                            successCallback(result);\n                        }\n                        tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare, [sharePointId, 2, shareSchemeId]);\n                    },\n                    fail: function (result) {\n                        //分享失败相关处理\n                        if (failCallback) {\n                            failCallback(result);\n                        }\n                    },\n                    complete: function () {\n                    }\n                });\n            }\n        }\n        catch(err) {\n            tywx.LOGE(\"error:\", \"tywx.ShareInterface.share——\" + JSON.stringify(err));\n        }*/\n    },\n    share2: function (title, imageUrl, sharePointId, shareSchemeId, successCallback, failCallback, extraInfo) {\n        try {\n            if (tywx.IsWechatPlatform()) {\n                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare, [sharePointId, 1, shareSchemeId]);\n                let query = 'inviteCode=' + tywx.UserInfo.userId + '&sourceCode=' + sharePointId + \"&inviteName=\" + tywx.UserInfo.userName + \"&imageType=\" + shareSchemeId + \"&extraInfo=\" + (extraInfo ? extraInfo : '');\n                tywx.ShareInterface.ShareTimeStamp = new Date().getTime();\n                tywx.ShareInterface.IsWaitingCallback = true;\n                tywx.ShareInterface.CurrentShareParams = {\n                    title: title,\n                    imageUrl: imageUrl,\n                    sharePointId: sharePointId,\n                    shareSchemeId: shareSchemeId,\n                    successCallback: successCallback,\n                    failCallback: failCallback,\n                    extraInfo: extraInfo\n                };\n                wx.shareAppMessage({\n                    title: title,\n                    imageUrl: imageUrl,\n                    query: query,\n                    success: function (result) {\n                        console.log(\"share success\");\n                    },\n                    fail: function (result) {\n                        console.log(\"share fail\");\n                    },\n                    complete: function () {\n                        console.log(\"share complete\");\n                    }\n                });\n            }\n        } catch (err) {\n            tywx.LOGE(\"error:\", \"tywx.ShareInterface.share——\" + JSON.stringify(err));\n        }\n    },\n    shareBack: function () {\n        console.log('tywx.ShareInterface.shareBack');\n        let time_stack = new Date().getTime();\n        let wait_time = time_stack - tywx.ShareInterface.ShareTimeStamp;\n        let shareParams = tywx.ShareInterface.CurrentShareParams;\n        let [min_time, max_time] = tywx.tt.configManager.getInstance().ShareLimit || [3000, 10000];\n        console.log('tywx.ShareInterface.shareBack', wait_time, min_time, max_time, JSON.stringify(shareParams));\n        if (shareParams) {\n            if (wait_time >= min_time) {\n                console.log('tywx.ShareInterface.shareBack', 'success');\n                shareParams.successCallback && shareParams.successCallback(null);\n                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare, [shareParams.sharePointId, 2, shareParams.shareSchemeId]);\n            } else {\n                console.log('tywx.ShareInterface.shareBack', 'fail');\n                shareParams.failCallback && shareParams.failCallback();\n                tywx.ShareInterface.commonFialedCallback();\n            }\n        }\n        tywx.ShareInterface.IsWaitingCallback = false;\n        tywx.ShareInterface.CurrentShareParams = null;\n    },\n    commonFialedCallback: function () {\n        if (tywx.tt.configManager.getInstance().auditing ||\n            tywx.tt.isMinGanIP ||\n            !tywx.tt.configManager.getInstance().ShareToast.show) {\n            return;\n        }\n        tywx.tt.Utils.showWXModal(tywx.tt.configManager.getInstance().ShareToast.content, '温馨提示');\n    }\n};\n\ntywx.onShareAppMessageInit = function () {\n    try {\n        if (tywx.IsWechatPlatform()) {\n            wx.onShareAppMessage(function (result) {\n                /**\n                 * 获取转发信息,手动设置过则使用设置信息,否则随机获取一个分享点信息\n                 */\n                var config = tywx.ShareInterface.getOnShareAppMessageInfo();\n                if (config == null) {\n                    config = tywx.ShareInterface.getRandomOnShareAppMessageInfo();\n                }\n                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare, [config.sharePointId, 1, config.shareSchemeId]);\n                return {\n                    title: config.title,\n                    imageUrl: config.imageUrl,\n                    query: \"inviteCode=\" + tywx.UserInfo.userId + \"&sourceCode=\" + config.sharePointId + \"&inviteName=\" + tywx.UserInfo.userName + \"&imageType=\" + config.shareSchemeId,\n                    success: function (shareTickets, groupMsgInfos) {\n                        tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare, [config.sharePointId, 2, config.shareSchemeId]);\n                    },\n                    fail: function () {\n\n                    },\n                    complete: function () {}\n                }\n            });\n        };\n    } catch (err) {\n        tywx.LOGE(\"error:\", \"tywx.ShareInterface.share——\" + JSON.stringify(err));\n    }\n};\n\ntywx.onShareAppMessageInit();"]}