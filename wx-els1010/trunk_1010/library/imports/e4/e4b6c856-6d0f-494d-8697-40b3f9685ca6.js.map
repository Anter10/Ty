{"version":3,"sources":["../../../../../assets/scripts/common_frame/assets/scripts/common_frame/ShareInterface.js"],"names":["tywx","ShareInterface","OnShareAppMessageInfo","shareWithSharePoint","sharePointStr","successCallback","failCallback","extraInfo","PropagateInterface","_cachedShareConfig","randomShareInfo","_shuffleByWeights","sharePointInfo","share","shareContent","sharePicUrl","sharePointId","shareSchemeId","setOnShareAppMessageInfoWithSharePoint","title","imageUrl","setOnShareAppMessageInfo","getOnShareAppMessageInfo","getRandomOnShareAppMessageInfo","shareKeys","_key","push","length","randomIndex","Math","floor","random","sharePointKey","config","IsWechatPlatform","BiLog","clickStat","clickStatEventType","clickStatEventTypeUserShare","wx","shareAppMessage","query","UserInfo","userId","userName","success","result","SystemInfo","openLocalRecord","TuyooSDK","freshLocalShareTimes","fail","complete","err","LOGE","JSON","stringify","onShareAppMessageInit","onShareAppMessage","shareTickets","groupMsgInfos"],"mappings":"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","file":"ShareInterface.js","sourceRoot":"../../../../../assets/scripts/common_frame","sourcesContent":["/**\n * Created by xiaochuntian on 2018/5/3.\n */\n\ntywx.ShareInterface = {\n    OnShareAppMessageInfo: null,   //右上角转发对应的分享点信息\n\n    shareWithSharePoint: function(sharePointStr, successCallback, failCallback, extraInfo) {\n        if(tywx.PropagateInterface._cachedShareConfig) {\n            var randomShareInfo = tywx.PropagateInterface._shuffleByWeights();\n            if(randomShareInfo && randomShareInfo[sharePointStr]) {\n                var sharePointInfo = randomShareInfo[sharePointStr];\n                tywx.ShareInterface.share(sharePointInfo.shareContent, sharePointInfo.sharePicUrl,\n                    sharePointInfo.sharePointId, sharePointInfo.shareSchemeId, successCallback, failCallback, extraInfo);\n            }\n        } else {\n            return null;\n        }\n    },\n\n    /**\n     * 设置右上角\"转发\"对应的分享信息(通过给出分享点)\n     */\n    setOnShareAppMessageInfoWithSharePoint: function(sharePointStr){\n        if(tywx.PropagateInterface._cachedShareConfig) {\n            var randomShareInfo = tywx.PropagateInterface._shuffleByWeights();\n            if(randomShareInfo && randomShareInfo[sharePointStr]) {\n                var sharePointInfo = randomShareInfo[sharePointStr];\n                this.OnShareAppMessageInfo = {\n                    title: sharePointInfo.shareContent,\n                    imageUrl: sharePointInfo.sharePicUrl,\n                    sharePointId: sharePointInfo.sharePointId,\n                    shareSchemeId: sharePointInfo.shareSchemeId\n                }\n            }\n        }\n    },\n\n    /**\n     * 设置右上角\"转发\"对应的分享信息\n     * @param title\n     * @param imageUrl\n     * @param sharePointId\n     * @param shareSchemeId\n     */\n    setOnShareAppMessageInfo: function(title, imageUrl, sharePointId, shareSchemeId){\n        this.OnShareAppMessageInfo = {\n            title: title,\n            imageUrl: imageUrl,\n            sharePointId: sharePointId,\n            shareSchemeId: shareSchemeId\n        }\n    },\n\n    /**\n     * 获取右上角\"转发\"对应的分享信息\n     * @returns {null}\n     */\n    getOnShareAppMessageInfo: function() {\n        return this.OnShareAppMessageInfo;\n    },\n\n    /**\n     * 随机获取一个分享点作为\"转发\"对应的分享信息\n     * @returns {*}\n     */\n    getRandomOnShareAppMessageInfo: function() {\n        var shareKeys = [];\n\n        for(var _key in tywx.PropagateInterface._cachedShareConfig){\n            shareKeys.push(_key);\n        }\n        if(shareKeys && shareKeys.length > 0) {\n            var randomIndex = (Math.floor(Math.random()*10000))%shareKeys.length;\n            var sharePointKey = shareKeys[randomIndex];\n            var sharePointInfo = tywx.PropagateInterface._cachedShareConfig[sharePointKey];\n            if(sharePointInfo && sharePointInfo.length > 0) {\n                randomIndex = (Math.floor(Math.random()*10000))%sharePointInfo.length;\n                var config = {\n                    title: sharePointInfo[randomIndex].shareContent,\n                    imageUrl: sharePointInfo[randomIndex].sharePicUrl,\n                    sharePointId: sharePointInfo[randomIndex].sharePointId,\n                    shareSchemeId: sharePointInfo[randomIndex].shareSchemeId\n                }\n                return config;\n            }\n        }\n        return null;\n    },\n\n    /**\n     * 根据分享信息调用分享接口,并封装了必要的打点和处理\n     * @param title\n     * @param imageUrl\n     * @param sharePointId\n     * @param shareSchemeId\n     * @param successCallback\n     * @param failCallback\n     * @param extraInfo 额外信息\n     */\n    share: function(title, imageUrl, sharePointId, shareSchemeId, successCallback, failCallback, extraInfo) {\n        try {\n            if (tywx.IsWechatPlatform()) {\n                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare, [sharePointId, 1, shareSchemeId]);\n                wx.shareAppMessage({\n                    title: title,\n                    imageUrl: imageUrl,\n                    query: 'inviteCode=' + tywx.UserInfo.userId + '&sourceCode=' + sharePointId + \"&inviteName=\" + tywx.UserInfo.userName + \"&imageType=\" + shareSchemeId + \"&extraInfo=\" + (extraInfo ? extraInfo : ''),\n                    success: function (result) {\n                        //分享成功相关处理\n                        if (successCallback) {\n                            successCallback(result);\n                        }\n                        tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare, [sharePointId, 2, shareSchemeId]);\n                        if(tywx.SystemInfo.openLocalRecord){\n                            tywx.TuyooSDK.freshLocalShareTimes();\n                        }\n                    },\n                    fail: function (result) {\n                        //分享失败相关处理\n                        if (failCallback) {\n                            failCallback(result);\n                        }\n                    },\n                    complete: function () {\n                    }\n                });\n            }\n        }\n        catch(err) {\n            tywx.LOGE(\"error:\", \"tywx.ShareInterface.share——\" + JSON.stringify(err));\n        }\n    }\n};\n\ntywx.onShareAppMessageInit = function() {\n    try{\n        if(tywx.IsWechatPlatform()) {\n            wx.onShareAppMessage(function (result) {\n                /**\n                 * 获取转发信息,手动设置过则使用设置信息,否则随机获取一个分享点信息\n                 */\n                tywx.ShareInterface.setOnShareAppMessageInfoWithSharePoint(\"defaultSharePoint\");\n                var config = tywx.ShareInterface.getOnShareAppMessageInfo();\n                if(config == null) {\n                    config = tywx.ShareInterface.getRandomOnShareAppMessageInfo();\n                }\n                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare,[config.sharePointId, 1, config.shareSchemeId]);\n                return {\n                    title: config.title,\n                    imageUrl : config.imageUrl,\n                    query : \"inviteCode=\"+tywx.UserInfo.userId+\"&sourceCode=\"+config.sharePointId+\"&inviteName=\"+tywx.UserInfo.userName+\"&imageType=\"+config.shareSchemeId,\n                    success : function (shareTickets,groupMsgInfos) {\n                        tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare,[config.sharePointId, 2, config.shareSchemeId]);\n                        if(tywx.SystemInfo.openLocalRecord){\n                            tywx.TuyooSDK.freshLocalShareTimes();\n                        }\n                    },\n                    fail : function () {\n\n                    },\n                    complete : function () {\n                    }\n                }\n            });\n        };\n    }\n    catch(err) {\n        tywx.LOGE(\"error:\", \"tywx.ShareInterface.share——\" + JSON.stringify(err));\n    }\n};\n\ntywx.onShareAppMessageInit();"]}