{"version":3,"sources":["../../../../../../assets/scripts/game/rank/assets/scripts/game/rank/rank_view.js"],"names":["cc","Class","extends","Component","properties","phbSprite","Sprite","selfPmSprite","rankShareButton","Node","background","touchNode","onLoad","tywx","tt","friend","setStop","Utils","sendWXMsg","method","self","tex","Texture2D","tex1","window","sharedCanvas","width","height","rankBtnScript","getComponent","setButtonCallType","setShareConfig","constants","ShareConfig","HOME_RANK_SHARE","setSuccessCall","shareSuc","setTouchEndCall","closeRankView","delay","delayTime","delay1","dscall","callFunc","_updateSelfPM","call","drawrank","seq","sequence","node","stopAllActions","runAction","isdrawranking","MAIN_MENU_NUM","TT_SCORE","Timer","setTimer","_updateSubDomainCanvas","closeing","rank_manager","friendsRankView","removeFromParent","ani","Animation","on","play","start","wx","openDataContext","getOpenDataContext","canvas","initWithElement","handleLoadedTexture","spriteFrame","SpriteFrame"],"mappings":"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","file":"rank_view.js","sourceRoot":"../../../../../../assets/scripts/game/rank","sourcesContent":[" cc.Class({\n     extends: cc.Component,\n\n     properties: {\n         phbSprite: cc.Sprite,\n         selfPmSprite: cc.Sprite,\n         rankShareButton: cc.Node,\n         background: cc.Node,\n         touchNode: cc.Node,\n     },\n\n\n     onLoad() {\n         tywx.tt.friend.setStop(true);\n         tywx.tt.Utils.sendWXMsg({\n             method: 9,\n         });\n\n         var self = this;\n         this.tex = new cc.Texture2D();\n         this.tex1 = new cc.Texture2D();\n         window.sharedCanvas.width = 635;\n         window.sharedCanvas.height = 120;\n         tywx.tt.Utils.sendWXMsg({\n             method: 20,\n         });\n\n         const rankBtnScript = this.rankShareButton.getComponent(\"ShareButton\")\n         rankBtnScript.setButtonCallType(1);\n         rankBtnScript.setShareConfig(tywx.tt.constants.ShareConfig.HOME_RANK_SHARE);\n         rankBtnScript.setSuccessCall(function () {\n             self.shareSuc();\n         });\n        //  this.touchNode.on('touchstart', function (event) {\n        //     //  return true;\n        //  });\n        //  this.touchNode.on('touchend', function (event) {\n        //     //  self.closeRankView();\n        //  });\n         this.background.getComponent(\"background\").setTouchEndCall(function () {\n             self.closeRankView();\n         });\n\n         let delay = cc.delayTime(0.7);\n         let delay1 = cc.delayTime(0.5);\n         let dscall = cc.callFunc(function () {\n             self._updateSelfPM();\n         });\n         let call = cc.callFunc(function () {\n             self.drawrank();\n         });\n\n\n         let seq = cc.sequence(delay1, dscall, delay, call);\n         this.node.stopAllActions();\n         this.node.runAction(seq);\n     },\n\n     drawrank: function () {\n         this.isdrawranking = true;\n         window.sharedCanvas.width = 635;\n         window.sharedCanvas.height = 20 * 100;\n         tywx.tt.Utils.sendWXMsg({\n             method: 9,\n         });\n\n         tywx.tt.Utils.sendWXMsg({\n             method: 1,\n             MAIN_MENU_NUM: tywx.tt.constants.TT_SCORE,\n         });\n         let self = this;\n         tywx.Timer.setTimer(this, function () {\n             self._updateSubDomainCanvas();\n         }, 0.5, 11, 0);\n     },\n\n     // 分享成功\n     shareSuc: function () {\n\n     },\n\n     closeRankView: function () {\n         if (this.closeing) {\n             return;\n         }\n         tywx.tt.Utils.sendWXMsg({\n             method: 9,\n         });\n         this.closeing = true;\n         tywx.tt.friend.setStop(false);\n         window.sharedCanvas.width = 211;\n         window.sharedCanvas.height = 98;\n        \n         let call = function () {\n             tywx.tt.rank_manager.friendsRankView.removeFromParent(true);\n             tywx.tt.rank_manager.friendsRankView = null;\n         };\n         let ani = tywx.tt.rank_manager.friendsRankView.getComponent(cc.Animation);\n         ani.on(\"finished\", call, this);\n         ani.play(\"hide_ui\");\n     },\n\n     start() {\n\n     },\n\n     /**\n      * 刷新子域的canvas\n      */\n     _updateSubDomainCanvas: function () {\n         if (!this.tex || !window.wx) {\n             return;\n         }\n         var openDataContext = wx.getOpenDataContext();\n         var sharedCanvas = openDataContext.canvas;\n         this.tex.initWithElement(sharedCanvas);\n         this.tex.handleLoadedTexture();\n         this.phbSprite.spriteFrame = new cc.SpriteFrame(this.tex);\n     },\n\n     /**\n      * 刷新子域的canvas\n      */\n\n     _updateSelfPM: function () {\n         if (!this.tex1 || !window.wx || this.isdrawranking) {\n             return;\n         }\n         var openDataContext = wx.getOpenDataContext();\n         var sharedCanvas = openDataContext.canvas;\n         this.tex1.initWithElement(sharedCanvas);\n         this.tex1.handleLoadedTexture();\n         this.selfPmSprite.spriteFrame = new cc.SpriteFrame(this.tex1);\n     },\n\n\n     // update (dt) {},\n });"]}