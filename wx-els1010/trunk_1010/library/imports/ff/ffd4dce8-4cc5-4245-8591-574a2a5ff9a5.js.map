{"version":3,"sources":["../../../../../../assets/scripts/game/gameover/assets/scripts/game/gameover/gameover_view.js"],"names":["gameover_view_path","gameover_rank","require","gameover_view","cc","Class","extends","Component","properties","scoreLabel","Label","restartBtn","Node","jcdlNode","maxScoreLabel","phbnode","shareNode","background","root","btnGetMoney","restartGame","closeCall","rankBtnCall","tywx","tt","rank_manager","showRank","shareCall","closeing","Utils","sendWXMsg","method","hideChilds","onLoad","self","curgamescene","storeScore","NotificationCenter","listen","events","TT_EVENT_RED_PACKET_CHANGE","onRedPacktChange","active","console","log","JSON","stringify","RedPacketInfo","configManager","getInstance","auditing","data","max","formatCashFen2Yuan","totalAmount","getComponent","init","setShowCall","sharescript","calltype","config","constants","ShareConfig","GAMEOVER_SHARE","GAMEOVER_VIDEO","setShareConfig","setButtonCallType","setSuccessCall","TAG","canadd","ads","addAdsNode","v2","addIcon","string","parseInt","loadItem","TT_SCORE","res","fuHuoCall","childs","children","tindex","call","callFunc","node","seq","sequence","scaleTo","runAction","length","curnode","removeFromParent","friend","setStop","showWXBanner","BoardView","reset","blocksAni","seq1","delayTime","delay","rep","repeat","setData","scorecz","score","tscore","time","stopAllActions","start","statics","show","loader","loadRes","err","prefab","gameovernode","instantiate","ani","Animation","play","ads_script","commonScaleIn","director","getScene","addChild","module","exports"],"mappings":"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","file":"gameover_view.js","sourceRoot":"../../../../../../assets/scripts/game/gameover","sourcesContent":[" const gameover_view_path = \"prefabs/gameover_view\";\n let gameover_rank = require('../gameover/gameover_rank.js');\n const gameover_view = cc.Class({\n     extends: cc.Component,\n     properties: {\n         scoreLabel: cc.Label,\n         restartBtn: cc.Node,\n         jcdlNode: cc.Node,\n         maxScoreLabel: cc.Label,\n         phbnode: cc.Node,\n         shareNode: cc.Node,\n         background: cc.Node,\n         root: cc.Node,\n         btnGetMoney: cc.Node,\n     },\n\n\n     restartGame: function () {\n         this.closeCall();\n     },\n\n     rankBtnCall: function () {\n         tywx.tt.rank_manager.showRank();\n     },\n\n     shareCall: function () {\n\n     },\n\n     closeCall: function () {\n         if (this.closeing) {\n             return;\n         }\n         this.closeing = true;\n         tywx.tt.Utils.sendWXMsg({\n             method: 9,\n         });\n         this.hideChilds();\n     },\n\n     onLoad() {\n         var self = this;\n         // 存储分数\n         tywx.tt.curgamescene.storeScore();\n         tywx.NotificationCenter.listen(tywx.tt.events.TT_EVENT_RED_PACKET_CHANGE, this.onRedPacktChange, this);\n         this.btnGetMoney.active = false;\n         console.log(\"红包数据 = \" + JSON.stringify(tywx.tt.RedPacketInfo));\n         if (tywx.tt.configManager.getInstance().auditing == false && tywx.tt.RedPacketInfo) {\n             self.btnGetMoney.active = true;\n             let data = {}\n             data.max = tywx.tt.Utils.formatCashFen2Yuan(tywx.tt.RedPacketInfo.totalAmount);\n             self.btnGetMoney.getComponent('GetMoneyButton').init(data);\n             self.btnGetMoney.getComponent('GetMoneyButton').setShowCall(function () {\n                 console.log(\"主界面的红包\");\n             })\n         } else {\n             self.btnGetMoney.active = false;\n         }\n         //  this.background.getComponent(\"background\").setTouchEndCall(function () {\n         //      self.restartGame();\n         //  });\n         // 初始化复活按钮的相关设置\n         //  this.fuhuoScript = this.restartBtn.getComponent(\"ShareButton\")\n         //  this.fuhuoScript.setButtonCallType(1);\n         //  let share = false;\n         //  let calltype = share ? 1 : 2;\n         //  const config = calltype == 1 ? tywx.tt.constants.ShareConfig.GAMEOVER_FUHUO_SHARE : tywx.tt.constants.ShareConfig.GAMEOVER_FUHUO_VIDEO;\n         //  this.fuhuoScript.setShareConfig(config);\n         //  this.fuhuoScript.setSuccessCall(function () {\n         //      self.fuHuoCall();\n         //  });\n\n         this.sharescript = this.shareNode.getComponent(\"ShareButton\")\n         var self = this;\n         //  const share_control = tywx.tt.configManager.getInstance().share_control ? tywx.tt.configManager.getInstance().share_control.recovergame : [\"share\", 100];\n         const calltype = 1; //tywx.tt.Utils.shareVideoCtr(share_control);\n         const config = calltype == 1 ? tywx.tt.constants.ShareConfig.GAMEOVER_SHARE : tywx.tt.constants.ShareConfig.GAMEOVER_VIDEO;\n         this.sharescript.setShareConfig(config);\n         this.sharescript.setButtonCallType(calltype);\n         this.sharescript.setSuccessCall(function () {\n             //  self.fuHuoCall();\n             tywx.tt.log(TAG, \"分享成功\");\n         });\n\n         // 添加交叉倒流节点\n         var canadd = true;\n         canadd && tywx.tt.ads.addAdsNode(\"blink_play\", this.jcdlNode, cc.v2(0, 0));\n         // 开始倒计时\n         // 添加好友排行的界面\n         gameover_rank.addIcon(this.phbnode);\n         this.maxScoreLabel.string = parseInt(tywx.tt.Utils.loadItem(tywx.tt.constants.TT_SCORE, 0)) + \"\";\n     },\n\n     /**\n      * @description 红包数据变化的时候调用\n      * @param {Object} res 红包变化的数据\n      */\n     onRedPacktChange: function (res) {\n         console.log(\"红包数据 = \" + JSON.stringify(res));\n         if (res.data && res.data.totalAmount) {\n             let data = {}\n             data.max = tywx.tt.Utils.formatCashFen2Yuan(res.data.totalAmount);\n             this.btnGetMoney.getComponent('GetMoneyButton').init(data);\n         } else {\n             tywx.tt.log(TAG, \"通知事件中的红包数据 = \" + JSON.stringify(res));\n         }\n     },\n\n\n     fuHuoCall: function () {\n         this.closeCall();\n     },\n\n     hideChilds: function () {\n         let childs = this.root.children;\n\n         var self = this;\n         let tindex = 0;\n\n         let call = cc.callFunc(function () {\n             let node = childs[tindex];\n             let seq = cc.sequence(cc.scaleTo(0.12, 1.2), cc.scaleTo(0.12, 0));\n             node.runAction(seq);\n             tindex = tindex + 1;\n             if (tindex == childs.length) {\n                 let call = cc.callFunc(function () {\n                     gameover_view.curnode.removeFromParent(true);\n                     gameover_view.curnode = null;\n                     tywx.tt.friend.setStop(false);\n                     tywx.tt.Utils.showWXBanner();\n                     tywx.tt.BoardView.reset();\n                     tywx.tt.BoardView.blocksAni();\n                 });\n                 let seq1 = cc.sequence(cc.delayTime(0.3), call);\n                 gameover_view.curnode.runAction(seq1);\n             }\n         });\n         let delay = cc.delayTime(0.12);\n         let seq = cc.sequence(call, delay);\n         let rep = cc.repeat(seq, childs.length);\n         this.node.runAction(rep);\n     },\n\n     setData(data) {\n         this.data = data;\n         let self = this;\n         let scorecz = data.score;\n         if (scorecz > 0) {\n             let tscore = 0;\n             let call = cc.callFunc(function () {\n                 tscore = tscore + 2;\n                 self.scoreLabel.string = tscore;\n             });\n             let time = 2 / scorecz;\n             let delay = cc.delayTime(time);\n             let seq = cc.sequence(delay, call);\n             let rep = cc.repeat(seq, scorecz / 2);\n             this.scoreLabel.node.stopAllActions();\n             this.scoreLabel.node.runAction(rep);\n         } else {\n             this.scoreLabel.string = \"0\";\n         }\n     },\n\n     start() {\n\n     },\n\n     statics: {\n         curnode: null,\n         /**\n          * @description 显示gameOver的视图\n          * @param {Object} data gameover的显示数据\n          */\n         show: function (data) {\n             cc.loader.loadRes(gameover_view_path, (err, prefab) => {\n                 if (!err) {\n                     let gameovernode = cc.instantiate(prefab);\n                     let ani = gameovernode.getComponent(cc.Animation);\n                     ani.play(\"show_hide\");\n                     let ads_script = gameovernode.getComponent('gameover_view');\n                     ads_script.setData(data);\n                     gameover_view.curnode = gameovernode;\n                     tywx.tt.Utils.commonScaleIn(ads_script.root);\n                     cc.director.getScene().addChild(gameovernode);\n                 }\n             });\n         }\n     },\n });\n\n\n module.exports = gameover_view;"]}