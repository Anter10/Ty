{"version":3,"sources":["../../../../../../assets/scripts/game/lottery/assets/scripts/game/lottery/lottery_manager.js"],"names":["TAG","lotery_view_path","lottery_button_path","lottery_manager","cc","Class","statics","lotterynode","data","getLotteryDataByType","lot_type","tywx","tt","error","setFinishCall","call","getComponent","removeLotteryView","removeFromParent","ani","Animation","on","play","setData","default","turning_disc","log","JSON","stringify","addZPIcon","tlot_type","tparent","tpos","pos","parent","loader","loadRes","err","prefab","adsnode","instantiate","ads_script","setType","position","addChild","listenCDNConfigData","NotificationCenter","listen","events","TT_GET_CONFIG_SUCCESS","showLottery","loterycall","configManager","getInstance","auditing","Utils","commonScaleIn","getChildByName","director","getScene","warn","module","exports"],"mappings":"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","file":"lottery_manager.js","sourceRoot":"../../../../../../assets/scripts/game/lottery","sourcesContent":["let TAG = '[game/lottery/lottery_manager.js]]';\nlet lotery_view_path = \"prefabs/lottery_view\";\nlet lottery_button_path = \"prefabs/lottery_button\";\n\nconst lottery_manager = cc.Class({\n    statics: {\n        lotterynode: null,\n        data: null,\n\n        /**\n         * @description 得到当前类型的抽奖数据\n         * @param {String} lot_type  抽奖数据\n         */\n        getLotteryDataByType: function (lot_type) {\n            if (lottery_manager.data[lot_type]) {\n                return lottery_manager.data[lot_type];\n            } else {\n                tywx.tt.error(TAG, \"没有你给\" + lot_type + \"类型的红包数据\");\n            }\n            return null;\n        },\n\n        /**\n         * @description 设置抽奖结束后的回调方法\n         * @param {Function} call 设置抽奖结束后的回调方法\n         */\n        setFinishCall: function (call) {\n            lottery_manager.lotterynode.getComponent('lottery_view').setFinishCall(call);\n        },\n\n        /**\n         * @description 删除抽奖界面\n         */\n        removeLotteryView: function () {\n            let call = function () {\n                lottery_manager.lotterynode.removeFromParent(false);\n                lottery_manager.lotterynode = null;\n            };\n            let ani = lottery_manager.lotterynode.getComponent(cc.Animation);\n            ani.on(\"finished\", call, this);\n            ani.play(\"hide_ui\");\n        },\n\n        /**\n         * @description 设置游戏的抽奖数据\n         * @param {Object} data 抽奖的所有数据\n         */\n        setData: function (data) {\n            lottery_manager.data = data.default.turning_disc;\n            tywx.tt.log(\"当前的抽奖数据 = \" + JSON.stringify(lottery_manager.data));\n        },\n\n        /**\n         * @description 添加转盘按钮\n         * @param {String} tlot_type \n         * @param {cc.Node} tparent \n         * @param {cc.v2} tpos \n         */\n        addZPIcon: function (tlot_type, tparent, tpos) {\n            const pos = tpos;\n            const parent = tparent;\n            const lot_type = tlot_type;\n            cc.loader.loadRes(lottery_button_path, (err, prefab) => {\n                if (!err) {\n                    let adsnode = cc.instantiate(prefab);\n                    let ads_script = adsnode.getComponent('lottery_button');\n                    ads_script.setType(lot_type);\n                    adsnode.position = pos;\n                    parent.addChild(adsnode);\n                }\n            });\n        },\n\n        /**\n         * @description 监听config的CDN数据\n         */\n        listenCDNConfigData: function () {\n            tywx.NotificationCenter.listen(tywx.tt.events.TT_GET_CONFIG_SUCCESS, lottery_manager.setData, lottery_manager);\n        },\n\n        /**\n         * @description 展示抽奖界面\n         * @param {String} lot_type 抽奖类型\n         */\n        showLottery: function (lot_type, loterycall) {\n            if (!lottery_manager.lotterynode && lottery_manager.data && tywx.tt.configManager.getInstance().auditing == false) {\n                let tlot_type = lot_type;\n                cc.loader.loadRes(lotery_view_path, (err, prefab) => {\n                    if (!err) {\n                        let lotterynode = cc.instantiate(prefab);\n                        let ads_script = lotterynode.getComponent('lottery_view');\n                        let ani = lotterynode.getComponent(cc.Animation);\n                        ani.play(\"show_hide\");\n                        ads_script.setData(lottery_manager.getLotteryDataByType(tlot_type));\n                        lottery_manager.lotterynode = lotterynode;\n                        lottery_manager.setFinishCall(loterycall);\n                        tywx.tt.Utils.commonScaleIn(lotterynode.getChildByName(\"centnode\"));\n                        cc.director.getScene().addChild(lotterynode);\n                    }\n                });\n            } else {\n                tywx.tt.warn(\"没有抽奖数据\");\n            }\n        }\n    },\n});\n\n\n\nmodule.exports = lottery_manager;"]}