{"version":3,"sources":["../../../../../assets/script/ui/assets/script/ui/gameSinglemode.js"],"names":["els","require","ElsUtils","ELSEvent","cc","Class","extends","Component","properties","gameNode","default","type","Node","displayName","winline","lose_single","win_single","whisper_win_single","sl_bg","prefabMTAnima","Prefab","nodeAdapterBgHome","nodeAdapterGame","masks","prefabWisperStartAni","nodeWisperAniParent","btnRevive","nodeZhuBaoInfo","labelZhuBaoCounts","Label","labelBtnRevive","onLoad","active","gameview","getComponent","game_mask","node","getChildByName","nanguan","mask_btn","on","EventType","TOUCH_END","mask_btn_click","onloseBackHandler","onloseRegameHandler","onwinNextHandler","onwinShareHandler","win_content","win_content_icon","self","loader","loadRes","err","prefab","preFabNode","instantiate","openData","insertChild","tywx","NotificationCenter","listen","ELS_EVENT_REFRESH_ZHUBAO_COUNT","refreshZhuBaoInfo","onDestroy","ignoreScope","start","game","UIManager","model","updateWinLine","tmp_model","mconf","isWhisper","isEndless","opacity","strContent","pos_y","pos_x","ltl","getWinLine","position","v2","labelContent","string","getWinStep","isNanGuan","showMe","removeFromParent","stopAllParticleSys","hideMe","params","tmp_grid","mgrid","zhubao_count","mcore","zhubao_max","get","showWisperStart","index","console","log","animation_end_callback","hiden_mask","hideMask","content","split","ani","init","cipherIndex","parent","runAction","sequence","fadeOut","callFunc","showWin","_win_single","undefined","mode","ELS_MODE_SINGLE","cipherData","length","showWithData","openId","showQuery","data","succ","Animation","play","pcs","ParticleSystem","resetSystem","showLose","shibai","is_endless","currentReviveTimes","ENDLESS_VALUES","ReviveMaxTime","showRevive","CONFIG","openEmergency","pcs1","stopSystem","pcs2","eve","loseBackToHome","delItem","reStartGame","nextStage","ShareInterface","shareMsg","ELS_SHRAE_TYPE","GAME_QQH_WIN","GAME_SINGLE_WIN","onwinSaveHandler","onBtnReviveClickCallback","SHARE_REVIVE","successCallback","result","isCanShare2GroupByTicket","SHARE_LOCK_TAG","TAG_REVIVE_AND_GIFT_PROP","add_step","game_over","top_line","clearThreeBottomLines","setGameStatus","ELS_GAME_STATE","PLAYING","setTimeout","isWaitingRevive","Util","wechatShowModal","failCallback"],"mappings":"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","file":"gameSinglemode.js","sourceRoot":"../../../../../assets/script/ui","sourcesContent":["var els = require(\"../core/els.js\");\nvar ElsUtils = require(\"../core/ElsUtils.js\");\nvar ELSEvent = require('../core/ElsEvents.js');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n        gameNode: {\n            default: null,\n            type: cc.Node,\n            displayName: \"对[game common]的引用\"\n        },\n        winline: cc.Node,\n        lose_single: cc.Node,\n        win_single: cc.Node,\n        whisper_win_single: cc.Node,\n        sl_bg: cc.Node,\n        prefabMTAnima: cc.Prefab, //! 猫头鹰动画\n        nodeAdapterBgHome: cc.Node,\n        nodeAdapterGame: cc.Node,\n        masks: [cc.Node],\n        prefabWisperStartAni: {\n            default: null,\n            type: cc.Prefab,\n            displayName: '悄悄话开始动画预制件',\n        },\n        nodeWisperAniParent: {\n            default: null,\n            type: cc.Node,\n            displayName: '悄悄话开始动画父节点',\n        },\n        btnRevive: cc.Node, //! 复活按钮\n        nodeZhuBaoInfo: cc.Node, //! 珠宝信息节点\n        labelZhuBaoCounts: [cc.Label], //! 珠宝数量\n        labelBtnRevive: cc.Label, //* 复活按钮中的label\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n        this.btnRevive.active = false;\n        this.gameview = this.gameNode.getComponent(\"game\");\n        this.game_mask = this.node.getChildByName('game_mask');\n        this.nanguan = this.node.getChildByName('nanguan');\n        this.mask_btn = this.game_mask.getChildByName('mask_btn');\n        this.mask_btn.on(cc.Node.EventType.TOUCH_END, this.mask_btn_click, this);\n\n        this.lose_single.getChildByName('sBackBtn').on(cc.Node.EventType.TOUCH_END, this.onloseBackHandler, this);\n        this.lose_single.getChildByName('sreGameBtn').on(cc.Node.EventType.TOUCH_END, this.onloseRegameHandler, this);\n\n        this.win_single.getChildByName('sNextBtn').on(cc.Node.EventType.TOUCH_END, this.onwinNextHandler, this);\n        this.win_single.getChildByName('sShareBtn').on(cc.Node.EventType.TOUCH_END, this.onwinShareHandler, this);\n\n        // this.whisper_win_single.getChildByName('sShareBtn').on(cc.Node.EventType.TOUCH_END, this.onwinShareHandler, this);\n        // this.whisper_win_single.getChildByName('sSaveBtn').on(cc.Node.EventType.TOUCH_END, this.onwinSaveHandler, this);\n\n        this.win_content = this.whisper_win_single.getChildByName('whisper_win_content');\n        this.win_content_icon = this.whisper_win_single.getChildByName('whisper_win_content_icon');\n        let self = this;\n        cc.loader.loadRes('prefab/OpenData', function(err, prefab) {\n            var preFabNode = cc.instantiate(prefab);\n            // preFabNode.parent = self.node;\n            self.openData = preFabNode;\n            self.node.insertChild(preFabNode, 0);\n        });\n        tywx.NotificationCenter.listen(ELSEvent.ELS_EVENT_REFRESH_ZHUBAO_COUNT, this.refreshZhuBaoInfo, this);\n    },\n\n    onDestroy() {\n        tywx.NotificationCenter.ignoreScope(this);\n    },\n\n    start: function() {\n        this.game = tywx.UIManager.game;\n        this.model = this.game.model;\n        this.updateWinLine();\n    },\n\n    updateWinLine: function() {\n        let tmp_model = tywx.UIManager.game.model;\n        if (tmp_model.mconf.isWhisper || tmp_model.mconf.isEndless) {\n            this.winline.active = false;\n        } else {\n            this.winline.active = true;\n            this.winline.opacity = 150;\n            var strContent = '';\n            var pos_y = -421;\n            var pos_x = 103;\n            var ltl = tmp_model.getWinLine();\n            strContent = `消到${ltl}行以下过关`;\n            pos_y = ltl * 50 + pos_y;\n            this.winline.position = cc.v2(pos_x, pos_y);\n            let labelContent = this.winline.getChildByName('label_win').getComponent(cc.Label);\n            labelContent.string = strContent;\n            tmp_model.getWinStep();\n            this.nanguan.active = tmp_model.isNanGuan;\n        }\n    },\n\n    showMe: function() {\n        if (this.node.openData) {\n            this.node.openData.removeFromParent();\n        }\n        this.win_single.active = false;\n        this.whisper_win_single.active = false;\n        this.lose_single.active = false;\n        this.sl_bg.active = false;\n        this.win_content.active = false;\n        this.win_content_icon.active = false;\n        this.updateWinLine();\n        //! Modify by Lu Ning  at  2018/6/30  18:04 .\n        //! 胜利条件修改为一直显示\n        //this.winline.runAction(cc.sequence(cc.fadeIn(0.5), cc.delayTime(1), cc.fadeOut(0.5)));\n        this.stopAllParticleSys();\n\n        this.nodeAdapterBgHome.active = false;\n        this.nodeAdapterGame.active = true;\n\n        // 珠宝信息\n        let tmp_model = tywx.UIManager.game.model;\n        this.nodeZhuBaoInfo.active = tmp_model.mconf.isEndless;\n        this.refreshZhuBaoInfo();\n    },\n\n    hideMe: function() {\n        this.winline.active = false;\n    },\n    /**\n     * @param {Object} params\n     * @param {Number} params.x\n     * @param {Number} params.y\n     * @param {Number} params.type\n     */\n    refreshZhuBaoInfo: function(params) {\n        let tmp_model = tywx.UIManager.game.model;\n        if (!tmp_model.mconf.isEndless) return;\n        let tmp_grid = tmp_model.mgrid[0];\n        let zhubao_count = tmp_grid.mcore.zhubao_count;\n        let zhubao_max = tmp_grid.mcore.zhubao_max;\n        this.labelZhuBaoCounts[0].string = `${zhubao_count.get(112)}/${zhubao_max.get(112)}`;\n        this.labelZhuBaoCounts[1].string = `${zhubao_count.get(113)}/${zhubao_max.get(113)}`;\n        this.labelZhuBaoCounts[2].string = `${zhubao_count.get(114)}/${zhubao_max.get(114)}`;\n    },\n\n    showWisperStart: function(index) {\n        console.log('showWisperStart', index);\n        let self = this;\n        this.game = tywx.UIManager.game;\n        let animation_end_callback = () => {\n            self.game.hiden_mask();\n            self.hideMask();\n        };\n        let content = this.game.win_content.split(\"\\n\")[1][index];\n\n        let ani = cc.instantiate(this.prefabWisperStartAni);\n        ani.getComponent('WisperStartAnimation').init(content, animation_end_callback, this.masks[this.game.cipherIndex]);\n        ani.parent = this.nodeWisperAniParent;\n    },\n\n    hideMask: function() {\n        //! 右侧区域\n        let self = this;\n        this.game_mask.runAction(cc.sequence(\n            cc.fadeOut(0.5),\n            cc.callFunc(() => {\n                self.game_mask.active = false;\n                self.game_mask.opacity = 255;\n            })\n        ));\n        //! 左侧暗文\n        //this.masks[this.game.cipherIndex].active = false;\n    },\n\n    showWin: function() {\n        this.updateWinLine();\n        this.lose_single.active = false;\n        this.btnRevive.active = false;\n\n        var _win_single = undefined;\n        if (this.game.model.mconf.mode === els.ELS_MODE_SINGLE && this.game.model.mconf.isWhisper === true && this.game.cipherIndex == this.game.cipherData.length) {\n            // TODO: 悄悄话胜利 选择礼物\n            // tywx.MSG.whisperPass(tywx.showQuery.inviteCode, tywx.showQuery.randomKey);\n            this.whisper_win_single.getComponent(\"whisper_win_single\").showWithData({\n                // avatarUrl:this.game.win_contetn_avatarUrl,\n                // user_heard_url:tywx.WXUserInfo.avatarUrl,\n                openId: tywx.showQuery.openId,\n                data: this.game.win_content,\n            });\n            return;\n        } else {\n            this.whisper_win_single.active = false;\n            this.win_single.active = true;\n            _win_single = this.win_single;\n        }\n\n        //新的成功动画  个人\n        var succ = _win_single.getChildByName(\"FangKuai_shengli\");\n        succ.getComponent(cc.Animation).play(\"FangKuai_shengli\");\n        //播放粒子\n        let pcs = succ.getChildByName(\"particlesystem01\").getComponent(cc.ParticleSystem);\n        pcs.resetSystem();\n        //this.model.playMusic(els.ELS_VOICE.WIN_MUSIC, false);\n    },\n\n    showLose: function() {\n        this.lose_single.active = true;\n        this.win_single.active = false;\n        this.whisper_win_single.active = false;\n\n        //新的失败动画  单人\n        var shibai = this.lose_single.getChildByName(\"FangKuai_shibai\");\n        shibai.getComponent(cc.Animation).play(\"FangKuai_shibai\");\n        //播放粒子\n        let pcs = shibai.getChildByName(\"particlesystem01\").getComponent(cc.ParticleSystem);\n        pcs.resetSystem();\n\n        //* 复活按钮显示刷新 normal: 复活+10步，分享复活\n        let is_endless = tywx.UIManager.game.model.mconf.isEndless;\n        this.labelBtnRevive.string = is_endless ? '分享复活' : '分享复活+10步';\n        //! 无尽模式需要限制复活次数\n        if (is_endless && tywx.UIManager.game.currentReviveTimes >= els.ENDLESS_VALUES.ReviveMaxTime) {\n            this.btnRevive.node.active = false;\n        }\n    },\n    /**\n     * 失败显示复活\n     */\n    showRevive: function() {\n        this.showLose();\n        //根据配置显示复活按钮\n        if (els.CONFIG.openEmergency) {\n            //if(true){    \n            this.btnRevive.active = true;\n        } else {\n            this.btnRevive.active = false;\n        }\n    },\n\n    stopAllParticleSys() {\n        var shibai = this.lose_single.getChildByName(\"FangKuai_shibai\");\n        shibai.getComponent(cc.Animation).play(\"FangKuai_shibai\");\n        let pcs1 = shibai.getChildByName(\"particlesystem01\").getComponent(cc.ParticleSystem);\n        pcs1.stopSystem();\n        //新的成功动画\n        var succ = this.win_single.getChildByName(\"FangKuai_shengli\");\n        succ.getComponent(cc.Animation).play(\"FangKuai_shengli\");\n        //播放粒子 \n        let pcs2 = succ.getChildByName(\"particlesystem01\").getComponent(cc.ParticleSystem);\n        pcs2.stopSystem();\n    },\n\n    mask_btn_click: function() {\n        console.log('mask_btn_click');\n        //! 游戏区域遮罩隐藏\n        this.game.hiden_mask();\n        //! 左侧文字遮罩隐藏\n        this.masks[this.game.cipherIndex].active = false;\n    },\n\n    onloseBackHandler(eve) {\n        this.lose_single.active = false;\n        this.stopAllParticleSys();\n        this.game.loseBackToHome();\n    },\n\n    onloseRegameHandler(eve) {\n        let is_endless = tywx.UIManager.game.model.mconf.isEndless;\n        if(is_endless) {\n            console.log(\"delete local ELS_CURRENT_ENDLESS_LEVEL!!!\");\n            ElsUtils.delItem('ELS_CURRENT_ENDLESS_LEVEL');\n        }\n        this.lose_single.active = false;\n        this.stopAllParticleSys();\n        this.game.reStartGame();\n    },\n\n    onwinNextHandler(eve) {\n        this.stopAllParticleSys();\n        this.win_single.active = false;\n        this.whisper_win_single.active = false;\n        console.log(\"fengbing\", \" *-*-*-*- win next handler *-*-*-*-\");\n        if (this.game.model.mconf.mode == els.ELS_MODE_SINGLE && this.game.model.mconf.isWhisper == true && this.game.cipherIndex >= this.game.cipherData.length) {\n            // tywx.UIManager.showUI(els.ELS_GAME_LAYER.HOMEPAGE);\n            this.game.loseBackToHome();\n            this.win_content.getComponent(\"cc.Label\").string = \"\";\n        } else {\n            this.game.nextStage();\n        }\n\n        //this.gameNode.yanhua.active = false;\n    },\n\n    onwinShareHandler(eve) {\n        this.stopAllParticleSys();\n        // 悄悄话通关 分享\n        if (this.game.model.mconf.mode == els.ELS_MODE_SINGLE && this.game.model.mconf.isWhisper == true && this.game.cipherIndex >= this.game.cipherData.length) {\n            tywx.ShareInterface.shareMsg({\n                type: els.ELS_SHRAE_TYPE.GAME_QQH_WIN\n            });\n        } else { // 闯关胜利 分享\n            tywx.ShareInterface.shareMsg({\n                type: els.ELS_SHRAE_TYPE.GAME_SINGLE_WIN\n            });\n        }\n    },\n\n    // save(params) {\n    //     var canvas = cc.game.canvas;\n    //     var width = cc.winSize.width;\n    //     var height = cc.winSize.height;\n    //     canvas.toTempFilePath({\n    //         x: width / 10,\n    //         y: height / 10 + (height - 1280) / 2,\n    //         width: 720*0.8,\n    //         height: 1280*0.8,\n    //         destWidth: 720*0.8,\n    //         destHeight: 1280*0.8,\n    //         success(res) {\n    //             //.可以保存该截屏图片\n    //             console.log(res)\n    //             ElsUtils.saveImage2PhoneByUrl(res.tempFilePath, params.success, params.fail);\n    //         },\n    //         fail(res) {\n    //             params.fail && params.fail();\n    //         }\n    //     });\n    // },\n\n    onwinSaveHandler: function() {\n        console.log(\"onwinSaveHandler11111\");\n        // this.save({\n        //     success: function() {\n        //         wx.hideLoading();\n        //         wx.showToast({\n        //             title: '保存成功',\n        //             duration: 2000,\n        //             icon: null\n        //         });\n        //     },\n        //     fail: function() {\n        //         wx.hideLoading();\n        //         wx.showToast({\n        //             title: '保存失败',\n        //             duration: 2000,\n        //             icon: null\n        //         });\n        //     }\n        // });\n    },\n\n    // update (dt) {},\n    onBtnReviveClickCallback() {\n        let self = this;\n        tywx.ShareInterface.shareMsg({\n            type: els.ELS_SHRAE_TYPE.SHARE_REVIVE,\n            successCallback: (result) => {\n                ElsUtils.isCanShare2GroupByTicket(\n                    els.SHARE_LOCK_TAG.TAG_REVIVE_AND_GIFT_PROP,\n                    result,\n                    () => {\n                        //! success\n                        //! 加10步\n                        self.game.model.add_step += 10;\n                        //! 设置游戏没有结束\n                        self.game.model.mgrid[0].mcore.game_over = false;\n                        //! 限制消除条件\n                        if (self.game.model.mgrid[0].mcore.top_line >= 18) {\n                            //! 消除5行\n                            self.game.model.mgrid[0].clearThreeBottomLines();\n                        }\n                        self.lose_single.active = false;\n\n                        self.game.model.setGameStatus(els.ELS_GAME_STATE.PLAYING);\n                        setTimeout(() => {\n                            //! 设置游戏状态\n                            console.log('reset-waiting-revive-state', self.game.isWaitingRevive);\n                            self.game.isWaitingRevive = false;\n                        }, 2000);\n                        //! Add revive times.\n                        self.game.currentReviveTimes++;\n                    }, () => {\n                        //! fail\n                        console.log('分享失败');\n                        tywx.Util.wechatShowModal(\"复活失败，请分享到不同群\", false, \"确认\");\n                    }\n                );\n            },\n            failCallback: () => {\n                console.log('分享失败');\n            }\n        });\n    }\n});\n"]}