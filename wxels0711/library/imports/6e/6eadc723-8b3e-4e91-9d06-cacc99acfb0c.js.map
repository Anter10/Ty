{"version":3,"sources":["../../../../../assets/script/CommonFrame/assets/script/CommonFrame/TuyooSDK.js"],"names":["console","log","tywx","TuyooSDK","SESSION_KEY","login","IsWechatPlatform","getSystemInfo","wechatLogin","StateInfo","networkConnected","Timer","setTimer","cc","director","BiLog","clickStat","clickStatEventType","clickStatEventTypeWxLoginStart","wx","success","params","JSON","stringify","clickStatEventTypeWxLoginSuccess","code","WXUserInfo","loginTuyooWithCode","OpenDataContextUtil","getUserInfo","ret","e","NotificationCenter","trigger","EventType","WEIXIN_LOGIN_SUCCESS","fail","clickStatEventTypeWxLoginFailed","WEIXIN_LOGIN_FAIL","complete","loginTuyooWith3rdSession","getStorage","key","data","request","url","SystemInfo","loginUrl","snsId","deviceName","clientId","appId","userInfo","cancelTimer","showShareMenu","withShareTicket","gender","local_uuid","Util","getLocalUUID","uuid","sdkPath","dataObj","wxAppId","scene_id","UserInfo","scene_param","invite_id","nickName","nikeName","avatarUrl","clickStatEventTypeLoginSDKStart","header","method","checkData","error","result","userId","userName","userPic","purl","authorCode","wxgame_session_key","token","setStorage","clickStatEventTypeLoginSDKSuccess","initWebSocketUrl","showQuery","sourceCode","clickStatEventTypeUserFrom","inviteCode","imageType","SDK_LOGIN_SUCCESS","clickStatEventTypeLoginSDKFailed","SDK_LOGIN_FAIL","loginResult","TCPClient","reconnet","model","isiPhone","indexOf","windowHeight","resultType","systemType","wechatType","version","system","wechatAuthorize","getSetting","res","authSetting","clickStatEventTypeAuthorizationStart","authorize","scope","clickStatEventTypeAuthorizationSuccess","START_AUTHORIZATION_SUCCESS","clickStatEventTypeAuthorizationFailed","START_AUTHORIZATION_FAILED","createOrder","id","prodPrice","name","prodCount","prodId","chargeType","gameId","prodName","appInfo","rechargeOrder","orderCallFunc","platformOrderId","chargeCoin","_chargeCoin","imei","results","tips","getStoreList","GET_STORE_LIST_SUCCESS","GET_STORE_LIST_FAIL","reqUrl","hall_version","mustcharge","chargeInfo","chargeData","notifyUrl","replace","requestMidasPayment","mode","env","offerId","buyQuantity","chargeTotal","platform","currencyType","zoneId","WechatInterfaceInit","onShow","scene","query","scenePath","from","isOnForeground","GAME_SHOW","_inviteCode","hasUUID","checkLocalUUID","oldUserFlag","gdt_vid","weixinadinfo","plaintext","ciphertext","SECRETLANGUAGEDATA","SECRET_LANGUAGE_TO_GAME","isSceneQrCode","hasOwnProperty","path","decodeURIComponent","connectStatus","CONNECT_STATUS_OK","user_add_item","MSG","addItems","select_gift_item","_item","content","items","itemId","substr","_amount","_uuid","whisperStart","undefined","enterGame","onHide","UIManager","game","mconf","isWhisper","loseBackToHome","GAME_HIDE","close","getNetSuccess","isConnected","networkType","getNetworkType","onNetworkStatusChange","onError","d","Date","errMsg","toDateString","toTimeString","message","uploadLogTimely"],"mappings":"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","file":"TuyooSDK.js","sourceRoot":"../../../../../assets/script/CommonFrame","sourcesContent":["/**\n * @author zhaoliang\n * @date 1.28\n *\n * 全局对象\n * 系统信息\n * 包括clientId，loginUrl等\n */\nconsole.log(\"TuyooSDK loaded\");\ntywx.TuyooSDK = {\n    SESSION_KEY: 'TU_SESSION_STORAGE',\n\n    /***************************以下为登录相关接口*********************************/\n    login: function () {\n        if (tywx.IsWechatPlatform()) {\n            tywx.TuyooSDK.getSystemInfo();\n            tywx.TuyooSDK.wechatLogin();\n        }\n        else {\n            //其他平台,待添加\n        }\n    },\n\n    // 微信登录\n    wechatLogin: function () {\n        if (!tywx.IsWechatPlatform()) {\n            return;\n        }\n        if (!tywx.StateInfo.networkConnected) {\n            console.log(\"net work ???\");\n            tywx.Timer.setTimer(cc.director, tywx.TuyooSDK.login, 3);\n            return;\n        }\n        tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeWxLoginStart, []);\n        wx.login({\n            success: function (params) {\n                console.log(null, 'wx login success, params:' + JSON.stringify(params));\n                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeWxLoginSuccess, [params.code]);\n                if (params.code) {\n                    var code = params.code;\n\n                    if (tywx.WXUserInfo) {\n                        tywx.TuyooSDK.loginTuyooWithCode(code, tywx.WXUserInfo);\n                    } else {\n                        try {\n                            tywx.OpenDataContextUtil.getUserInfo(\n                                function (ret) {\n                                    console.log(\"ret-->\" + ret);\n                                    tywx.WXUserInfo = ret[0];\n                                    tywx.TuyooSDK.loginTuyooWithCode(code, tywx.WXUserInfo);\n                                },\n                                function (ret) {\n                                    console.log(ret);\n                                    tywx.TuyooSDK.loginTuyooWithCode(code);\n                                });\n                        } catch (e) {\n                            tywx.TuyooSDK.loginTuyooWithCode(code);\n                        }\n\n                    }\n                    tywx.NotificationCenter.trigger(tywx.EventType.WEIXIN_LOGIN_SUCCESS, params);\n                }\n            },\n\n            fail: function (params) {\n                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeWxLoginFailed, []);\n                console.log(null, 'wx login fail, params:' + JSON.stringify(params));\n                tywx.NotificationCenter.trigger(tywx.EventType.WEIXIN_LOGIN_FAIL);\n                tywx.Timer.setTimer(cc.director, tywx.TuyooSDK.login, 3);\n            },\n\n            complete: function (params) {\n\n            }\n        });\n    },\n\n    // 微信不需要重新授权，使用\n    loginTuyooWith3rdSession: function () {\n        if (!tywx.IsWechatPlatform()) {\n            return;\n        }\n        wx.getStorage({\n            key: tywx.TuyooSDK.SESSION_KEY,\n            success: function (params) {\n                if (!params.data) {\n                    tywx.TuyooSDK.wechatLogin();\n                    return;\n                }\n                // 微信授权成功后使用code登录途游服务器\n                wx.request({\n                    url: tywx.SystemInfo.loginUrl + 'open/v3/user/processSnsIdNew',\n                    data: {\n                        snsId: params.data,\n                        deviceName: 'wechatGame',\n                        clientId: tywx.SystemInfo.clientId,\n                        appId: tywx.SystemInfo.appId\n                    },\n\n                    success: function (params) {\n                        console.log(null, 'tuyoo login success, params:' + JSON.stringify(params));\n                    },\n\n                    fail: function (params) {\n                        console.log(null, 'tuyoo login fail, params:' + JSON.stringify(params));\n                    },\n\n                    complete: function (params) {\n\n                    }\n                });\n            },\n            fail: function (params) {\n                tywx.TuyooSDK.wechatLogin();\n            },\n            complete: function (params) {\n\n            }\n        });\n    },\n\n    // 微信授权成功后，使用\n    /* {\n     \"data\": {\n     \"result\": {\n     \"code\": 0,\n     \"userId\": 10116,\n     \"exception_report\": 0,\n     \"userType\": 4,\n     \"authInfo\": \"{\\\"authcode\\\": \\\"eyJ1aWQiOiAxMDExNiwgInVuYW1lIjogIlx1Njc2NVx1NWJiZTAwNzRBaWJzVCIsICJ1dG9rZW4iOiAiMjAxOC0wMS0yOSAxNDoxMzoxMi40NzEzMzgiLCAiY29pbiI6IDAsICJlbWFpbCI6ICIiLCAidXRpbWUiOiAiMjAxOC0wMS0yOSAxNDoxMzoxMi40NzA0NzEifQ==\\\", \\\"account\\\": \\\"\\\", \\\"uid\\\": 10116, \\\"usercode\\\": \\\"\\\"}\",\n     \"tcpsrv\": {\n     \"ip\": \"192.168.10.88\",\n     \"port\": 8041\n     },\n     \"isCreate\": 1,\n     \"changePwdCount\": 0,\n     \"360.vip\": 0,\n     \"logclient\": {\n     \"loguploadurl\": \"\",\n     \"logreporturl\": \"\"\n     },\n     \"userPwd\": \"ty817142\",\n     \"purl\": \"http://ddz.image.tuyoo.com/avatar/head_female_0.png\",\n     \"snsId\": \"wxapp:071Nehqt0Z4XEe1jN6qt007Cqt0Nehqz\",\n     \"userEmail\": \"\",\n     \"connectTimeOut\": 35,\n     \"appId\": 9999,\n     \"heartBeat\": 6,\n     \"userName\": \"来宾0074AibsT\",\n     \"mobile\": \"\",\n     \"token\": \"cce362d6-68a8-485e-b137-86ae6828e07a\",\n     \"authorCode\": \"eyJ1aWQiOiAxMDExNiwgInVuYW1lIjogIlx1Njc2NVx1NWJiZTAwNzRBaWJzVCIsICJ1dG9rZW4iOiAiMjAxOC0wMS0yOSAxNDoxMzoxMi40NzEzMzgiLCAiY29pbiI6IDAsICJlbWFpbCI6ICIiLCAidXRpbWUiOiAiMjAxOC0wMS0yOSAxNDoxMzoxMi40NzA0NzEifQ==\",\n     \"log_report\": 0,\n     \"showAd\": 1\n     }\n     },\n     \"header\": {\n     \"Server\": \"nginx/1.4.1\",\n     \"Date\": \"Mon, 29 Jan 2018 06:13:12 GMT\",\n     \"Content-Type\": \"application/json;charset=UTF-8\",\n     \"Transfer-Encoding\": \"chunked\",\n     \"Connection\": \"keep-alive\",\n     \"Content-Encoding\": \"gzip\"\n     },\n     \"statusCode\": 200,\n     \"errMsg\": \"request:ok\"\n     }\n     */\n    loginTuyooWithCode: function (code, userInfo) {\n        if (!tywx.IsWechatPlatform()) {\n            return;\n        }\n        if (!tywx.StateInfo.networkConnected) {\n            console.log(\"net work ???\");\n            tywx.Timer.cancelTimer(cc.director, tywx.TuyooSDK.login);\n            tywx.Timer.setTimer(cc.director, tywx.TuyooSDK.login, 3);\n            return;\n        }\n        // 微信授权成功后使用code登录途游服务器\n        wx.showShareMenu({\n            withShareTicket: true\n        });\n\n\n        //咱们后端 0 是男 1 是女,要转换\n        var gender = 0;\n        if (userInfo && userInfo.gender) {\n            gender = userInfo.gender;\n        }\n\n        var local_uuid = tywx.Util.getLocalUUID();\n        //! UUID保存\n        tywx.SystemInfo.uuid = local_uuid;\n        console.log(\"local_uuid:\", local_uuid);\n        var sdkPath = tywx.SystemInfo.loginUrl;\n        var dataObj = {\n            appId: tywx.SystemInfo.appId,\n            wxAppId: tywx.SystemInfo.wxAppId,\n            clientId: tywx.SystemInfo.clientId,\n            snsId: 'wxapp:' + code,\n            uuid: local_uuid,\n            //以下为上传玩家的微信用户信息\n            // nickName: userInfo.nickName,\n            // avatarUrl: userInfo.avatarUrl,\n            gender: gender,\n            scene_id: tywx.UserInfo.scene_id || \"\",\n            scene_param: tywx.UserInfo.scene_param || \"\",\n            invite_id: tywx.UserInfo.invite_id || 0\n        };\n        let nickName = \"\";\n        if (userInfo && userInfo.nickName) {\n            dataObj.nikeName = userInfo.nickName;\n            nickName = userInfo.nickName;\n        }\n\n        if (userInfo && userInfo.avatarUrl) {\n            dataObj.avatarUrl = userInfo.avatarUrl;\n        }\n        tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeLoginSDKStart, [code, local_uuid, nickName]);\n        wx.request({\n            url: sdkPath + 'open/v6/user/LoginBySnsIdNoVerify',\n            header: {\n                'content-type': 'application/x-www-form-urlencoded'\n            },\n            data: dataObj,\n            method: 'POST',\n\n            success: function (params) {\n                console.log(null, 'tuyoo login success, params:' + JSON.stringify(params));\n                var checkData = params.data;\n                if (checkData.error && checkData.error.code == 1) {\n                    console.log('tuyoo login fail...');\n                    return;\n                }\n                // 保存用户名/用户ID/用户头像\n                var result = checkData.result;\n                tywx.UserInfo.userId = result.userId;\n                tywx.UserInfo.userName = result.userName;\n                tywx.UserInfo.userPic = result.purl;\n                tywx.UserInfo.authorCode = result.authorCode;\n                tywx.UserInfo.wxgame_session_key = result.wxgame_session_key;\n                console.log(null, 'userId:' + tywx.UserInfo.userId + ' userName:' + tywx.UserInfo.userName + ' userPic:' + tywx.UserInfo.userPic);\n\n                var token = result.token;\n                console.log(null, 'token:' + token);\n                wx.setStorage({\n                    key: tywx.TuyooSDK.SESSION_KEY,\n                    data: token\n                });\n\n                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeLoginSDKSuccess, [code, local_uuid, nickName, result.userId]);\n                tywx.TuyooSDK.initWebSocketUrl(result);\n                if (tywx.UserInfo.scene_id && tywx.showQuery && tywx.showQuery.sourceCode) {\n                    tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserFrom,\n                        [\n                            tywx.UserInfo.scene_id,\n                            tywx.showQuery.inviteCode,\n                            tywx.showQuery.sourceCode,\n                            tywx.showQuery.imageType,\n                            \"GameStart\"\n                        ]);\n                }\n                // 发送登录成功事件\n                tywx.NotificationCenter.trigger(tywx.EventType.SDK_LOGIN_SUCCESS);\n            },\n\n            fail: function (params) {\n                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeLoginSDKFailed, [code, local_uuid, nickName]);\n                console.log(null, 'tuyoo login fail, params:' + JSON.stringify(params));\n                tywx.NotificationCenter.trigger(tywx.EventType.SDK_LOGIN_FAIL);\n                tywx.TuyooSDK.loginTuyooWithCode(code, userInfo);\n            },\n\n            complete: function (params) {\n\n            }\n        });\n    },\n\n    /**\n     * 使用sdk登陆返回信息解析得到服务器连接地址,对于单机游戏来说无效\n     * @param loginResult\n     */\n    initWebSocketUrl: function (loginResult) {\n        tywx.TCPClient.reconnet();\n    },\n\n\n    getSystemInfo: function () {\n        // {\n        // \t\"0\":{\n        // \t\"errMsg\":\"getSystemInfo:ok\",\n        // \t\t\"model\":\"iPhone X\",\n        // \t\t\"pixelRatio\":3,\n        // \t\t\"windowWidth\":375,\n        // \t\t\"windowHeight\":812,\n        // \t\t\"system\":\"iOS 10.0.1\",\n        // \t\t\"language\":\"zh_CN\",\n        // \t\t\"version\":\"6.6.3\",\n        // \t\t\"batteryLevel\":100,\n        // \t\t\"screenWidth\":375,\n        // \t\t\"screenHeight\":812,\n        // \t\t\"SDKVersion\":\"1.8.0\",\n        // \t\t\"brand\":\"devtools\",\n        // \t\t\"fontSizeSetting\":16,\n        // \t\t\"statusbarHeight\":44,\n        // \t\t\"platform\":\"devtools\"\n        // }\n        // }\n        if (!tywx.IsWechatPlatform()) {\n            return;\n        }\n        wx.getSystemInfo({\n            success: function (result) {\n                var model = result.model;\n                var isiPhone = model.indexOf(\"iPhone\") >= 0;\n                var windowHeight = result.windowHeight;\n                var resultType = 0;\n                if (isiPhone) {\n                    if (windowHeight == 812) {   //iPhoneX\n                        resultType = 2;\n                    } else if (windowHeight == 736) { // 7p 8p\n                        resultType = 4;\n                    } else {  //其他iPhone\n                        resultType = 1;\n                    }\n                } else { //cc.sys.OS_ANDROID\n                    resultType = 3;\n                }\n                tywx.UserInfo.systemType = resultType;\n                tywx.UserInfo.wechatType = result.version;\n                tywx.UserInfo.model = result.model;\n                tywx.UserInfo.system = result.system;\n            },\n            fail: function () {\n            },\n            complete: function () {\n            }\n        });\n    },\n\n    wechatAuthorize: function () {\n        if (!tywx.IsWechatPlatform()) {\n            return;\n        }\n        wx.getSetting({\n            success: function (res) {\n                if (!res.authSetting['scope.userInfo']) {\n                    tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeAuthorizationStart, []);\n                    wx.authorize({\n                        scope: \"scope.userInfo\",\n                        success: function () {\n                            tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeAuthorizationSuccess, []);\n                            tywx.NotificationCenter.trigger(tywx.EventType.START_AUTHORIZATION_SUCCESS);\n                        },\n                        fail: function () {\n                            tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeAuthorizationFailed, []);\n                            tywx.NotificationCenter.trigger(tywx.EventType.START_AUTHORIZATION_FAILED);\n                        },\n                        complete: function () {\n                        }\n                    });\n                }\n                else {\n                    tywx.NotificationCenter.trigger(tywx.EventType.START_AUTHORIZATION_SUCCESS);\n                }\n            }\n        });\n    },\n\n    /***************************以下为支付相关接口*********************************/\n\n    createOrder: function (id, prodPrice, name, prodCount) {\n        /*\n         params  id:商品ID,prodPrice:价格  单位元, name:商品名称\n         prodCount:购买数量,默认为1\n\n         prodId:商品ID, prodName:商品名称, prodCount:购买数量\n         prodPrice:价格  单位元,\n         chargeType:支付方式 wxapp.iap,\n         gameId:子游戏id,\n         appInfo:透传参数,\n         mustcharge:是否支付 默认填 1\n         */\n        var data = {};\n        data.prodId = id;\n        data.prodPrice = prodPrice;\n        data.chargeType = \"wxapp.iap\";\n        data.gameId = tywx.SystemInfo.gameId;\n        data.prodName = name;\n        data.prodCount = prodCount;\n        data.appInfo = {};\n        tywx.TuyooSDK.rechargeOrder(data);\n    },\n\n    orderCallFunc: function (url, platformOrderId, chargeCoin) {\n        if (!tywx.IsWechatPlatform()) {\n            return;\n        }\n        var local_uuid = tywx.Util.getLocalUUID();\n        var _chargeCoin = chargeCoin;\n        wx.request({\n            url: url,\n            header: {\n                'content-type': 'application/x-www-form-urlencoded'\n            },\n            data: {\n                userId: tywx.UserInfo.userId,\n                appId: tywx.SystemInfo.appId,\n                wxAppId: tywx.SystemInfo.wxAppId,\n                clientId: tywx.SystemInfo.clientId,\n                imei: 'null',\n                uuid: local_uuid,\n                platformOrderId: platformOrderId,\n            },\n\n            method: 'POST',\n\n            success: function (results) {\n                var tips = \"购买成功\";\n            },\n            fail: function (params) {\n                console.log(null, 'file = [Recharge] fun = [OrderCallFun] 充值失败 params = ' + JSON.stringify(params));\n            },\n            complete: function (params) {\n\n            }\n        });\n    },\n\n    /***************************获取道具配置相关接口*********************************/\n    getStoreList: function () {\n        let url = tywx.SystemInfo.loginUrl + \"api/hall5/store/list\";\n        wx.request({\n            url: url,\n            header: {\n                'content-type': 'application/x-www-form-urlencoded'\n            },\n            data: {},\n            method: 'POST',\n            success: function (params) {\n                tywx.NotificationCenter.trigger(tywx.EventType.GET_STORE_LIST_SUCCESS, params);\n            },\n            fail: function (params) {\n                tywx.NotificationCenter.trigger(tywx.EventType.GET_STORE_LIST_FAIL, params);\n            },\n            complete: function (params) {\n                tywx.NotificationCenter.trigger(tywx.EventType.GET_STORE_LIST_FAIL, params);\n            }\n        });\n    },\n\n    /*\n     params prodId:商品ID, prodName:商品名称, prodCount:购买数量\n     prodPrice:价格  单位元,\n     chargeType:支付方式 wxapp.iap,\n     gameId:子游戏id,\n     appInfo:透传参数,\n     mustcharge:是否支付 默认填 1\n     */\n    rechargeOrder: function (params) {\n        if (!tywx.IsWechatPlatform()) {\n            return;\n        }\n        var local_uuid = tywx.Util.getLocalUUID();\n        var sdkPath = tywx.SystemInfo.loginUrl;\n        var reqUrl = tywx.SystemInfo.hall_version == 'hall37' ? sdkPath + 'open/v4/pay/order' : sdkPath + 'open/v5/pay/order';\n        wx.request({\n            url: reqUrl,\n            header: {\n                'content-type': 'application/x-www-form-urlencoded'\n            },\n            data: {\n                userId: tywx.UserInfo.userId,\n                appId: tywx.SystemInfo.appId,\n                wxAppId: tywx.SystemInfo.wxAppId,\n                clientId: tywx.SystemInfo.clientId,\n                imei: 'null',\n                uuid: local_uuid,\n                //商品信息\n                prodId: params.prodId,\n                prodName: params.prodName,\n                prodCount: params.prodCount || 1,\n                prodPrice: params.prodPrice,\n                chargeType: params.chargeType,\n                gameId: params.gameId,\n                appInfo: params.appInfo,\n                mustcharge: params.mustcharge || 1\n            },\n\n            method: 'POST',\n\n            success: function (params) {\n                console.log(null, 'tuyoo rechargeOrder success, params:' + JSON.stringify(params));\n                var results = params.data.result;\n                if (results.code == 0) {\n                    var chargeInfo = results.chargeInfo;\n                    var chargeData = chargeInfo.chargeData;\n                    var notifyUrl = chargeData.notifyUrl.replace(\"ve\", \"vg\");\n                    var platformOrderId = chargeData.platformOrderId;\n                    console.log(null, 'tuyoo rechargeOrder success 创建订单成功, chargeData.mustcharge =' + chargeData.mustcharge);\n                    if (chargeData && chargeData.mustcharge == 1) {\n                        // wx.requestMidasPayment  购买微信币\n                        wx.requestMidasPayment({\n                            mode: chargeData.mode,\n                            env: chargeData.env,\n                            offerId: chargeData.offerId,\n                            buyQuantity: 10 * chargeInfo.chargeTotal,\n                            platform: chargeData.platform,\n                            currencyType: \"CNY\",\n                            zoneId: chargeData.zoneId,\n                            success: function (params) {\n                                // 支付成功\n                                tywx.TuyooSDK.orderCallFunc(notifyUrl, platformOrderId, chargeInfo.chargeCoin);\n                            },\n                            fail: function (params) {\n                                console.log(null, '米大师支付 fail params = ' + JSON.stringify(params));\n                            }\n                        });\n                    } else if (chargeData && chargeData.mustcharge == 0) {\n                        tywx.TuyooSDK.orderCallFunc(notifyUrl, platformOrderId, chargeInfo.chargeCoin);\n                    }\n                } else if (results.code == 1) {\n                    //hall.MsgBoxManager.showToast({title : results.info});\n                } else if (results.code == 3) {\n                    //hall.MsgBoxManager.showToast({title : '微信小程序登陆验证失败!'});\n                }\n            },\n            fail: function (params) {\n                //hall.MsgBoxManager.showToast({title : '购买失败!'});\n            },\n            complete: function (params) {\n            }\n        });\n    },\n};\n\n\ntywx.WechatInterfaceInit = function () {\n    if (tywx.IsWechatPlatform()) {\n        /**\n         * 小程序回到前台,具体逻辑自己实现\n         */\n        wx.onShow(function (result) {\n            // {\"0\":{\"scene\":1044,\"shareTicket\":\"beecdf9e-e881-492c-8a3f-a7d8c54dfcdb\",\"query\":{}}}  (从后台切到前台才有shareTicket,启动时没有)\n            //console.log('', \"+++++++++++++++++onShow+++++++++++++++++\"+JSON.stringify(result));\n            console.log('', \"+++++++++++++++++onShow+++++++++++++++++\" + JSON.stringify(result));\n            //取相关参数\n            var scene = result.scene;\n            var query = result.query;\n            var scenePath = '';\n            //来源处理\n            tywx.UserInfo.scene_id = scene;\n            tywx.UserInfo.scene_param = query.from || \"\";\n            tywx.UserInfo.invite_id = query.inviteCode || 0;\n            tywx.StateInfo.isOnForeground = true;\n            tywx.NotificationCenter.trigger(tywx.EventType.GAME_SHOW, result);\n            let _inviteCode = query && query.inviteCode ? query.inviteCode : 0;\n\n            tywx.showQuery = query || {};\n            var hasUUID = tywx.Util.checkLocalUUID();\n            var oldUserFlag = hasUUID ? 1 : 0;\n\n            if (query && query.gdt_vid && query.weixinadinfo) {\n                //从广点通广告跳过来的，from的开头加入gdt标识区分\n                var from = \"gdt.\" + query.weixinadinfo;\n                tywx.UserInfo.scene_param = from;\n                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserFrom, [scene, from, oldUserFlag]);\n            }\n            else if (query && query.sourceCode) {\n                //从小程序消息卡片中点入,该场景为\"点击用户分享卡片进入游戏注册时，分享用户的user_id直接当做场景参数放在param02，param03和param04分别代表分享点id和分享图文id\"\n                //var query = \"inviteCode=\"+ty.UserInfo.userId+\"&sourceCode=\"+type +\"&imageType=\"+imageMap.imageType+\"&inviteName=\"+ty.UserInfo.userName;\n                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserFrom, [scene, query.inviteCode, query.sourceCode, query.imageType, \"CardActive\", oldUserFlag]);\n                if (query && query.plaintext && query.ciphertext) {\n                    //密语传情进入\n                    tywx.SECRETLANGUAGEDATA = query;\n                    tywx.UserInfo.showQuery = query;\n                    tywx.NotificationCenter.trigger(tywx.EventType.SECRET_LANGUAGE_TO_GAME, query);\n                }\n            } else {\n                if (tywx.Util.isSceneQrCode(scene)) {\n                    //从小程序码进入,相关见文档https://developers.weixin.qq.com/minigame/dev/tutorial/open-ability/qrcode.html\n                    if (query.hasOwnProperty('scene')) {\n                        scenePath = query.scene;\n                    } else if (result.hasOwnProperty('path')) {\n                        scenePath = result.path;\n                    }\n                    scenePath.replace(\".html\", \"\");     //生成时可能会在path后面添加.html\n                    scenePath = decodeURIComponent(scenePath);\n                    tywx.UserInfo.scene_param = scenePath;\n                    tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserFrom, [scene, scenePath, oldUserFlag]);\n                } else {\n                    //场景值和场景参数分别记录到可选参数param01和param02当中，如param01=1058，param02=tuyouqipai\n                    //场景参数由项目组接入推广渠道时配置，如公众号dacihua、tuyouqipai，二维码填写企业或个人标识\n                    tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserFrom, [scene, query.from, oldUserFlag]);\n                }\n            }\n\n            if (tywx.UserInfo.userId === 0) {\n                tywx.TuyooSDK.login();\n                console.log(\"tuyoo login\");\n            } else {\n                if (tywx.TCPClient.connectStatus !== tywx.TCPClient.CONNECT_STATUS_OK) {\n                    tywx.TCPClient.reconnet();\n                    console.log(\"tcp reconnet\");\n                } else {\n                    if (tywx.UserInfo.user_add_item > 0) {\n                        console.log(\"user_add_item ..:: \", tywx.UserInfo.user_add_item);\n                        tywx.MSG.addItems(6, 0, tywx.UserInfo.user_add_item);\n                        tywx.UserInfo.user_add_item = -1;\n                    }\n                    if (tywx.UserInfo.select_gift_item) {\n                        let _item = tywx.UserInfo.select_gift_item ? tywx.UserInfo.select_gift_item.content.items[0].itemId.substr(-4) : \"\";\n                        let _amount = 1;\n                        let _uuid = tywx.UserInfo.select_gift_item.uuid;\n                        tywx.MSG.whisperStart(_uuid, _item, _amount);\n                        tywx.UserInfo.select_gift_item = undefined;\n                    }\n                    \n                    if (_inviteCode !== 0) {\n                        tywx.MSG.enterGame(_inviteCode);\n                        console.log(\"enter game..:: \", _inviteCode);\n                    } else {\n                        console.log(\"enter game..\");\n                    }\n                }\n            }\n        });\n\n        /**\n         * 小程序进入后台\n         */\n        wx.onHide(function () {\n            console.log('', \"+++++++++++++++++onHide+++++++++++++++++\");\n            if (tywx.UIManager.game.model.mconf.mode === 0 && tywx.UIManager.game.model.mconf.isWhisper === true) {\n                tywx.UIManager.game.loseBackToHome();\n                return;\n            }\n            tywx.UserInfo.scene_id = 0;\n            tywx.StateInfo.isOnForeground = false;\n            tywx.NotificationCenter.trigger(tywx.EventType.GAME_HIDE);\n            tywx.TCPClient.close();\n        });\n\n        var getNetSuccess = function (res) {\n            if (res.hasOwnProperty('isConnected')) {\n                tywx.StateInfo.networkConnected = res.isConnected;\n            }\n            // else if (res.hasOwnProperty('errMsg')){\n            //     tywx.StateInfo.networkConnected = res.errMsg == 'getNetworkType:ok'\n            // }\n            else {\n                tywx.StateInfo.networkConnected = res.networkType != 'none';\n            }\n\n            tywx.StateInfo.networkType = res.networkType;//wifi,2g,3g,4g,none,unknown\n\n            if (tywx.StateInfo.networkConnected) {\n                if (tywx.UserInfo.userId === 0) { // 登录失败\n                    tywx.TuyooSDK.login();\n                } else {\n                    if (tywx.TCPClient.connectStatus !== tywx.TCPClient.CONNECT_STATUS_OK) { // tcp 连接异常\n                        tywx.TCPClient.reconnet();\n                    }\n                }\n            }\n        };\n\n        wx.getNetworkType({\n            success: getNetSuccess\n        });\n\n        wx.onNetworkStatusChange(getNetSuccess);\n\n        wx.onError(function (res) {\n            var d = new Date();\n            var errMsg = 'userId:' + tywx.UserInfo.userId + 'time:' + d.toDateString() + ' ' + d.toTimeString() + ';' + res.message;\n            tywx.BiLog.uploadLogTimely(errMsg);\n        });\n    }\n    ;\n};\n\ntywx.WechatInterfaceInit();\n\n"]}