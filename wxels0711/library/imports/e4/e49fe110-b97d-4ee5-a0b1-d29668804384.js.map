{"version":3,"sources":["../../../../../assets/script/ui/assets/script/ui/els_gift_prop_view.js"],"names":["ELSEvent","require","els","ElsUtils","cc","Class","extends","Component","properties","nodeGiftBox","Node","nodeGiftProp","animGiftBox","Animation","animGiftBoxRotate","animGiftProp","animGiftPropRotate","nodePropDisplays","nodeBtnClose","particlesInGiftBox","ParticleSystem","particlesInGiftProp","onLoad","active","isTouchEnable","self","on","num","string","console","log","play","start","showParticlesInGiftBox","forEach","particle","resetSystem","hideParticlesInGiftBox","stopSystem","showParticlesInGiftProp","hideParticlesInGiftProp","_MsgAddItem","params","_locAddItem","_itemId","hideGiftBox","showGiftProp","_node","_i","_s","tywx","UserInfo","local2Server","parseInt","onDestroy","NotificationCenter","ignoreScope","init","game","config","showGiftBox","pauseGame","model","playMusic","ELS_VOICE","BOX_MUSIC","stop","hideGiftProp","onBtnShareBox","CONFIG","openEmergency","ShareInterface","shareMsg","type","ELS_SHRAE_TYPE","SHARE_GIFT_PROP","successCallback","result","isCanShare2GroupByTicket","SHARE_LOCK_TAG","TAG_REVIVE_AND_GIFT_PROP","UIManager","is_endless","mconf","isEndless","MSG","addItems","Map","TCPClient","connectStatus","CONNECT_STATUS_OK","user_add_item","Util","wechatShowModal","failCallback","errMsg","onShareFailed","onBtnShareProp","trigger","ELS_EVENT_HIDE_GIFT_PROP","node","motaiCallback"],"mappings":"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","file":"els_gift_prop_view.js","sourceRoot":"../../../../../assets/script/ui","sourcesContent":["let ELSEvent = require('../core/ElsEvents.js');\nlet els = require('../core/els.js');\nlet ElsUtils = require('../core/ElsUtils.js');\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        nodeGiftBox: cc.Node,\n        nodeGiftProp: cc.Node,\n        animGiftBox: cc.Animation,\n        animGiftBoxRotate: cc.Animation,\n        animGiftProp: cc.Animation,\n        animGiftPropRotate: cc.Animation,\n        nodePropDisplays: [cc.Node],\n        nodeBtnClose: cc.Node,\n        particlesInGiftBox: [cc.ParticleSystem],\n        particlesInGiftProp: [cc.ParticleSystem],\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.nodeGiftBox.active = false;\n        this.nodeGiftProp.active = false;\n        this.nodeBtnClose.active = false;\n        this.isTouchEnable = true;\n\n        let self = this;\n        this.animGiftBox.on('finished', (num, string)=>{\n            console.log('show gift box finished',num, string);\n            self.animGiftBoxRotate.play();\n        }, this);\n        this.animGiftProp.on('finished', (num, string)=>{\n            console.log('show gift box finished',num, string);\n            self.animGiftPropRotate.play();\n        }, this);\n        // tywx.NotificationCenter.listen(ELSEvent.ELS_EVENT_ADD_ITEM_SUCCESS, this._MsgAddItem, this);\n        \n    },\n\n    start () {\n    },\n\n    showParticlesInGiftBox(){\n        this.particlesInGiftBox.forEach(particle=>{\n            particle.resetSystem();\n        });\n    },\n    hideParticlesInGiftBox(){\n        this.particlesInGiftBox.forEach(particle=>{\n            particle.stopSystem();\n        });\n    },\n    showParticlesInGiftProp(){\n        this.particlesInGiftProp.forEach(particle=>{\n            particle.resetSystem();\n        });\n    },\n    hideParticlesInGiftProp(){\n        this.particlesInGiftProp.forEach(particle=>{\n            particle.stopSystem();\n        });\n    },\n\n    _MsgAddItem(params){\n        // tywx.UserInfo.user_add_item = -1;\n        // this.hideGiftBox();\n        // this.showGiftProp();\n        // let self = this;\n        // let _sid = params.result.itemId;\n        // this.nodePropDisplays.forEach(function (_node, _i) {\n        //     let _s = tywx.UserInfo.local2Server(_i);\n        //     _node.active = false;\n        //     if (_sid.indexOf(_s) !== -1) { // 包含 item:1017 1017\n        //         _node.active = true;\n        //     }\n        // });\n        //! 添加道具\n        // tywx.NotificationCenter.trigger(ELSEvent.ELS_EVENT_ADD_PROP,params);\n    },\n\n    _locAddItem(_itemId) {\n        this.hideGiftBox();\n        this.showGiftProp();\n        let self = this;\n        // let _itemId = params.result.itemId;\n        this.nodePropDisplays.forEach(function (_node, _i) {\n            let _s = tywx.UserInfo.local2Server(_i);\n            _node.active = false;\n            if (parseInt(_s) === parseInt(_itemId)) { // 包含 item:1017 1017\n                _node.active = true;\n            }\n        });\n    },\n\n    onDestroy(){\n        console.log('els_gift_prop_view   on destroy');\n        // tywx.NotificationCenter.ignore(ELSEvent.ELS_EVENT_GIFT_PROP, this.onGiftProp, this);\n        tywx.NotificationCenter.ignoreScope(this);\n\n    },\n    init(game){\n        this.game = game;\n        console.log('init els gift prop view ===>',this.game.config);\n    },\n    showGiftBox(){\n        this.isTouchEnable = true;\n        this.nodeGiftBox.active = true;\n        this.nodeBtnClose.active = true;\n        this.nodeGiftProp.active = false;\n        this.animGiftBox.play();\n        this.game.pauseGame();\n        this.game.model.playMusic(els.ELS_VOICE.BOX_MUSIC, false);\n        this.showParticlesInGiftBox();\n    },\n    hideGiftBox(){\n        this.isTouchEnable = false;\n        this.nodeGiftBox.active = false;\n        this.animGiftBox.stop();\n        this.animGiftBoxRotate.stop();\n        this.hideParticlesInGiftBox();\n    },\n    showGiftProp(){\n        this.nodeGiftProp.active = true;\n        this.animGiftProp.play();\n        this.showParticlesInGiftProp();\n    },\n    hideGiftProp(){\n        this.nodeGiftProp.active = false;\n        this.animGiftProp.stop();\n        this.animGiftPropRotate.stop();\n        this.hideParticlesInGiftProp();\n    },\n    // //! {type:0,num:1}\n    // onGiftProp(param){\n    //     this.hideGiftBox();\n    //     this.showGiftProp();\n    //     for(let prop of this.nodePropDisplays){\n    //         prop.active = false;\n    //     }\n    //     this.nodePropDisplays[param.type].active = true;\n    //     //! 添加道具\n    //     tywx.NotificationCenter.trigger(ELSEvent.ELS_EVENT_ADD_PROP,param);\n    //\n    // },\n    onBtnShareBox(){\n        console.log('onBtnShareBox===>',this.game.config);\n        if(!this.isTouchEnable) return;\n        this.isTouchEnable = false;\n        if(els.CONFIG.openEmergency){  \n            let self = this;\n            tywx.ShareInterface.shareMsg({\n                type: els.ELS_SHRAE_TYPE.SHARE_GIFT_PROP,\n                successCallback:(result)=>{\n                    console.log('onBtnTestShare',result);\n                    ElsUtils.isCanShare2GroupByTicket(\n                        els.SHARE_LOCK_TAG.TAG_REVIVE_AND_GIFT_PROP,\n                        result,\n                        ()=>{\n                            console.log('onBtnShareBox===>分享成功');\n                            let game = tywx.UIManager.game;\n                            let is_endless = game.model.mconf.isEndless;\n                            let _itemId = tywx.MSG.addItems(6,null,null,is_endless ? new Map([[1017,[0,50]],[1018,[51,60]],[1020,[61,100]]]) : null);\n                            if (tywx.TCPClient.connectStatus !== tywx.TCPClient.CONNECT_STATUS_OK) {\n                                tywx.UserInfo.user_add_item = _itemId;\n                            }\n                            self._locAddItem(_itemId);\n                        },()=>{\n                            console.log('onBtnShareBox===>分享失败===.分享到不同的群');\n                            tywx.Util.wechatShowModal(\"获得失败，请分享到不同群\", false, \"确认\");\n                            //self.onShareFailed();\n                            self.isTouchEnable = true;\n                        }\n                    ); \n                },\n                failCallback:(result)=>{\n                    self.isTouchEnable = true;\n                    if (result.errMsg === \"shareAppMessage:cancel\") {\n                        console.log(\"分享取消\");\n                        return;\n                    }\n                    console.log('分享失败');\n                    self.onShareFailed();\n\n                }\n            });  \n        }\n        else{\n            //let _itemId = tywx.MSG.addItems(6);\n            let game = tywx.UIManager.game;\n            let is_endless = game.model.mconf.isEndless;\n            let _itemId = tywx.MSG.addItems(6,null,null,is_endless ? new Map([[1017,[0,50]],[1018,[51,60]],[1020,[61,100]]]) : null);\n                            \n            this._locAddItem(_itemId);\n        }\n    },\n    onShareFailed(){\n        //! 显示关闭按钮\n        this.nodeBtnClose.active = true;\n    },\n    onBtnShareProp(){\n        //this.node.destroy();\n        tywx.NotificationCenter.trigger(ELSEvent.ELS_EVENT_HIDE_GIFT_PROP,{});\n        this.node.active = false;\n        this.nodeBtnClose.active = false;\n        // tywx.NotificationCenter.ignore(ELSEvent.ELS_EVENT_GIFT_PROP, this.onGiftProp, this);\n    },\n\n    // update (dt) {},\n    motaiCallback(){\n\n    },\n\n});\n"]}