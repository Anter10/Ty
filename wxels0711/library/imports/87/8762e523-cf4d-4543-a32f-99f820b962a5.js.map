{"version":3,"sources":["../../../../../assets/script/core/assets/script/core/model.js"],"names":["nge","require","els","ElsAi","ElsProfile","Class","ElsModel","Model","extend","ctor","ElsGrid","winlinedir","ebdir","begin_help1st","mgrid","stage","emergency","keepstar","pause","currentStage","currentStatus","ELS_GAME_STATE","HOMEPAGE","endless_line","endless_clear","endless_level","allowDoPopAction","adSlot","adSlotConf","i","mBlockQueue","Array","MAXBLKQUEUE","bgAudioContext","randomBgMusic","tywx","NotificationCenter","listen","EventType","GAME_SHOW","onForGround","onChangeAd","genRandomBlockQueue","seed","srand","ELS_CLASSIC","mconf","block_type","tmptype","block_tmp","rand","tmpreplace","tmprate","mode","ELS_MODE_AI","ELS_MODE_SINGLE","getRandomZhuBaoConfig","zhubao_config","CONFIG","zhubao_endless","level","zhubao","length","e","init","bmpindex","bmp","undefined","_mode","_isWhisper","isWhisper","_isEndless","isEndless","_next_attack","next_attack","ElsConfig","mrep","ElsReplay","mai","mrender","setBlkDat","BLKDAT_C","BLKDAT_NC","setQueue","reset","bn","ELSBMP_NANDU","bi","setBmp","ELSBMP","add_step","setGameStatus","_status","trigger","displayAd","getGameStatus","getAutoAttackStep","auto_attack_step","cs","parseInt","n","auto_attack_endless","ss","se","st","step","auto_attack","getMainTips","tips","getWinStep","isNanGuan","mstep","winstep_nanguan","ns","ds","winstep_new","getWinLine","ltl","winline","line","self","innerSV","v","AdManager","showBannerAd","setScheduleAd","needhelp1st","destroyBannerAd","canelScheduleAd","Timer","isScheduledTimer","cc","director","scheduleAd","cancelTimer","setTimer","checkPlayMusic","ret","getInstance","getIsMusicMute","stopBgMusic","playBgMusic","playRandomBgMusic","playMusic","_audioName","_loop","volume","isInWXChat","_audioContext","wx","createInnerAudioContext","src","autoPlay","loop","play","ELS_VOICE","BG_MUSIC","destroy","stopRandomBgMusic","console","log","ran","Math","random","bgm","url","SystemInfo","cdnPath","ElsCore","grid","Uint8Array","GRIDSIZE","col_top","HENG","col_hole","combo","cur_x","cur_y","cur_z","cur_block","next_block","save_block","top_line","tdx","tdy","fullrows","cling_blocks","block_index","attack","ai_mode","save_lock","game_over","game_result","zhubao_count","Map","zhubao_max","_pool","clone","cloned","pop","_assign","recycle","push","dst","d","s","slice","set","get","ElsTimer","_super","ready_wending","ElsStat","combo_total","combo_max","combo_current","score","clear_lines","isKO","addScore","UPGRADE_STANTARD","areaId","blkindex","act","isreplay","canRun","window","factory","exports","module","define","amd"],"mappings":";;;;;;;;AAAA,IAAIA,MAAMC,QAAQ,aAAR,CAAV;AACA,IAAIC,MAAMD,QAAQ,UAAR,CAAV;AACA,IAAIE,QAAQF,QAAQ,SAAR,CAAZ;AACA,IAAIG,aAAaH,QAAQ,iBAAR,CAAjB;AACA,IAAII,QAAQL,IAAIK,KAAhB;;AAEA,IAAIC,WAAWN,IAAIO,KAAJ,CAAUC,MAAV,CAAiB;AAC5BC,UAAM,cAAUC,OAAV,EAAmB;AACrB,aAAKC,UAAL,GAAkB,CAAlB;AACA,aAAKC,KAAL,GAAa,CAAb;AACA,aAAKC,aAAL,GAAqB,CAAC,CAAtB;AACA,aAAKC,KAAL,GAAW,EAAX;AACA,aAAKC,KAAL,GAAW,CAAX;AACA,aAAKC,SAAL,GAAiB,KAAjB;AACA,aAAKC,QAAL,GAAgB,KAAhB;AACA,aAAKC,KAAL,GAAW,KAAX;AACA,aAAKC,YAAL,GAAoB,CAApB;AACA,aAAKC,aAAL,GAAqBlB,IAAImB,cAAJ,CAAmBC,QAAxC;AACA,aAAKC,YAAL,GAAqB,CAArB;AACA,aAAKC,aAAL,GAAqB,KAArB;AACA,aAAKC,aAAL,GAAqB,CAArB;AACA,aAAKf,OAAL,GAAeA,OAAf;AACA,aAAKgB,gBAAL,GAAwB,IAAxB;AACA,aAAKC,MAAL,GAAY,CAAC,CAAb,CAhBqB,CAgBN;AACf,aAAKC,UAAL,GAAgB;AACZ,iBAAI,yBADQ;AAEZ,iBAAI,yBAFQ;AAGZ,iBAAI;AAHQ,SAAhB;AAKA,aAAI,IAAIC,IAAE,CAAV,EAAYA,IAAE,CAAd,EAAgBA,GAAhB,EAAqB;AACjB,iBAAKf,KAAL,CAAWe,CAAX,IAAc,IAAInB,OAAJ,CAAY,IAAZ,EAAkBmB,CAAlB,CAAd;AACH;AACD,aAAKC,WAAL,GAAmB,IAAIC,KAAJ,CAAU7B,IAAI8B,WAAd,CAAnB;AACA,aAAKC,cAAL,GAAsB,IAAtB;AACA,aAAKC,aAAL,GAAqB,IAArB;;AAEAC,aAAKC,kBAAL,CAAwBC,MAAxB,CAA+BF,KAAKG,SAAL,CAAeC,SAA9C,EAAyD,KAAKC,WAA9D,EAA2E,IAA3E;AACAL,aAAKC,kBAAL,CAAwBC,MAAxB,CAA+B,UAA/B,EAA2C,KAAKI,UAAhD,EAA4D,IAA5D;AACH,KAhC2B;;AAkC5B;AACAC,yBAAqB,6BAASC,IAAT,EACrB;AACI3C,YAAI4C,KAAJ,CAAUD,IAAV;AACA,YAAGzC,IAAI2C,WAAP,EACI,KAAKC,KAAL,CAAWC,UAAX,GAAsB,CAAtB,CADJ,KAGI,KAAKD,KAAL,CAAWC,UAAX,GAAsB,CAAtB;AACJ,YAAI,KAAKD,KAAL,CAAWC,UAAX,IAAuB,CAA3B,EAA8B;AAC1B,gBAAIC,OAAJ;AACA,gBAAIC,YAAY,CAAC,CAAjB;AACA;AACA,iBAAK,IAAIpB,IAAI,CAAb,EAAgBA,IAAG3B,IAAI8B,WAAvB,EAAoCH,GAApC,EAAyC;AACrC,uBAAO,IAAP,EAAa;AACTmB,8BAAUhD,IAAIkD,IAAJ,KAAW,CAArB;AACA,wBAAID,aAAWD,OAAf,EACI;AACP;AACD,oBAAIG,aAAanD,IAAIkD,IAAJ,EAAjB;AACA,oBAAIE,UAAU,CAAd;AACA,oBAAG,KAAKN,KAAL,CAAWO,IAAX,IAAiBnD,IAAIoD,WAAxB,EACIF,UAAU,CAAV,CADJ,KAGIA,UAAU,CAAV;AACJ,oBAAID,aAAWC,OAAX,IAAoB,CAAxB,EAA2B;AACvB,wBAAG,KAAKN,KAAL,CAAWO,IAAX,IAAiBnD,IAAIoD,WAAxB,EAAqC;AACjC,4BAAIN,WAAS,CAAT,IAAcA,WAAS,CAA3B,EAA8BA,UAAQ,CAAR;AAC9B,4BAAIA,WAAS,CAAT,IAAcA,WAAS,CAA3B,EAA8BA,UAAQ,CAAR;AAC9B,4BAAIA,WAAS,CAAT,IAAcA,WAAS,CAA3B,EAA8BA,UAAQ,CAAR;AACjC;AACD,wBAAG,KAAKF,KAAL,CAAWO,IAAX,IAAiBnD,IAAIqD,eAAxB,EAAyC;AACrC,4BAAIP,WAAS,CAAb,EAAgBA,UAAQ,CAAR;AAChB,4BAAIA,WAAS,CAAT,IAAcA,WAAS,CAA3B,EAA8BA,UAAQ,CAAR;AAC9B,4BAAIA,WAAS,CAAT,IAAcA,WAAS,CAAvB,IAA4BA,WAAS,CAAzC,EAA4CA,UAAQ,CAAR;AAC/C;AACJ;AACD,qBAAKlB,WAAL,CAAiBD,CAAjB,IAAoBmB,OAApB;AACAC,4BAAYD,OAAZ;AACH;AACJ;AACD,YAAI,KAAKF,KAAL,CAAWC,UAAX,IAAuB,CAA3B,EAA8B;AAC1B,iBAAK,IAAIlB,IAAI,CAAb,EAAgBA,IAAG3B,IAAI8B,WAAvB,EAAoCH,GAApC,EAAyC;AACrC,oBAAIsB,aAAanD,IAAIkD,IAAJ,EAAjB;AACA,oBAAIF,UAAahD,IAAIkD,IAAJ,KAAW,CAA5B;AACA,oBAAIC,aAAW,CAAX,IAAc,CAAlB,EACI,IAAIH,WAAS,CAAT,IAAcA,WAAS,CAA3B,EACIA,UAAQ,CAAR;AACR,qBAAKlB,WAAL,CAAiBD,CAAjB,IAAoBmB,OAApB;AACH;AACJ;AACJ,KApF2B;AAqF5B;AACAQ,2BAAuB,iCAAU;AAC7B;AACA,YAAIC,gBAAgBvD,IAAIwD,MAAJ,CAAWC,cAA/B;AACA,YAAIC,QAAQH,cAAcG,KAA1B;AACA,YAAIC,SAASJ,cAAcI,MAA3B;AACA,aAAI,IAAIhC,IAAI,CAAZ,EAAcA,IAAI+B,MAAME,MAAxB,EAAgCjC,GAAhC,EAAoC;AAChC,gBAAIkC,IAAIH,MAAM/B,CAAN,CAAR;AACA,gBAAGA,IAAI,CAAJ,IAAS,KAAKJ,aAAL,GAAqBsC,CAA9B,IAAmC,KAAKtC,aAAL,IAAsBmC,MAAM/B,IAAI,CAAV,CAA5D,EAAyE;AACrE,uBAAOgC,OAAOhC,IAAI,CAAX,CAAP;AACH;AACJ;AACD,eAAO,CAAC,CAAR;AACH,KAlG2B;;AAoG5BmC,UAAM,cAASC,QAAT,EAAmBtB,IAAnB,EAAyB;AAC3B,YAAIuB,MAAM,CACN,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,EAAiB,CAAjB,EAAmB,CAAnB,CADM,EAEN,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,EAAiB,CAAjB,EAAmB,CAAnB,CAFM,EAGN,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,EAAiB,CAAjB,EAAmB,CAAnB,CAHM,EAIN,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,EAAiB,CAAjB,EAAmB,CAAnB,CAJM,EAKN,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,EAAiB,CAAjB,EAAmB,CAAnB,CALM,EAMN,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,EAAiB,CAAjB,EAAmB,CAAnB,CANM,EAON,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,EAAiB,CAAjB,EAAmB,CAAnB,CAPM,EAQN,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,EAAiB,CAAjB,EAAmB,CAAnB,CARM,EASN,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,EAAiB,CAAjB,EAAmB,CAAnB,CATM,EAUN,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,EAAiB,CAAjB,EAAmB,CAAnB,CAVM,CAAV;;AAaA;AACA,YAAG,KAAKpB,KAAL,IAAc,KAAKA,KAAL,CAAWO,IAAX,IAAmBc,SAApC,EAA8C;AAC1C,gBAAIC,QAAQ,KAAKtB,KAAL,CAAWO,IAAvB;AACA,gBAAIgB,aAAa,KAAKvB,KAAL,CAAWwB,SAA5B;AACA,gBAAIC,aAAa,KAAKzB,KAAL,CAAW0B,SAA5B;AACA,gBAAIC,eAAe,KAAK3B,KAAL,CAAW4B,WAA9B;AACA,iBAAK5B,KAAL,GAAa,IAAI6B,SAAJ,EAAb;AACA,iBAAK7B,KAAL,CAAWO,IAAX,GAAkBe,KAAlB;AACA,iBAAKtB,KAAL,CAAWwB,SAAX,GAAuBD,UAAvB;AACA,iBAAKvB,KAAL,CAAW0B,SAAX,GAAuBD,UAAvB;AACA,iBAAKzB,KAAL,CAAW4B,WAAX,GAAyBD,YAAzB;AACH,SAVD,MAUK;AACD,iBAAK3B,KAAL,GAAa,IAAI6B,SAAJ,EAAb;AACH;;AAED,aAAKC,IAAL,GAAY,IAAIC,SAAJ,EAAZ;AACA,aAAKC,GAAL,GAAW,IAAI3E,KAAJ,EAAX;AACA,aAAKuC,mBAAL,CAAyBC,IAAzB;AACA,aAAKoC,OAAL,GAAa,EAAb;AACA,aAAK9D,QAAL,GAAgB,KAAhB;AACA,aAAI,IAAIY,IAAE,CAAV,EAAYA,IAAE,CAAd,EAAgBA,GAAhB,EAAqB;AACjB,iBAAKf,KAAL,CAAWe,CAAX,IAAgB,IAAI,KAAKnB,OAAT,CAAiB,IAAjB,EAAuBmB,CAAvB,CAAhB;AACA,iBAAKf,KAAL,CAAWe,CAAX,EAAciB,KAAd,GAAsB,KAAKA,KAA3B;AACA,gBAAG5C,IAAI2C,WAAP,EAAoB;AAChB,qBAAK/B,KAAL,CAAWe,CAAX,EAAcmD,SAAd,CAAwB9E,IAAI+E,QAA5B;AACH,aAFD,MAGK;AACD,qBAAKnE,KAAL,CAAWe,CAAX,EAAcmD,SAAd,CAAwB9E,IAAIgF,SAA5B;AACH;AACD,iBAAKpE,KAAL,CAAWe,CAAX,EAAcsD,QAAd,CAAuB,KAAKrD,WAA5B;AACA,iBAAKhB,KAAL,CAAWe,CAAX,EAAcuD,KAAd;AACA,gBAAG,CAAC,KAAKtC,KAAL,CAAW0B,SAAf,EAA0B;AACtB,qBAAKrD,YAAL,GAAoB8C,QAApB;AACA,oBAAIoB,KAAKnF,IAAIoF,YAAb;AACA,oBAAGrB,YAAU,CAAb,EAAgB;AACZ,wBAAIsB,KAAKF,GAAGpB,WAAWoB,GAAGvB,MAAjB,EAAyB,CAAzB,CAAT;AACA,yBAAKhD,KAAL,CAAWe,CAAX,EAAc2D,MAAd,CAAqBtF,IAAIuF,MAAJ,CAAWF,EAAX,CAArB;AACA,yBAAKG,QAAL,GAAgB,CAAhB;AACH;AACJ,aARD,MAQO;AACH;AACA,qBAAKvE,YAAL,GAAoB,CAApB;AACA,qBAAKL,KAAL,CAAWe,CAAX,EAAc2D,MAAd,CAAqBtF,IAAIuF,MAAJ,CAAW,IAAE,KAAKhE,aAAP,GAAqB,CAAhC,CAArB;AACA,qBAAKiE,QAAL,GAAgB,CAAhB;AACH;AACJ;AACJ,KAhK2B;;AAkK5BC,mBAAgB,uBAASC,OAAT,EAAkB;AAC9B,aAAKxE,aAAL,GAAqBwE,OAArB;AACAzD,aAAKC,kBAAL,CAAwByD,OAAxB,CAAgC,eAAhC,EAAiD,KAAKzE,aAAtD;AACA,aAAK0E,SAAL;AACH,KAtK2B;;AAwK5BC,mBAAgB,yBAAY;AACxB,eAAO,KAAK3E,aAAZ;AACH,KA1K2B;;AA4K5B4E,uBAAmB,6BAAW;AAC1B,YAAIC,gBAAJ;AACA,YAAG,KAAKnD,KAAL,CAAW0B,SAAd,EAAyB;AACrB;AACA,gBAAI0B,KAAKC,SAAS,KAAK1E,aAAd,CAAT;AACA,iBAAI,IAAI2E,IAAE,CAAV,EAAaA,IAAElG,IAAIwD,MAAJ,CAAW2C,mBAAX,CAA+BtF,KAA/B,CAAqC+C,MAArC,GAA4C,CAA3D,EAA8DsC,GAA9D,EAAmE;AAC/D,oBAAIE,KAAKpG,IAAIwD,MAAJ,CAAW2C,mBAAX,CAA+BtF,KAA/B,CAAqCqF,CAArC,CAAT;AACA,oBAAIG,KAAKrG,IAAIwD,MAAJ,CAAW2C,mBAAX,CAA+BtF,KAA/B,CAAqCqF,IAAE,CAAvC,CAAT;AACA,oBAAII,KAAKtG,IAAIwD,MAAJ,CAAW2C,mBAAX,CAA+BI,IAA/B,CAAoCL,CAApC,CAAT;AACA,oBAAGF,KAAGK,EAAH,IAASL,MAAII,EAAhB,EAAoB;AAChBL,uCAAmBO,EAAnB;AACA;AACH;AACJ;AACJ,SAZD,MAYO;AACH,gBAAIN,KAAK,KAAK/E,YAAL,GAAmBjB,IAAIoF,YAAJ,CAAiBxB,MAA7C;AACA,iBAAI,IAAIsC,IAAE,CAAV,EAAaA,IAAElG,IAAIwD,MAAJ,CAAWgD,WAAX,CAAuB3F,KAAvB,CAA6B+C,MAA7B,GAAoC,CAAnD,EAAsDsC,GAAtD,EAA2D;AACvD,oBAAIE,KAAKpG,IAAIwD,MAAJ,CAAWgD,WAAX,CAAuB3F,KAAvB,CAA6BqF,CAA7B,CAAT;AACA,oBAAIG,KAAKrG,IAAIwD,MAAJ,CAAWgD,WAAX,CAAuB3F,KAAvB,CAA6BqF,IAAE,CAA/B,CAAT;AACA,oBAAII,KAAKtG,IAAIwD,MAAJ,CAAWgD,WAAX,CAAuBD,IAAvB,CAA4BL,CAA5B,CAAT;AACA,oBAAGF,KAAGK,EAAH,IAASL,MAAII,EAAhB,EAAoB;AAChBL,uCAAmBO,EAAnB;AACA;AACH;AACJ;AACJ;AACD,eAAOP,gBAAP;AACH,KAvM2B;;AAyM5BU,iBAAa,uBAAW;AACpB,YAAIC,OAAO,CACP,WADO,EAEP,UAFO,EAGP,SAHO,EAIP,UAJO,EAKP,UALO,CAAX;;AAQA,eAAOA,KAAMT,SAAS,KAAKpF,KAAL,GAAa,GAAtB,IAA6B6F,KAAK9C,MAAxC,CAAP;AACH,KAnN2B;;AAqN5B+C,gBAAY,sBAAW;AACnB,aAAKC,SAAL,GAAiB,KAAjB;AACA,YAAI,KAAKhE,KAAL,CAAWwB,SAAf,EAA0B,OAAO,EAAP;AAC1B,YAAI,KAAKxB,KAAL,CAAW0B,SAAf,EAA0B,OAAO,OAAP;AAC1B,YAAI0B,KAAK,KAAK/E,YAAL,GAAmBjB,IAAIoF,YAAJ,CAAiBxB,MAA7C;AACA,YAAIiD,QAAQ7G,IAAIoF,YAAJ,CAAiBY,EAAjB,EAAqB,CAArB,CAAZ;AACA,YAAGhG,IAAIwD,MAAJ,CAAWsD,eAAd,EAA+B;AAC3B,iBAAI,IAAIZ,IAAE,CAAV,EAAaA,IAAElG,IAAIwD,MAAJ,CAAWsD,eAAX,CAA2BjG,KAA3B,CAAiC+C,MAAhD,EAAwDsC,GAAxD,EAA6D;AACzD,oBAAIa,KAAK/G,IAAIwD,MAAJ,CAAWsD,eAAX,CAA2BjG,KAA3B,CAAiCqF,CAAjC,EAAoC,CAApC,CAAT;AACA,oBAAIc,KAAKhH,IAAIwD,MAAJ,CAAWsD,eAAX,CAA2BjG,KAA3B,CAAiCqF,CAAjC,EAAoC,CAApC,CAAT;AACA,oBAAGF,MAAOe,KAAG,CAAb,EAAiB;AACb,yBAAKH,SAAL,GAAiB,IAAjB;AACAC,6BAASG,EAAT;AACH;AACJ;AACJ;AACD,YAAG,KAAK/F,YAAL,IAAqBjB,IAAIoF,YAAJ,CAAiBxB,MAAzC,EACI,OAAOqC,SAASY,QAAM,GAAN,GAAU,GAAnB,CAAP;AACJ,YAAG7G,IAAIwD,MAAJ,CAAWyD,WAAd,EAA2B;AACvB,iBAAI,IAAIf,IAAE,CAAV,EAAaA,IAAElG,IAAIwD,MAAJ,CAAWyD,WAAX,CAAuBpG,KAAvB,CAA6B+C,MAA7B,GAAoC,CAAnD,EAAsDsC,GAAtD,EAA2D;AACvD,oBAAIE,KAAKpG,IAAIwD,MAAJ,CAAWyD,WAAX,CAAuBpG,KAAvB,CAA6BqF,CAA7B,CAAT;AACA,oBAAIG,KAAKrG,IAAIwD,MAAJ,CAAWyD,WAAX,CAAuBpG,KAAvB,CAA6BqF,IAAE,CAA/B,CAAT;AACA,oBAAII,KAAKtG,IAAIwD,MAAJ,CAAWyD,WAAX,CAAuBV,IAAvB,CAA4BL,CAA5B,CAAT;AACA,oBAAGF,KAAGK,EAAH,IAASL,MAAII,EAAhB,EAAoB;AAChBS,6BAASP,EAAT;AACA;AACH;AACJ;AACJ;AACD,eAAOO,KAAP;AACH,KAnP2B;;AAqP5BK,gBAAY,sBAAW;AACnB,YAAIC,GAAJ;AAAA,YAASnB,KAAK,KAAK/E,YAAL,GAAmBjB,IAAIoF,YAAJ,CAAiBxB,MAAlD;AACA,aAAI,IAAIsC,IAAE,CAAV,EAAaA,IAAElG,IAAIwD,MAAJ,CAAW4D,OAAX,CAAmBvG,KAAnB,CAAyB+C,MAAzB,GAAgC,CAA/C,EAAkDsC,GAAlD,EAAuD;AACnD,gBAAIE,KAAKpG,IAAIwD,MAAJ,CAAW4D,OAAX,CAAmBvG,KAAnB,CAAyBqF,CAAzB,CAAT;AACA,gBAAIG,KAAKrG,IAAIwD,MAAJ,CAAW4D,OAAX,CAAmBvG,KAAnB,CAAyBqF,IAAE,CAA3B,CAAT;AACA,gBAAII,KAAKtG,IAAIwD,MAAJ,CAAW4D,OAAX,CAAmBC,IAAnB,CAAwBnB,CAAxB,CAAT;AACA,gBAAGF,KAAGK,EAAH,IAASL,MAAII,EAAhB,EAAoB;AAChBe,sBAAMb,EAAN;AACA;AACH;AACJ;AACD,eAAOa,GAAP;AACH,KAjQ2B;;AAmQ5B;AACAvB,aApQ4B,uBAoQhB;AACR;AACA,YAAI0B,OAAK,IAAT;AACA,iBAASC,OAAT,CAAiBC,CAAjB,EAAmB;AACf,gBAAGF,KAAK7F,MAAL,IAAa+F,CAAhB,EAAkB;AACdF,qBAAK7F,MAAL,GAAY+F,CAAZ;AACAvF,qBAAKwF,SAAL,CAAeC,YAAf,CAA4BJ,KAAK5F,UAAL,CAAgB4F,KAAK7F,MAAL,GAAY,EAA5B,CAA5B;AACA6F,qBAAKK,aAAL;AACH;AACJ;AACD;AACA,YAAO,KAAK9B,aAAL,MAAwB7F,IAAImB,cAAJ,CAAmBC,QAA3C,IAAqD,KAAKwG,WAAL,IAAkB,KAA9E,EAAsF;;AAElF,gBAAG,KAAK/B,aAAL,MAAwB7F,IAAImB,cAAJ,CAAmBC,QAA9C,EAAuD;AACnD;AACAmG,wBAAQ,CAAR;AACH,aAHD,MAGK;AACD;AACA,oBAAG,KAAK3E,KAAL,CAAWO,IAAX,IAAiBnD,IAAIoD,WAAxB,EAAoC;AAChC;AACAmE,4BAAQ,CAAR;AACH,iBAHD,MAGK;AACD;AACAA,4BAAQ,CAAR;AACH;AACJ;AAEJ,SAhBD,MAgBK;AACDtF,iBAAKwF,SAAL,CAAeI,eAAf;AACA,iBAAKC,eAAL;AACH;AACJ,KAnS2B;;AAoS5B;AACAA,qBAAiB,2BAAW;AACxB,YAAG7F,KAAK8F,KAAL,CAAWC,gBAAX,CAA4BC,GAAGC,QAA/B,EAAyC,KAAKC,UAA9C,CAAH,EAA6D;AACzDlG,iBAAK8F,KAAL,CAAWK,WAAX,CAAuBH,GAAGC,QAA1B,EAAoC,KAAKC,UAAzC;AACH;AACJ,KAzS2B;AA0S5B;AACAR,mBAAe,yBAAW;AACtB,aAAKG,eAAL;AACA7F,aAAK8F,KAAL,CAAWM,QAAX,CAAoBJ,GAAGC,QAAvB,EAAiC,KAAKC,UAAtC,EAAkD,EAAlD;AACH,KA9S2B;AA+S5B;AACAA,gBAAa,sBAAW;AACpBlG,aAAKC,kBAAL,CAAwByD,OAAxB,CAAgC,UAAhC,EAA4C,EAA5C;AACH,KAlT2B;AAmT5B;AACApD,gBAAc,sBAAW;AACrBN,aAAKwF,SAAL,CAAeC,YAAf,CAA4B,KAAKhG,UAAL,CAAgB,KAAKD,MAAL,GAAY,EAA5B,CAA5B;AACH,KAtT2B;;AAwT5B6G,oBAAgB,0BAAU;AACtB,YAAIC,MAAM,IAAV;AACA;AACA,YAAGrI,WAAWsI,WAAX,GAAyBC,cAAzB,EAAH,EAA6C;AACzCF,kBAAM,KAAN;AACA,iBAAKG,WAAL;AACH;AACD,eAAOH,GAAP;AACH,KAhU2B;;AAkU5BjG,iBAAe,uBAAW;AACtB,YAAG,CAAC,KAAKgG,cAAL,EAAJ,EAA0B;AACtB;AACH;;AAED,YAAI,KAAKvG,cAAT,EAAwB;AACpB,iBAAK4G,WAAL;AACH,SAFD,MAGI;AACA,gBAAI,KAAK3G,aAAT,EAAuB;AACnB,qBAAK4G,iBAAL;AACH;AACJ;AACJ,KA/U2B;;AAiV5BC,eAAY,mBAASC,UAAT,EAAqBC,KAArB,EAA4BC,MAA5B,EAAmC;AAC3C;AACA,YAAG,CAAC/G,KAAKgH,UAAN,IAAoB,CAAC,KAAKX,cAAL,EAAxB,EACI;AACJ;AACA,YAAIY,gBAAgBC,GAAGC,uBAAH,EAApB;AACAF,sBAAcG,GAAd,GAAoBP,UAApB;AACAI,sBAAcI,QAAd,GAAyB,IAAzB;AACAJ,sBAAcK,IAAd,GAAqBR,KAArB;AACAG,sBAAcF,MAAd,GAAuBA,WAAW/E,SAAX,GAAuB,GAAvB,GAA6B+E,MAApD;AACAE,sBAAcM,IAAd;AACA;AACA,YAAIV,eAAe9I,IAAIyJ,SAAJ,CAAcC,QAAjC,EAA0C;AACtC;AACA,iBAAKhB,WAAL;AACA,gBAAG,KAAK3G,cAAR,EAAwB;AACpB,qBAAKA,cAAL,CAAoB,CAApB,EAAuB4H,OAAvB;AACH;AACD,iBAAK5H,cAAL,GAAsB,CAACmH,aAAD,EAAgBlJ,IAAIyJ,SAAJ,CAAcC,QAA9B,CAAtB;AACH;AACJ,KArW2B;AAsW5Bf,iBAAa,uBAAU;AACnB,YAAIO,gBAAgBC,GAAGC,uBAAH,EAApB;AACAF,sBAAcG,GAAd,GAAoBrJ,IAAIyJ,SAAJ,CAAcC,QAAlC;AACAR,sBAAcI,QAAd,GAAyB,IAAzB;AACAJ,sBAAcK,IAAd,GAAqB,IAArB;AACAL,sBAAcF,MAAd,GAAuB,GAAvB;AACAE,sBAAcM,IAAd;AACA;AACA,aAAKd,WAAL;AACA,YAAG,KAAK3G,cAAR,EAAwB;AACpB,iBAAKA,cAAL,CAAoB,CAApB,EAAuB4H,OAAvB;AACH;AACD,aAAK5H,cAAL,GAAsB,CAACmH,aAAD,EAAgBlJ,IAAIyJ,SAAJ,CAAcC,QAA9B,CAAtB;AAEH,KApX2B;AAqX5BE,uBAAmB,6BAAU;AACzB,YAAG,KAAK5H,aAAR,EAAuB;AACnB,iBAAKA,aAAL,CAAmB,CAAnB,EAAsB2H,OAAtB;AACH;AACD,aAAK3H,aAAL,GAAqB,IAArB;AACA6H,gBAAQC,GAAR,CAAY,mCAAZ,EAAgD,KAAK9H,aAArD,EAAoE,KAAKD,cAAzE;AACH,KA3X2B;AA4X5B2G,iBAAa,uBAAU;AACnB,YAAG,KAAK3G,cAAR,EAAwB;AACpB,iBAAKA,cAAL,CAAoB,CAApB,EAAuB4H,OAAvB;AACH;AACD,aAAK5H,cAAL,GAAsB,IAAtB;AACA,aAAK6H,iBAAL;AACH,KAlY2B;AAmY5BhB,uBAAmB,6BAAU;AACzB,YAAG,CAAC,KAAKN,cAAL,EAAJ,EAA2B;AAC3B,aAAKI,WAAL;AACAmB,gBAAQC,GAAR,CAAY,8BAAZ,EAA2C,KAAK9H,aAAhD;AACA,YAAI+H,MAAM9D,SAAS+D,KAAKC,MAAL,KAAgBjK,IAAIwD,MAAJ,CAAW0G,GAA3B,GAAiC,CAA1C,CAAV;AACA,YAAIC,MAASlI,KAAKmI,UAAL,CAAgBC,OAAzB,UAAqCN,GAArC,SAAJ;AACA,YAAIb,gBAAgBC,GAAGC,uBAAH,EAApB;AACAF,sBAAcG,GAAd,GAAoBc,GAApB;AACAjB,sBAAcI,QAAd,GAAyB,IAAzB;AACAJ,sBAAcK,IAAd,GAAqB,IAArB;AACAL,sBAAcF,MAAd,GAAuB,CAAvB;AACAE,sBAAcM,IAAd;AACA,YAAG,KAAKxH,aAAR,EAAuB;AACnB,iBAAKA,aAAL,CAAmB,CAAnB,EAAsB2H,OAAtB;AACH;AACD,aAAK3H,aAAL,GAAqB,CAACkH,aAAD,EAAgBiB,GAAhB,CAArB;AACH;;AAnZ2B,CAAjB,CAAf;;AAwZA;AACA,IAAIG,UAAUnK,MAAMG,MAAN,CAAa;AACvBC,UAAM,gBAAW;AACb,aAAKgK,IAAL,GAAY,IAAIC,UAAJ,CAAexK,IAAIyK,QAAnB,CAAZ;AACA,aAAKC,OAAL,GAAe,IAAI7I,KAAJ,CAAU7B,IAAI2K,IAAd,CAAf;AACA,aAAKC,QAAL,GAAgB,IAAI/I,KAAJ,CAAU7B,IAAI2K,IAAd,CAAhB;AACA,aAAKE,KAAL,GAAW,CAAX;AACA,aAAKC,KAAL,GAAW,KAAKC,KAAL,GAAW,KAAKC,KAAL,GAAW,CAAjC;AACA,aAAKC,SAAL,GAAe,CAAf,CANa,CAMM;AACnB,aAAKC,UAAL,GAAgB,CAAhB,CAPa,CAOM;AACnB,aAAKC,UAAL,GAAgB,CAAhB,CARa,CAQM;AACnB,aAAKC,QAAL,GAAc,CAAd;AACA,aAAKC,GAAL,GAAS,KAAKC,GAAL,GAAS,CAAlB,CAVa,CAUkB;AAC/B,aAAKC,QAAL,GAAc,EAAd;AACA,aAAKC,YAAL,GAAkB,EAAlB;AACA,aAAKC,WAAL,GAAiB,CAAjB;AACA,aAAKC,MAAL,GAAY,IAAI7J,KAAJ,CAAU,CAAV,CAAZ,CAda,CAcY;AACzB,aAAK8J,OAAL,GAAa,EAAb;AACA,aAAKC,SAAL,GAAe,KAAf;AACA,aAAKC,SAAL,GAAe,KAAf;AACA,aAAKC,WAAL,GAAiB,CAAjB,CAlBa,CAkBM;AACnB,aAAKC,YAAL,GAAoB,IAAIC,GAAJ,CAAQ,CAAC,CAAC,GAAD,EAAK,CAAL,CAAD,EAAS,CAAC,GAAD,EAAK,CAAL,CAAT,EAAiB,CAAC,GAAD,EAAK,CAAL,CAAjB,CAAR,CAApB,CAnBa,CAmB2C;AACxD,aAAKC,UAAL,GAAkB,IAAID,GAAJ,CAAQ,CAAC,CAAC,GAAD,EAAK,CAAL,CAAD,EAAS,CAAC,GAAD,EAAK,CAAL,CAAT,EAAiB,CAAC,GAAD,EAAK,CAAL,CAAjB,CAAR,CAAlB,CApBa,CAoByC;AACzD,KAtBsB;;AAwBvBE,WAAO,EAxBgB;AAyBvBC,WAAO,iBAAY;AACf,YAAIC,SAASnI,SAAb;AACA,YAAI,KAAKiI,KAAL,CAAWtI,MAAX,GAAoB,CAAxB,EAA0B;AACtBwI,qBAAS,KAAKF,KAAL,CAAWG,GAAX,EAAT;AACH,SAFD,MAGK;AACDD,qBAAS,IAAI9B,OAAJ,EAAT;AACH;AACD,aAAKgC,OAAL,CAAa,IAAb,EAAmBF,MAAnB;AACA,eAAOA,MAAP;AACH,KAnCsB;;AAqCvBG,aAAS,mBAAY;AACjB,aAAKL,KAAL,CAAWM,IAAX,CAAgB,IAAhB;AACH,KAvCsB;;AAyCvBF,aAAS,iBAAUjD,GAAV,EAAeoD,GAAf,EAAoB;AACzBA,YAAI5B,KAAJ,GAAYxB,IAAIwB,KAAhB;AACA4B,YAAI3B,KAAJ,GAAYzB,IAAIyB,KAAhB;AACA2B,YAAI1B,KAAJ,GAAY1B,IAAI0B,KAAhB;AACA0B,YAAIzB,KAAJ,GAAY3B,IAAI2B,KAAhB;AACAyB,YAAIxB,SAAJ,GAAgB5B,IAAI4B,SAApB;AACAwB,YAAIvB,UAAJ,GAAiB7B,IAAI6B,UAArB;AACAuB,YAAItB,UAAJ,GAAiB9B,IAAI8B,UAArB;AACAsB,YAAIrB,QAAJ,GAAe/B,IAAI+B,QAAnB;AACAqB,YAAIpB,GAAJ,GAAUhC,IAAIgC,GAAd;AACAoB,YAAInB,GAAJ,GAAUjC,IAAIiC,GAAd;AACAmB,YAAIhB,WAAJ,GAAkBpC,IAAIoC,WAAtB;AACAgB,YAAId,OAAJ,GAActC,IAAIsC,OAAlB;AACAc,YAAIb,SAAJ,GAAgBvC,IAAIuC,SAApB;AACAa,YAAIZ,SAAJ,GAAgBxC,IAAIwC,SAApB;AACAY,YAAIX,WAAJ,GAAkBzC,IAAIyC,WAAtB;AACA,YAAIY,IAAID,IAAI/B,OAAZ;AACA,YAAIiC,IAAItD,IAAIqB,OAAZ;AACAgC,UAAE,CAAF,IAAOC,EAAE,CAAF,CAAP;AACAD,UAAE,CAAF,IAAOC,EAAE,CAAF,CAAP;AACAD,UAAE,CAAF,IAAOC,EAAE,CAAF,CAAP;AACAD,UAAE,CAAF,IAAOC,EAAE,CAAF,CAAP;AACAD,UAAE,CAAF,IAAOC,EAAE,CAAF,CAAP;AACAD,UAAE,CAAF,IAAOC,EAAE,CAAF,CAAP;AACAD,UAAE,CAAF,IAAOC,EAAE,CAAF,CAAP;AACAD,UAAE,CAAF,IAAOC,EAAE,CAAF,CAAP;AACAD,UAAE,CAAF,IAAOC,EAAE,CAAF,CAAP;AACAD,UAAE,CAAF,IAAOC,EAAE,CAAF,CAAP;AACAD,YAAID,IAAI7B,QAAR;AACA+B,YAAItD,IAAIuB,QAAR;AACA8B,UAAE,CAAF,IAAOC,EAAE,CAAF,CAAP;AACAD,UAAE,CAAF,IAAOC,EAAE,CAAF,CAAP;AACAD,UAAE,CAAF,IAAOC,EAAE,CAAF,CAAP;AACAD,UAAE,CAAF,IAAOC,EAAE,CAAF,CAAP;AACAD,UAAE,CAAF,IAAOC,EAAE,CAAF,CAAP;AACAD,UAAE,CAAF,IAAOC,EAAE,CAAF,CAAP;AACAD,UAAE,CAAF,IAAOC,EAAE,CAAF,CAAP;AACAD,UAAE,CAAF,IAAOC,EAAE,CAAF,CAAP;AACAD,UAAE,CAAF,IAAOC,EAAE,CAAF,CAAP;AACAD,UAAE,CAAF,IAAOC,EAAE,CAAF,CAAP;AACAF,YAAIf,MAAJ,CAAW,CAAX,IAAgBrC,IAAIqC,MAAJ,CAAW,CAAX,CAAhB;AACAe,YAAIf,MAAJ,CAAW,CAAX,IAAgBrC,IAAIqC,MAAJ,CAAW,CAAX,CAAhB;AACAe,YAAIlB,QAAJ,GAAelC,IAAIkC,QAAJ,CAAaqB,KAAb,EAAf;AACA;AACAH,YAAIlC,IAAJ,CAASsC,GAAT,CAAaxD,IAAIkB,IAAjB;AACAkC,YAAIV,YAAJ,CAAiBc,GAAjB,CAAqB,GAArB,EAAyBxD,IAAI0C,YAAJ,CAAiBe,GAAjB,CAAqB,GAArB,CAAzB;AACAL,YAAIV,YAAJ,CAAiBc,GAAjB,CAAqB,GAArB,EAAyBxD,IAAI0C,YAAJ,CAAiBe,GAAjB,CAAqB,GAArB,CAAzB;AACAL,YAAIV,YAAJ,CAAiBc,GAAjB,CAAqB,GAArB,EAAyBxD,IAAI0C,YAAJ,CAAiBe,GAAjB,CAAqB,GAArB,CAAzB;AACAL,YAAIR,UAAJ,CAAeY,GAAf,CAAmB,GAAnB,EAAuBxD,IAAI4C,UAAJ,CAAea,GAAf,CAAmB,GAAnB,CAAvB;AACAL,YAAIR,UAAJ,CAAeY,GAAf,CAAmB,GAAnB,EAAuBxD,IAAI4C,UAAJ,CAAea,GAAf,CAAmB,GAAnB,CAAvB;AACAL,YAAIR,UAAJ,CAAeY,GAAf,CAAmB,GAAnB,EAAuBxD,IAAI4C,UAAJ,CAAea,GAAf,CAAmB,GAAnB,CAAvB;AACH;AA5FsB,CAAb,CAAd;;AA+FA,IAAIC,WAAWjN,IAAIiI,KAAJ,CAAUzH,MAAV,CAAiB;AAC5BC,UAAM,gBAAW;AACb,aAAKyM,MAAL;AACA,aAAKC,aAAL,GAAmB,CAAnB;AACH;AAJ2B,CAAjB,CAAf;;AAOA,IAAIC,UAAU/M,MAAMG,MAAN,CAAa;AACvBC,UAAM,gBAAW;AACb,aAAK4M,WAAL,GAAmB,CAAnB;AACA,aAAKC,SAAL,GAAiB,CAAjB;AACA,aAAKC,aAAL,GAAqB,CAArB;AACA,aAAK3J,KAAL,GAAa,CAAb;AACA,aAAK4J,KAAL,GAAa,CAAb;AACA,aAAKC,WAAL,GAAmB,CAAnB;AACA,aAAKC,IAAL,GAAY,KAAZ;AACH,KATsB;;AAWvBC,YAXuB,oBAWdd,CAXc,EAWX;AACR,aAAKW,KAAL,IAAcX,CAAd;AACA,aAAI,IAAIhL,IAAE,CAAV,EAAaA,IAAE3B,IAAI0N,gBAAJ,CAAqB9J,MAApC,EAA4CjC,GAA5C,EAAiD;AAC7C,gBAAG,KAAK2L,KAAL,IAAYtN,IAAI0N,gBAAJ,CAAqB/L,IAAE,CAAvB,CAAZ,IAAyC,KAAK2L,KAAL,IAAYtN,IAAI0N,gBAAJ,CAAqB/L,CAArB,CAAxD,EAAiF;AAC7E,qBAAK+B,KAAL,GAAa/B,CAAb;AACA;AACH;AACJ;AACJ;AAnBsB,CAAb,CAAd;;AAuBA,IAAIgD,YAAYxE,MAAMG,MAAN,CAAa;AACzBC,UAAM,gBAAW;AACb,aAAKoN,MAAL,GAAY,CAAZ;AACA,aAAK9M,KAAL,GAAW,CAAX;AACA,aAAK+M,QAAL,GAAc,CAAd;AACA,aAAKC,GAAL,GAAS,EAAT;AACH;AANwB,CAAb,CAAhB;;AASA,IAAIpJ,YAAYtE,MAAMG,MAAN,CAAa;AACzBC,UAAM,gBAAW;AACb,aAAKuN,QAAL,GAAc,KAAd;AACA,aAAK1J,SAAL,GAAe,KAAf;AACA,aAAKE,SAAL,GAAe,KAAf;AACA,aAAKyJ,MAAL,GAAc,IAAd;AACA,aAAK5K,IAAL,GAAWnD,IAAIqD,eAAf;AACA;AACH;AARwB,CAAb,CAAhB;;AAWA,CAAC,UAAU2K,MAAV,EAAkBC,OAAlB,EAA2B;AACxB,QAAI,QAAOC,OAAP,yCAAOA,OAAP,OAAmB,QAAvB,EAAiC;AAC7BC,eAAOD,OAAP,GAAiBD,SAAjB;AACH,KAFD,MAEO,IAAI,OAAOG,MAAP,KAAkB,UAAlB,IAAgCA,OAAOC,GAA3C,EAAgD;AACnDD,eAAOH,OAAP;AACH,KAFM,MAEA;AACHD,eAAOlO,GAAP,GAAamO,SAAb;AACH;AACJ,CARD,aAQS,YAAY;AACjB,WAAO;AACH,oBAAY7N,QADT;AAEH,mBAAWkK,OAFR;AAGH,oBAAYyC,QAHT;AAIH,mBAAWG,OAJR;AAKH,qBAAavI,SALV;AAMH,qBAAaF;AANV,KAAP;AAQH,CAjBD","file":"model.js","sourceRoot":"../../../../../assets/script/core","sourcesContent":["var nge = require(\"./engine.js\");\nvar els = require(\"./els.js\");\nvar ElsAi = require(\"./ai.js\");\nvar ElsProfile = require(\"./ELSProfile.js\");\nvar Class = nge.Class;\n\nvar ElsModel = nge.Model.extend({\n    ctor: function (ElsGrid) {\n        this.winlinedir = 1;\n        this.ebdir = 1;\n        this.begin_help1st = -1;\n        this.mgrid=[];\n        this.stage=0;\n        this.emergency = false;\n        this.keepstar = false;\n        this.pause=false;\n        this.currentStage = 0;\n        this.currentStatus = els.ELS_GAME_STATE.HOMEPAGE;\n        this.endless_line =  0;\n        this.endless_clear = false;\n        this.endless_level = 1;\n        this.ElsGrid = ElsGrid;\n        this.allowDoPopAction = true;\n        this.adSlot=-1;//广告槽\n        this.adSlotConf={\n            \"1\":\"adunit-b61c5f52e2942279\",\n            \"2\":\"adunit-6bd777cddfba016a\",\n            \"3\":\"adunit-cb6c0c6de7f272f1\",\n        };\n        for(var i=0;i<2;i++) {\n            this.mgrid[i]=new ElsGrid(this, i);\n        }\n        this.mBlockQueue = new Array(els.MAXBLKQUEUE);\n        this.bgAudioContext = null;\n        this.randomBgMusic = null;\n\n        tywx.NotificationCenter.listen(tywx.EventType.GAME_SHOW, this.onForGround, this);\n        tywx.NotificationCenter.listen('changeAd', this.onChangeAd, this);\n    },\n\n    //生成随机块序列\n    genRandomBlockQueue: function(seed)\n    {\n        nge.srand(seed);\n        if(els.ELS_CLASSIC) \n            this.mconf.block_type=1;\n        else \n            this.mconf.block_type=0;\n        if (this.mconf.block_type==1) {\n            var tmptype;\n            var block_tmp = -1;\n            //生成500个块的序列\n            for (var i = 0; i <els.MAXBLKQUEUE; i++) {\n                while (true) {\n                    tmptype = nge.rand()%9;\n                    if (block_tmp!=tmptype)\n                        break;\n                }\n                var tmpreplace = nge.rand();\n                var tmprate = 2;\n                if(this.mconf.mode==els.ELS_MODE_AI)\n                    tmprate = 2;\n                else\n                    tmprate = 2;\n                if (tmpreplace%tmprate==0) {\n                    if(this.mconf.mode==els.ELS_MODE_AI) {\n                        if (tmptype==5 || tmptype==6) tmptype=0;\n                        if (tmptype==3 || tmptype==4) tmptype=8;\n                        if (tmptype==1 || tmptype==2) tmptype=7;\n                    }\n                    if(this.mconf.mode==els.ELS_MODE_SINGLE) {\n                        if (tmptype==5) tmptype=8;\n                        if (tmptype==3 || tmptype==4) tmptype=8;\n                        if (tmptype==1 || tmptype==2 || tmptype==6) tmptype=7;\n                    }\n                }\n                this.mBlockQueue[i]=tmptype;\n                block_tmp = tmptype;\n            }\n        }\n        if (this.mconf.block_type==0) {\n            for (var i = 0; i <els.MAXBLKQUEUE; i++) {\n                var tmpreplace = nge.rand();\n                var tmptype    = nge.rand()%9;\n                if (tmpreplace%3==0)\n                    if (tmptype==3 || tmptype==4)\n                        tmptype=2;\n                this.mBlockQueue[i]=tmptype;\n            }\n        }\n    },\n    // 获取珠宝配置\n    getRandomZhuBaoConfig: function(){\n        //return {'deep':10, 'd1':1, 'd2':2, 'd3':5};\n        let zhubao_config = els.CONFIG.zhubao_endless;\n        let level = zhubao_config.level;\n        let zhubao = zhubao_config.zhubao;\n        for(let i = 0;i < level.length; i++){\n            let e = level[i];\n            if(i > 0 && this.endless_level < e && this.endless_level >= level[i - 1]){\n                return zhubao[i - 1];\n            }\n        }\n        return -1;\n    },\n\n    init: function(bmpindex, seed) {\n        var bmp = [\n            [0,0,1,1,1,1,1,1,0,0],\n            [0,1,1,1,1,1,1,1,1,0],\n            [2,2,2,2,2,0,2,2,2,2],\n            [2,2,2,2,2,2,0,2,2,2],\n            [3,3,3,0,0,3,3,3,3,3],\n            [3,3,0,0,0,0,3,3,3,3],\n            [4,4,0,0,0,0,4,4,4,4],\n            [4,4,4,0,0,4,4,4,4,4],\n            [0,5,5,5,5,5,5,5,5,0],\n            [0,0,5,5,5,5,5,5,0,0]\n        ];\n\n        //记录上一关卡的mode\n        if(this.mconf && this.mconf.mode != undefined){\n            var _mode = this.mconf.mode;\n            var _isWhisper = this.mconf.isWhisper;\n            var _isEndless = this.mconf.isEndless;\n            var _next_attack = this.mconf.next_attack;\n            this.mconf = new ElsConfig();\n            this.mconf.mode = _mode;\n            this.mconf.isWhisper = _isWhisper;\n            this.mconf.isEndless = _isEndless;\n            this.mconf.next_attack = _next_attack;\n        }else{\n            this.mconf = new ElsConfig();\n        }\n\n        this.mrep = new ElsReplay();\n        this.mai = new ElsAi();\n        this.genRandomBlockQueue(seed);\n        this.mrender=[];\n        this.keepstar = false;\n        for(var i=0;i<2;i++) {\n            this.mgrid[i] = new this.ElsGrid(this, i);\n            this.mgrid[i].mconf = this.mconf;\n            if(els.ELS_CLASSIC) {\n                this.mgrid[i].setBlkDat(els.BLKDAT_C);\n            }\n            else {\n                this.mgrid[i].setBlkDat(els.BLKDAT_NC);\n            }\n            this.mgrid[i].setQueue(this.mBlockQueue);\n            this.mgrid[i].reset();\n            if(!this.mconf.isEndless) {\n                this.currentStage = bmpindex;\n                var bn = els.ELSBMP_NANDU;\n                if(bmpindex>=0) {\n                    var bi = bn[bmpindex % bn.length][0];\n                    this.mgrid[i].setBmp(els.ELSBMP(bi));\n                    this.add_step = 0;\n                }\n            } else {\n                //@ENDLESS 初次设置第一个图,从i3开始\n                this.currentStage = 0;\n                this.mgrid[i].setBmp(els.ELSBMP(3+this.endless_level-1));\n                this.add_step = 0;\n            }\n        }\n    },\n\n    setGameStatus : function(_status) {\n        this.currentStatus = _status;\n        tywx.NotificationCenter.trigger(\"STATUS_CHANGE\", this.currentStatus);\n        this.displayAd();\n    },\n\n    getGameStatus : function () {\n        return this.currentStatus;\n    },\n\n    getAutoAttackStep: function() {\n        var auto_attack_step;\n        if(this.mconf.isEndless) {\n            //@ENDLESS 从auto_attack_endless里取涨行速度配置\n            var cs = parseInt(this.endless_level);\n            for(var n=0; n<els.CONFIG.auto_attack_endless.stage.length-1; n++) {\n                var ss = els.CONFIG.auto_attack_endless.stage[n];\n                var se = els.CONFIG.auto_attack_endless.stage[n+1];\n                var st = els.CONFIG.auto_attack_endless.step[n];\n                if(cs<se && cs>=ss) {\n                    auto_attack_step = st;\n                    break;\n                }\n            }\n        } else {\n            var cs = this.currentStage%(els.ELSBMP_NANDU.length);\n            for(var n=0; n<els.CONFIG.auto_attack.stage.length-1; n++) {\n                var ss = els.CONFIG.auto_attack.stage[n];\n                var se = els.CONFIG.auto_attack.stage[n+1];\n                var st = els.CONFIG.auto_attack.step[n];\n                if(cs<se && cs>=ss) {\n                    auto_attack_step = st;\n                    break;\n                }\n            }\n        }\n        return auto_attack_step;\n    },\n\n    getMainTips: function() {\n        var tips = [\n            '快速上滑换掉当前块',\n            '点击屏幕旋转方块',\n            '左右滑拖动方块',\n            '快速下滑扔下方块',\n            '道具可以帮你过关'\n        ];\n\n        return tips[ parseInt(this.stage / 300) % tips.length ];\n    },\n\n    getWinStep: function() {\n        this.isNanGuan = false;\n        if (this.mconf.isWhisper) return 50;\n        if (this.mconf.isEndless) return 5000000;\n        var cs = this.currentStage%(els.ELSBMP_NANDU.length);\n        var mstep = els.ELSBMP_NANDU[cs][1];\n        if(els.CONFIG.winstep_nanguan) {\n            for(var n=0; n<els.CONFIG.winstep_nanguan.stage.length; n++) {\n                var ns = els.CONFIG.winstep_nanguan.stage[n][0];\n                var ds = els.CONFIG.winstep_nanguan.stage[n][1];\n                if(cs == (ns-1)) {\n                    this.isNanGuan = true;\n                    mstep -= ds;\n                }\n            }\n        }\n        if(this.currentStage >= els.ELSBMP_NANDU.length) \n            return parseInt(mstep*2.0/3.0);\n        if(els.CONFIG.winstep_new) {\n            for(var n=0; n<els.CONFIG.winstep_new.stage.length-1; n++) {\n                var ss = els.CONFIG.winstep_new.stage[n];\n                var se = els.CONFIG.winstep_new.stage[n+1];\n                var st = els.CONFIG.winstep_new.step[n];\n                if(cs<se && cs>=ss) {\n                    mstep += st;\n                    break;\n                }\n            }\n        }\n        return mstep;\n    },\n\n    getWinLine: function() {\n        var ltl, cs = this.currentStage%(els.ELSBMP_NANDU.length);\n        for(var n=0; n<els.CONFIG.winline.stage.length-1; n++) {\n            var ss = els.CONFIG.winline.stage[n];\n            var se = els.CONFIG.winline.stage[n+1];\n            var st = els.CONFIG.winline.line[n];\n            if(cs<se && cs>=ss) {\n                ltl = st;\n                break;\n            }\n        }\n        return ltl;\n    },\n\n    //显示广告\n    displayAd() {\n        //tywx.AdManager.showAd({x:0,y:0});\n        let self=this;\n        function innerSV(v){\n            if(self.adSlot!=v){\n                self.adSlot=v;\n                tywx.AdManager.showBannerAd(self.adSlotConf[self.adSlot+\"\"]);\n                self.setScheduleAd();\n            }\n        }\n        //if(  this.getGameStatus() == els.ELS_GAME_STATE.HOMEPAGE  ||  (this.getGameStatus() != els.ELS_GAME_STATE.HOMEPAGE&&this.needhelp1st==false) ){\n        if(   (this.getGameStatus() != els.ELS_GAME_STATE.HOMEPAGE&&this.needhelp1st==false) ){    \n\n            if(this.getGameStatus() == els.ELS_GAME_STATE.HOMEPAGE){\n                //首页槽1\n                innerSV(1);\n            }else{\n                //非首页并且不播放帮助时候显示\n                if(this.mconf.mode==els.ELS_MODE_AI){\n                    //AI槽2\n                    innerSV(2);\n                }else{\n                    //单人槽3\n                    innerSV(3);\n                }\n            } \n\n        }else{\n            tywx.AdManager.destroyBannerAd();\n            this.canelScheduleAd();\n        }\n    },\n    //取消广告计时器\n    canelScheduleAd: function() {\n        if(tywx.Timer.isScheduledTimer(cc.director, this.scheduleAd)){\n            tywx.Timer.cancelTimer(cc.director, this.scheduleAd);\n        }\n    },\n    //开启广告计时器\n    setScheduleAd: function() {\n        this.canelScheduleAd();\n        tywx.Timer.setTimer(cc.director, this.scheduleAd, 20);\n    },\n    //广告计时器\n    scheduleAd : function() {\n        tywx.NotificationCenter.trigger('changeAd', {});\n    },\n    //改变广告事件\n    onChangeAd  : function() {\n        tywx.AdManager.showBannerAd(this.adSlotConf[this.adSlot+\"\"]);   \n    },\n\n    checkPlayMusic: function(){\n        let ret = true;\n        //console.log('checkPlayMusic',ElsProfile.getInstance().getIsMusicMute());\n        if(ElsProfile.getInstance().getIsMusicMute()){\n            ret = false;\n            this.stopBgMusic();\n        }\n        return ret;\n    },\n\n    onForGround  : function() {\n        if(!this.checkPlayMusic()){\n            return;\n        }\n\n        if (this.bgAudioContext){\n            this.playBgMusic();\n        }\n        else{\n            if (this.randomBgMusic){\n                this.playRandomBgMusic();\n            }\n        }\n    },\n\n    playMusic : function(_audioName, _loop, volume){\n        //console.log('playMusic 1===>  ' + _audioName + this.stage);\n        if(!tywx.isInWXChat || !this.checkPlayMusic())\n            return;\n        //! 使用微信API播放音效,使用cocos的方式效率有点低\n        var _audioContext = wx.createInnerAudioContext();\n        _audioContext.src = _audioName;\n        _audioContext.autoPlay = true;\n        _audioContext.loop = _loop;\n        _audioContext.volume = volume === undefined ? 1.0 : volume;\n        _audioContext.play();\n        //! 播放背景音乐\n        if (_audioName === els.ELS_VOICE.BG_MUSIC){\n            //this.playBgMusic();\n            this.stopBgMusic();\n            if(this.bgAudioContext) {\n                this.bgAudioContext[0].destroy();\n            }\n            this.bgAudioContext = [_audioContext, els.ELS_VOICE.BG_MUSIC];\n        }\n    },\n    playBgMusic: function(){\n        var _audioContext = wx.createInnerAudioContext();\n        _audioContext.src = els.ELS_VOICE.BG_MUSIC;\n        _audioContext.autoPlay = true;\n        _audioContext.loop = true;\n        _audioContext.volume = 1.0;\n        _audioContext.play();\n        //! 播放背景音乐\n        this.stopBgMusic();\n        if(this.bgAudioContext) {\n            this.bgAudioContext[0].destroy();\n        }\n        this.bgAudioContext = [_audioContext, els.ELS_VOICE.BG_MUSIC];\n\n    },\n    stopRandomBgMusic: function(){\n        if(this.randomBgMusic) {\n            this.randomBgMusic[0].destroy();\n        }\n        this.randomBgMusic = null;\n        console.log('bgMusigState stopRandomBgMusic==>',this.randomBgMusic, this.bgAudioContext);\n    },\n    stopBgMusic: function(){\n        if(this.bgAudioContext) {\n            this.bgAudioContext[0].destroy();\n        }\n        this.bgAudioContext = null;\n        this.stopRandomBgMusic();\n    },\n    playRandomBgMusic: function(){\n        if(!this.checkPlayMusic()) return;\n        this.stopBgMusic();\n        console.log('bgMusigState playRandomMusic',this.randomBgMusic);\n        let ran = parseInt(Math.random() * els.CONFIG.bgm + 1);\n        let url = `${tywx.SystemInfo.cdnPath}m/${ran}.mp3`;\n        var _audioContext = wx.createInnerAudioContext();\n        _audioContext.src = url;\n        _audioContext.autoPlay = true;\n        _audioContext.loop = true;\n        _audioContext.volume = 1;\n        _audioContext.play();\n        if(this.randomBgMusic) {\n            this.randomBgMusic[0].destroy();\n        }\n        this.randomBgMusic = [_audioContext, url];\n    },\n\n\n});\n\n//数据结构\nvar ElsCore = Class.extend({\n    ctor: function() {\n        this.grid = new Uint8Array(els.GRIDSIZE);\n        this.col_top = new Array(els.HENG);\n        this.col_hole = new Array(els.HENG);\n        this.combo=0;\n        this.cur_x=this.cur_y=this.cur_z=0;\n        this.cur_block=0;  //当前块\n        this.next_block=0; //下一块\n        this.save_block=0; //保存块\n        this.top_line=0;\n        this.tdx=this.tdy=0;           //记录将要落下虚影的坐标\n        this.fullrows=[];\n        this.cling_blocks=[];\n        this.block_index=0;\n        this.attack=new Array(2);//攻击行数和生成空洞随机种子 ０:行数,１:seed\n        this.ai_mode=\"\";\n        this.save_lock=false;\n        this.game_over=false;\n        this.game_result=0;//0未得出结果, 1普通结束(经典模式), 2胜利, 3失败\n        this.zhubao_count = new Map([[112,0],[113,0],[114,0]]); // 统计当前还需要消除的珠宝数量\n        this.zhubao_max = new Map([[112,0],[113,0],[114,0]]); // 需要消除的珠宝总数量\n    },\n\n    _pool: [],\n    clone: function () {\n        var cloned = undefined;\n        if (this._pool.length > 0){\n            cloned = this._pool.pop();\n        }\n        else {\n            cloned = new ElsCore();\n        }\n        this._assign(this, cloned);\n        return cloned;\n    },\n\n    recycle: function () {\n        this._pool.push(this);\n    },\n\n    _assign: function (src, dst) {\n        dst.combo = src.combo;\n        dst.cur_x = src.cur_x;\n        dst.cur_y = src.cur_y;\n        dst.cur_z = src.cur_z;\n        dst.cur_block = src.cur_block;\n        dst.next_block = src.next_block;\n        dst.save_block = src.save_block;\n        dst.top_line = src.top_line;\n        dst.tdx = src.tdx;\n        dst.tdy = src.tdy;\n        dst.block_index = src.block_index;\n        dst.ai_mode = src.ai_mode;\n        dst.save_lock = src.save_lock;\n        dst.game_over = src.game_over;\n        dst.game_result = src.game_result;\n        var d = dst.col_top;\n        var s = src.col_top;\n        d[0] = s[0];\n        d[1] = s[1];\n        d[2] = s[2];\n        d[3] = s[3];\n        d[4] = s[4];\n        d[5] = s[5];\n        d[6] = s[6];\n        d[7] = s[7];\n        d[8] = s[8];\n        d[9] = s[9];\n        d = dst.col_hole;\n        s = src.col_hole;\n        d[0] = s[0];\n        d[1] = s[1];\n        d[2] = s[2];\n        d[3] = s[3];\n        d[4] = s[4];\n        d[5] = s[5];\n        d[6] = s[6];\n        d[7] = s[7];\n        d[8] = s[8];\n        d[9] = s[9];\n        dst.attack[0] = src.attack[0];\n        dst.attack[1] = src.attack[1];\n        dst.fullrows = src.fullrows.slice();\n        //dst.cling_blocks = src.cling_blocks.slice();\n        dst.grid.set(src.grid);\n        dst.zhubao_count.set(112,src.zhubao_count.get(112));\n        dst.zhubao_count.set(113,src.zhubao_count.get(113));\n        dst.zhubao_count.set(114,src.zhubao_count.get(114));\n        dst.zhubao_max.set(112,src.zhubao_max.get(112));\n        dst.zhubao_max.set(113,src.zhubao_max.get(113));\n        dst.zhubao_max.set(114,src.zhubao_max.get(114));\n    }\n});\n\nvar ElsTimer = nge.Timer.extend({\n    ctor: function() {\n        this._super();\n        this.ready_wending=0;\n    }\n});\n\nvar ElsStat = Class.extend({\n    ctor: function() {\n        this.combo_total = 0;\n        this.combo_max = 0;\n        this.combo_current = 0;\n        this.level = 0;\n        this.score = 0;\n        this.clear_lines = 0;\n        this.isKO = false;\n    },\n\n    addScore(s) {\n        this.score += s;\n        for(var i=0; i<els.UPGRADE_STANTARD.length; i++) {\n            if(this.score<=els.UPGRADE_STANTARD[i+1] && this.score>=els.UPGRADE_STANTARD[i]) {\n                this.level = i;\n                break;\n            }\n        }\n    }\n});\n\n\nvar ElsReplay = Class.extend({\n    ctor: function() {\n        this.areaId=0;\n        this.stage=0;\n        this.blkindex=0;\n        this.act='';\n    }\n});\n\nvar ElsConfig = Class.extend({\n    ctor: function() {\n        this.isreplay=false;\n        this.isWhisper=false;\n        this.isEndless=false;\n        this.canRun = true;\n        this.mode =els.ELS_MODE_SINGLE;\n        //this.mode=els.ELS_MODE_AI;\n    }\n});\n\n(function (window, factory) {\n    if (typeof exports === 'object') {\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        define(factory);\n    } else {\n        window.nge = factory();\n    }\n})(this, function () {\n    return {\n        \"ElsModel\": ElsModel,\n        \"ElsCore\": ElsCore,\n        \"ElsTimer\": ElsTimer,\n        \"ElsStat\": ElsStat,\n        \"ElsReplay\": ElsReplay,\n        \"ElsConfig\": ElsConfig,\n    }\n});\n"]}