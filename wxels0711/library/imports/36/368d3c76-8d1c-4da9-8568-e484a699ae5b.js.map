{"version":3,"sources":["../../../../../assets/script/core/assets/script/core/touch.js"],"names":["nge","require","els","Class","ElsTouch","Model","extend","ctor","game","_firstTouchPoint","x","y","_lastTouchPoint","_lastPointDrag","_isNeedDrop","_isNeedHold","_maxRLAct","_maxDAct","_firstTouchTime","_lastMoveTime","_moveDX","_moveDY","_idenSizeX","_idenSizeY","_idenSizeDrop","_btn_scope","cc","rect","triggerPutUserAction","a","useract","length","began","_beganGesture","moved","_movedGesture","ended","_endedGesture","_setTouchKeyThreshold","dx","dt","now","Date","getTime","model","mgrid","mcore","cur_x","currenttime","Math","abs","dy","dx_drag","dy_drag","horizontalMove","actCount","parseInt","i","_checkTriggerBtnClick","_x","_y","window","factory","exports","module","define","amd"],"mappings":"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","file":"touch.js","sourceRoot":"../../../../../assets/script/core","sourcesContent":["var nge = require(\"./engine.js\");\nvar els = require(\"./els.js\");\nvar Class = nge.Class;\nvar ElsTouch = nge.Model.extend({\n    ctor : function(game) {\n        this.game = game;\n        //手触摸屏幕的第一个触摸位置,在touchBegan时赋值\n        //用于判断是否为点击（旋转）动作\n        this._firstTouchPoint = {x:0, y:0};\n        //手触摸屏幕的上一个触摸位置\n        //touchBegan时赋值，touchMove时更新,用于计算dx,dy\n        this._lastTouchPoint = {x:0, y:0};\n        //上一次更新drag数值的位置\n        this._lastPointDrag = {x:0, y:0};\n        this._isNeedDrop = false;\n        this._isNeedHold = false;\n        //控制产生左右移动数量\n        this._maxRLAct = 0;\n        //控制产生向下移动数量\n        this._maxDAct = 0;\n        this._firstTouchTime = 0;\n        this._lastMoveTime = 0;     //用于计算滑动中连续两个点的间隔时间\n        this._moveDX = 0;           //一次触摸抬起之前，手指移动的x方向最大距离\n        this._moveDY = 0;           //一次触摸抬起之前，手指移动的y方向最大距离\n        this._idenSizeX = 0;        //识别动作阈值\n        this._idenSizeY = 0;        //识别动作阈值\n        this._idenSizeDrop = 0;\n\n        this._btn_scope = {\n            'btn_fightAI' : cc.rect(300, 640, 320, 110), //对战\n            'btn_classic' : cc.rect(300, 500, 320, 110), //经典\n            'btn_pause' : cc.rect(15, 1220, 45, 45),     //暂停\n            'btn_help'  : cc.rect(430, 190, 70, 70),     //帮助\n            'btn_rank' : cc.rect(620, 190, 70, 70),      //排行\n            'btn_share' : cc.rect(520, 190, 70, 70),     //主页分享\n            'btn_continue' : cc.rect(180, 700, 370, 140), //继续\n            'btn_back_pause' : cc.rect(180, 550, 370, 140), //暂停返回主页\n            'btn_reStart' : cc.rect(180, 500, 360, 150),   //重新开始\n            'btn_back_lose' : cc.rect(280, 450, 160, 100),  //失败:返回主页\n            'btn_nextStage' : cc.rect(300, 440, 210, 120),    //下一关\n            'btn_ShareFlaunt' : cc.rect(180, 520, 340, 100), //分享炫耀\n            'btn_back_win' : cc.rect(280, 470, 160, 60),     //返回主页\n            'btn_help_back' : cc.rect(570, 915, 60, 60),        //帮助关闭\n            'btn_emergencyShare' : cc.rect(600, 1020, 100, 121), //减5行\n            'btn_emergencyShareS' : cc.rect(600, 800, 100, 121),  //加5步\n            'btn_keepstar_share' : cc.rect(210, 530, 300, 100),  //失败保护: 分享到群\n            'btn_keepstar_cancel' : cc.rect(290, 420, 180, 90), //失败保护: 取消\n            'btn_rank_close' : cc.rect(565, 1018, 50, 50),\n            'btn_rank_challenge' : cc.rect(93, 990, 257, 85),\n            'btn_rank_classic' : cc.rect(350, 990, 257, 85),\n        };\n    },\n\n    triggerPutUserAction : function(a) {\n        //console.log(\"PUTACT....\"+a);\n        this.game.useract[this.game.useract.length] = a;\n    },\n\n    began : function(x, y) {\n        return this._beganGesture(x, y);\n    },\n\n    moved : function(x, y) {\n        this._movedGesture(x, y);\n    },\n\n    ended : function(x, y) {\n        this._endedGesture(x, y);\n    },\n\n    _setTouchKeyThreshold : function(dx, dt) {\n        this._idenSizeX = 48;\n        this._idenSizeY = 40;\n        this._idenSizeDrop = 35;\n    },\n\n    _beganGesture : function(x, y) {\n        var now = new Date().getTime();\n        this._lastMoveTime = now;\n        this._firstTouchTime = now;\n        this._firstTouchPoint.x = x;\n        this._firstTouchPoint.y = y;\n        this._lastTouchPoint.x = x;\n        this._lastTouchPoint.y = y;\n        this._lastPointDrag.x = x;\n        this._lastPointDrag.y = y;\n        this._isNeedDrop = false;\n        this._isNeedHold = false;\n        this._moveDX = 0;\n        this._moveDY = 0;\n        this._maxRLAct = this.game.model.mgrid[0].mcore.cur_x - 5;\n        return true;\n    },\n\n    _movedGesture : function(x, y) {\n        var currenttime = new Date().getTime();\n\n        //旋转触摸条件\n        if (Math.abs(this._firstTouchPoint.x - x) > this._moveDX)\n            this._moveDX = Math.abs(this._firstTouchPoint.x - x);\n        if (Math.abs(this._firstTouchPoint.y - y) > this._moveDY)\n            this._moveDY = Math.abs(this._firstTouchPoint.y - y);\n\n        //计算dx，dy，dx_drag, dy_drag\n        var dx = x - this._lastTouchPoint.x;\n        var dy = y - this._lastTouchPoint.y;\n        this._lastTouchPoint.x = x;\n        this._lastTouchPoint.y = y;\n        var dx_drag = x - this._lastPointDrag.x;\n        var dy_drag = y - this._lastPointDrag.y;\n\n        var dt = currenttime - this._lastMoveTime;\n        this._setTouchKeyThreshold(dx, dt);\n\n        if(dx==0 && dy==0) return;\n\n        //console.log(\"TOUCHMOVE...dx=\"+dx+\" dy=\"+dy+\" dxdrag=\"+dx_drag+\" dydrag=\"+dy_drag);\n\n        //下扫直落\n        if (dy < -this._idenSizeDrop) {\n            if (dx <= this._idenSizeX * 0.6 && dx >= -this._idenSizeX * 0.6)\n                this._isNeedDrop = true;\n        }\n\n        //上扫暂存\n        if (dy > this._idenSizeDrop) {\n            if (dx <= this._idenSizeX * 1.1 && dx >= -this._idenSizeX * 1.1)\n                this._isNeedHold = true;\n            this._lastPointDrag.y = y;\n        }\n\n        //左右拖动\n        if (dy >= -this._idenSizeDrop && dy <= this._idenSizeDrop) {\n            var horizontalMove = false;\n            if (dy >= 0)\n                horizontalMove = true;\n            else if (Math.abs(dx) / Math.abs(dy) > 1.0)\n                horizontalMove = true;\n            else\n                this._lastPointDrag.x = x;\n\n            //右移动作\n            if (dx_drag > this._idenSizeX && horizontalMove) {\n                var actCount = parseInt(dx_drag / this._idenSizeX);\n\n                for (var i = 0; i < actCount; i++) {\n                    if (this._maxRLAct <= 5) {\n                        this.triggerPutUserAction('R');\n                        this._maxRLAct++;\n                    }\n                }\n                this._lastPointDrag.x += this._idenSizeX * actCount;\n                this._lastPointDrag.y = y;\n\n                this._isNeedDrop = false;\n                this._isNeedHold = false;\n            }\n            //左移动作\n            if (dx_drag < -this._idenSizeX && horizontalMove) {\n                var actCount = parseInt(Math.abs(dx_drag) / this._idenSizeX);\n                for (var i = 0; i < actCount; i++) {\n                    if (this._maxRLAct >= -5) {\n                        this.triggerPutUserAction('L');\n                        this._maxRLAct--;\n                    }\n                }\n                this._lastPointDrag.x -= this._idenSizeX * actCount;\n                this._lastPointDrag.y = y;\n\n                this._isNeedDrop = false;\n                this._isNeedHold = false;\n            }\n\n            //下移动作\n            if (dy_drag < -this._idenSizeY) {\n                var actCount = parseInt(Math.abs(dy_drag) / this._idenSizeY);\n                for (var i = 0; i < actCount; i++) {\n                    if (this._maxDAct <= 20) {\n                        this.triggerPutUserAction('D');\n                        this._maxDAct++;\n                    }\n                }\n                this._lastPointDrag.x = x;\n                this._lastPointDrag.y -= this._idenSizeY * actCount\n            }\n        }\n\n        this._lastMoveTime = currenttime;\n    },\n\n    _endedGesture : function(x, y) {\n\n        if(!this._checkTriggerBtnClick(x, y)){\n            if(this._isNeedDrop) {\n                this.triggerPutUserAction('W');\n                this._isNeedDrop=false;\n            }\n            if(this._isNeedHold) {\n                this.triggerPutUserAction('S');\n                this._isNeedHold=false;\n            }\n            //旋转动作检测\n            if(this._moveDX<=25.0 && this._moveDY<=25.0)\n            {\n                this.triggerPutUserAction('T');\n            }\n        }\n    },\n\n    _checkTriggerBtnClick : function (_x, _y) {\n        //return this.game.checkTriggerBtnClick(this._btn_scope,  new cc.Vec2(_x, _y));\n        return false; //永久不成立\n    }\n});\n(function (window, factory) {\n    if (typeof exports === 'object') {\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        define(factory);\n    } else {\n        window.ElsTouch = factory();\n    }\n})(this, function () {\n    return ElsTouch\n});\n"]}