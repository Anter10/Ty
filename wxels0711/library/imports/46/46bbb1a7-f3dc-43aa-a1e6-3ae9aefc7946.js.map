{"version":3,"sources":["../../../../../assets/script/CommonFrame/assets/script/CommonFrame/AdManager.js"],"names":["tywx","AdManager","adIconBtn","adInfoList","currentAdInfo","currentWebPage","retryTimes","AnimType","STATIC","SHAKE","FRAME","adUnitId","showVidelAd","IsWechatPlatform","rewardedVideoAd","wx","createRewardedVideoAd","videoAdOK","show","catch","load","then","console","log","err","errMsg","e","showToast","title","duration","requestADInfo","self","onLoad","onClose","res","isEnded","undefined","MSG","addRewardDiamond","reqObj","timeStamp","Date","getTime","act","time","game_mark","SystemInfo","cloudId","gameId","signStr","getConfigSignStr","paramStrList","key","push","finalUrl","shareManagerUrl","join","that","request","url","method","success","statusCode","ret","data","JSON","stringify","retmsg","index","NotificationCenter","trigger","fail","getAdNode","showAd","position","genRandomFirstAdInfo","active","cc","loader","loadRes","prefab","preFabNode","instantiate","p","x","y","game","addPersistRootNode","adIconNode","adButton","getChildByName","on","onClickAdIconBtn","length","weight_list","i","_randomObj","parseInt","icon_weight","icon_id","sort","a","b","weight","_total","forEach","element","_randomIndex","Math","random","_tTotal","_selectIndex","_selectObj","id","genRandomSecondAdInfo","_webPages","webpages","webpage_weight","config_id","_animaType","icon_type","spriteIco","stopAllActions","getComponent","Animation","removeComponent","setRotation","BiLog","clickStat","clickStatEventType","clickStatEventTypeShowAdBtn","icon_skip_type","toappid","togame","icon_url","texture","Sprite","spriteFrame","SpriteFrame","error","anchorX","anchorY","_act1","rotateBy","_act2","_act3","_act4","_delay","delayTime","runAction","repeatForever","sequence","repeat","allFrames","playFrameAction","animation","addComponent","clip","AnimationClip","createWithSpriteFrames","name","wrapMode","WrapMode","Loop","addClip","play","results","getError","_frame","getContent","hideAd","skip_type","topath","path","second_toappid","clickStatEventTypeClickAdBtn","navigateToMiniProgram","resetBtnIcon","appId","envVersion","extraData","from","clickStatEventTypeClickDirectToMiniGameSuccess","webpage_url","clickStatEventTypeClickDirectToMiniGameFail","clickStatEventTypeClickShowQRCode","previewImage","current","urls","LOGD","sortedKeys","Object","keys","finalSign","hex_md5","showBannerAd","adid","window","hasOwnProperty","sysInfo","getSystemInfoSync","screenWidth","screenHeight","ratio","destroyBannerAd","curBannerAd","createBannerAd","style","left","top","width","onResize","height","hide","destroy"],"mappings":"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","file":"AdManager.js","sourceRoot":"../../../../../assets/script/CommonFrame","sourcesContent":["/**\n * Created by xiaochuntian on 2018/5/31.\n */\n\n/**\n * 交叉导流相关系统接口, 调用导流接口使用showAd() 接口， 刷新导流显示icon使用resetBtnIcon() 接口\n */\ntywx.AdManager = {\n    adIconBtn: null, //向其他小游戏的导流入口\n\n    adInfoList: [], //所有广告信息的列表\n    currentAdInfo: null, //当前做展示的导流信息\n    currentWebPage: null, //当前显示的最终导流游戏的信息\n    retryTimes: 3, //网络请求失败重试次数\n    //demo数据\n    AnimType: { //广告显示的动画\n        STATIC: 1, //静态\n        SHAKE: 2, //抖动\n        FRAME: 3 //帧动画\n    },\n    adUnitId: \"adunit-b1b6646ef9af8363\", // 视频广告id\n\n    showVidelAd: function() {\n        if (!tywx.IsWechatPlatform()) {\n            return;\n        }\n        try {\n            let rewardedVideoAd = wx.createRewardedVideoAd({\n                adUnitId: this.adUnitId\n            });\n            if (this.videoAdOK) {\n                this.videoAdOK = false;\n                rewardedVideoAd.show()\n                    .catch(err => {\n                        rewardedVideoAd.load()\n                            .then(() => rewardedVideoAd.show())\n                    });\n            } else {\n                rewardedVideoAd.load()\n                    .then(() => rewardedVideoAd.show())\n                    .catch(err => console.log(err.errMsg))\n            }\n        } catch (e) {\n            // statements\n            wx.showToast({\n                title: '版本太低啦',\n                duration: 1000,\n            });\n            console.log(e);\n        }\n\n    },\n\n    /**\n     * 请求交叉倒流的信息\n     */\n    requestADInfo: function() {\n\n        if (!tywx.IsWechatPlatform()) {\n            return;\n        }\n        try {\n            let rewardedVideoAd = wx.createRewardedVideoAd({\n                adUnitId: this.adUnitId\n            });\n            let self = this;\n            rewardedVideoAd.onLoad(() => {\n                console.log('激励视频 广告加载成功');\n                self.videoAdOK = true\n            });\n\n            rewardedVideoAd.onClose(res => {\n                // 用户点击了【关闭广告】按钮\n                // 小于 2.1.0 的基础库版本，res 是一个 undefined\n                if (res && res.isEnded || res === undefined) {\n                    // 正常播放结束，可以下发游戏奖励\n                    tywx.MSG.addRewardDiamond(1);\n                } else {\n                    // 播放中途退出，不下发游戏奖励\n                }\n            });\n        } catch (e) {\n            // statements\n            console.log(e);\n        }\n\n\n\n        this.retryTimes--;\n        var reqObj = {};\n        var timeStamp = new Date().getTime();\n        reqObj.act = 'api.getCrossConfig';\n        reqObj.time = timeStamp;\n        reqObj.game_mark = tywx.SystemInfo.cloudId + \"-\" + tywx.SystemInfo.gameId;\n        var signStr = this.getConfigSignStr(reqObj);\n        var paramStrList = [];\n        for (var key in reqObj) {\n            paramStrList.push(key + '=' + reqObj[key]);\n        }\n        paramStrList.push('sign=' + signStr);\n        var finalUrl = tywx.SystemInfo.shareManagerUrl + '?' + paramStrList.join('&');\n        var that = this;\n\n        wx.request({\n            url: finalUrl,\n            method: 'GET',\n            success: function(res) {\n                if (res.statusCode == 200) {\n\n                    var ret = res.data;\n                    console.log('RET:' + JSON.stringify(ret));\n                    that.adInfoList = [];\n                    if (ret.retmsg) {\n                        for (var index in ret.retmsg) {\n                            that.adInfoList.push(ret.retmsg[index]);\n                        }\n                    }\n\n                    tywx.NotificationCenter.trigger('GET_AD_MSG_SUCCESS');\n\n                    that.retryTimes = 3;\n                }\n            },\n            fail: function(res) {\n\n                if (that.retryTimes > 0) {\n\n                    that.requestADInfo();\n                } else {\n                    that.retryTimes = 0;\n                }\n\n            }\n        });\n\n\n    },\n\n    /**\n     * 获取广告推广节点（可任意添加动画）\n     * @returns {null}\n     */\n    getAdNode: function() {\n\n        return this.adIconBtn;\n\n    },\n\n    /**\n     * 对外接口，用于添加广告位\n     * position {x, y}\n     */\n    showAd: function(position) {\n\n        this.genRandomFirstAdInfo();\n\n        if (!this.currentAdInfo) {\n            return;\n        }\n\n        if (this.adIconBtn) {\n            this.adIconBtn.active = true;\n        } else {\n            var that = this;\n            //动态加载资源必须放在resources目录下,导流入口强制命名为adNode,放在resources/prefabs下\n            cc.loader.loadRes('prefab/adNode', function(err, prefab) {\n                var preFabNode = cc.instantiate(prefab);\n                preFabNode.position = cc.p(position.x, position.y);\n                that.adIconBtn = preFabNode;\n                cc.game.addPersistRootNode(preFabNode);\n                that.adIconNode();\n                var adButton = that.adIconBtn.getChildByName('adButton');\n                adButton.on('click', function() {\n                    that.onClickAdIconBtn();\n                });\n            });\n        }\n    },\n\n    /**\n     * 生成随机的一级导流信息\n     */\n    genRandomFirstAdInfo: function() {\n\n        if (this.adInfoList.length == 0) {\n            return;\n        }\n\n        var weight_list = [{\n            'weight': 0,\n            'id': '000'\n        }];\n        var that = this;\n\n        for (var i in this.adInfoList) {\n\n            var _randomObj = {\n                'weight': parseInt(that.adInfoList[i].icon_weight),\n                'id': that.adInfoList[i].icon_id,\n            };\n            weight_list.push(_randomObj);\n        }\n\n        weight_list.sort(function(a, b) {\n            return a.weight > b.weight;\n        });\n\n        var _total = 0;\n\n        weight_list.forEach(element => {\n            _total += element.weight;\n        });\n\n        var _randomIndex = parseInt(Math.random() * 10000) % (_total + 1);\n\n        var _tTotal = 0;\n\n        var _selectIndex = 0;\n\n        for (var i = 0; i < (weight_list.length - 1); i++) {\n            _tTotal += weight_list[i].weight;\n            if (_tTotal < _randomIndex && (_tTotal + weight_list[i + 1].weight) >= _randomIndex) {\n                _selectIndex = i + 1;\n                break;\n            }\n        }\n        var _selectObj = weight_list[_selectIndex];\n\n        this.adInfoList.forEach(element => {\n            if (element.icon_id == _selectObj.id) {\n                this.currentAdInfo = element;\n            }\n        });\n\n    },\n\n    /**\n     * 生成随机的二级导流信息\n     */\n    genRandomSecondAdInfo: function() {\n\n        var _webPages = this.currentAdInfo.webpages;\n\n        if (_webPages.length == 0) {\n            return;\n        }\n\n        var weight_list = [{\n            'weight': 0,\n            'id': '000'\n        }];\n\n        for (var i in _webPages) {\n\n            var _randomObj = {\n                'weight': parseInt(_webPages[i].webpage_weight),\n                'id': _webPages[i].config_id\n            }\n\n            weight_list.push(_randomObj);\n        }\n\n        weight_list.sort(function(a, b) {\n            return a.weight > b.weight;\n        });\n\n        var _total = 0;\n\n        weight_list.forEach(element => {\n            _total += element.weight;\n        });\n\n        var _randomIndex = parseInt(Math.random() * 10000) % (_total + 1);\n\n        var _tTotal = 0;\n\n        var _selectIndex = 0;\n        for (var i = 0; i < (weight_list.length - 1); i++) {\n            _tTotal += weight_list[i].weight;\n            if (_tTotal < _randomIndex && (_tTotal + weight_list[i + 1].weight) >= _randomIndex) {\n                _selectIndex = i + 1;\n                break;\n            }\n        }\n        var _selectObj = weight_list[_selectIndex];\n\n\n        _webPages.forEach(element => {\n            if (element.config_id == _selectObj.id) {\n                this.currentWebPage = element;\n            }\n        });\n\n    },\n\n    adIconNode: function() {\n\n        if (!this.currentAdInfo || !this.adIconBtn) {\n            return;\n        }\n\n        var _animaType = this.currentAdInfo.icon_type;\n        var that = this;\n\n        var spriteIco = this.adIconBtn.getChildByName('adIcon');\n        var adButton = this.adIconBtn.getChildByName('adButton');\n\n        spriteIco.stopAllActions();\n        if (spriteIco.getComponent(cc.Animation)) {\n            spriteIco.removeComponent(cc.Animation);\n        }\n\n        spriteIco.setRotation(0);\n\n        tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeShowAdBtn, [that.currentAdInfo.icon_id,\n            that.currentAdInfo.icon_type,\n            that.currentAdInfo.icon_skip_type,\n            that.currentAdInfo.toappid,\n            that.currentAdInfo.togame\n        ]);\n\n        switch (_animaType) {\n\n            case this.AnimType.STATIC:\n\n                cc.loader.load({\n                    url: that.currentAdInfo.icon_url[0]\n                }, function(err, texture) {\n                    if (!err) {\n\n                        spriteIco.getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(texture);\n                    } else {\n\n                    }\n                });\n\n                break;\n            case this.AnimType.SHAKE:\n\n                cc.loader.load({\n                    url: that.currentAdInfo.icon_url[0]\n                }, function(error, texture) {\n\n                    spriteIco.getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(texture);\n                    spriteIco.anchorX = 0.5;\n                    spriteIco.anchorY = 0.5;\n                    var _act1 = cc.rotateBy(0.06, -20);\n                    var _act2 = cc.rotateBy(0.12, 40);\n                    var _act3 = cc.rotateBy(0.12, -40);\n                    var _act4 = cc.rotateBy(0.06, 20);\n                    var _delay = cc.delayTime(1);\n                    spriteIco.runAction(cc.repeatForever(cc.sequence(_act1,\n                        cc.repeat(cc.sequence(_act2, _act3), 4),\n                        _act4,\n                        _delay)));\n                });\n\n\n                break;\n            case this.AnimType.FRAME:\n\n                var allFrames = [];\n\n                var playFrameAction = function() {\n\n                    if (!spriteIco.getComponent(cc.Animation)) {\n\n                        var animation = spriteIco.addComponent(cc.Animation);\n                        var clip = cc.AnimationClip.createWithSpriteFrames(allFrames, 10);\n                        clip.name = 'anim_frame';\n                        clip.wrapMode = cc.WrapMode.Loop;\n                        animation.addClip(clip);\n                        animation.play('anim_frame');\n                    }\n                };\n\n                for (var i = 0; i < that.currentAdInfo.icon_url.length; i++) {\n\n                    cc.loader.load(that.currentAdInfo.icon_url, function(err, results) {\n\n\n                        if (err) {\n                            for (var i = 0; i < err.length; i++) {\n                                cc.log('Error url [' + err[i] + ']: ' + results.getError(err[i]));\n                            }\n                        }\n\n                        for (var i = 0; i < that.currentAdInfo.icon_url.length; i++) {\n\n                            var _frame = new cc.SpriteFrame(results.getContent(that.currentAdInfo.icon_url[i]));\n                            allFrames.push(_frame);\n                        }\n                        playFrameAction();\n                    });\n                }\n\n                break;\n            default:\n                break;\n\n        }\n\n    },\n\n    hideAd: function() {\n        if (this.adIconBtn) {\n            this.adIconBtn.active = false;\n        }\n    },\n\n    onClickAdIconBtn: function() {\n\n        this.genRandomSecondAdInfo();\n\n        //先尝试直接跳转\n        var skip_type = this.currentAdInfo.icon_skip_type;\n        var toappid = this.currentAdInfo.toappid;\n        var togame = this.currentAdInfo.togame;\n        var topath = this.currentAdInfo.path;\n        var second_toappid = this.currentAdInfo.second_toappid;\n\n        console.log('topath ====>' + topath);\n        var that = this;\n        tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeClickAdBtn, [that.currentAdInfo.icon_id,\n            that.currentAdInfo.toappid,\n            that.currentAdInfo.togame\n        ]);\n\n        //先尝试直接跳转\n        if (wx && wx.navigateToMiniProgram) {\n            this.resetBtnIcon();\n            if (1 == skip_type) {\n\n                wx.navigateToMiniProgram({\n                    appId: toappid,\n                    path: topath ? topath : '?from=adcross',\n                    envVersion: 'release',\n                    extraData: {\n                        from: topath ? topath : '?from=adcross',\n                    },\n                    success: function(res) {\n\n                        tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeClickDirectToMiniGameSuccess, [that.currentAdInfo.icon_id,\n                            that.currentWebPage.config_id,\n                            that.currentWebPage.webpage_url,\n                            that.currentAdInfo.toappid,\n                            that.currentAdInfo.togame\n                        ]);\n                        console.log('wx.navigateToMiniProgram success');\n                        console.log(res);\n                    },\n                    fail: function(res) {\n                        console.log('wx.navigateToMiniProgram fail');\n                        console.log(res);\n\n                        tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeClickDirectToMiniGameFail, [that.currentAdInfo.icon_id,\n                            that.currentWebPage.config_id,\n                            that.currentWebPage.webpage_url,\n                            that.currentAdInfo.toappid,\n                            that.currentAdInfo.togame\n                        ]);\n                    }\n                });\n\n                return;\n            } else if (2 == skip_type) {\n\n                wx.navigateToMiniProgram({\n                    appId: second_toappid,\n                    path: topath ? topath : '?from=adcross',\n                    envVersion: 'release',\n                    extraData: {\n                        from: topath ? topath : '?from=adcross',\n                    },\n                    success: function(res) {\n                        console.log('wx.navigateToMiniProgram success');\n                        console.log(res);\n\n                        tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeClickDirectToMiniGameSuccess, [that.currentAdInfo.icon_id,\n                            that.currentWebPage.config_id,\n                            that.currentWebPage.webpage_url,\n                            that.currentAdInfo.toappid,\n                            that.currentAdInfo.togame\n                        ]);\n                    },\n                    fail: function(res) {\n                        console.log('wx.navigateToMiniProgram fail');\n                        console.log(res);\n\n                        tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeClickDirectToMiniGameFail, [that.currentAdInfo.icon_id,\n                            that.currentWebPage.config_id,\n                            that.currentWebPage.webpage_url,\n                            that.currentAdInfo.toappid,\n                            that.currentAdInfo.togame\n                        ]);\n                    }\n                });\n\n\n            } else {\n                console.error('Unsupported skip type! Please Check!');\n            }\n\n\n            return;\n        }\n\n        //直接跳转接口不好使，展示 小程序/小游戏 二维码图片\n        if (!this.currentWebPage) {\n            return;\n        }\n\n\n\n        tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeClickShowQRCode, [that.currentAdInfo.icon_id,\n            that.currentWebPage.config_id,\n            that.currentWebPage.webpage_url,\n            that.currentAdInfo.toappid,\n            that.currentAdInfo.togame\n        ]);\n        if (tywx.IsWechatPlatform()) {\n            wx.previewImage({\n                current: [that.currentWebPage.webpage_url],\n                urls: [that.currentWebPage.webpage_url],\n                success: function(res) {\n                    tywx.LOGD(null, \"预览图片成功！\");\n                },\n                fail: function(res) {\n                    tywx.LOGD(null, \"预览图片失败！\");\n                }\n            });\n        }\n\n        this.resetBtnIcon();\n    },\n\n    /**\n     * 刷新ad按钮的icon\n     */\n    resetBtnIcon: function() {\n\n        if (!this.adIconBtn) {\n            return;\n        } else {\n            this.genRandomFirstAdInfo();\n            this.adIconNode();\n        }\n\n    },\n\n    /**\n     * 计算签名字符串\n     * @param reqObj\n     * @returns {string}\n     */\n    getConfigSignStr: function(reqObj) {\n        var sortedKeys = Object.keys(reqObj).sort();\n        var signStr = '';\n        for (var i = 0; i < sortedKeys.length; i++) {\n            var key = sortedKeys[i];\n            if (key == 'act' || key == 'sign') {\n                continue;\n            } else {\n                signStr += key + '=' + reqObj[key];\n            }\n        }\n        var finalSign = tywx.hex_md5('market.tuyoo.com-api-' + signStr + '-market.tuyoo-api') || '';\n        return finalSign;\n    },\n\n\n    /**\n     * 展示Banner广告\n     * @param adid 广告ID\n     */\n    showBannerAd: function(adid) {\n\n        console.log('showBanner');\n        if (!window.wx) {\n            //防止在浏览器中报错\n            return;\n        }\n\n        if (!wx.hasOwnProperty('createBannerAd')) {\n            tywx.LOGD(null, '玩家基础库,不支持banner!');\n            return;\n        }\n\n        var sysInfo = wx.getSystemInfoSync();\n        var screenWidth = sysInfo.screenWidth;\n        var screenHeight = sysInfo.screenHeight;\n        //自适应高 设计的广告栏宽600.高190  游戏整体宽是720\n        var ratio = 0.88;\n\n        this.destroyBannerAd();\n\n        tywx.LOGD('showBannerAd', '当前屏幕宽度:' + screenWidth + \"; screenHeight:\" + screenHeight);\n\n        tywx.curBannerAd = wx.createBannerAd({\n            adUnitId: adid,\n            style: {\n                left: 0,\n                top: 0,\n                width: ratio * screenWidth,\n            }\n        });\n        try {\n            tywx.curBannerAd.onResize(function(res) {\n                console.log('showBannerAd', '当前banner,width:' + res.width + \"; height:\" + res.height);\n                if (tywx.curBannerAd) {\n                    tywx.curBannerAd.style.left = (screenWidth - res.width) / 2;\n                    tywx.curBannerAd.style.top = screenHeight - screenHeight * 0.153; // - res.height + 1;\n                    res.height = screenHeight * 0.15;\n                    res.width = screenWidth;\n                }\n            });\n        } catch (e) {\n\n            console.log(e);\n        }\n\n        tywx.curBannerAd.show();\n    },\n\n    destroyBannerAd: function() {\n        if (tywx.curBannerAd) {\n            try {\n                tywx.curBannerAd.hide();\n                tywx.curBannerAd.destroy();\n            } catch (e) {\n                console.log(e);\n            }\n            tywx.curBannerAd = null;\n        }\n    }\n\n\n};\n\ntywx.AdManager.requestADInfo();"]}