{"version":3,"sources":["../../../../../assets/script/core/assets/script/core/ai.js"],"names":["els","require","nge","Class","elsAiPolicyVS","getMode","core","ai_mode","mcore","top_line","elsAiPolicyADV","AIP","ElsAi","extend","ctor","mActQueue","tActQueue","maxScore","work2idx","getGridScore","tg","cx","cy","cf","nf","ccombo","aip","i","score","hole_count","top_total","xiagu","Array","HENG","xiagu_count","xiagu_total","col_hole","col_top","Math","min","top_avg","fangcha","t","cur_x","combo","AI_F1","fs","save","scan","b1","clone","b2","b3","bq","bq1","bq2","tmpz","ELS_CLASSIC","ZCOUNT_C","cur_block","ZCOUNT_NC","tmpsave","s2","recycle","saveBlk","nz","n","moveBlk","TURN_CW","x2","LEFT","REACH_BORDER","RIGHT","AI_F2","tai","cxs","cys","cfs","bq0","b0","DDOWN","REACH_BOTTOM","fullrows","length","clearRow","cur_y","nextBlk","s","ms_scan","maxscore_scan","AI_F3","b","mx","xx","SET","getAIAct","len","optN","minScore","sort","_","a","tmp","pop","m","cret","slice","window","factory","exports","module","define","amd"],"mappings":"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","file":"ai.js","sourceRoot":"../../../../../assets/script/core","sourcesContent":["var els = require(\"./els.js\");\nvar nge = require(\"./engine.js\");\nvar Class = nge.Class;\nvar elsAiPolicyVS = {\n    getMode: function(core) {\n        core.ai_mode = (core.mcore.top_line > 10)?\"safe\":\"normal\";\n    },\n    \"safe\": {\n        \"init\": 5000,\n        \"clear.line\": [0,6000,7200,10800,14400],\n        \"fangcha\": -0.5,\n        \"top.avg\": -300,\n        \"hole\": -2000,\n        \"combo\": [300000, 2500],\n        \"xiagu.max\": 2,\n        \"xiagu\": -500\n    },\n    \"normal\": {\n        \"init\": 5000,\n        \"clear.line\": [0,-7000,-6400,160,240],\n        \"fangcha\": -0.5,\n        \"top.avg\": -30,\n        \"hole\": -2500,\n        \"combo\": [300000, 2500],\n        \"xiagu.max\": 2,\n        \"xiagu\": -500\n    }\n};\n\nvar elsAiPolicyADV = {\n    getMode: function(core) {\n        core.ai_mode = (core.top_line > 10)?\"safe\":\"normal\";\n    },\n    \"safe\": {\n        \"init\": 5000,\n        \"clear.line\": [0,6000,7200,10800,14400],\n        \"fangcha\": -0.5,\n        \"top.avg\": -300,\n        \"hole\": -2000,\n        \"combo\": [300000, 2500],\n        \"xiagu.max\": 1,\n        \"xiagu\": -500\n    },\n    \"normal\": {\n        \"init\": 5000,\n        \"clear.line\": [0,6000,7200,10800,14400],\n        \"fangcha\": -0.5,\n        \"top.avg\": -30,\n        \"hole\": -2500,\n        \"combo\": [300000, 2500],\n        \"xiagu.max\": 1,\n        \"xiagu\": -500\n    }\n};\n\nvar AIP = elsAiPolicyVS;\n//var AIP = elsAiPolicyADV;\n\nvar ElsAi = Class.extend({\n    ctor: function() {\n        this.mActQueue=[];\n        this.tActQueue=[];\n        this.maxScore=0;\n        this.work2idx = -1;\n    },\n\n    //布局评分,用于AI计算最合理的摆法...\n    getGridScore: function(tg, cx, cy, cf, nf, ccombo) {\n        var core = tg.mcore;\n        var aip = AIP[tg.ai_mode];\n        var i, score=aip[\"init\"], hole_count=0, top_total=0;\n        var xiagu=new Array(els.HENG), xiagu_count=0, xiagu_total=0;\n        //计算总空\n        for(i=0;i<els.HENG;i++) {\n            hole_count+=core.col_hole[i];\n            top_total+=core.col_top[i]*10;\n            xiagu[i]=0;\n            if(i==0) {\n                if(core.col_top[1]>core.col_top[0])\n                    xiagu[i]=core.col_top[1]-core.col_top[0];\n            } else if(i==els.HENG-1) {\n                if(core.col_top[i-1]>core.col_top[i])\n                    xiagu[i]=core.col_top[i-1]-core.col_top[i];\n            } else {\n                if((core.col_top[i+1]>core.col_top[i]) &&\n                   (core.col_top[i-1]>core.col_top[i]))\n                    xiagu[i]=Math.min(core.col_top[i-1],core.col_top[i+1])-core.col_top[i];\n            }\n            if(xiagu[i]>2)\n                xiagu_count++;\n            xiagu_total+=xiagu[i];\n        }\n\n        //计算平均行高,计算行高方差\n        var top_avg = top_total/els.HENG;\n        var fangcha = 0;\n        for(i=0;i<els.HENG;i++) {\n            var t=core.col_top[i]*10-top_avg;\n            fangcha+=(t*t);\n        }\n\n        //按方差评分\n        score += fangcha*aip[\"fangcha\"];\n\n        //鼓励靠边...\n        score += ((cx-5)*(cx-5)+(core.cur_x-5)*(core.cur_x-5))*5;\n\n        //进攻模式不鼓励只消一两行，鼓励消掉两行以上\n        score += aip[\"clear.line\"][cf];\n        score += aip[\"clear.line\"][nf];\n\n        //局面越低约均衡越好\n        score += top_avg*aip[\"top.avg\"];\n\n        //空洞越少越好\n        score += hole_count*aip[\"hole\"];\n\n        //连击加分\n        if (ccombo>2)\n            score += ccombo*aip[\"combo\"][0];\n        else\n            score += ccombo*aip[\"combo\"][1];\n\n        //连击加分\n        if(core.combo>2)\n            score += core.combo*aip[\"combo\"][0];\n        else\n            score += core.combo*aip[\"combo\"][1];\n\n        //峡谷越少越好，有一个大峡谷不怕，怕出现两个峡谷\n        if(xiagu_count>=aip[\"xiagu.max\"])\n            score+=aip[\"xiagu\"]*xiagu_total;\n\n        return score;\n    },\n\n    AI_F1: function(tg, cx, cy, cf, combo, fs, save, scan) {\n        var b1 = tg.mcore.clone();\n        var b2=null,b3=null;\n        var bq='',bq1='',bq2='';\n\n        bq=this.tActQueue;\n        var tmpz;\n        if(els.ELS_CLASSIC) \n            tmpz = els.ZCOUNT_C[tg.mcore.cur_block];\n        else\n            tmpz = els.ZCOUNT_NC[tg.mcore.cur_block];\n\n        var tmpsave = save?1:0;\n\n        for(var s2=0; s2<=tmpsave; s2++) {\n            tg.mcore.recycle();\n            tg.mcore = b1.clone();\n            this.tActQueue=bq;\n            if(s2!=0) {\n                this.tActQueue+='S';\n                tg.saveBlk(true);\n            }\n            b2 = tg.mcore.clone();\n            bq1 = this.tActQueue;\n\n            for(var nz=0; nz<tmpz; nz++) {\n                tg.mcore.recycle();\n                tg.mcore = b2.clone();\n                this.tActQueue = bq1;\n                //旋转\n                for(var n=0; n<nz; n++) {\n                    this.tActQueue+='T';\n                    tg.moveBlk(els.TURN_CW, true);\n                }\n\n                b3 = tg.mcore.clone();\n                bq2 = this.tActQueue;\n\n                for(var x2=0;x2<3;x2++) {\n                    tg.mcore.recycle();\n                    tg.mcore = b3.clone();\n                    this.tActQueue = bq2\n                    //左移\n                    if(x2==1)\n                        while(tg.moveBlk(els.LEFT, true)!=els.REACH_BORDER) {\n                            this.tActQueue+='L';\n                            fs(this, tg, cx, cy, cf, combo, scan);\n                        }\n                    //右移\n                    if(x2==2)\n                        while(tg.moveBlk(els.RIGHT, true)!=els.REACH_BORDER) {\n                            this.tActQueue+='R';\n                            fs(this, tg, cx, cy, cf, combo, scan);\n                        }\n                    if(x2==0)\n                        fs(this, tg, cx, cy, cf, combo, scan);\n                }\n                b3.recycle();\n            }\n            b2.recycle();\n        }\n        b1.recycle();\n    },\n\n    AI_F2: function(tai, tg, cxs, cys, cfs, combo, scan) {\n        var cx, cy, cf, ccombo;\n        var bq0 = '';\n\n        //保存现场\n        var b0 = tg.mcore.clone();\n        bq0 = tai.tActQueue;\n\n        //直接下落\n        while(tg.moveBlk(els.DDOWN, true)!=els.REACH_BOTTOM);\n        tai.tActQueue+='W';\n        ccombo = tg.mcore.combo;\n        cf = tg.mcore.fullrows.length;\n        tg.clearRow(true);\n        cx = tg.mcore.cur_x;\n        cy = tg.mcore.cur_y;\n        tg.nextBlk(true);\n        tai.tActQueue+='N';\n\n        var s = tai.getGridScore(tg, cx, cy, cf, 0, combo);\n        if(scan) {\n            tai.ms_scan[tai.ms_scan.length] = \n                [s, tai.tActQueue, tg.mcore, cx, cy, cf, ccombo];\n        } else {\n            if(s > tai.maxscore_scan)\n                tai.AI_F1(tg, cx, cy, cf, ccombo, tai.AI_F3);\n        }\n\n        //恢复现场\n        if(!scan) tg.mcore.recycle();\n        tg.mcore = b0.clone();\n        b0.recycle();\n        tai.tActQueue=bq0;\n    },\n\n    AI_F3: function(tai, tg, cx, cy, cf, combo, scan) {\n        var s, nf;\n        var b;\n        var bq='';\n        b=tg.mcore.clone();\n        bq=tai.tActQueue;\n\n        var mx = 0;\n        for(var i=0; i<4; i++) {\n            var xx = tg.mcore.cur_x+i;\n            if(xx>=els.HENG)\n                break;\n            if(tg.mcore.col_top[xx]>mx)\n                mx=tg.mcore.col_top[xx];\n        }\n        tg.moveBlk(els.SET, true);\n\n        //直接下落\n        while(tg.moveBlk(els.DDOWN, true)!=els.REACH_BOTTOM);\n        tai.tActQueue+='W';\n        nf = tg.mcore.fullrows.length;\n        tg.clearRow(true);\n        s = tai.getGridScore(tg, cx, cy, cf, nf, combo);\n        if(s>tai.maxScore) {\n            tai.mActQueue = tai.tActQueue;\n            tai.mActQueue+='N';\n            tai.maxScore=s;\n        }\n\n        tg.mcore.recycle();\n        tg.mcore = b.clone();\n        b.recycle();\n        tai.tActQueue=bq;\n    },\n\n    //如果自动运行动作序列为空则计算生成指令序列，否则返回动作指令  \n    getAIAct: function(tg) {\n        //return ''; //debug...\n        var tai = this;\n        var len = tai.mActQueue.length;\n        var optN = 6;\n        var minScore = -9000000000;\n\n        //需要计算自动队列,第一帧先扫描第一块\n        if(len==0 && tai.work2idx<0) {\n            tai.maxScore = minScore;\n            //保存现场\n            var b = tg.mcore.clone();\n            //遍历第一块获取分数和ms_scan列表\n            tai.tActQueue='';\n            tg.clearRow(true);\n            AIP.getMode(tg);\n            tai.ms_scan = [];\n            tai.AI_F1(tg, 0, 0, 0, 0, tai.AI_F2, false, true);\n            //高分在前面\n            tai.ms_scan.sort(function _(a,b) {return (b[0]-a[0]);});\n            //console.log('AISORT'+tai.ms_scan.length+':'+tai.ms_scan);\n            //删除并释放topN个最低分数\n            if(tai.ms_scan.length>optN) {\n                for(var i=0; i<optN; i++) {\n                    var tmp = tai.ms_scan.pop();\n                    tmp[2].recycle();\n                }\n            }\n            tai.work2idx = tai.ms_scan.length-1;\n            tg.mcore.recycle();\n            tg.mcore = b.clone();\n            b.recycle();\n            return;\n        }\n\n        //针对ms_scan列表,进行第二块的遍历运算,每帧只算1个布局\n        if(tai.work2idx>=0) {\n            var b = tg.mcore.clone();\n            var m = tai.ms_scan[tai.work2idx];\n            tg.mcore = m[2];\n            tai.tActQueue = m[1];\n            tai.AI_F1(tg, m[3], m[4], m[5], m[6], tai.AI_F3);\n            tg.mcore.recycle();\n            tg.mcore = b.clone();\n            b.recycle();\n            tai.work2idx-=1;\n            if(tai.work2idx==-1) tai.ms_scan = null;\n            return;\n        }\n\n        //取走第一个动作码，返回\n        var cret = tai.mActQueue[0];\n        tai.mActQueue = tai.mActQueue.slice(1);\n        return cret;\n    }\n});\n\n(function (window, factory) {\n    if (typeof exports === 'object') {\n      module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n      define(factory);\n    } else {\n      window.ElsAi = factory();\n    }\n  })(this, function () {\n    return ElsAi;\n});\n"]}