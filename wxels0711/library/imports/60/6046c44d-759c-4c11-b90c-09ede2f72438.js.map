{"version":3,"sources":["../../../../../assets/script/ui/assets/script/ui/MagicBottleView.js"],"names":["ELSEvent","require","els","MAX_MAGIC","cc","Class","extends","Component","properties","nodeFull","Node","nodeNormal2","nodeBoxMove","aniNormal","Animation","aniFull","labCurrentMagic","Label","labAddMagic","prefabAddMagic","Prefab","onLoad","currentMagic","addValue","node","active","string","addLabDefaultPos","position","hide","on","num","console","log","tywx","NotificationCenter","listen","ELS_EVENT_MAGIC_BOTTLE_ADD","progressTo","ELS_EVENT_MAGIC_BOTTLE_FULL","bottleFull","ELS_EVENT_MAGIC_RESET_BOTTLE","reset","init","game","start","onDestroy","ignore","nodeNormal","addMagic","add","model","mconf","isWhisper","showAddMagicEffect","normalAniCtrl","getComponent","tmpAddMagic","instantiate","self","parent","animationPause","play","showBoxMove","end_pos","getChildByName","move_end","p","scale","runAction","sequence","spawn","moveTo","scaleTo","callFunc"],"mappings":"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","file":"MagicBottleView.js","sourceRoot":"../../../../../assets/script/ui","sourcesContent":["let ELSEvent = require('../core/ElsEvents.js');\nlet els = require(\"../core/els.js\");\nconst MAX_MAGIC = 100;\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        nodeFull: cc.Node,\n        nodeNormal2: cc.Node,\n        nodeBoxMove: cc.Node,\n        aniNormal: cc.Animation,\n        aniFull: cc.Animation,\n        labCurrentMagic: cc.Label,\n        labAddMagic: cc.Label,\n        prefabAddMagic: cc.Prefab,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.currentMagic = 0;\n        this.addValue = 0;\n        this.labAddMagic.node.active = false;\n        this.labCurrentMagic.string = '0';\n        this.addLabDefaultPos = this.labAddMagic.node.position;\n        this.hide();\n\n        this.aniFull.on('finished', (num, string)=>{\n            console.log('full finished',num, string);\n        }, this);\n\n        //! 事件监听\n        tywx.NotificationCenter.listen(ELSEvent.ELS_EVENT_MAGIC_BOTTLE_ADD, this.progressTo, this);\n        tywx.NotificationCenter.listen(ELSEvent.ELS_EVENT_MAGIC_BOTTLE_FULL, this.bottleFull, this);\n        tywx.NotificationCenter.listen(ELSEvent.ELS_EVENT_MAGIC_RESET_BOTTLE, this.reset, this);\n\n    },\n    init(game){\n        this.game = game;\n    },\n\n    start () {\n    },\n    onDestroy(){\n        tywx.NotificationCenter.ignore(ELSEvent.ELS_EVENT_MAGIC_BOTTLE_ADD, this.progressTo, this);\n        tywx.NotificationCenter.ignore(ELSEvent.ELS_EVENT_MAGIC_BOTTLE_FULL, this.bottleFull, this);\n        tywx.NotificationCenter.ignore(ELSEvent.ELS_EVENT_MAGIC_RESET_BOTTLE, this.reset, this);\n    },\n\n    // update (dt) {},\n    reset(){\n        console.log('MagicBottleView  reset',this.nodeNormal,this.aniNormal);\n        this.nodeNormal2.active = true;\n        //this.aniNormal.play();\n        this.nodeFull.active = false;\n        this.currentMagic = 0;\n        this.labCurrentMagic.string = '0';\n    },\n    addMagic(add){\n        if (this.game.model.mconf.isWhisper) {\n            return;\n        }\n        this.currentMagic += add;\n        this.currentMagic = this.currentMagic > MAX_MAGIC ? MAX_MAGIC : this.currentMagic;\n        this.addValue = add;\n        console.log('show add magic', this.currentMagic);\n    },\n    showAddMagicEffect(){\n        console.log('show add magic effect ===>bottle');\n        let normalAniCtrl = this.nodeNormal2.getComponent('els_view_magic_bottle');\n        if(normalAniCtrl){\n            normalAniCtrl.progressTo(this.currentMagic);\n        }\n        if(this.addValue > 0){\n            let tmpAddMagic = cc.instantiate(this.prefabAddMagic);\n            let self = this;\n            tmpAddMagic.parent = this.node;\n            tmpAddMagic.position = this.labAddMagic.node.position;\n            tmpAddMagic.getComponent('els_view_add_magic').init(this.addValue,()=>{\n                self.labCurrentMagic.string = `${self.currentMagic}`;\n            });\n        }\n        console.log('show add magic', normalAniCtrl);\n    },\n    animationPause(){\n        //this.aniNormal.pause();\n    },\n    hide(){\n        this.nodeFull.active = false;\n        this.nodeNormal2.active = false;\n        this.nodeBoxMove.active = false;\n    },\n    progressTo(num){\n        console.log('progerssTo2',num);\n        this.animationPause();\n    },\n    bottleFull(num){\n        console.log('bottle full',num);\n        //this.aniNormal.stop();\n        this.nodeNormal2.active = false;\n        this.nodeFull.active = true;\n        this.aniFull.play();\n        this.currentMagic = 0;\n        this.showBoxMove();\n    },\n    showBoxMove(){\n        this.nodeBoxMove.active = true;\n        let end_pos = this.node.getChildByName('EndPos').position;\n        console.log('showBoxMove', end_pos);\n        let self = this;\n        let move_end = ()=>{\n            self.nodeBoxMove.active = false;\n            self.nodeBoxMove.position = cc.p(0,0);\n            self.nodeBoxMove.scale = 0.5;\n            self.nodeFull.active = false;\n            self.nodeNormal2.active = true;\n        };\n        this.nodeBoxMove.runAction(\n            cc.sequence(\n                cc.spawn(\n                    cc.moveTo(0.5,end_pos),\n                    cc.scaleTo(0.5,1)\n                ),\n                cc.callFunc(move_end)\n            )\n        );\n    }\n});\n"]}