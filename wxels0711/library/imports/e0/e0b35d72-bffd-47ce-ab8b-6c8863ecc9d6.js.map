{"version":3,"sources":["../../../../../assets/script/core/assets/script/core/ELSProfile.js"],"names":["ELSProfile","keyvalues","KEYS","MUSIC_MUTE","BLOCK_IDX","SHARE_TIME_STAMP","initProps","tywx","IsWechatPlatform","console","log","wx","getStorageSync","currentTimeMillis","PROPS_COUNT","save","key","cc","sys","localStorage","setItem","value","is_mute","setIsMusicMute","min_wait","getValueByKey","ret","date","Date","getTime","PROP_TYPES","push","count","_instance","load","PROP_0","PROP_1","module","exports"],"mappings":"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","file":"ELSProfile.js","sourceRoot":"../../../../../assets/script/core","sourcesContent":["/**\n * 管理俄罗斯方块本地存储数据\n * create by luning.\n */\nimport { els } from \"./els.js\";\n\nclass ELSProfile{\n    constructor(){\n        this.keyvalues = {};\n\n        this.keyvalues[ELSProfile.KEYS.MUSIC_MUTE] = false;\n        this.keyvalues[ELSProfile.KEYS.BLOCK_IDX] = 0;\n        this.keyvalues[ELSProfile.KEYS.SHARE_TIME_STAMP] = 0;\n        this.initProps();\n    }\n    static getInstance(){\n        if(ELSProfile._instance === null){\n            ELSProfile._instance = new ELSProfile();\n            ELSProfile._instance.load();\n        }\n        return ELSProfile._instance;\n    }\n\n    load(){\n        if(!tywx.IsWechatPlatform()) return;\n        console.log('Profile load start');\n        this.keyvalues[ELSProfile.KEYS.MUSIC_MUTE] = wx.getStorageSync(ELSProfile.KEYS.MUSIC_MUTE);\n        if(this.keyvalues[ELSProfile.KEYS.MUSIC_MUTE] === ''){\n            this.keyvalues[ELSProfile.KEYS.MUSIC_MUTE] = false;\n        }  \n\n        this.keyvalues[ELSProfile.KEYS.SHARE_TIME_STAMP] = wx.getStorageSync(ELSProfile.KEYS.SHARE_TIME_STAMP);\n        if(this.keyvalues[ELSProfile.KEYS.SHARE_TIME_STAMP] === ''){\n            this.keyvalues[ELSProfile.KEYS.SHARE_TIME_STAMP] = this.currentTimeMillis();\n        }\n\n        this.keyvalues[ELSProfile.KEYS.PROPS_COUNT] = wx.getStorageSync(ELSProfile.KEYS.PROPS_COUNT);\n        console.log('prop count',this.keyvalues[ELSProfile.KEYS.PROPS_COUNT]);\n        if(this.keyvalues[ELSProfile.KEYS.PROPS_COUNT] === ''){\n            this.initProps();\n        }\n        \n        console.log('Profile load end');\n        this.save();\n    }\n\n    save(){\n        for(var key in this.keyvalues){\n            // wx.setStorage({\n            //     key: key,\n            //     data: this.keyvalues[key]\n            // });\n            cc.sys.localStorage.setItem(key, this.keyvalues[key]);\n        }\n    }\n\n    getValueByKey(key){\n        return this.keyvalues[key];\n    }\n    setValueByKey(key, value){\n        this.keyvalues[key] = value;\n        this.save();\n    }\n\n    getIsMusicMute(){\n        return this.keyvalues[ELSProfile.KEYS.MUSIC_MUTE];\n    }\n    setIsMusicMute(is_mute){\n        this.keyvalues[ELSProfile.KEYS.MUSIC_MUTE] = is_mute;\n\n        this.save();\n    }\n    switchMusicMute(){\n        this.setIsMusicMute(!this.keyvalues[ELSProfile.KEYS.MUSIC_MUTE]);\n    }\n\n    setShareTimeStamp(){\n        this.keyvalues[ELSProfile.KEYS.SHARE_TIME_STAMP] = this.currentTimeMillis();\n        this.save();\n    }\n    getLastShareTimeStamp(){\n        return this.keyvalues[ELSProfile.KEYS.SHARE_TIME_STAMP];\n    }\n\n    isShowRank(){\n        let min_wait = 28800000;// 8 * 60 * 60 * 1000\n        if(this.currentTimeMillis() - this.getValueByKey(ELSProfile.KEYS.SHARE_TIME_STAMP) >= min_wait){\n            return true;\n        }\n        return false;\n    }\n\n    currentTimeMillis(){\n        let ret = 0;\n        let date = new Date();\n        ret = date.getTime();\n        return ret;\n    }\n\n    //! 道具相关接口\n    initProps(){\n        this.keyvalues[ELSProfile.KEYS.PROPS_COUNT] = [];\n        for(var key in ELSProfile.PROP_TYPES){\n            this.keyvalues[ELSProfile.KEYS.PROPS_COUNT].push(0);\n        }\n    }\n    //! 增加道具\n    addPropByKey(key, count = 1){\n        this.keyvalues[ELSProfile.KEYS.PROPS_COUNT][key] += count;\n        this.save();\n    }\n    //! 获取道具数量\n    getPropByKey(key){\n        let ret = this.keyvalues[ELSProfile.KEYS.PROPS_COUNT][key];\n        return ret;\n    }\n    //! 使用道具\n    usePropByKey(key, count = 1){\n        let ret = false;\n        if(this.keyvalues[ELSProfile.KEYS.PROPS_COUNT][key] > 0){\n            this.keyvalues[ELSProfile.KEYS.PROPS_COUNT][key] -= count;\n            if(this.keyvalues[ELSProfile.KEYS.PROPS_COUNT][key] < 0) this.keyvalues[ELSProfile.KEYS.PROPS_COUNT][key] = 0;\n            ret = true;\n        }\n        else{\n            if(this.keyvalues[ELSProfile.KEYS.PROPS_COUNT][key] < 0) this.keyvalues[ELSProfile.KEYS.PROPS_COUNT][key] = 0;\n            ret = false;\n        }\n        this.save();\n        return ret;\n    }\n}\n//! 保存在本地的属性定义\nELSProfile.KEYS = {\n    MUSIC_MUTE: 'music_mute', //! 是否静音\n    BLOCK_IDX: 'block_idx', //! 皮肤id\n    SHARE_TIME_STAMP: 'share_time_stamp', //! 群分享时间戳\n    PROPS_COUNT: 'props_count', //! 道具数量\n};\nELSProfile.PROP_TYPES = {\n    PROP_0: 0, //! 塌陷 锤子\n    PROP_1: 1, //! 填充 火箭\n};\nELSProfile._instance = null;\nmodule.exports = ELSProfile;\n"]}