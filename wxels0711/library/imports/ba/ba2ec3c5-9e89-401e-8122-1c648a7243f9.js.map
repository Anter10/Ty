{"version":3,"sources":["../../../../../assets/script/ui/assets/script/ui/els_view_daliy_login.js"],"names":["ElsUtils","require","ElsEvents","PropConfig","cc","Class","name","properties","id","count","GiftConfig","day","props","ElsViewDailyLogin","extends","Component","prefabItem","Prefab","nodeContent","Node","giftConfigs","onLoad","tywx","NotificationCenter","listen","ELS_EVENT_DAILY_LOGIN_GIFT_SUCCESS","onGiftSuccess","start","onDestroy","ignoreScope","init","getting_idx","UserInfo","loginReward","canGet","get","configs","conf","isGettedGift","waitingGetItem","forEach","tmp_config","loginServerId2String","e","nday","tmp_rewards","rewards","tmp_prop","itemId","push","element","idx","console","log","tmp_item","instantiate","parent","getComponent","showWaitingGet","showGetted","motaiCallback","btnGetClickCallback","Util","wechatShowModal","MSG","requestDailyLogin","btnCloseClickCallback","node","destroy","params","error","map","Map","items","result","content","has","module","exports"],"mappings":"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","file":"els_view_daliy_login.js","sourceRoot":"../../../../../assets/script/ui","sourcesContent":["let ElsUtils = require('../core/ElsUtils.js');\nlet ElsEvents = require('../core/ElsEvents.js');\nlet PropConfig = cc.Class({\n    name: 'PropConfig',\n    properties:{\n        id: 1014,\n        count: 5\n    }\n});\nlet GiftConfig = cc.Class({\n    name: 'GiftConfig',\n    properties:{\n        day: '第一天',\n        props: [PropConfig]\n    }\n});\n\nlet ElsViewDailyLogin = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        prefabItem: cc.Prefab,\n        nodeContent: cc.Node,\n        giftConfigs : [GiftConfig],\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        tywx.NotificationCenter.listen(ElsEvents.ELS_EVENT_DAILY_LOGIN_GIFT_SUCCESS, this.onGiftSuccess, this);\n    },\n\n    start () {\n\n    },\n\n    // update (dt) {},\n\n    onDestroy(){\n        tywx.NotificationCenter.ignoreScope(this);  \n    },\n\n    init(){\n        let getting_idx = tywx.UserInfo.loginReward.day;\n        let canGet = tywx.UserInfo.loginReward.get;\n        let configs = tywx.UserInfo.loginReward.conf;\n        this.getting_idx = getting_idx;\n        this.giftConfigs = [];\n        this.isGettedGift = !canGet;\n        this.waitingGetItem = null;\n        configs.forEach((e=>{\n            let tmp_config = new GiftConfig();\n            tmp_config.day = ElsUtils.loginServerId2String(e.nday);\n            let tmp_rewards = e.rewards;\n            tmp_config.props = [];\n            tmp_rewards.forEach(e=>{\n                let tmp_prop = new PropConfig();\n                tmp_prop.id = e.itemId;\n                tmp_prop.count = e.count;\n                tmp_config.props.push(tmp_prop);\n            });\n            this.giftConfigs.push(tmp_config);\n        }));\n\n        this.giftConfigs.forEach((element, idx) => {\n            console.log('els_view_daliy_login/element',element, idx);\n            let tmp_item = cc.instantiate(this.prefabItem);\n            tmp_item.parent = this.nodeContent;\n            tmp_item.getComponent('els_view_daily_login_item').init(element, idx < getting_idx);\n            if(idx === getting_idx){\n                if (canGet) {\n                    tmp_item.getComponent('els_view_daily_login_item').showWaitingGet();\n                    this.waitingGetItem = tmp_item;\n                } else {\n                    tmp_item.getComponent('els_view_daily_login_item').showGetted();\n                }\n            }\n        });\n    },\n    /**\n     * 模态层回调\n     */\n    motaiCallback(){},\n    /**\n     * 领取奖励\n     */\n    btnGetClickCallback(){\n        if(this.isGettedGift) {\n            tywx.Util.wechatShowModal(\"今天的奖励已经领取，请明天再来领取！\", false, \"确认\");\n            return;\n        }\n        \n        let tmp_config = this.giftConfigs[this.getting_idx];\n        if(tmp_config){\n            tywx.MSG.requestDailyLogin();\n        }\n    },\n    /**\n     * 关闭界面\n     */\n    btnCloseClickCallback(){\n        this.node.destroy();\n    },\n\n    onGiftSuccess(params){\n        console.log('els_view_daliy_login/onGiftSuccess',params);\n        \n        if (params.error) {\n            tywx.Util.wechatShowModal(\"今天的奖励已经领取，请明天再来领取！\", false, \"确认\");\n            return;\n        }\n\n        tywx.UserInfo.loginReward.get = 0;\n        this.isGettedGift = true;\n        if(this.waitingGetItem){\n            this.waitingGetItem.getComponent('els_view_daily_login_item').showGetted();\n        }\n        let map = new Map([[1014,'钻石'],[1017,'导弹'],[1018,'锤子'],[1019,'魔法棒']]);\n        let items = params.result.items;\n        if(items){\n            let content = '恭喜获得\\r\\n'; // \\r\\n 换行在真机上可以，模拟器中不行\n            items.forEach(e=>{\n                if(map.has(e.itemId)){\n                    content += `${map.get(e.itemId)}x${e.count} `;\n                }\n            });\n            tywx.Util.wechatShowModal(content, false, \"确认\");\n        }\n\n    }\n});\nmodule.exports = ElsViewDailyLogin;"]}