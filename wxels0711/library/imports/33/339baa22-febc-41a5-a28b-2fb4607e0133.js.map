{"version":3,"sources":["../../../../../assets/script/ui/assets/script/ui/star_control.js"],"names":["tywx","StarControl","init","nodepool","cc","NodePool","self","curNodeArray","console","log","isAniPlay","prefabStar","loader","loadRes","Prefab","err","prefab","i","newNode","instantiate","put","createStars","node","starnum","getnum","startype","getChildrenCount","size","clearNodes","width","totalwidth","star","get","jsstar","getComponent","setPosition","p","push","addChild","playAddStarAni","length","playAniAdd","playDelStarAni","playAnidel","shift","removeFromParent"],"mappings":"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","file":"star_control.js","sourceRoot":"../../../../../assets/script/ui","sourcesContent":["\ntywx.StarControl = {\n\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    init : function () {\n        this.nodepool = new cc.NodePool();\n        var self = this;\n        this.curNodeArray = [];\n        console.log(\"--------init--------------------\");\n        this.isAniPlay = false;\n        this.prefabStar = null;\n        \n        cc.loader.loadRes(\"prefab/starnode\", cc.Prefab, function (err, prefab) {\n            console.log(\"load prefab sucess ++++++++++++++++ \");\n        \tif (prefab instanceof cc.Prefab) {\n                for (var i =10; i >= 0; --i) {\n                    var newNode = cc.instantiate(prefab);\n                    self.nodepool.put(newNode);\n                }\n                self.prefabStar = prefab;\n        \t}\n        });\n    },\n\n\n    createStars : function (node, starnum, getnum, startype) {\n        if(!node)\n            return;\n        if(node.getChildrenCount() > 0)\n            return;\n        if(!starnum || starnum > 1000)\n            return;\n        if(!getnum)\n            getnum = 0;\n\n        if(this.nodepool.size() === 0)\n            return;\n        this.isAniPlay = false;\n        console.log(\"fengbing\", \" *-*-*- create stars *-*-*- \"+starnum+'  getnum  '+getnum);\n\n        this.clearNodes();\n        this.getnum = getnum;\n        var width = startype === 0 ? 10 : 46 + 32 ;\n        var totalwidth = (starnum-0.5)*(width+14);\n        \n        for(var i=0; i<starnum; i++){\n            var star = this.nodepool.get();\n            //var star = cc.instantiate(this.prefabStar);\n            var jsstar = star.getComponent(\"star\");\n            jsstar.init(startype, getnum>i ? 1: 0);\n            star.setPosition(cc.p(-totalwidth*0.5+i*(width+14), 0));\n            this.curNodeArray.push(star);\n            node.addChild(star);\n        }\n        console.log(\"fengbing\", \" *-*-*- create stars *-*-*- end\");\n\n    },\n\n\n    playAddStarAni : function () {\n        if(this.isAniPlay || this.curNodeArray.length==0)\n            return;\n\n        if(this.getnum<=0)\n            return;\n        this.isAniPlay = true;\n        var node = this.curNodeArray[this.getnum-1];\n        var jsstar = node.getComponent(\"star\");\n        // console.log(\"fengbing\", \" -*-*-*- play add star ani *-*-*-*-\");\n        jsstar.playAniAdd();\n    },\n\n    playDelStarAni : function () {\n        if(this.isAniPlay || this.curNodeArray.length==0)\n            return;\n\n        if(this.getnum>=this.curNodeArray.length)\n            return;\n        this.isAniPlay = true;\n        var node = this.curNodeArray[this.getnum];\n        if(node) {\n            console.log(\"fengbing\", \" -*-*-*- play del star ani *-*-*-*-\");\n            var jsstar = node.getComponent(\"star\");\n            jsstar.playAnidel();\n        }\n    },\n\n    clearNodes : function () {\n        var self = this;\n        this.getnum = -1;\n        this.isAniPlay = false;\n        while (this.curNodeArray.length>0){\n            var node = this.curNodeArray.shift();\n            node.removeFromParent();\n            self.nodepool.put(node);\n        }\n    },\n\n    // update (dt) {},\n};\n"]}