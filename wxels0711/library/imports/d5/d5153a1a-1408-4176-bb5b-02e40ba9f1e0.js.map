{"version":3,"sources":["../../../../../assets/script/ui/assets/script/ui/whisper_win_single.js"],"names":["ElsUtils","require","els","ELSEvent","cc","Class","extends","Component","properties","win_content","Node","win_content_icon","Sprite","user_win_content_icon","win_whisper_image","title","Label","onLoad","isListen","tywx","NotificationCenter","listen","ELS_EVENT_CLEARN_GIFT","clearn_gift","EventType","CMD_ELSWX","_onMsgElsWx","node","getChildByName","on","TOUCH_END","onwinShareHandler","onwinSaveHandler","dismiss_btn_click","start","game","UIManager","model","that","loader","load","err","tex","log","Texture2D","spriteFrame","SpriteFrame","getComponent","active","mconf","isWhisper","_game","getUI","ELS_GAME_LAYER","GAME_SINGLE","hideAllUI","showUI","HOMEPAGE","trigger","ELS_EVENT_CLEARN_GIFT_PROP_ANIMATION","showGif","showWithData2","win_content_data","params","result","action","UserInfo","showQuery","undefined","status","itemId","itemKindId","updateLocQuery","SECRETLANGUAGEDATA","randomKey","ELS_EVENT_SHOW_GIFT_PROP_ANIMATION","type","prop_id","ret","getLocQueryData","console","JSON","stringify","_query_key","querys","parse","loadItem","new_querys","i","length","_tq","push","saveItem","showGift","showWithData","data","_sendUser","inviteCode","_uuid","MSG","whisperPass","self","setTimeout","canelScheduleAd","AdManager","destroyBannerAd","string","_win_single","openId","openData","showQQHWin","loadRes","prefab","preFabNode","instantiate","parent","succ","Animation","play","pcs","ParticleSystem","resetSystem","eve","stopAllParticleSys","ShareInterface","shareMsg","ELS_SHRAE_TYPE","GAME_QQH_WIN","pcs2","stopSystem","save","canvas","_width","width","_height","height","_y","_h","toTempFilePath","x","y","destWidth","destHeight","success","res","saveImage2PhoneByUrl","tempFilePath","fail","wx","hideLoading","showToast","duration","icon"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAIA,WAAWC,QAAQ,qBAAR,CAAf;AACA,IAAIC,MAAMD,QAAQ,gBAAR,CAAV;AACA,IAAIE,WAAWF,QAAQ,sBAAR,CAAf;AACAG,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,qBAAaL,GAAGM,IADR;AAERC,0BAAkBP,GAAGQ,MAFb;AAGRC,+BAAuBT,GAAGQ,MAHlB;AAIRE,2BAAmBV,GAAGQ,MAJd;AAKRG,eAAOX,GAAGY;AALF,KAHP;;AAWL;;AAEAC,UAbK,oBAaI;;AAEL,YAAI,CAAC,KAAKC,QAAV,EAAoB;AAChBC,iBAAKC,kBAAL,CAAwBC,MAAxB,CAA+BlB,SAASmB,qBAAxC,EAA+D,KAAKC,WAApE,EAAiF,IAAjF;AACAJ,iBAAKC,kBAAL,CAAwBC,MAAxB,CAA+BF,KAAKK,SAAL,CAAeC,SAA9C,EAAyD,KAAKC,WAA9D,EAA2E,IAA3E;AACA,iBAAKR,QAAL,GAAgB,IAAhB;AACH;;AAGD,aAAKS,IAAL,CAAUC,cAAV,CAAyB,WAAzB,EAAsCC,EAAtC,CAAyCzB,GAAGM,IAAH,CAAQc,SAAR,CAAkBM,SAA3D,EAAsE,KAAKC,iBAA3E,EAA8F,IAA9F;AACA,aAAKJ,IAAL,CAAUC,cAAV,CAAyB,UAAzB,EAAqCC,EAArC,CAAwCzB,GAAGM,IAAH,CAAQc,SAAR,CAAkBM,SAA1D,EAAqE,KAAKE,gBAA1E,EAA4F,IAA5F;AACA,aAAKL,IAAL,CAAUC,cAAV,CAAyB,SAAzB,EAAoCC,EAApC,CAAuCzB,GAAGM,IAAH,CAAQc,SAAR,CAAkBM,SAAzD,EAAoE,KAAKG,iBAAzE,EAA4F,IAA5F;;AAEA,aAAKxB,WAAL,GAAmB,KAAKkB,IAAL,CAAUC,cAAV,CAAyB,qBAAzB,CAAnB;AACA,aAAKjB,gBAAL,GAAwB,KAAKgB,IAAL,CAAUC,cAAV,CAAyB,0BAAzB,CAAxB;AAEH,KA7BI;AA+BLM,SA/BK,mBA+BG;AACJ,aAAKC,IAAL,GAAYhB,KAAKiB,SAAL,CAAeD,IAA3B;AACA,aAAKE,KAAL,GAAa,KAAKF,IAAL,CAAUE,KAAvB;AACA,YAAIC,OAAO,IAAX;AACAlC,WAAGmC,MAAH,CAAUC,IAAV,CAAe,4BAAf,EAA6C,UAASC,GAAT,EAAcC,GAAd,EAAmB;AAC5DtC,eAAGuC,GAAH,CAAO,kCAAkCD,eAAetC,GAAGwC,SAApD,CAAP;AACA,gBAAIC,cAAc,IAAIzC,GAAG0C,WAAP,CAAmBJ,GAAnB,CAAlB;AACAJ,iBAAKxB,iBAAL,CAAuBiC,YAAvB,CAAoC,WAApC,EAAiDF,WAAjD,GAA+DA,WAA/D;AACH,SAJD;AAKH,KAxCI;AA0CLZ,qBA1CK,+BA0Ce;AAChB,aAAKN,IAAL,CAAUqB,MAAV,GAAmB,KAAnB;AACA,aAAKX,KAAL,CAAWY,KAAX,CAAiBC,SAAjB,GAA6B,KAA7B;AACA,YAAIC,QAAQhC,KAAKiB,SAAL,CAAegB,KAAf,CAAqBlD,IAAImD,cAAJ,CAAmBC,WAAxC,EAAqD3B,IAArD,CAA0DoB,YAA1D,CAAuE,gBAAvE,CAAZ;AACAI,cAAMxB,IAAN,CAAWC,cAAX,CAA0B,UAA1B,EAAsCoB,MAAtC,GAA+C,KAA/C;AACA7B,aAAKiB,SAAL,CAAemB,SAAf;AACApC,aAAKiB,SAAL,CAAeoB,MAAf,CAAsBtD,IAAImD,cAAJ,CAAmBI,QAAzC;AACAtC,aAAKC,kBAAL,CAAwBsC,OAAxB,CAAgCvD,SAASwD,oCAAzC;AACA;AACA;AACA;AACH,KArDI;;;AAuDL;AACA;AACA;AACA;;AAEApC,eA5DK,yBA4DS;AACV,aAAKqC,OAAL,GAAe,KAAf;AACA,aAAKC,aAAL,CAAmB,KAAKC,gBAAxB;AACH,KA/DI;AAiELpC,eAjEK,uBAiEOqC,MAjEP,EAiEe;;AAGhB,YAAIA,OAAOC,MAAP,CAAcC,MAAd,KAAyB,aAA7B,EAA4C;AACxC,gBAAI,CAAC9C,KAAK+C,QAAL,CAAcC,SAAnB,EAA8B;AAC1B;AACH;AACDhD,iBAAK+C,QAAL,CAAcC,SAAd,GAA0BC,SAA1B;AACA,gBAAIL,OAAOC,MAAP,CAAcK,MAAd,KAAyB,CAA7B,EAAgC;AAC5B,oBAAIC,SAASP,OAAOC,MAAP,CAAcO,UAA3B;AACA,qBAAKC,cAAL,CAAoBrD,KAAKsD,kBAAL,CAAwBC,SAA5C,EAAuDJ,MAAvD;AACAnD,qBAAKC,kBAAL,CAAwBsC,OAAxB,CAAgCvD,SAASwE,kCAAzC,EAA6E;AACzEC,0BAAM,CADmE;AAEzEC,6BAASP;AAFgE,iBAA7E;;AAKA,qBAAKV,OAAL,GAAe,IAAf;AACH,aATD,MASO;AACH,oBAAIzC,KAAKsD,kBAAL,CAAwBC,SAA5B,EAAuC;AACnC,wBAAII,MAAM,KAAKC,eAAL,CAAqB5D,KAAKsD,kBAAL,CAAwBC,SAA7C,CAAV;AACA,wBAAII,OAAOA,QAAQ,EAAnB,EAAuB;AACnB3D,6BAAKC,kBAAL,CAAwBsC,OAAxB,CAAgCvD,SAASwE,kCAAzC,EAA6E;AACzEC,kCAAM,CADmE;AAEzEC,qCAASC;AAFgE,yBAA7E;;AAKA,6BAAKlB,OAAL,GAAe,IAAf;AACH,qBAPD,MAOO;AACH,6BAAKC,aAAL,CAAmB,KAAKC,gBAAxB;AACH;AACJ,iBAZD,MAYO;AACH,yBAAKD,aAAL,CAAmB,KAAKC,gBAAxB;AACH;AACJ;AACDkB,oBAAQrC,GAAR,CAAY,2BAAZ,EAAyCsC,KAAKC,SAAL,CAAenB,MAAf,CAAzC;AACH;AACJ,KArGI;;;AAuGLS,oBAAgB,wBAASE,SAAT,EAAoBJ,MAApB,EAA4B;AACxC,YAAIa,aAAa,oBAAjB;AACA,YAAIC,SAASH,KAAKI,KAAL,CAAWrF,SAASsF,QAAT,CAAkBH,UAAlB,EAA8B,EAA9B,CAAX,CAAb;AACA,YAAII,aAAa,EAAjB,CAHwC,CAGnB;AACrB,aAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIJ,OAAOK,MAA3B,EAAmCD,GAAnC,EAAwC;AACpC,gBAAIE,MAAMN,OAAOI,CAAP,CAAV;AACA,gBAAIE,IAAI,WAAJ,MAAqBhB,SAAzB,EAAoC;AAChCgB,oBAAI,QAAJ,IAAgBpB,MAAhB;AACH;AACDiB,uBAAWI,IAAX,CAAgBD,GAAhB;AACH;AACD1F,iBAAS4F,QAAT,CAAkBT,UAAlB,EAA8BF,KAAKC,SAAL,CAAeK,UAAf,CAA9B,EAA0D,IAA1D;AACH,KAnHI;;AAqHLR,mBArHK,2BAqHWL,SArHX,EAqHsB;AACvB,YAAII,MAAM,EAAV;AACA,YAAIK,aAAa,oBAAjB;AACA,YAAIC,SAASH,KAAKI,KAAL,CAAWrF,SAASsF,QAAT,CAAkBH,UAAlB,EAA8B,EAA9B,CAAX,CAAb;AACA,aAAK,IAAIK,IAAI,CAAb,EAAgBA,IAAIJ,OAAOK,MAA3B,EAAmCD,GAAnC,EAAwC;AACpC,gBAAIE,MAAMN,OAAOI,CAAP,CAAV;AACA,gBAAIE,IAAI,WAAJ,MAAqBhB,SAAzB,EAAoC;AAChCI,sBAAMY,IAAI,QAAJ,KAAiB,EAAvB;AACA;AACH;AACJ;AACD,eAAOZ,GAAP;AACH,KAjII;AAmILe,YAnIK,oBAmIIvB,MAnIJ,EAmIY;AACbnD,aAAKC,kBAAL,CAAwBsC,OAAxB,CAAgCvD,SAASwE,kCAAzC,EAA6E;AACzEC,kBAAM,CADmE;AAEzEC,qBAASP;AAFgE,SAA7E;AAIH,KAxII;AA0ILwB,gBA1IK,wBA0IQC,IA1IR,EA0Ic;AACf,YAAI,CAAC,KAAK7E,QAAV,EAAoB;AAChBC,iBAAKC,kBAAL,CAAwBC,MAAxB,CAA+BlB,SAASmB,qBAAxC,EAA+D,KAAKC,WAApE,EAAiF,IAAjF;AACAJ,iBAAKC,kBAAL,CAAwBC,MAAxB,CAA+BF,KAAKK,SAAL,CAAeC,SAA9C,EAAyD,KAAKC,WAA9D,EAA2E,IAA3E;AACA,iBAAKR,QAAL,GAAgB,IAAhB;AACH;AACD,aAAK4C,gBAAL,GAAwBiC,IAAxB;AACA,YAAI5E,KAAKsD,kBAAT,EAA6B;AACzB,gBAAIuB,YAAY7E,KAAKsD,kBAAL,CAAwBwB,UAAxC;AACA,gBAAIC,QAAQ/E,KAAKsD,kBAAL,CAAwBC,SAApC;AACAvD,iBAAKgF,GAAL,CAASC,WAAT,CAAqBJ,SAArB,EAAgCE,KAAhC;AACH;;AAED,YAAIG,OAAO,IAAX;AACAC,mBAAW,YAAW;AAClBD,iBAAKxC,aAAL,CAAmBkC,IAAnB;AACH,SAFD,EAEG,GAFH;;AAIA;AACH,KA7JI;AA+JLlC,iBA/JK,yBA+JSkC,IA/JT,EA+Je;;AAEhB,YAAI,KAAKnC,OAAT,EAAkB;AACd;AACH;AACD,aAAKA,OAAL,GAAe,IAAf;;AAEAzC,aAAKiB,SAAL,CAAeD,IAAf,CAAoBE,KAApB,CAA0BkE,eAA1B;AACApF,aAAKqF,SAAL,CAAeC,eAAf;;AAEA;AACA,YAAI1F,QAAQ,MAAZ;AACA,aAAKA,KAAL,CAAWgC,YAAX,CAAwB,UAAxB,EAAoC2D,MAApC,GAA6C3F,KAA7C;;AAEA,aAAK+C,gBAAL,GAAwBiC,IAAxB;AACA,aAAKpE,IAAL,CAAUqB,MAAV,GAAmB,IAAnB;AACA,YAAI2D,cAAc,KAAKhF,IAAvB;AACA,aAAKlB,WAAL,CAAiBuC,MAAjB,GAA0B,IAA1B;AACA,aAAKvC,WAAL,CAAiBsC,YAAjB,CAA8B,UAA9B,EAA0C2D,MAA1C,GAAmD,KAAK5C,gBAAL,CAAsBiC,IAAzE;AACA,YAAIM,OAAO,IAAX;AACA,YAAIO,SAASb,KAAKa,MAAlB;AACA,YAAI,KAAKC,QAAT,EAAmB;AACf,iBAAKA,QAAL,CAAc9D,YAAd,CAA2B,UAA3B,EAAuC+D,UAAvC,CAAkDF,MAAlD;AACH,SAFD,MAEO;AACH,gBAAIP,QAAO,IAAX;AACAjG,eAAGmC,MAAH,CAAUwE,OAAV,CAAkB,iBAAlB,EAAqC,UAAStE,GAAT,EAAcuE,MAAd,EAAsB;AACvD,oBAAIC,aAAa7G,GAAG8G,WAAH,CAAeF,MAAf,CAAjB;AACAX,sBAAKQ,QAAL,GAAgBI,UAAhB;AACAA,2BAAWE,MAAX,GAAoBd,MAAK1E,IAAzB;AACAsF,2BAAWlE,YAAX,CAAwB,UAAxB,EAAoC+D,UAApC,CAA+CF,MAA/C;AACH,aALD;AAMH;;AAED;AACA,YAAIQ,OAAOT,YAAY/E,cAAZ,CAA2B,kBAA3B,CAAX;AACAwF,aAAKrE,YAAL,CAAkB3C,GAAGiH,SAArB,EAAgCC,IAAhC,CAAqC,kBAArC;AACA;AACA,YAAIC,MAAMH,KAAKxF,cAAL,CAAoB,kBAApB,EAAwCmB,YAAxC,CAAqD3C,GAAGoH,cAAxD,CAAV;AACAD,YAAIE,WAAJ;AAEH,KAvMI;AA0ML1F,qBA1MK,6BA0Ma2F,GA1Mb,EA0MkB;AACnB,aAAKC,kBAAL;AACA;AACAxG,aAAKyG,cAAL,CAAoBC,QAApB,CAA6B;AACzBjD,kBAAM1E,IAAI4H,cAAJ,CAAmBC;AADA,SAA7B;AAGH,KAhNI;AAkNLJ,sBAlNK,gCAkNgB;AACjB;AACA,YAAIP,OAAO,KAAKzF,IAAL,CAAUC,cAAV,CAAyB,kBAAzB,CAAX;AACAwF,aAAKrE,YAAL,CAAkB3C,GAAGiH,SAArB,EAAgCC,IAAhC,CAAqC,kBAArC;AACA;AACA,YAAIU,OAAOZ,KAAKxF,cAAL,CAAoB,kBAApB,EAAwCmB,YAAxC,CAAqD3C,GAAGoH,cAAxD,CAAX;AACAQ,aAAKC,UAAL;AACH,KAzNI;;;AA2NLC,UAAM,SAASA,IAAT,CAAcnE,MAAd,EAAsB;AACxB,YAAIoE,SAAS/H,GAAG+B,IAAH,CAAQgG,MAArB;AACA,YAAIC,SAASD,OAAOE,KAApB;AACA,YAAIC,UAAUH,OAAOI,MAArB;AACA,YAAIlC,OAAO,IAAX;AACAA,aAAKtF,KAAL,CAAWY,IAAX,CAAgBqB,MAAhB,GAAyB,KAAzB;AACA,YAAIwF,KAAKF,UAAU,IAAV,GAAiB,CAACA,UAAW,CAAC,OAAK,EAAN,IAAY,IAAZ,GAAmBA,OAA/B,IAA2C,CAA5D,GAAgE,CAACA,UAAU,IAAX,IAAmB,CAAnB,GAAuB,EAAhG;AACA,YAAIG,KAAKH,UAAU,IAAV,GAAiB,CAAC,OAAK,EAAN,IAAY,IAAZ,GAAmBA,OAApC,GAA8C,IAAvD;AACAH,eAAOO,cAAP,CAAsB;AACpBC,eAAG,KAAKP,MAAL,GAAc,GADG;AAEpBQ,eAAGJ,EAFiB;AAGpBH,mBAAO,MAAMD,MAAN,GAAe,GAHF;AAIpBG,oBAAQE,EAJY;AAKpBI,uBAAW,GALS;AAMpBC,wBAAY,IANQ;AAOpBC,qBAAS,SAASA,OAAT,CAAiBC,GAAjB,EAAsB;AAC7BhE,wBAAQrC,GAAR,CAAYqG,GAAZ;AACAhJ,yBAASiJ,oBAAT,CAA8BD,IAAIE,YAAlC,EAAgDnF,OAAOgF,OAAvD,EAAgEhF,OAAOoF,IAAvE;AACA9C,qBAAKtF,KAAL,CAAWY,IAAX,CAAgBqB,MAAhB,GAAyB,IAAzB;AACD,aAXmB;AAYpBmG,kBAAM,SAASA,IAAT,CAAcH,GAAd,EAAmB;AACvB3C,qBAAKtF,KAAL,CAAWiC,MAAX,GAAoB,IAApB;AACAe,uBAAOoF,IAAP,IAAepF,OAAOoF,IAAP,EAAf;AACD;AAfmB,SAAtB;AAiBD,KApPE;;AAsPLnH,sBAAkB,4BAAW;AACzBgD,gBAAQrC,GAAR,CAAY,kBAAZ;AACA,aAAKuF,IAAL,CAAU;AACNa,qBAAS,mBAAW;AAChBK,mBAAGC,WAAH;AACAD,mBAAGE,SAAH,CAAa;AACTvI,2BAAO,MADE;AAETwI,8BAAU,IAFD;AAGTC,0BAAM;AAHG,iBAAb;AAKH,aARK;AASNL,kBAAM,gBAAW;AACbC,mBAAGC,WAAH;AACAD,mBAAGE,SAAH,CAAa;AACTvI,2BAAO,MADE;AAETwI,8BAAU,IAFD;AAGTC,0BAAM;AAHG,iBAAb;AAKH;AAhBK,SAAV;AAkBH;;AAED;AA5QK,CAAT","file":"whisper_win_single.js","sourceRoot":"../../../../../assets/script/ui","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\nvar ElsUtils = require(\"../core/ElsUtils.js\");\nvar els = require(\"../core/els.js\");\nvar ELSEvent = require(\"../core/ElsEvents.js\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        win_content: cc.Node,\n        win_content_icon: cc.Sprite,\n        user_win_content_icon: cc.Sprite,\n        win_whisper_image: cc.Sprite,\n        title: cc.Label\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n\n        if (!this.isListen) {\n            tywx.NotificationCenter.listen(ELSEvent.ELS_EVENT_CLEARN_GIFT, this.clearn_gift, this);\n            tywx.NotificationCenter.listen(tywx.EventType.CMD_ELSWX, this._onMsgElsWx, this);\n            this.isListen = true;\n        }\n\n\n        this.node.getChildByName('sShareBtn').on(cc.Node.EventType.TOUCH_END, this.onwinShareHandler, this);\n        this.node.getChildByName('sSaveBtn').on(cc.Node.EventType.TOUCH_END, this.onwinSaveHandler, this);\n        this.node.getChildByName('backBtn').on(cc.Node.EventType.TOUCH_END, this.dismiss_btn_click, this);\n\n        this.win_content = this.node.getChildByName('whisper_win_content');\n        this.win_content_icon = this.node.getChildByName('whisper_win_content_icon');\n\n    },\n\n    start() {\n        this.game = tywx.UIManager.game;\n        this.model = this.game.model;\n        let that = this;\n        cc.loader.load('share_img/wisper_share.jpg', function(err, tex) {\n            cc.log('Result should be a texture: ' + (tex instanceof cc.Texture2D));\n            var spriteFrame = new cc.SpriteFrame(tex);\n            that.win_whisper_image.getComponent('cc.Sprite').spriteFrame = spriteFrame;\n        });\n    },\n\n    dismiss_btn_click() {\n        this.node.active = false;\n        this.model.mconf.isWhisper = false;\n        var _game = tywx.UIManager.getUI(els.ELS_GAME_LAYER.GAME_SINGLE).node.getComponent(\"gameSinglemode\");\n        _game.node.getChildByName(\"win_tips\").active = false;\n        tywx.UIManager.hideAllUI();\n        tywx.UIManager.showUI(els.ELS_GAME_LAYER.HOMEPAGE);\n        tywx.NotificationCenter.trigger(ELSEvent.ELS_EVENT_CLEARN_GIFT_PROP_ANIMATION);\n        // this.node.destroyAllChildren();\n        // this.node.removeAllChildren();\n        // this.node.destroy();\n    },\n\n    // onDestroy() {\n    //     tywx.NotificationCenter.trigger(ELSEvent.ELS_EVENT_CLEARN_GIFT_PROP_ANIMATION);\n    //     tywx.NotificationCenter.ignoreScope(this);\n    // },\n\n    clearn_gift() {\n        this.showGif = false;\n        this.showWithData2(this.win_content_data);\n    },\n\n    _onMsgElsWx(params) {\n\n\n        if (params.result.action === \"whisperPass\") {\n            if (!tywx.UserInfo.showQuery) {\n                return;\n            }\n            tywx.UserInfo.showQuery = undefined;\n            if (params.result.status === 1) {\n                let itemId = params.result.itemKindId;\n                this.updateLocQuery(tywx.SECRETLANGUAGEDATA.randomKey, itemId);\n                tywx.NotificationCenter.trigger(ELSEvent.ELS_EVENT_SHOW_GIFT_PROP_ANIMATION, {\n                    type: 2,\n                    prop_id: itemId\n                });\n\n                this.showGif = true;\n            } else {\n                if (tywx.SECRETLANGUAGEDATA.randomKey) {\n                    let ret = this.getLocQueryData(tywx.SECRETLANGUAGEDATA.randomKey);\n                    if (ret && ret !== \"\") {\n                        tywx.NotificationCenter.trigger(ELSEvent.ELS_EVENT_SHOW_GIFT_PROP_ANIMATION, {\n                            type: 2,\n                            prop_id: ret\n                        });\n\n                        this.showGif = true;\n                    } else {\n                        this.showWithData2(this.win_content_data);\n                    }\n                } else {\n                    this.showWithData2(this.win_content_data);\n                }\n            }\n            console.log(\"_onMsgElsWx::whisper_pass\", JSON.stringify(params));\n        }\n    },\n\n    updateLocQuery: function(randomKey, itemId) {\n        var _query_key = \"SECRETLANGUAGEDATA\";\n        var querys = JSON.parse(ElsUtils.loadItem(_query_key, ''));\n        var new_querys = []; //new Array();\n        for (var i = 0; i < querys.length; i++) {\n            var _tq = querys[i];\n            if (_tq[\"randomKey\"] === randomKey) {\n                _tq[\"itemId\"] = itemId;\n            }\n            new_querys.push(_tq);\n        }\n        ElsUtils.saveItem(_query_key, JSON.stringify(new_querys), true);\n    },\n\n    getLocQueryData(randomKey) {\n        let ret = \"\";\n        var _query_key = \"SECRETLANGUAGEDATA\";\n        var querys = JSON.parse(ElsUtils.loadItem(_query_key, ''));\n        for (var i = 0; i < querys.length; i++) {\n            var _tq = querys[i];\n            if (_tq[\"randomKey\"] === randomKey) {\n                ret = _tq[\"itemId\"] || \"\";\n                break;\n            }\n        }\n        return ret;\n    },\n\n    showGift(itemId) {\n        tywx.NotificationCenter.trigger(ELSEvent.ELS_EVENT_SHOW_GIFT_PROP_ANIMATION, {\n            type: 0,\n            prop_id: itemId\n        });\n    },\n\n    showWithData(data) {\n        if (!this.isListen) {\n            tywx.NotificationCenter.listen(ELSEvent.ELS_EVENT_CLEARN_GIFT, this.clearn_gift, this);\n            tywx.NotificationCenter.listen(tywx.EventType.CMD_ELSWX, this._onMsgElsWx, this);\n            this.isListen = true;\n        }\n        this.win_content_data = data;\n        if (tywx.SECRETLANGUAGEDATA) {\n            let _sendUser = tywx.SECRETLANGUAGEDATA.inviteCode;\n            let _uuid = tywx.SECRETLANGUAGEDATA.randomKey;\n            tywx.MSG.whisperPass(_sendUser, _uuid);\n        }\n\n        let self = this;\n        setTimeout(function() {\n            self.showWithData2(data);\n        }, 300);\n\n        return;\n    },\n\n    showWithData2(data) {\n\n        if (this.showGif) {\n            return;\n        }\n        this.showGif = true;\n\n        tywx.UIManager.game.model.canelScheduleAd();\n        tywx.AdManager.destroyBannerAd();\n\n        // let title = this.win_content_data.title ? this.win_content_data.title: \"恭喜通关\";\n        let title = \"恭喜通关\";\n        this.title.getComponent(\"cc.Label\").string = title;\n\n        this.win_content_data = data;\n        this.node.active = true;\n        let _win_single = this.node;\n        this.win_content.active = true;\n        this.win_content.getComponent(\"cc.Label\").string = this.win_content_data.data;\n        var self = this;\n        let openId = data.openId;\n        if (this.openData) {\n            this.openData.getComponent(\"OpenData\").showQQHWin(openId);\n        } else {\n            let self = this;\n            cc.loader.loadRes('prefab/OpenData', function(err, prefab) {\n                var preFabNode = cc.instantiate(prefab);\n                self.openData = preFabNode;\n                preFabNode.parent = self.node;\n                preFabNode.getComponent(\"OpenData\").showQQHWin(openId);\n            });\n        }\n\n        //新的成功动画  个人\n        var succ = _win_single.getChildByName(\"FangKuai_shengli\");\n        succ.getComponent(cc.Animation).play(\"FangKuai_shengli\");\n        //播放粒子\n        let pcs = succ.getChildByName(\"particlesystem01\").getComponent(cc.ParticleSystem);\n        pcs.resetSystem();\n\n    },\n\n\n    onwinShareHandler(eve) {\n        this.stopAllParticleSys();\n        // 悄悄话通关 分享\n        tywx.ShareInterface.shareMsg({\n            type: els.ELS_SHRAE_TYPE.GAME_QQH_WIN\n        });\n    },\n\n    stopAllParticleSys() {\n        //新的成功动画\n        var succ = this.node.getChildByName(\"FangKuai_shengli\");\n        succ.getComponent(cc.Animation).play(\"FangKuai_shengli\");\n        //播放粒子\n        let pcs2 = succ.getChildByName(\"particlesystem01\").getComponent(cc.ParticleSystem);\n        pcs2.stopSystem();\n    },\n\n    save: function save(params) {\n        var canvas = cc.game.canvas;\n        var _width = canvas.width;\n        var _height = canvas.height;\n        var self = this;\n        self.title.node.active = false;\n        var _y = _height < 1280 ? (_height - ((1024+30) / 1280 * _height)) / 2 : (_height - 1024) / 2 - 30;\n        var _h = _height < 1280 ? (1024-30) / 1280 * _height : 1024;\n        canvas.toTempFilePath({\n          x: 72 * _width / 720,\n          y: _y,\n          width: 576 * _width / 720, \n          height: _h,\n          destWidth: 720,\n          destHeight: 1280,\n          success: function success(res) {\n            console.log(res);\n            ElsUtils.saveImage2PhoneByUrl(res.tempFilePath, params.success, params.fail);\n            self.title.node.active = true;\n          },\n          fail: function fail(res) {\n            self.title.active = true;\n            params.fail && params.fail();\n          }\n        });\n      },\n\n    onwinSaveHandler: function() {\n        console.log(\"onwinSaveHandler\");\n        this.save({\n            success: function() {\n                wx.hideLoading();\n                wx.showToast({\n                    title: '保存成功',\n                    duration: 2000,\n                    icon: null\n                });\n            },\n            fail: function() {\n                wx.hideLoading();\n                wx.showToast({\n                    title: '保存失败',\n                    duration: 2000,\n                    icon: null\n                });\n            }\n        });\n    },\n\n    // update (dt) {},\n});"]}