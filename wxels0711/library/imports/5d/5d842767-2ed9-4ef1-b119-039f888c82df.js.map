{"version":3,"sources":["../../../../../assets/script/core/assets/script/core/render.js"],"names":["nge","require","els","ELSEvent","ElsUtils","ElsRender","Render","extend","ctor","idx","grid","gnode","index","fullrow","clear_vr","addMagic","drawGrid","mt","mtimer","am","CONFIG","add_magic","clear","getFirstRenderFlag","fr","getexdata","i","length","g","getComponent","showAddMagicEffect","zhubao_map","zhubaoAnimationMap","forEach","v","k","t_r","ZONG","parseInt","split","active","resetFirstRenderFlag","HENG","push","Math","random","crs","getstat","needdraw","dat","mcore","blk","blocks","j","gv","GRIDW","c","opt","ro","r","sc","x","y","t","cos","sin","setBlkColor","rawscale","scale","position","cc","v2","cb","cur_block","cx","tdx","cy","tdy","cz","cur_z","bs","shadow","opacity","setRotation","ax","BLK_C_OFFSET","ay","spriteFrame","blockimgs","drawHoldNext","gr","holdnext","h","save_block","n1","mQueue","block_index","MAXBLKQUEUE","n2","hnv","n","BLKDAT_C","drawAttackLine","group","ptfrom","ptto","delay","dis","abs","pDistance","speed","attAni","attani","stopAllActions","setPosition","runAction","sequence","delayTime","show","spawn","rotateBy","moveTo","callFunc","hide","Sprite","setVisible","dd","drawAttack","attack_count","game","model","playMusic","ELS_VOICE","ATTACK_MUSIC","linecnt","pt1","pt2","showClearAnimation","drawCombo","ca","combo","mi","COMBO_MUSIC","console","log","showCombo","draw","tywx","TCPClient","connectStatus","CONNECT_STATUS_OK","UserInfo","userId","NotificationCenter","trigger","ELS_EVENT_ADD_MAGIC","maintips","string","getMainTips","window","factory","exports","module","define","amd"],"mappings":"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","file":"render.js","sourceRoot":"../../../../../assets/script/core","sourcesContent":["var nge = require(\"./engine.js\");\nvar els = require(\"./els.js\");\nvar ELSEvent = require(\"./ElsEvents.js\");\nvar ElsUtils = require('./ElsUtils.js');\nvar ElsRender = nge.Render.extend({\n    ctor: function(idx, grid, gnode) {\n        this.index = idx;\n        this.grid = grid;\n        this.gnode = gnode;\n        this.fullrow = {};\n        this.clear_vr = [];\n        this.addMagic = 0;\n    },\n\n    drawGrid: function() {\n        var mt = this.grid.mtimer;\n        let am = els.CONFIG.add_magic.clear;\n        if(mt.getFirstRenderFlag(\"clear-row\")) {\n            this.fullrow = {};\n            var fr = this.grid.mtimer.getexdata(\"clear-row\");\n            let add_magic = 0; // 消除整行添加的magic值\n            for(var i=0; i<fr.length; i++) {\n                this.fullrow[fr[i]] = 1;\n            }\n            var g = this.gnode.getComponent('main');\n            g.showAddMagicEffect();\n            add_magic = am[fr.length >= 4 ? 4 : fr.length];\n            this.addMagic += add_magic;\n            let zhubao_map = g.zhubaoAnimationMap;\n            if(zhubao_map){\n                zhubao_map.forEach((v,k) => {\n                    let t_r = els.ZONG - 1 - parseInt(k.split('_')[0]);\n                    if(this.fullrow[t_r]){\n                        v.active = false;\n                    }\n                });\n            }\n            //tywx.NotificationCenter.trigger(ELSEvent.ELS_EVENT_ADD_MAGIC,add_magic);\n            mt.resetFirstRenderFlag(\"clear-row\");\n            for(var i=0; i<els.HENG; i++) {\n                this.clear_vr.push(\n                    [\n                        (15+Math.random()*15) * -3.0,\n                        (80+Math.random()*20) / 180.0 * 3.1415926\n                    ]\n                )\n            }\n        }\n        var crs = this.grid.mtimer.getstat(\"clear-row\");\n        if(crs==0) {\n            if(this.grid.needdraw) \n                this.grid.needdraw = false;\n            else {\n                //console.log('skip draw grid.....');\n                return;\n            }\n        }\n        //Render grid...\n        var g = this.gnode.getComponent('main');\n        var dat = this.grid.mcore.grid;\n        var blk = g.blocks[this.index];\n        for (var i = 0; i < els.ZONG; i++) {\n            for (var j = 0; j < els.HENG; j++) {\n                var gv = dat[i * els.GRIDW + j+2];\n                var c = blk[els.ZONG - i - 1][j];\n                var opt = 0, ro=0, r, v, sc = 0, x=0, y=0;\n                \n                if(crs!=0 && this.fullrow[i]) {\n                    r = this.clear_vr[j][1];\n                    v = this.clear_vr[j][0];\n                    //满行消除前闪烁\n                    var t = 10-crs;\n                    opt = gv==0?0:(crs/2%2==0?0:250);\n                    sc = -0.01;\n                    x = t*v*Math.cos(r)/8.0;\n                    y = (t*v*Math.sin(r) - 0.5*9.8*t*t)/5.0;\n                    ro = t*36;\n                    //if(j==0) console.log(\"PPPP.....\"+t+'-'+x+'-'+y);\n                    // if(ElsUtils.isZhubao(gv)) {\n                    //     g.setBlkColor(c, 0, gv%100, 1, 0);\n                    //     continue; \n                    // }\n                } else {\n                    opt = gv==0?0:180;\n                }\n                g.setBlkColor(c, opt, gv%100, 1, ro);\n                if(c.rawscale) c.scale = c.rawscale*(1-(10-crs)*sc)*10/els.HENG;\n                c.position = cc.v2(c.position.x+x, c.position.y+y);\n            }\n        }\n        //Render shadow...\n        if(this.index==0) {\n            var cb = this.grid.mcore.cur_block;\n            var cx = this.grid.mcore.tdx;\n            var cy = this.grid.mcore.tdy;\n            var cz = this.grid.mcore.cur_z;\n            var bs = 72*6.6/els.HENG+2;\n            g.shadow.opacity = 60;\n            g.shadow.scale = 9.6/els.HENG;\n            g.shadow.setRotation(90*cz);\n            var ax = bs*els.BLK_C_OFFSET[cb][cz][0];\n            var ay = bs*els.BLK_C_OFFSET[cb][cz][1];\n            g.shadow.position = cc.v2(216+bs*cx+ax, 213+bs*(els.ZONG-cy)+ay-980/els.HENG); //修改shadow坐标zfw\n            g.shadow.getComponent('cc.Sprite').spriteFrame = g.blockimgs[cb+11];\n        }\n\n    },\n    drawHoldNext: function() {\n        //Render hold next...\n        if(this.index!=0) return;\n        var g = this.gnode.getComponent('main');\n        var gr = this.grid;\n        var blk = g.holdnext;\n        var h = gr.mcore.save_block;\n        var n1 = gr.mQueue[(gr.mcore.block_index+1)%els.MAXBLKQUEUE];\n        var n2 = gr.mQueue[(gr.mcore.block_index+2)%els.MAXBLKQUEUE];\n        var hnv = [ h, n1, n2];\n        for(var n=0;n<3;n++) {\n            if(hnv[n]>=0) {\n                for(var i=0; i<4; i++) {\n                    for(var j=0; j<4; j++) {\n                        var gv = els.BLKDAT_C[hnv[n]][0][i*4+j];\n                        g.setBlkColor(blk[n][i][j], gv==0?50:200, gv%100);\n                    }\n                }\n            } else {\n                for(var i=0; i<4; i++) {\n                    for(var j=0; j<4; j++) {\n                        g.setBlkColor(blk[n][i][j], 50, 0);\n                    }\n                }\n            }\n        }\n    },\n    drawAttackLine: function(group, ptfrom, ptto, delay, t) {\n        var dis = Math.abs(cc.pDistance(ptfrom, ptto));\n        var speed = dis / t;\n        var g = this.gnode.getComponent('main');\n        var attAni = g.attani[this.index];\n\n        for (var j = 0; j < 6; j++) {\n            attAni[group][j].stopAllActions();\n            attAni[group][j].setPosition(ptfrom);\n\n            if (j == 0) {\n                attAni[group][j].runAction(cc.sequence(\n                    cc.delayTime(delay),\n                    cc.show(),\n                    cc.spawn(cc.rotateBy(t, 1800), cc.moveTo(t, ptto)),\n                    cc.callFunc(function hide(){\n                        this.getComponent(cc.Sprite).setVisible(false);\n                    }, attAni[group][j])\n                ));\n            }\n            else {\n                var dd = 20.0 / speed;\n                attAni[group][j].runAction(cc.sequence(\n                    cc.delayTime(delay + dd * j), cc.show(), cc.moveTo(t, ptto),\n                    cc.callFunc(function hide(){\n                        this.getComponent(cc.Sprite).setVisible(false);\n                    }, attAni[group][j])\n                ));\n            }\n        }\n    },\n    drawAttack: function() {\n        if( this.grid.mtimer.getFirstRenderFlag(\"attack\") ) {\n            var g = this.gnode.getComponent('main');\n            var attack_count = this.grid.mtimer.getexdata(\"attack\");\n\n            g.game.model.playMusic(els.ELS_VOICE.ATTACK_MUSIC, false);\n\n            var linecnt = [2, 3, 5];\n            var pt1 = this.index==0 ? cc.v2(470,630) : cc.v2(100, 880);\n            // 播放攻击动画\n            for (var i = 0; i < linecnt[attack_count - 1]; i++) {\n                var pt2 = this.index==0 ? \n                            cc.v2(100+i*20, 900+i*30) : \n                            cc.v2(470+i*20, 700+i*60);\n                var delay = Math.random() * 0.1;\n                this.drawAttackLine(i, pt1, pt2, delay, 0.3);\n            }\n\n            //TODO: 这里直接将第二个grid判断为AI,以后可能需要修改，虽然在game中AI也是这样判断的\n            //! 攻击两个意味着消除了3行\n            if(this.grid.index !== 1 && attack_count >= 2){\n                g.showClearAnimation(attack_count + 1);\n            }\n\n            this.grid.mtimer.resetFirstRenderFlag(\"attack\");\n        }\n    },\n    drawCombo: function() {\n        if( this.grid.mtimer.getFirstRenderFlag(\"combo\")) {\n            var g = this.gnode.getComponent('main');\n            var c = this.grid.mtimer.getexdata(\"combo\");\n            var pt1 = this.index === 0 ? cc.v2(450, 830) : cc.v2(80, 980);\n            var ca = els.CONFIG.add_magic.combo;\n            let add_magic = c >= 3 ? c * ca : 0; // 连击添加的magic值\n            if (c >= 3){\n                var mi = c;\n                if(c>14) mi = 14;\n                g.game.model.playMusic(els.ELS_VOICE.COMBO_MUSIC[mi-3], false);\n            }\n            if(this.grid.index !== 1){\n                console.log('show combo');\n                g.showCombo(c);\n            }\n            this.addMagic += add_magic;\n            //tywx.NotificationCenter.trigger(ELSEvent.ELS_EVENT_ADD_MAGIC,add_magic);\n\n            this.grid.mtimer.resetFirstRenderFlag(\"combo\");\n        }\n    },\n    draw: function () {\n        this.drawGrid();\n        this.drawHoldNext();\n        this.drawAttack();\n        this.drawCombo();\n        if(this.addMagic > 0){\n            //! 断网或者SDK登陆失败，不添加能量\n            if(tywx.TCPClient.connectStatus === tywx.TCPClient.CONNECT_STATUS_OK && tywx.UserInfo.userId !== 0){\n                tywx.NotificationCenter.trigger(ELSEvent.ELS_EVENT_ADD_MAGIC,this.addMagic);\n                //tywx.NotificationCenter.trigger(ELSEvent.ELS_EVENT_ADD_MAGIC,40);\n            }\n            this.addMagic = 0;\n        }\n        var g = this.gnode.getComponent('main');\n        g.maintips.getComponent('cc.Label').string = g.game.model.getMainTips();\n    }\n});\n\n(function (window, factory) {\n  if (typeof exports === 'object') {\n    module.exports = factory();\n  } else if (typeof define === 'function' && define.amd) {\n    define(factory);\n  } else {\n    window.ElsRender = factory();\n  }\n})(this, function () {\n    return ElsRender\n})\n"]}