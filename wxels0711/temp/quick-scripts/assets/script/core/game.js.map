{"version":3,"sources":["game.js"],"names":["nge","require","els","model","ElsGrid","ElsModel","ElsRender","ElsTouch","ELSEvent","ElsGame","Game","extend","ctor","render","_super","shareInfo","tywx","NotificationCenter","listen","EventType","GET_SHARE_CONFIG_SUCCESS","onGetShareMsg","ELS_EVENT_SET_MAGIC_BUSY","onMagicBusy","PropagateInterface","getShareConfigInfo","config","requestTimes","requestConfigInfo","playMusic","ELS_VOICE","BG_MUSIC","magicBusy","isWaitingRevive","isShowingEndlessLevelEnd","currentReviveTimes","msg","retmsg","_deliveryList","delivery","_randomIndex","Math","floor","random","length","_deliveryInfo","shareContent","sharePicUrl","sharePointId","shareSchemeId","ShareInterface","setOnShareAppMessageInfo","is_busy","initGame","gameNode","bmp","seed","stage","init","mconf","isEndless","endless_level","e","console","log","mrender","i","mgrid","useract","mode","ELS_MODE_AI","startTimerCountdown","ELS_TIMER_COUNT","ELS_MODE_SINGLE","gameCtrl","getComponent","magicBottle","playActionBase","mcore","save_lock","updateColHoleTop","_configUrl","SystemInfo","cdnPath","that","successcb","ret","v","version","uid","parseInt","UserInfo","userId","c","cb","d","CONFIG_LOCAL","CONFIG","k","undefined","JSON","stringify","failcb","HttpUtil","httpGet","scheduleUpdate_Manual","dt","self","_gameCtrl","_ui_list","menu","share5line","lose","win","pause","searchai","help","rank","share5step","keepstar","keepstarOK","lose_single","win_single","backmask","helpbg","active","opacity","_status","getGameStatus","ELS_GAME_STATE","RESULT_WIN","yanhua","SHOW_MASK","logo","lbl_next","lbl_hold","scheduleUpdate","PLAYING","updatePlayingView","needhelp1st","mask","maskidx","emergency","eb","t","ebdir","animShare5Line","show","animShare5Step","hide","updateScoreTitle","canRun","show_mask","draw","isreplay","whisper_win","isWhisper","mstat","clear_lines","particleSystem","getChildByName","cc","ParticleSystem","begin_win_partical","resetSystem","setTimeout","updateLocQuery","cipherIndex","cipherData","setGameStatus","BiLog","clickStat","clickStatEventType","clickStatEventTypePassAllQQHStage","currentStage","nextStage","clickStatEventTypePassQQHStage","isEndlessLevelEnd","updateEndlessScore","score","saveItem","showNextStageWhenEndless","clearnAllRows","trigger","ELS_EVENT_ON_SHOW_ENDLESS_LEVEL_UP","ltl","getWinLine","top_line","WIN_MUSIC","updateStage","clickStatEventTypeEndSingleWin","mstep","getWinStep","block_index","add_step","fullrows","LOSE_MUSIC","SHOW_REVIVE","clickStatEventTypeEndSingleLose","game_over","playAutoDownAction","playUserAction","openEmergency","KEEPSTAR","updatePKStar","RESULT_LOSE","clickStatEventTypeEndVSLoseNE","pkstar","pklevel","ailevel","ostar","opkl","updatePKLevel","clickStatEventTypeEndVSWin","playAIAction","updateELS","checkEmergency","tdtime","tlevel","level","DOWN_TIME","timeoauto","mtimer","getstat","mai","work2idx","getAIAct","ais","AI_SPEED","timeoai","aiact","id","pcore","attack","m","testDDown","update","gtop","lbl_antiscore","lbl_progress","lbl_title","lbl_myscore","lbl_endless_score","HOMEPAGE","HELP","RANK","_stage","_aiti_score","_my_score","Label","string","ELS_PLAYER_TITLE2","pkstar_level","stopTimerCountdown","timestep","lbl_time","_time","stepstr","_freshCountDown","obj","runAction","blink","stopAllActions","countTimerObj","clearInterval","setInterval","delItem","key","sys","localStorage","removeItem","isInWXChat","wx","removeUserCloudStorage","keyList","success","fail","value","only_local","setItem","setUserCloudStorage","KVDataList","loadItem","default_value","getItem","ls","val","ps","max","level_state","_getPKStarLevel","pkstar_level_get","star","len","startotal","star_level","cur_star","starnum","_getPKStarLevelName","g0","g1","isUserGiveup","pkcount","performance","abs","pl","al","expect","LEVEL_K","_testTurn","pg","dir","testcmd","tcore","clone","mret","moveBlk","LEFT","RIGHT","NORMAL","recycle","index","act","cancel","TURN_MUSIC","TURN_CW","TURN_CCW","DROP_MUSIC","MOVE_MUSIC","DOWN","REACH_BOTTOM","nextBlk","saveBlk","sinkAllCol","fillRandomBlock","fill_num","randomFillGrid","fillGridByIndex","grid_idx","needdraw","clearnRow","checkClearnRow","usePopMagicWand","clearnTopGirdByCount","setFreezeStep","updateBlock","_main","n","il","ZONG","j","jl","HENG","blocks","scale","bsize","setBlkColor","position","v2","rawpos","_backToHomePage","_game","UIManager","getUI","ELS_GAME_LAYER","GAME_SINGLE","node","hideAllUI","showUI","hidenBeyondNode","matchAiLevel","isNaN","rd","toFixed","fightAI_fun","clickStatEventTypeStartVSHome","allowDoPopAction","READYGO_MUSIC","playRandomBgMusic","SEARCH_AI","StarControl","clearNodes","showBeyondNode","btn_secret_language","curIndex","randomKey","setBmp","masks","showWisperStart","gleNode","setEndless","endless_line","tmp","split","endless_score_save","endless_clear","startClassicGame","startEndlessGame","loseBackToHome","reStartGame","clickStatEventTypeStartVSRestart","_query_key","querys","parse","inLoc","new_querys","_tq","push","_type","clickStatEventTypeStartVSNext","ELSBMP","main","shadow","num","tmp_grid_idx","GRIDW","blk_idx","grid","offset_y","sequence","moveBy","p","callFunc","easing","easeIn","ELS_EVENT_ENDLESS_SHOW_LEVEL_END","game_mask","hiden_mask","continueGame","pauseGame","PAUSE","backToHomePage","cancelKeepStar","begin_cd","clickStatEventTypeEndVSLoseNoKeep","keepStarShare","_successCall","clickStatEventTypeEndVSLoseKeep","_failCall","shareMsg","type","ELS_SHRAE_TYPE","GAME_KEEP_STAR","successCallback","failCallback","emergencyShare","_share_type","GAME_SHARE_DEL5","GAME_SHARE_ADD5","clearThreeBottomLines","a5","add5step","window","factory","exports","module","define","amd"],"mappings":"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","file":"game.js","sourceRoot":"../../../../../assets/script/core","sourcesContent":["//从game.js分离\nvar nge = require(\"./engine.js\");\nvar els = require(\"./els.js\");\nvar model = require(\"./model.js\");\nvar ElsGrid = require(\"./grid.js\");\nvar ElsModel = model.ElsModel;\nvar ElsRender = require(\"./render.js\");\nvar ElsTouch = require(\"./touch.js\");\nvar ELSEvent = require(\"./ElsEvents.js\");\nvar ElsGame = nge.Game.extend({\n\n    ctor: function (model, render) {\n        this._super(model, render);\n        this.shareInfo = {};\n        tywx.NotificationCenter.listen(tywx.EventType.GET_SHARE_CONFIG_SUCCESS, this.onGetShareMsg, this);\n        tywx.NotificationCenter.listen(ELSEvent.ELS_EVENT_SET_MAGIC_BUSY, this.onMagicBusy, this);\n        tywx.PropagateInterface.getShareConfigInfo();//! 获取所有分享点信息\n        this.config = null;\n        this.requestTimes = 3;      //! 请求次数上线\n        this.requestConfigInfo();   //! 请求配置信息\n        this.model.playMusic(els.ELS_VOICE.BG_MUSIC, true, 0.4);\n        this.magicBusy = false;\n        this.isWaitingRevive = false; //* 是否在等待复活\n        this.isShowingEndlessLevelEnd = false;\n        this.currentReviveTimes = 0; //* 当前复活次数\n    },\n\n    onGetShareMsg: function (msg) {\n\n        if (!msg || !msg.retmsg) return;\n\n        var _deliveryList = msg.retmsg.delivery;\n        var _randomIndex = (Math.floor(Math.random() * 10000)) % _deliveryList.length;\n        var _deliveryInfo = _deliveryList[_randomIndex];\n\n        if (!_deliveryInfo\n            || !_deliveryInfo.shareContent\n            || !_deliveryInfo.sharePicUrl\n            || !_deliveryInfo.sharePointId\n            || !_deliveryInfo.shareSchemeId) {\n            return;\n        }\n\n        tywx.ShareInterface.setOnShareAppMessageInfo(_deliveryInfo.shareContent,\n            _deliveryInfo.sharePicUrl,\n            _deliveryInfo.sharePointId,\n            _deliveryInfo.shareSchemeId);\n    },\n    onMagicBusy: function(is_busy){\n        this.magicBusy = is_busy;\n    },\n\n    initGame: function (gameNode, bmp, seed) {\n        this.model.stage = 0;\n        this.gameNode = gameNode;\n        try {\n            this.model.init(bmp, seed);\n             //! 无尽模式限制复活次数\n        \tif(this.model.mconf.isEndless && this.model.endless_level === 0){\n                this.currentReviveTimes = 0;\n            }\n        } catch (e) {\n            console.log(e);\n        }\n\n        this.mrender = [];\n        for (var i = 0; i < 2; i++) {\n            this.mrender[i] = new ElsRender(i, this.model.mgrid[i], this.gameNode);\n        }\n\n        this.useract = [];\n        if (this.model.mconf.mode == els.ELS_MODE_AI) {\n            this.startTimerCountdown(els.ELS_TIMER_COUNT);\n        } else if(this.model.mconf.mode == els.ELS_MODE_SINGLE){\n            let gameCtrl = this.gameNode.getComponent('main');\n            if(gameCtrl.magicBottle){\n                //gameCtrl.magicBottle.reset();\n            }\n        }\n        this.playActionBase(0, 'S');\n        this.model.mgrid[0].mcore.save_lock = false;\n        this.playActionBase(0, 'D');\n        this.model.mgrid[0].updateColHoleTop(2,11);\n        this.isWaitingRevive = false;\n\n        //重置关卡用于测试\n        //this.delItem('ELS_HELP1ST');\n        //this.delItem('ELS_PKCOUNT');\n        //this.delItem('ELS_PKLOG');\n        //this.delItem('ELS_PKLEVEL');\n        //this.delItem('ELS_PKSTAR');\n        //this.delItem('ELS_CURRENT_STAGE2');\n        //this.saveItem('ELS_PKCOUNT', 0);\n        //this.saveItem('ELS_PKLOG', '[]');\n        //this.saveItem('ELS_PKLEVEL', 1);\n        //this.saveItem('ELS_CURRENT_STAGE2', 174);\n        //this.saveItem('ELS_PKSTAR', 20);\n\n    },\n\n    /**\n     * 请求获取配置信息\n     */\n    requestConfigInfo: function () {\n\n        this.requestTimes--;\n        var _configUrl = tywx.SystemInfo.cdnPath + 'config/tetris.json';\n        var that = this;\n\n        var successcb = function (ret) {\n            that.requestTimes = 3;\n            var v = tywx.SystemInfo.version;\n            var uid = parseInt(tywx.UserInfo.userId);\n            var c, cb, d;\n            c = ret[''+v];\n            cb = ret[''+v+'_ABTEST'];\n            d = ret['default'];\n            if(!d) {\n                //没找到缺省服务器配置...\n                console.log('No default server config, use local config...');\n                d = els.CONFIG_LOCAL;\n            }\n            if(!c) {\n                //没找到版本对应配置，使用缺省配置...\n                els.CONFIG = d;\n                console.log(_configUrl + 'use default config...');\n            } else {\n                //AB测试...\n                if(cb) {\n                    if(uid % 2 == 0) {\n                        els.CONFIG = c;\n                        console.log(_configUrl + 'use '+ v + '_A server config...');\n                    } else {\n                        els.CONFIG = cb;\n                        console.log(_configUrl + 'use '+ v + '_B server config...');\n                    }\n                } else {\n                    els.CONFIG = c;\n                    console.log(_configUrl + 'use '+ v + ' server config...');\n                }\n                //把缺省配置中的配置项复制到当前配置...\n                for(var k in d) {\n                    if(els.CONFIG[k] === undefined)\n                        els.CONFIG[k] = d[k];\n                }\n            }\n            console.log('CONFIG '+JSON.stringify(ret));\n            console.log(_configUrl + 'ret ======> ' + JSON.stringify(els.CONFIG));\n\n            //TEST openEmergency FLAG...\n            //els.CONFIG.openEmergency = false;\n        };\n\n        var failcb = function (ret) {\n            if (that.requestTimes > 0) {\n                that.requestConfigInfo();\n                console.log(_configUrl + 'retry...');\n            } else {\n                els.CONFIG = els.CONFIG_LOCAL;\n                console.log(_configUrl + ' fail! use local ======> ' + JSON.stringify(els.CONFIG));\n            }\n        };\n        tywx.HttpUtil.httpGet({ 'url': _configUrl }, successcb, failcb);\n    },\n\n    //现在自己调用 防治不停的调用\n    scheduleUpdate_Manual: function (dt) {\n\n        return;\n        this.model.stage++;\n        let self = this;\n\n        var _gameCtrl = this.gameNode.getComponent('main');\n        var _ui_list = [_gameCtrl.menu,\n        _gameCtrl.share5line,\n        _gameCtrl.lose,     //保星失败\n        _gameCtrl.win,      //AI对战成功\n        _gameCtrl.pause,\n        _gameCtrl.searchai,\n        _gameCtrl.help,\n        _gameCtrl.rank,\n        _gameCtrl.share5step,\n        _gameCtrl.keepstar,   //失败保护\n        _gameCtrl.keepstarOK, //保星成功\n        _gameCtrl.lose_single,//单机失败\n        _gameCtrl.win_single,  //单机成功\n        _gameCtrl.backmask,     //半透底板\n\n        _gameCtrl.helpbg   //帮助的背景z\n\n        ];\n        for (var i in _ui_list) {\n            if (_ui_list[i]) {\n                _ui_list[i].active = false;\n                _ui_list[i].opacity = 0;\n            }\n        }\n\n        var _status = this.model.getGameStatus();\n        if (_status != els.ELS_GAME_STATE.RESULT_WIN) {\n            _gameCtrl.yanhua.active = false;\n        }\n        switch (_status) {\n\n            case els.ELS_GAME_STATE.SHOW_MASK:\n                _ui_list[13].active = false;\n                _ui_list[4].active = false;\n                _gameCtrl.logo.opacity = 0;\n                _gameCtrl.lbl_next.opacity = 255;\n                _gameCtrl.lbl_hold.opacity = 255;\n                break;\n        }\n\n    },\n\n    //每秒FRAME_HZ(缺省60)次调用此方法 ,只更新游戏中，其他状态手动更新\n    scheduleUpdate: function (dt) {\n\n        //if(this.magicBusy) return;\n\n\n        this.model.stage++;\n        var _status = this.model.getGameStatus();\n        var _gameCtrl = this.gameNode.getComponent('main');\n\n        var _ui_list = [_gameCtrl.menu,        //0\n        _gameCtrl.share5line,              //1\n        _gameCtrl.lose,     //保星失败      //2\n        _gameCtrl.win,      //AI对战成功    //3\n        _gameCtrl.pause,                   //4\n        _gameCtrl.searchai,                //5\n        _gameCtrl.help,                    //6\n        _gameCtrl.rank,                    //7\n        _gameCtrl.share5step,              //8\n        _gameCtrl.keepstar,   //失败保护    //9\n        _gameCtrl.keepstarOK, //保星成功    //10\n        _gameCtrl.lose_single,//单机失败    //11\n        _gameCtrl.win_single,  //单机成功   //12\n        _gameCtrl.backmask,     //半透底板  //13\n        ];\n\n\n        switch (_status) {\n            case els.ELS_GAME_STATE.PLAYING:\n\n                this.updatePlayingView(dt);\n                if (this.model.needhelp1st) {\n                    //轮播help图片...\n                    _gameCtrl.mask.opacity = 200;\n                    if (this.model.stage % 150 == 0) {\n                        if (_gameCtrl.maskidx == null) {\n                            //检测值\n                            _gameCtrl.maskidx = 0;\n                        }\n                        // 去掉轮播\n                        /*\n                        _gameCtrl.maskidx = ((_gameCtrl.maskidx + 1) % 5);\n                        _gameCtrl.mask.getComponent(\"cc.Sprite\").spriteFrame = _gameCtrl.blockimgs[20 + _gameCtrl.maskidx];\n                        if (_gameCtrl.maskidx != 0)\n                            this.model.playMusic(els.ELS_VOICE.HELP_MUSIC[_gameCtrl.maskidx - 1], false);\n                        if (_gameCtrl.maskidx >= 4) {\n                            this.model.needhelp1st = false;\n                            this.saveItem('ELS_HELP1ST', 1);\n\n                            this.model.displayAd();\n                        }*/\n                    }\n                }\n\n                if (this.model.emergency) {\n                    var eb = null;\n                    if (this.model.mconf.mode === els.ELS_MODE_AI) {\n                        eb = _ui_list[1];\n                    } else {\n                        eb = _ui_list[8];\n                    }\n                    eb.active = true;\n                    //eb.opacity = 205;\n                    var t = this.model.stage % 6;\n                    if (t === 0) this.model.ebdir = this.model.ebdir * -1;\n                    //eb.rotation = 3 - this.model.ebdir * this.model.stage % 6;\n                    _gameCtrl.animShare5Line.getComponent('shareGiftAnimationView').show();\n                    _gameCtrl.animShare5Step.getComponent('shareGiftAnimationView').show();\n                }\n                else{\n                    _ui_list[1].active = false;\n                    _ui_list[8].active = false;\n                    _gameCtrl.animShare5Line.getComponent('shareGiftAnimationView').hide();\n                    _gameCtrl.animShare5Step.getComponent('shareGiftAnimationView').hide();\n                }\n\n                this.updateScoreTitle();\n\n                if (!this.model.mconf.canRun) {\n                    this.show_mask();\n                    console.log(\"show_mask\");\n                }\n                break;\n            default:\n                break;\n        }\n\n    },\n\n    updatePlayingView: function (dt) {\n        if(!this.isShowingEndlessLevelEnd) // 无尽展示下一关的时候不渲染\n            this.mrender[0].draw();\n        if (this.model.mconf.mode !== els.ELS_MODE_SINGLE)\n            this.mrender[1].draw();\n\n        //this.model.mgrid[0].mcore.game_over = true;  //每局开始就胜利\n\n        if (this.model.mconf.isreplay) {\n            if (this.model.pause) return;\n        } else {\n            switch (this.model.mconf.mode) {\n                case els.ELS_MODE_SINGLE:\n                    if (this.model.pause) return;\n                    var whisper_win = this.model.mconf.isWhisper && this.model.mgrid[0].mstat.clear_lines >= 1;\n                    if (whisper_win) {\n                        console.log(\"whisper single mode success!!!\");\n                        //粒子 烟花\n                        var _gameCtrl = this.gameNode.getComponent('main');\n                        var particleSystem = _gameCtrl.yanhua.getChildByName(\"particlesystem\").getComponent(cc.ParticleSystem);\n                        // _gameCtrl.yanhua.active = true;\n                        if (particleSystem && this.model.begin_win_partical == -1) {\n                            this.model.begin_win_partical = 0;\n                            _gameCtrl.yanhua.active = true;\n                            particleSystem.resetSystem();\n\n                            var self = this;\n                            setTimeout(function () {\n                                _gameCtrl.yanhua.active = false;\n                                self.updateLocQuery();\n                                self.model.begin_win_partical = -1;\n                                // self.model.playMusic(els.ELS_VOICE.WIN_MUSIC, false);\n                                //self.model.currentStage += 1;\n                                //self.updateStage(self.model.currentStage);\n                                if (self.cipherIndex >= self.cipherData.length) {\n                                    self.model.setGameStatus(els.ELS_GAME_STATE.RESULT_WIN);   //此局胜利\n                                    //self.scheduleUpdate_Manual();\n                                    tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypePassAllQQHStage, [self.model.currentStage]);\n                                }else {\n                                    self.nextStage();\n                                    tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypePassQQHStage, [self.model.currentStage]);\n                                }\n                            }, 1200);\n                        }\n                        return;\n                    }\n                    //TODO: 无尽模式===>小关卡结束\n                    if(!this.isShowingEndlessLevelEnd && this.model.mconf.isEndless && this.model.mgrid[0].isEndlessLevelEnd() && this.model.getGameStatus() === els.ELS_GAME_STATE.PLAYING){\n                        console.log('game/updatePlayingView','endless mode success');\n                        this.isShowingEndlessLevelEnd = true;\n                        this.updateEndlessScore(this.model.mgrid[0].mstat.score);\n                        let self = this;\n                        let cb = ()=>{\n                            console.log('endless call next stage');\n                            self.model.endless_level++;\n                            this.saveItem('ELS_CURRENT_ENDLESS_LEVEL', \n                                self.model.endless_level+'-'+self.model.mgrid[0].mstat.score);\n                            self.showNextStageWhenEndless();\n                        };\n                        this.model.mgrid[0].clearnAllRows(cb,this.mrender[0]);\n                        tywx.NotificationCenter.trigger(ELSEvent.ELS_EVENT_ON_SHOW_ENDLESS_LEVEL_UP, null);\n                    }\n\n                    var ltl = this.model.getWinLine();\n                    if (!this.model.mconf.isEndless && this.model.mgrid[0].mcore.top_line <= ltl && this.model.getGameStatus() === els.ELS_GAME_STATE.PLAYING) {\n                        console.log(\"single mode success!!!\");\n                        //粒子 烟花\n                        var _gameCtrl = this.gameNode.getComponent('main');\n                        var particleSystem = _gameCtrl.yanhua.getChildByName(\"particlesystem\").getComponent(cc.ParticleSystem);\n                        _gameCtrl.yanhua.active = true;\n                        if (particleSystem && this.model.begin_win_partical == -1) {\n                            this.model.begin_win_partical = 0;\n                            _gameCtrl.yanhua.active = true;\n                            particleSystem.resetSystem();\n\n                            var self = this;\n                            setTimeout(function () {\n                                self.model.begin_win_partical = -1;\n                                self.model.playMusic(els.ELS_VOICE.WIN_MUSIC, false);\n                                self.model.currentStage += 1;\n                                self.updateStage(self.model.currentStage);\n                                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeEndSingleWin,\n                                    [self.model.currentStage]);\n                                self.model.setGameStatus(els.ELS_GAME_STATE.RESULT_WIN);   //此局胜利\n\n                                self.scheduleUpdate_Manual();\n                            }, 1200);\n\n                        }\n                        return;\n                    }\n                    var mstep = this.model.getWinStep();\n                    if(!this.isWaitingRevive){ \n                        if (this.model.mgrid[0].mcore.block_index >= (mstep + this.model.add_step)) {\n                            if (this.model.mgrid[0].mcore.fullrows.length == 0) {\n                                this.model.playMusic(els.ELS_VOICE.LOSE_MUSIC, false);\n                                //this.model.setGameStatus(els.ELS_GAME_STATE.RESULT_LOSE);   //此局失败\n                                this.model.setGameStatus(els.ELS_GAME_STATE.SHOW_REVIVE);   //展示复活\n                                this.isWaitingRevive = true; // 设置等待复活\n                                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeEndSingleLose,\n                                    [this.model.currentStage, this.model.add_step]);\n                                this.scheduleUpdate_Manual();\n                                return;\n                            }\n                        }\n                        if (this.model.mgrid[0].mcore.game_over) {\n                            this.model.playMusic(els.ELS_VOICE.LOSE_MUSIC, false);\n                            this.model.setGameStatus(els.ELS_GAME_STATE.SHOW_REVIVE);   //展示复活\n                            this.isWaitingRevive = true; // 设置等待复活\n                            //this.model.setGameStatus(els.ELS_GAME_STATE.RESULT_LOSE);   //此局失败\n                            // this.scheduleUpdate_Manual();\n                            return;\n                        };\n                    }\n                    this.playAutoDownAction(dt);\n                    this.playUserAction(dt);\n                    break;\n\n                case els.ELS_MODE_AI:\n                    if (this.model.pause) return;\n                    if (this.model.mgrid[0].mcore.game_over) {\n                        this.model.playMusic(els.ELS_VOICE.LOSE_MUSIC, false);\n                        if (els.CONFIG.openEmergency)\n                            this.model.setGameStatus(els.ELS_GAME_STATE.KEEPSTAR);   //此局失败    \n                        else {\n                            this.updatePKStar(-1);\n                            this.model.setGameStatus(els.ELS_GAME_STATE.RESULT_LOSE);\n                            tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeEndVSLoseNE,\n                                [this.model.pkstar, this.model.pklevel, this.model.ailevel]);\n                        }\n                        //this.updatePKLevel();\n\n                        // this.scheduleUpdate_Manual();\n                        return;\n                    };\n                    if (this.model.mgrid[1].mcore.game_over) {\n                        //粒子 烟花\n                        var _gameCtrl = this.gameNode.getComponent('main');\n                        var particleSystem = _gameCtrl.yanhua.getChildByName(\"particlesystem\").getComponent(cc.ParticleSystem);\n                        _gameCtrl.yanhua.active = true;\n                        if (particleSystem && this.model.begin_win_partical == -1) {\n                            particleSystem.resetSystem();\n                            this.model.begin_win_partical = 0;\n\n                            var self = this;\n                            setTimeout(function () {\n                                self.model.begin_win_partical = -1;\n                                self.model.playMusic(els.ELS_VOICE.WIN_MUSIC, false);\n                                var ostar = self.model.pkstar;\n                                var opkl = self.model.pklevel;\n                                self.updatePKLevel();\n                                self.updatePKStar(1);\n                                self.model.setGameStatus(els.ELS_GAME_STATE.RESULT_WIN);   //此局胜利\n                                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeEndVSWin,\n                                    [ostar, opkl, self.model.pkstar, self.model.pklevel, self.model.ailevel]);\n                                self.scheduleUpdate_Manual();\n                            }, 1200);\n                        }\n                        // this.model.setGameStatus(els.ELS_GAME_STATE.RESULT_WIN);   //此局胜利\n\n                        return;\n                    };\n                    this.playAutoDownAction(dt);\n                    this.playUserAction(dt);\n                    this.playAIAction(dt);\n                    break;\n            }\n        }\n        //倒计时不累计所用的时间 \n        //if(!mstate->countDown) mTimeUsed+=dt;\n        for (var i = 0; i < 2; i++)\n            this.updateELS(i, dt);\n        this.checkEmergency();\n    },\n\n    //自然下落...\n    playAutoDownAction: function (dt) {\n        //倒计时还没有结束 \n        //if(mstate->countDown) return;\n        //自然下落...\n        var tdtime, tlevel;\n        if (this.model.mconf.mode == els.ELS_MODE_AI)\n            tlevel = 0;\n        else\n            tlevel = this.model.mgrid[0].mstat.level;\n        //tdtime = els.DOWN_TIME[tlevel] * 1000;\n        tdtime =els.DOWN_TIME[0]*1000;\n        if (this.timeoauto > tdtime) {\n            this.timeoauto = 0;\n            //如果正在直落，不进行以下处理\n            if (this.model.mgrid[0].mtimer.getstat(\"fall\")) return;\n            this.playActionBase(0, 'D');\n        } else {\n            this.timeoauto += dt;\n        }\n    },\n\n    //AI动作\n    playAIAction: function (dt) {\n        //if (mstate->countDown) return;\n        //if(this.timeoai>AI_SPEED[this.model.mgrid[1].mstat.level]) {\n\n        //把计算任务分到多帧...\n        if (this.model.mai.work2idx >= 0)\n            this.model.mai.getAIAct(this.model.mgrid[1]);\n\n        //var ais = els.AI_SPEED[this.model.currentStage] || els.AI_SPEED[els.AI_SPEED.length - 1];\n        var ais = els.AI_SPEED[this.model.ailevel];\n        //ais = 80; //test...\n        if (this.timeoai > ais) {\n            var aiact = this.model.mai.getAIAct(this.model.mgrid[1]);\n            this.playActionBase(1, aiact);\n            // if(aiact=='W')\n            //     console.log(\"play ai action.....\");\n            this.timeoai = 0;\n        } else {\n            this.timeoai += dt;\n        }\n    },\n\n    //用户键盘输入\n    playUserAction: function (dt) {\n        for (var i = 0; i < this.useract.length; i++)\n            if (!this.model.mconf.isreplay)\n                this.playActionBase(0, this.useract[i]);\n        this.useract = [];\n    },\n\n    //检测攻击\n    updateELS: function (id, dt) {\n        //if (mCountDown>0) return;\n        var pcore = this.model.mgrid[id].mcore;\n        if (pcore.game_over) return;\n        //检测执行攻击\n        if (pcore.attack[0]) {\n            for (var m = 0; m < 2; m++) {\n                if (m != id && !pcore.game_over) {\n                    console.log(\"ATTACK!!!!!!!\" + pcore.attack[0]);\n                    this.model.mgrid[id].attack(this.model.mgrid[m], pcore.attack[0], pcore.attack[1]);\n                    this.model.mgrid[m].testDDown();\n                    this.model.mgrid[id].mtimer.trigger(\"attack\", pcore.attack[0]);\n                }\n            }\n            pcore.attack[0] = 0;\n        }\n        //更新内部定时器等操作\n        this.model.mgrid[id].update(dt);\n    },\n\n    //检测是否开始紧急救助模式\n    checkEmergency: function () {\n        if (!els.CONFIG.openEmergency) return;\n        if (this.model.getGameStatus() != els.ELS_GAME_STATE.PLAYING) return;\n        if (this.model.mconf.mode == els.ELS_MODE_AI) {\n            var gtop = this.model.mgrid[0].mcore.top_line;\n            if (gtop >= 15) {\n                this.model.emergency = true;\n                return;\n            }\n        }\n        if (this.model.mconf.mode == els.ELS_MODE_SINGLE) {\n            var mstep = this.model.getWinStep();\n            if (this.model.mgrid[0].mcore.block_index >= (mstep + this.model.add_step) - 4) {\n                this.model.emergency = true;\n                return;\n            }\n        }\n        this.model.emergency = false;\n    },\n\n    updateScoreTitle: function () {\n        var _status = this.model.getGameStatus();\n        var lbl_antiscore = this.gameNode.getComponent('main').lbl_antiscore;\n        var lbl_progress = this.gameNode.getComponent('main').lbl_progress;\n        var lbl_title = this.gameNode.getComponent('main').lbl_title;\n        var lbl_myscore = this.gameNode.getComponent('main').lbl_myscore;\n        let lbl_endless_score = this.gameNode.getComponent('main').lbl_endless_score;\n\n        if (_status == els.ELS_GAME_STATE.HOMEPAGE\n            || _status == els.ELS_GAME_STATE.HELP\n            || _status == els.ELS_GAME_STATE.RANK) {\n            lbl_antiscore.active = false;\n            lbl_progress.active = false;\n            lbl_title.active = false;\n            lbl_myscore.active = false;\n        } else {\n            if (this.model.mconf.mode == els.ELS_MODE_AI) {\n                lbl_antiscore.active = true;\n                lbl_progress.active = true;\n                lbl_title.active = true;\n                lbl_myscore.active = true;\n                var _stage = this.model.ailevel + '';\n                var _aiti_score = this.model.mgrid[1].mstat.score;\n                var _my_score = this.model.mgrid[0].mstat.score;\n                lbl_antiscore.getComponent(cc.Label).string = Math.floor(_aiti_score / 10000) + '攻' + (_aiti_score % 10000) + '分';\n                lbl_title.getComponent(cc.Label).string = els.ELS_PLAYER_TITLE2[this.model.pkstar_level][1];\n                lbl_myscore.getComponent(cc.Label).string = Math.floor(_my_score / 10000) + '攻' + (_my_score % 10000) + '分';\n            } else {\n                lbl_title.active = true;\n                lbl_myscore.active = true;\n                lbl_progress.active = false;\n                lbl_antiscore.active = false;\n                if(this.model.mconf.isEndless) \n                    lbl_title.getComponent(cc.Label).string = parseInt(this.model.endless_level) + '级';\n                else\n                    lbl_title.getComponent(cc.Label).string = (parseInt(this.model.currentStage) + 1) + '关';\n                lbl_myscore.getComponent(cc.Label).string = this.model.mgrid[0].mstat.score + '分';\n\n                lbl_myscore.active = !this.model.mconf.isEndless;\n                lbl_endless_score.active = this.model.mconf.isEndless;\n                lbl_endless_score.getComponent(cc.Label).string = this.model.mgrid[0].mstat.score;\n                //console.log('game/lbl_endless_score',`score${this.model.mgrid[0].mstat.score}`);\n            }\n        }\n        if (_status != els.ELS_GAME_STATE.PLAYING) {\n            this.stopTimerCountdown();\n            this.gameNode.getComponent('main').timestep.active = false;\n            this.gameNode.getComponent('main').lbl_time.active = false;\n        } else {\n            this.gameNode.getComponent('main').timestep.active = true;\n            if (this.model.mconf.mode == els.ELS_MODE_AI) {\n                this.gameNode.getComponent('main').lbl_time.active = true;\n                this.gameNode.getComponent('main').lbl_time.getComponent(cc.Label).string = this._time;\n            }\n            if (this.model.mconf.mode == els.ELS_MODE_SINGLE) {\n                this.gameNode.getComponent('main').lbl_time.active = true;\n                var mstep = this.model.getWinStep();\n                var stepstr = '';\n                if(mstep >= 100000) stepstr = '∞';\n                else stepstr = (mstep + this.model.add_step - this.model.mgrid[0].mcore.block_index) + '';\n                this.gameNode.getComponent('main').lbl_time.getComponent(cc.Label).string = stepstr;\n            }\n        }\n    },\n\n    _freshCountDown: function (obj) {\n        var that = obj;\n        that._time--;\n        //倒计时快结束时的提醒动画\n        if (this._time == 3) {\n            that.gameNode.getComponent('main').lbl_time.runAction(cc.blink(3, 12));\n        }\n        if (that._time <= 0) {\n            that._time = 0;\n            that.stopTimerCountdown();\n            if (that.model.mconf.mode === els.ELS_MODE_AI) {\n                if (that.model.mgrid[0].mstat.score > that.model.mgrid[1].mstat.score) {\n                    that.model.mgrid[1].mcore.game_over = true;\n                } else if (that.model.mgrid[0].mstat.score < that.model.mgrid[1].mstat.score) {\n                    that.model.mgrid[0].mcore.game_over = true;\n                } else {\n                    that.model.mgrid[1].mcore.game_over = true;\n                }\n            }\n        }\n    },\n\n    stopTimerCountdown: function () {\n        this.gameNode.getComponent('main').lbl_time.stopAllActions();\n        this.countTimerObj && clearInterval(this.countTimerObj);\n        this.countTimerObj = null;\n    },\n\n    //AI 模式下开启倒计时\n    startTimerCountdown: function (_time) {\n        var that = this;\n        this._time = _time;\n        if (this.countTimerObj != null) clearInterval(this.countTimerObj);\n        this.countTimerObj = setInterval(function () { that._freshCountDown(that); }, 1000);\n    },\n\n    delItem: function (key) {\n        cc.sys.localStorage.removeItem(key);\n        if (!tywx.isInWXChat)\n            return;\n        wx.removeUserCloudStorage({\n            keyList: [key],\n            success: (msg) => { console.log('removeObjectCloud  ' + key + ' succeeds', msg); },\n            fail: (msg) => { console.log('removeObjectCloud  ' + key + ' fails', msg); },\n        });\n    },\n\n    saveItem: function (key, value, only_local) {\n        value = value + '';\n        cc.sys.localStorage.setItem(key, value);\n        if (!tywx.isInWXChat)\n            return;\n        if (!only_local) {\n            //FIXED: 做版本检测，版本低的会有黑屏\n            if(wx.setUserCloudStorage){\n                wx.setUserCloudStorage({\n                    KVDataList: [{ key: key, value: value }],\n                    success: (msg) => { console.log('saveObjectToCloud  ' + key + ' succeeds', msg); },\n                    fail: (msg) => { console.log('saveObjectToCloud  ' + key + ' fails', msg); },\n                });\n            }\n        }\n    },\n\n    loadItem: function (key, default_value) {\n        var v = cc.sys.localStorage.getItem(key);\n        // console.log(key, 'v'+v);\n        if (!v) {\n            cc.sys.localStorage.setItem(key, default_value);\n            return default_value;\n        }\n        return v;\n    },\n\n    //闯关休闲模式过关时调用...\n    updateStage: function (stage) {\n        var ls = parseInt(this.loadItem('ELS_CURRENT_STAGE2', stage));\n        if (stage > ls)\n            this.saveItem('ELS_CURRENT_STAGE2', stage);\n    },\n    updateEndlessScore: function(score){\n        var ls = parseInt(this.loadItem('ELS_CURRENT_STAGE_ENDLESS', score));\n        if (score > ls)\n            this.saveItem('ELS_CURRENT_STAGE_ENDLESS', score);\n    },\n\n    updatePKStar: function (val) {\n        var ps = this.model.pkstar;\n        ps = Math.max(0, ps + val);\n        this.saveItem('ELS_PKSTAR', ps);\n        this.model.pkstar = ps;\n        //TODO: 根据PKSTAR更新this.model.pkstar_level\n        //参考 els.ELS_PLAYER_TITLE2\n        console.log(\"fengbing\", \" -----------  update pk star ---------  \" + ps);\n        var level_state = this._getPKStarLevel(ps);\n        this.model.pkstar_level = level_state[0];\n        this.model.pkstar_level_get = level_state[1];\n\n        console.log(\"fengbing\", \" update pkstar_level:  \" + this.model.pkstar_level + \"   this.model.pkstar_level_get: \" + this.model.pkstar_level_get);\n    },\n\n    /**\n     * 通过星星获取当前ELS_PLAYER_TITLE2级别\n     * @param star\n     * @private\n     */\n    _getPKStarLevel: function (star) {\n        if (!star)\n            return [0, 0];\n        var len = els.ELS_PLAYER_TITLE2.length;\n        var startotal = 0, star_level = 0, cur_star = 0;\n        for (var i = 0; i < len; i++) {\n            var starnum = els.ELS_PLAYER_TITLE2[i][0];\n            startotal += starnum;\n            if (startotal >= star) {\n                star_level = i;\n                break;\n            }\n        }\n        cur_star = els.ELS_PLAYER_TITLE2[star_level][0] - (startotal - star);\n        return [star_level, cur_star];\n    },\n\n    /**\n     * 获取当前star_level的名称\n     * @param star\n     * @returns {*}\n     * @private\n     */\n    _getPKStarLevelName: function (star) {\n        var level = this._getPKStarLevel(star)[0];\n        return els.ELS_PLAYER_TITLE2[level][1];\n    },\n\n    //对战模式一局结束，不管胜利失败都要调用...\n    //PL = PL + k*(P - E)\n    updatePKLevel: function () {\n        var g0 = this.model.mgrid[0];\n        var g1 = this.model.mgrid[1];\n\n        if (g0.isUserGiveup()) {\n            console.log(\"GIVEUP?...\" + g0.isUserGiveup());\n            return;\n        }\n        //update pkcount...\n        var pkcount = parseInt(this.loadItem('ELS_PKCOUNT', 0)) + 1;\n        this.saveItem('ELS_PKCOUNT', pkcount);\n\n        //update pklevel\n        //performance = score diff\n        var performance = Math.abs(g0.mstat.score - g1.mstat.score) / 10000.0;\n        var pl = this.model.pklevel;\n        var al = this.model.ailevel;\n        //expect = level diff\n        var expect = pl - al;\n        var k = els.LEVEL_K[parseInt(pl)];\n        pl = pl + k * (performance - expect);\n        if (pkcount <= 5 && performance < 1.0) {\n            console.log(\"pkcount...\" + pkcount + ' pl...' + pl);\n            pl += 2;\n        }\n        if (pl < 0) pl = 0; if (pl > 18) pl = 18;\n\n        console.log(\"PK...pklevel=\" + this.model.pklevel + \" ailevel=\" + al +\n            \" performance=\" + performance + \" expect=\" + expect + \" k=\" + k + \" newpl=\" + pl);\n\n        this.model.pklevel = pl;\n        this.saveItem('ELS_PKLEVEL', this.model.pklevel);\n\n        //保存近十局的对战记录\n        //var pklog = this.loadItem('ELS_PKLOG', '[]');\n        //pklog = JSON.parse(pklog);\n        //if(pklog.length==10) pklog.shift();\n        //pklog[pklog.length] = {me:this.model.pklevel, ai:this.model.ailevel, p:performance};\n        //this.saveItem('ELS_PKLOG', JSON.stringify(pklog));\n\n    },\n\n    //旋转动作的辅助函数\n    _testTurn: function (pg, dir, testcmd) {\n        var tcore = pg.mcore.clone();\n        var mret;\n\n        for (var i = 0; i < testcmd.length; i++) {\n            if (testcmd[i] === 'L')\n                pg.moveBlk(els.LEFT, false);\n            if (testcmd[i] === 'R')\n                pg.moveBlk(els.RIGHT, false);\n        }\n        mret = pg.moveBlk(dir, false);\n        if (mret === els.NORMAL) {\n            pg.testDDown();\n            return true;\n        } else {\n            pg.mcore.recycle();\n            pg.mcore = tcore.clone();\n            tcore.recycle();\n        }\n        return false;\n    },\n\n    //执行动作码的基础方法\n    playActionBase: function (index, act) {\n        var dir;\n        var pg = this.model.mgrid[index];\n\n        if (pg.mtimer.getstat(\"fall\")) pg.mtimer.cancel(\"fall\");\n        switch (act) {\n            case 'T':\n            case 'U':\n                if (0 === index) this.model.playMusic(els.ELS_VOICE.TURN_MUSIC, false);\n                //顺时针旋转。到边时，如果旋转遇到碰撞，就尝试自动左右移动，看看能否不碰撞了\n                dir = (act === 'T') ? els.TURN_CW : els.TURN_CCW;\n                //this.mrep.recordAction(index, act);\n                if (pg.moveBlk(dir, false) === els.NORMAL) {\n                    pg.testDDown();\n                    break;\n                } else {\n                    //开始尝试左右移动再转...\n                    if (this._testTurn(pg, dir, \"L\"))\n                        break;\n                    if (this._testTurn(pg, dir, \"LL\"))\n                        break;\n                    if (this._testTurn(pg, dir, \"R\"))\n                        break;\n                    if (this._testTurn(pg, dir, \"RR\"))\n                        break;\n                }\n                break;\n            case 'W':\n                //this.mrep.recordAction(index, act);\n                if (0 === index) this.model.playMusic(els.ELS_VOICE.DROP_MUSIC, false);\n                pg.mtimer.trigger(\"fall\", 0.12);\n                break;\n            case 'D':\n                //this.mrep.recordAction(index, act);\n                if (0 === index) this.model.playMusic(els.ELS_VOICE.MOVE_MUSIC, false);\n                if (pg.moveBlk(els.DOWN, false) === els.REACH_BOTTOM)\n                    pg.nextBlk(false);\n                pg.testDDown();\n                break;\n            case 'L':\n                if (0 === index) this.model.playMusic(els.ELS_VOICE.MOVE_MUSIC, false);\n                pg.moveBlk(els.LEFT, false);\n                pg.testDDown();\n                //this.mrep.recordAction(index, act);\n                break;\n            case 'R':\n                if (0 === index) this.model.playMusic(els.ELS_VOICE.MOVE_MUSIC, false);\n                pg.moveBlk(els.RIGHT, false);\n                pg.testDDown();\n                //this.mrep.recordAction(index, act);\n                break;\n            case 'S':\n                //this.mrep.recordAction(index, act);\n                pg.saveBlk(false);\n                pg.testDDown();\n                break;\n            case 'N':\n                //this.mrep.recordAction(index, act);\n                break;\n        }\n    },\n    /**\n     * @param index 指定玩家grid,现在只对玩家有效，所以传入0就好了\n     */\n    sinkAllCol: function(index){\n        let pg = this.model.mgrid[index];\n        pg.sinkAllCol();\n    },\n    /**\n     * @param index 指定玩家到grid,现在只对玩家有效，所以传入0就好了\n     * @param fill_num 填充的数量\n     */\n    fillRandomBlock: function(index,fill_num){\n        let pg = this.model.mgrid[index];\n        return pg.randomFillGrid(fill_num);\n    },\n    fillGridByIndex: function(index, grid_idx){\n        let pg = this.model.mgrid[index];\n        pg.fillGridByIndex(grid_idx);\n        pg.needdraw = true;\n    },\n    /**\n     * \n     * @param {int} index \n     */\n    clearnRow: function(index){\n        var pg = this.model.mgrid[index];\n        pg.checkClearnRow(false);\n    },\n    /**\n     * 使用魔法棒\n     */\n    usePopMagicWand: function(index){\n        var pg = this.model.mgrid[index];\n        pg.clearnTopGirdByCount();\n    },\n\n    /**\n     * 使用冰弹 封'5'步 不涨行 可累计\n     * @param {[type]} step [description]\n     */\n    setFreezeStep: function() {\n        var pg = this.model.mgrid[0];\n        pg.setFreezeStep(5);\n    },\n\n    updateBlock:function() {\n        //生成精灵\n\n        var _main = this.gameNode.getComponent('main');\n\n        // var setBlkColor = function(c, op, idx, scale, r) {\n        //     var cmap = [0, 9, 1, 2, 3, 4, 5, 6, 7, 8, 0, 0];\n        //     c.opacity = op;\n        //     c.rotation = 0 || r;\n        //     if (scale) c.scale = c.scale * scale;\n        //     c.getComponent('cc.Sprite').spriteFrame = _main.blockimgs[cmap[idx]];\n        // };\n\n        for (var n = 0; n < 2; n++) {\n            for (var i = 0, il = els.ZONG; i < il; i++) {\n                for (var j = 0, jl = els.HENG; j < jl; j++) {\n                    var c = _main.blocks[n][i][j] ;\n                    var scale = n == 0 ? 6.6 / els.HENG : 2.4 / els.HENG;\n                    var bsize = 72 * scale + 2;\n                    c.scale = scale;\n                    _main.setBlkColor(c, 0, 8);\n                    if (n === 0) {\n                        c.position = cc.v2(216 + (j+0.5) * bsize, 215 + (i+0.5) * bsize); //重置时候的方块位置\n                        c.rawpos = c.position;\n                    }\n                    if (n === 1) {\n                        c.position = cc.v2(14 + (j+0.5) * bsize, 796 + (i+0.5) * bsize);\n                        c.rawpos = c.position;\n                    }\n                }\n            }\n        }\n\n        if (els.HENG === 10) {\n            for (let n = 0; n < 2; n++) {\n                for (let i = 0; i < els.ZONG; i ++) {\n                    let c = _main.blocks[n][i][10];\n                    _main.setBlkColor(c, 0, 0);\n                }\n            }\n        }\n    },\n\n    _backToHomePage: function () {\n        this.model.mconf.isWhisper = false;\n        this.model.mconf.isEndless = false;\n        els.HENG = 10;\n        var _game = tywx.UIManager.getUI(els.ELS_GAME_LAYER.GAME_SINGLE).node.getComponent(\"gameSinglemode\");\n        _game.node.getChildByName(\"win_tips\").active = false;\n        this.updateBlock();\n        this.model.setGameStatus(els.ELS_GAME_STATE.HOMEPAGE);\n        this.initGame(this.gameNode, 0, parseInt(Math.random() * 10000));\n        this.model.playMusic(els.ELS_VOICE.BG_MUSIC, true, 0.4);\n        tywx.UIManager.hideAllUI();\n        tywx.UIManager.showUI(els.ELS_GAME_LAYER.HOMEPAGE);\n        this.gameNode.getComponent('main').hidenBeyondNode();\n    },\n\n    matchAiLevel: function () {\n        this.model.pklevel = parseInt(this.loadItem('ELS_PKLEVEL', 0));\n        if (isNaN(this.model.pklevel)) {\n            console.log(\"PKLEVEL NaN....\");\n            this.model.pklevel = 6 + Math.random() * 6;\n            this.saveItem('ELS_PKLEVEL', this.model.pklevel);\n        }\n        var ps = this.model.pkstar;\n        var pl = this.model.pklevel;\n        var al = 0;\n        if (ps < 50) {\n            var rd = Math.random();\n            if (rd <= 0.88)\n                al = pl - 2.8 - Math.random();\n            else\n                al = pl + 0.5 + Math.random();\n        } else {\n            al = pl - Math.random() * 3 + 1.5;\n        }\n        al = parseInt(al.toFixed(0));\n        console.log(\"AL...\" + al);\n        if (al < 0) al = 0;\n        if (al > 18) al = 18;\n        this.model.ailevel = al;\n    },\n\n    //对战按钮\n    fightAI_fun: function () {\n        els.HENG = 10;\n        this.updateBlock();\n\n        this.matchAiLevel();\n        this.initGame(this.gameNode, -1, parseInt(Math.random() * 10000));\n        tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeStartVSHome,\n            [this.model.pkstar, this.model.pklevel, this.model.ailevel]);\n        this.model.mconf.mode = els.ELS_MODE_AI;\n        this.model.allowDoPopAction = true;\n        this.model.playMusic(els.ELS_VOICE.READYGO_MUSIC, false);\n        //this.model.playMusic(els.ELS_VOICE.BG_MUSIC2, true, 0.4);\n        this.model.playRandomBgMusic();\n        this.model.setGameStatus(els.ELS_GAME_STATE.SEARCH_AI);\n        tywx.StarControl.clearNodes();\n        this.gameNode.getComponent('main').showBeyondNode(\"ELS_PKSTAR\");\n    },\n\n    // 密语\n    btn_secret_language: function (cipherData, curIndex, randomKey) {\n        console.log('btn_secret_language');\n        this.cipherData = cipherData;\n        this.cipherIndex = curIndex;\n        this.randomKey = randomKey;\n        els.HENG = 11;\n        this.updateBlock();\n\n        this.model.currentStage = parseInt(this.loadItem('ELS_CURRENT_STAGE2', 0));\n        this.model.mconf.mode = els.ELS_MODE_SINGLE;\n        this.initGame(this.gameNode, this.model.currentStage, parseInt(Math.random() * 10000));\n        this.model.mconf.canRun = false;\n        this.model.mconf.isWhisper = true;\n        this.model.setGameStatus(els.ELS_GAME_STATE.PLAYING);\n        this.model.allowDoPopAction = true;\n        this.model.playMusic(els.ELS_VOICE.READYGO_MUSIC, false);\n        //this.model.playMusic(els.ELS_VOICE.BG_MUSIC2, true, 0.4);\n        this.model.playRandomBgMusic();\n        tywx.StarControl.clearNodes();\n        this.model.mgrid[0].setBmp(this.cipherData[this.cipherIndex]);\n\n        tywx.UIManager.hideAllUI();\n        tywx.UIManager.showUI(els.ELS_GAME_LAYER.GAME_SINGLE);\n\n        var _game = tywx.UIManager.getUI(els.ELS_GAME_LAYER.GAME_SINGLE).node.getComponent(\"gameSinglemode\");\n        _game.node.getChildByName(\"win_tips\").active = true;\n        for (var i = 0; i < _game.masks.length; i ++) {\n            if (i >= curIndex && i < cipherData.length) {\n                _game.masks[i].active = true;\n            }else {\n                _game.masks[i].active = false;\n            }\n        }\n        _game.showWisperStart(this.cipherIndex);\n\n        var gleNode = tywx.UIManager.getUI(els.ELS_GAME_LAYER.GAME_SINGLE);\n        gleNode.node.getChildByName('sl_bg').active = true;\n        this.gameNode.getComponent('main').hidenBeyondNode();\n    },\n\n    //初始化无尽模式\n    setEndless: function() {\n        this.model.mconf.isEndless = true;\n        this.model.endless_line = 0;\n        var tmp = this.loadItem('ELS_CURRENT_ENDLESS_LEVEL', '1-0');\n        tmp = tmp.split('-');\n        this.model.endless_level = parseInt(tmp[0]);\n        this.model.endless_score_save = parseInt(tmp[1]);\n        this.model.endless_clear = false;\n        this.model.currentStage = 0;\n    },\n\n    //开始经典模式\n    startClassicGame: function () {\n        els.HENG = 10;\n        this.updateBlock();\n        this.model.currentStage = parseInt(this.loadItem('ELS_CURRENT_STAGE2', 0));\n        this.model.mconf.mode = els.ELS_MODE_SINGLE;\n        //this.setEndless(); //测试无尽模式\n        this.initGame(this.gameNode, this.model.currentStage, parseInt(Math.random() * 10000));\n        this.model.setGameStatus(els.ELS_GAME_STATE.PLAYING);\n        this.model.allowDoPopAction = true;\n        this.model.playMusic(els.ELS_VOICE.READYGO_MUSIC, false);\n        //this.model.playMusic(els.ELS_VOICE.BG_MUSIC2, true, 0.4);\n        this.model.playRandomBgMusic();\n        tywx.StarControl.clearNodes();\n        this.gameNode.getComponent('main').showBeyondNode(\"ELS_CURRENT_STAGE2\");\n    },\n    // 开始无尽模式\n    startEndlessGame: function(){\n        els.HENG = 10;\n        this.updateBlock();\n        this.model.currentStage = parseInt(this.loadItem('ELS_CURRENT_STAGE_ENDLESS', 0));\n        this.model.mconf.mode = els.ELS_MODE_SINGLE;\n        this.setEndless(); //设置为无尽模式\n        this.initGame(this.gameNode, this.model.currentStage, parseInt(Math.random() * 10000));\n        this.model.mgrid[0].mstat.score = this.model.endless_score_save;\n        this.model.setGameStatus(els.ELS_GAME_STATE.PLAYING);\n        this.model.allowDoPopAction = true;\n        this.model.playMusic(els.ELS_VOICE.READYGO_MUSIC, false);\n        //this.model.playMusic(els.ELS_VOICE.BG_MUSIC2, true, 0.4);\n        this.model.playRandomBgMusic();\n        tywx.StarControl.clearNodes();\n        this.gameNode.getComponent('main').showBeyondNode(\"ELS_CURRENT_STAGE_ENDLESS\");\n    },\n\n    //返回主页  失败\n    loseBackToHome: function () {\n        var _gameCtrl = this.gameNode.getComponent('main');\n        _gameCtrl.yanhua.active = false;\n        this.model.allowDoPopAction = true;\n        this.stopTimerCountdown();\n        this._backToHomePage();\n        tywx.StarControl.clearNodes();\n        this.scheduleUpdate_Manual();\n    },\n\n    //重新挑战 失败\n    reStartGame: function () {\n        if (this.model.mconf.mode === els.ELS_MODE_AI) {\n            this.matchAiLevel();\n            this.model.setGameStatus(els.ELS_GAME_STATE.SEARCH_AI);\n            tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeStartVSRestart,\n                [this.model.pkstar, this.model.pklevel, this.model.ailevel]);\n            this.initGame(this.gameNode, -1, parseInt(Math.random() * 10000));\n        } else {\n            if (this.model.mconf.isEndless) this.setEndless();\n            this.initGame(this.gameNode, this.model.currentStage, parseInt(Math.random() * 10000));\n            this.model.setGameStatus(els.ELS_GAME_STATE.PLAYING);\n            if (this.model.mconf.isWhisper) {\n                this.model.mgrid[0].setBmp(this.cipherData[this.cipherIndex]);\n                console.log(\"btn_reStart_fun cipherData\");\n            }\n        }\n        this.model.allowDoPopAction = true;\n        this.scheduleUpdate_Manual();\n    },\n\n    updateLocQuery: function () {\n        this.cipherIndex = this.cipherIndex + 1;\n        var _query_key = \"SECRETLANGUAGEDATA\";\n        var querys = JSON.parse(this.loadItem(_query_key, ''));\n        var inLoc = false;\n        var new_querys = []; //new Array();\n        for (var i = 0; i < querys.length; i++) {\n            var _tq = querys[i];\n            if (_tq[\"randomKey\"] === this.randomKey) {\n                _tq[\"curIndex\"] = this.cipherIndex;\n            }\n            new_querys.push(_tq);\n        }\n        this.saveItem(_query_key, JSON.stringify(new_querys), true);\n    },\n\n    //下一关 成功\n    nextStage: function () {\n        let _type = undefined;\n        if (this.model.mconf.mode === els.ELS_MODE_AI) {\n            _type = \"ELS_PKSTAR\";\n            this.matchAiLevel();\n            this.model.setGameStatus(els.ELS_GAME_STATE.SEARCH_AI);\n            tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeStartVSNext,\n                [this.model.pkstar, this.model.pklevel, this.model.ailevel]);\n            this.initGame(this.gameNode, -1, parseInt(Math.random() * 10000));\n        } else {\n            if (this.model.mconf.isWhisper) {\n                if (this.cipherIndex >= this.cipherData.length) {\n                    return;\n                }\n            }\n            else if(this.model.mconf.isEndless){\n                // @ENDLESS \n                _type = 'ELS_CURRENT_STAGE_ENDLESS';\n            }else {\n                _type = \"ELS_CURRENT_STAGE2\";\n            }\n            this.initGame(this.gameNode, this.model.currentStage, parseInt(Math.random() * 10000));\n            this.model.setGameStatus(els.ELS_GAME_STATE.PLAYING);\n            if (this.model.mconf.isWhisper) {\n                this.model.mgrid[0].setBmp(this.cipherData[this.cipherIndex]);\n                this.show_mask();\n                var _game = tywx.UIManager.getUI(els.ELS_GAME_LAYER.GAME_SINGLE).node.getComponent(\"gameSinglemode\");\n                _game.showWisperStart(this.cipherIndex);\n            }\n            else if(this.model.mconf.isEndless){\n                // @ENDLESS 设置关卡\n                this.isShowingEndlessLevelEnd = false;\n                this.add_step = 0;\n                this.model.mgrid[0].setBmp(els.ELSBMP(this.model.endless_level + 2));\n            }\n        }\n        this.gameNode.getComponent('main').showBeyondNode(_type);\n        //去掉烟花效果\n        var _gameCtrl = this.gameNode.getComponent('main');\n        var particleSystem = _gameCtrl.yanhua.getChildByName(\"particlesystem\").getComponent(cc.ParticleSystem);\n        _gameCtrl.yanhua.active = false;\n        tywx.StarControl.clearNodes();\n        this.model.allowDoPopAction = true;\n        this.scheduleUpdate_Manual();\n    },\n    /**\n     * @ENDLESS\n     * * 无尽模式开始下一关\n     * \n     */\n    showNextStageWhenEndless: function(){\n        if(this.model.mconf.isEndless && this.isShowingEndlessLevelEnd){\n            // @ENDLESS 设置关卡\n            let main = this.gameNode.getComponent('main');\n            this.add_step = 0;\n            main.shadow.active = false; //! 需要在setBmp之前，不然，宝石动画会提前显示\n            this.model.mgrid[0].setBmp(els.ELSBMP(this.model.endless_level + 2));\n            this.mrender[0].draw(); // 立即绘制\n            //this.pauseGame();\n            let num = 0;\n            for (let i = 0; i < els.ZONG; i++) {\n                for (let j = 0; j < els.HENG; j++) {\n                    let tmp_grid_idx = i * els.GRIDW + 2 + j;\n                    let blk_idx = els.ZONG - i - 1;\n                    if(this.model.mgrid[0].mcore.grid[tmp_grid_idx] > 100){\n                        num++;\n                        let c = main.blocks[0][blk_idx][j];\n                        main.setBlkColor(c,0,this.model.mgrid[0].mcore.grid[tmp_grid_idx]%100,1,0);\n                        let offset_y = (els.ZONG + 3) * 72 + Math.floor(Math.random() * 10) * 72;\n                        let t = offset_y / 900;\n                        let self = this;\n                        c.runAction(\n                            cc.sequence(\n                                cc.moveBy(0,cc.p(0,offset_y)),\n                                cc.callFunc(()=>{c.opacity = 180;}),\n                                cc.moveBy(t,cc.p(0,-offset_y)).easing(cc.easeIn(2.5)),\n                                cc.callFunc(()=>{\n                                    num--;\n                                    if(num === 0){\n                                        self.isShowingEndlessLevelEnd = false;\n                                        main.shadow.active = true;\n                                        tywx.NotificationCenter.trigger(ELSEvent.ELS_EVENT_ENDLESS_SHOW_LEVEL_END,null);\n                                        self.model.mgrid[0].updateColHoleTop(2,11);\n                                    }\n                                })\n                            )\n                        );\n                    }\n                }\n            }\n            console.log('showNextStageWhenEndless',num);\n            \n        }\n    },\n\n    // 展示蒙版\n    show_mask: function () {\n        if (this.model.getGameStatus() == els.ELS_GAME_STATE.PLAYING) {\n            this.model.setGameStatus(els.ELS_GAME_STATE.SHOW_MASK);\n            var _game = tywx.UIManager.getUI(els.ELS_GAME_LAYER.GAME_SINGLE).node.getComponent(\"gameSinglemode\");\n            _game.game_mask.active = true;\n            this.stopTimerCountdown();\n            this.model.allowDoPopAction = true;\n            this.scheduleUpdate_Manual();\n        }\n    },\n\n    hiden_mask: function () {\n        if (this.model.getGameStatus() == els.ELS_GAME_STATE.SHOW_MASK) {\n            this.model.mconf.canRun = true;\n            var _game = tywx.UIManager.getUI(els.ELS_GAME_LAYER.GAME_SINGLE).node.getComponent(\"gameSinglemode\");\n            //_game.game_mask.active = false;\n            this.continueGame();\n        }\n    },\n\n    /**\n     * 暂停游戏\n     */\n    pauseGame: function () {\n        if (this.model.getGameStatus() == els.ELS_GAME_STATE.PLAYING) {\n            this.model.setGameStatus(els.ELS_GAME_STATE.PAUSE);\n            this.stopTimerCountdown();\n        }\n    },\n\n    /**\n     * 继续游戏\n     */\n    continueGame: function () {\n        console.log('继续游戏======>>>>>');\n        this.model.setGameStatus(els.ELS_GAME_STATE.PLAYING);\n        this.startTimerCountdown(this._time);\n    },\n\n    backToHomePage: function () {\n        this.stopTimerCountdown();\n        this._backToHomePage();\n    },\n\n    //放弃保星\n    cancelKeepStar: function () {\n        this.model.keepstar = false;\n        this.updatePKStar(-1);\n        tywx.StarControl.clearNodes();\n        this.model.setGameStatus(els.ELS_GAME_STATE.RESULT_LOSE);\n        this.model.begin_cd = -1;\n        tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeEndVSLoseNoKeep,\n            [this.model.pkstar, this.model.pklevel, this.model.ailevel]);\n    },\n\n    //保星 分享到群\n    keepStarShare: function () {\n        var that = this;\n        var _successCall = function () {\n            console.log('keepstar _successCall');\n            that.model.keepstar = true;\n            that.model.setGameStatus(els.ELS_GAME_STATE.RESULT_LOSE);\n            tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeEndVSLoseKeep,\n                [that.model.pkstar, that.model.pklevel, that.model.ailevel]);\n        };\n        var _failCall = function () {\n            console.log('_failCall');\n            that.model.keepstar = false;\n            that.updatePKStar(-1);\n            that.model.setGameStatus(els.ELS_GAME_STATE.RESULT_LOSE);\n        };\n        tywx.ShareInterface.shareMsg({\n            type:els.ELS_SHRAE_TYPE.GAME_KEEP_STAR,\n            successCallback:_successCall,\n            failCallback:_failCall\n        });\n        this.model.allowDoPopAction = true;\n        tywx.StarControl.clearNodes();\n        this.model.begin_cd = -1;\n        this.scheduleUpdate_Manual();\n    },\n\n    //保星 分享成功    加五步。减5行\n    emergencyShare: function () {\n        if (((this.model.mconf.mode == els.ELS_MODE_AI) || (this.model.mconf.mode == els.ELS_MODE_SINGLE)) && this.model.emergency) {\n            var that = this;\n            var _share_type = undefined;\n            if (this.model.mconf.mode === els.ELS_MODE_AI) {\n                _share_type = els.ELS_SHRAE_TYPE.GAME_SHARE_DEL5;\n            }\n            if (this.model.mconf.mode === els.ELS_MODE_SINGLE) {\n                _share_type = els.ELS_SHRAE_TYPE.GAME_SHARE_ADD5;\n            }\n            var _successCall = function () {\n                console.log('emergency _successCall');\n                if (that.model.mconf.mode == els.ELS_MODE_AI) {\n                    that.model.mgrid[0].clearThreeBottomLines();\n                }\n                if (that.model.mconf.mode == els.ELS_MODE_SINGLE) {\n                    that.model.add_step += 5;\n                    console.log(\"ADD5STEP!!!\");\n                    var a5 = that.gameNode.getComponent('main').add5step;\n                    a5.opacity = 255;\n                    a5.runAction(cc.sequence(cc.blink(1.5, 5), cc.callFunc(function () { a5.opacity = 0; })));\n                }\n            }\n            var _failCall = function () {\n                console.log('_failCall');\n            }\n            tywx.ShareInterface.shareMsg({\n                type:_share_type,\n                successCallback: _successCall,\n                failCallback: _failCall\n            });\n            this.model.allowDoPopAction = true;\n            tywx.StarControl.clearNodes();\n            //-------------------------------\n            this.scheduleUpdate_Manual();\n        }\n    },\n});\n\n(function (window, factory) {\n    if (typeof exports === 'object') {\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        define(factory);\n    } else {\n        window.nge = factory();\n    }\n})(this, function () {\n    return {\n        \"elsGame\": ElsGame\n    }\n});\n"]}