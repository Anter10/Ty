{"version":3,"sources":["ShareInterface.js"],"names":["tywx","ShareInterface","OnShareAppMessageInfo","setOnShareAppMessageInfo","title","imageUrl","sharePointId","shareSchemeId","getOnShareAppMessageInfo","getRandomOnShareAppMessageInfo","shareKeys","_key","PropagateInterface","_cachedShareConfig","push","length","randomIndex","Math","floor","random","sharePointKey","sharePointInfo","config","shareContent","sharePicUrl","shareMsg","_para","_list","undefined","ShareConfig","hasOwnProperty","type","console","log","failCallback","isForceShare2Group","share","successCallback","query","myquery","isFroceShare2Group","IsWechatPlatform","BiLog","clickStat","clickStatEventType","clickStatEventTypeUserShare","_query","UserInfo","userId","userName","wx","shareAppMessage","success","result","showToast","duration","icon","fail","complete","onShareAppMessageInit","onShareAppMessage","shareTickets","groupMsgInfos"],"mappings":"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","file":"ShareInterface.js","sourceRoot":"../../../../../assets/script/CommonFrame","sourcesContent":["/**\n * Created by xiaochuntian on 2018/5/3.\n */\n\ntywx.ShareInterface = {\n    OnShareAppMessageInfo: null,   //右上角转发对应的分享点信息\n\n    /**\n     * 设置右上角\"转发\"对应的分享信息\n     * @param title\n     * @param imageUrl\n     * @param sharePointId\n     * @param shareSchemeId\n     */\n    setOnShareAppMessageInfo: function(title, imageUrl, sharePointId, shareSchemeId){\n        this.OnShareAppMessageInfo = {\n            title: title,\n            imageUrl: imageUrl,\n            sharePointId: sharePointId,\n            shareSchemeId: shareSchemeId\n        }\n    },\n\n    /**\n     * 获取右上角\"转发\"对应的分享信息\n     * @returns {null}\n     */\n    getOnShareAppMessageInfo: function() {\n        return this.OnShareAppMessageInfo;\n    },\n\n    /**\n     * 随机获取一个分享点作为\"转发\"对应的分享信息\n     * @returns {*}\n     */\n    getRandomOnShareAppMessageInfo: function() {\n        var shareKeys = [];\n\n        for(var _key in tywx.PropagateInterface._cachedShareConfig){\n            if (_key == \"game_qqh_make\" || _key == \"game_qqh_win\") {\n                continue;\n            }\n            shareKeys.push(_key);\n        };\n\n        if(shareKeys && shareKeys.length > 0) {\n            var randomIndex = (Math.floor(Math.random()*10000))%shareKeys.length;\n            var sharePointKey = shareKeys[randomIndex];\n            var sharePointInfo = tywx.PropagateInterface._cachedShareConfig[sharePointKey];\n            if(sharePointInfo && sharePointInfo.length > 0) {\n                randomIndex = (Math.floor(Math.random()*10000))%sharePointInfo.length;\n                var config = {\n                    title: sharePointInfo[randomIndex].shareContent,\n                    imageUrl: sharePointInfo[randomIndex].sharePicUrl,\n                    sharePointId: sharePointInfo[randomIndex].sharePointId,\n                    shareSchemeId: sharePointInfo[randomIndex].shareSchemeId\n                };\n                return config;\n            }\n        }\n        return null;\n    },\n\n    /**\n     * 根据分享信息调用分享接口,并封装了必要的打点和处理\n     * @param _para :obj {\n     * type: , //分享点类型\n     *          game_qqh_win: 悄悄话通关\n     *          game_keep_star: 对战保星\n     *          game_share_add5: 闯关加5步\n     *          game_share_del5: 对战减5行\n     *          game_single_win: 闯关胜利\n     *          game_vs_win: 对战胜利\n     *          dellvery: 转发按钮\n     *          game: 游戏内分享按钮\n     *          hamepage: 主页分享按钮\n     * imageUrl: \"\",\n     * successCallback: func,\n     * failCallback: func\n     * }\n     */\n    shareMsg: function (_para) {\n\n        var _list = undefined;\n        if (tywx.PropagateInterface.ShareConfig.hasOwnProperty(_para.type)) {\n            _list = tywx.PropagateInterface.ShareConfig[_para.type];\n        }else {\n            console.log(\"_type not in shareConfig\");\n            if (_para.failCallback) {\n                _para.failCallback();\n            }\n            return;\n        }\n        var randomIndex = (Math.floor(Math.random()*10000))%_list.length;\n        var config = {\n            title: _list[randomIndex].shareContent,\n            imageUrl: _list[randomIndex].sharePicUrl,\n            sharePointId: _list[randomIndex].sharePointId,\n            shareSchemeId: _list[randomIndex].shareSchemeId\n        };\n        let isForceShare2Group = true;\n        //TODO: 类型判断为悄悄话制作,则不用此后端图片 用生成的对应文字的图\n        if (_para.type === \"game_qqh_make\") {\n            if (!_para.imageUrl) {\n                console.log(\"whisper type:: _imageUrl don`t exist!!!\");\n                return;\n            }\n            config.imageUrl = _para.imageUrl;\n            isForceShare2Group = false;\n        }\n        this.share(config.title, config.imageUrl, config.sharePointId, config.shareSchemeId, _para.successCallback, _para.failCallback, _para.query, isForceShare2Group);\n    },\n\n    /**\n     * 根据分享信息调用分享接口,并封装了必要的打点和处理\n     * @param title\n     * @param imageUrl\n     * @param sharePointId\n     * @param shareSchemeId\n     * @param successCallback\n     * @param failCallback\n     * @param myquery\n     * @param isFroceShare2Group 是否强制分享到群\n     */\n    share: function(title, imageUrl, sharePointId, shareSchemeId, successCallback, failCallback, myquery, isFroceShare2Group) {\n        if(tywx.IsWechatPlatform()) {\n            tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare,[sharePointId, 1, shareSchemeId]);\n            var _query = 'inviteCode='+tywx.UserInfo.userId+'&sourceCode='+sharePointId+\"&inviteName=\"+tywx.UserInfo.userName+\"&imageType=\"+shareSchemeId;\n            //if(myquery) _query = _query+ \"&\" + myquery;\n            if(myquery) _query = myquery;\n            console.log(\"QQQQQQ...\"+_query);\n            wx.shareAppMessage({\n                title: title,\n                imageUrl : imageUrl,\n                query : _query,\n                success : function (result) {\n                    console.log('分享成功',result);\n                    if(isFroceShare2Group){ //! 强制分享到群\n                        if(result['shareTickets']){ //! 分享到群\n                            if(successCallback){\n                                successCallback(result);\n                            }\n                            tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare,[sharePointId, 2, shareSchemeId]);\n                        }\n                        else{\n                            //! toast 请分享到群\n                            wx.showToast({\n                                title: '请分享到群',\n                                duration: 1000,\n                                icon: null\n                            });\n                            if(failCallback){\n                                failCallback();\n                            }\n                        }   \n                    }\n                    else{\n                        if(successCallback){\n                            successCallback(result);\n                        }\n                        tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare,[sharePointId, 2, shareSchemeId]);\n                    }\n                    \n                    \n                },\n                fail : function (result) {\n                    console.log('分享失败',result);\n                    //分享失败相关处理\n                    if(failCallback) {\n                        failCallback(result);\n                    }\n                },\n                complete : function () {\n                }\n            });\n        }\n    }\n};\n\ntywx.onShareAppMessageInit = function() {\n    if(tywx.IsWechatPlatform()) {\n        wx.onShareAppMessage(function (result) {\n            /**\n             * 获取转发信息,手动设置过则使用设置信息,否则随机获取一个分享点信息\n             */\n            var config = tywx.ShareInterface.getOnShareAppMessageInfo();\n            if(config == null) {\n                config = tywx.ShareInterface.getRandomOnShareAppMessageInfo();\n            }\n            tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare,[config.sharePointId, 1, config.shareSchemeId]);\n            return {\n                title: config.title,\n                imageUrl : config.imageUrl,\n                query : \"inviteCode=\"+tywx.UserInfo.userId+\"&sourceCode=\"+config.sharePointId+\"&inviteName=\"+tywx.UserInfo.userName+\"&imageType=\"+config.shareSchemeId,\n                success : function (shareTickets,groupMsgInfos) {\n                    tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare,[config.sharePointId, 2, config.shareSchemeId]);\n                },\n                fail : function () {\n\n                },\n                complete : function () {\n                }\n            }\n        });\n    };\n};\n\ntywx.onShareAppMessageInit();\n"]}