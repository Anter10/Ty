{"version":3,"sources":["unlock_item.js"],"names":["els","require","cc","Class","extends","Component","properties","product_icon","Node","user_icon_l","user_name_l","Label","user_icon_r","user_name_r","button_title","button_nodes","onLoad","string","init","_data","_i","_index","button_state","_itemId","parseInt","_users","length","self","forEach","_user","i","_icon","_name","setUserInfo","update_button","console","log","_node","active","name","_imageUrl","purl","indexOf","setImage","loader","load","err","texture","getComponent","spriteFrame","SpriteFrame","loadRes","button_click","tywx","MSG","addItems","ShareInterface","shareMsg","type","ELS_SHRAE_TYPE","UNLOCK_GIFT_PROP"],"mappings":";;;;;;AAAA,IAAIA,MAAMC,QAAQ,mBAAR,CAAV;;AAEAC,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,sBAAeL,GAAGM,IADV;;AAGRC,qBAAcP,GAAGM,IAHT;AAIRE,qBAAcR,GAAGS,KAJT;;AAMRC,qBAAcV,GAAGM,IANT;AAORK,qBAAcX,GAAGS,KAPT;;AASRG,sBAAcZ,GAAGS,KATT;;AAWRI,sBAAc,CAACb,GAAGM,IAAJ,CAXN,CAWgB;AAXhB,KAHP;;AAiBL;;AAEAQ,UAnBK,oBAmBK;AACN,aAAKN,WAAL,CAAiBO,MAAjB,GAA0B,EAA1B;AACA,aAAKJ,WAAL,CAAiBI,MAAjB,GAA0B,EAA1B;AACH,KAtBI;AAwBLC,QAxBK,gBAwBAC,KAxBA,EAwBOC,EAxBP,EAwBW;AACZ,aAAKC,MAAL,GAAcD,EAAd;AACA,aAAKE,YAAL,GAAoB,CAApB;AACA,YAAIH,KAAJ,EAAW;AACP,iBAAKI,OAAL,GAAeJ,MAAM,QAAN,CAAf;AACA,gBAAIK,SAASL,MAAM,aAAN,CAAT,MAAmC,CAAvC,EAAyC;AAAE;AACvC,qBAAKG,YAAL,GAAoB,CAApB;AACH,aAFD,MAEO;AAAE;AACL,qBAAKA,YAAL,GAAoB,CAApB;AACH;AACD,gBAAIG,SAASN,MAAM,OAAN,CAAb;AACA,gBAAIM,OAAOC,MAAP,GAAgB,CAApB,EAAuB;AACnB,qBAAKJ,YAAL,GAAoB,CAApB;AACH;AACD,gBAAIK,OAAO,IAAX;AACAF,mBAAOG,OAAP,CAAe,UAAUC,KAAV,EAAiBC,CAAjB,EAAoB;AAC/B,oBAAIC,QAAQD,MAAM,CAAN,GAAUH,KAAKlB,WAAf,GAA6BkB,KAAKf,WAA9C;AACA,oBAAIoB,QAAQF,MAAM,CAAN,GAAUH,KAAKjB,WAAf,GAA6BiB,KAAKd,WAA9C;AACAc,qBAAKM,WAAL,CAAiBJ,KAAjB,EAAwBE,KAAxB,EAA+BC,KAA/B;AACH,aAJD;AAKH;AACD,aAAKE,aAAL;AACH,KA9CI;AAgDLA,iBAhDK,2BAgDU;AACXC,gBAAQC,GAAR,CAAY,eAAZ,EAA6B,KAAKd,YAAlC;AACA,YAAIK,OAAO,IAAX;AACA,aAAKZ,YAAL,CAAkBa,OAAlB,CAA0B,UAAUS,KAAV,EAAiBP,CAAjB,EAAoB;AAC1CO,kBAAMC,MAAN,GAAe,KAAf;AACA,gBAAIR,MAAMN,SAASG,KAAKL,YAAd,CAAV,EAAuC;AACnCe,sBAAMC,MAAN,GAAe,IAAf;AACH;AACJ,SALD;AAMH,KAzDI;AA2DLL,eA3DK,uBA2DOJ,KA3DP,EA2DcE,KA3Dd,EA2DqBC,KA3DrB,EA2D4B;AAC7BA,cAAMM,MAAN,GAAe,IAAf;AACAN,cAAMf,MAAN,GAAeY,MAAMU,IAArB;AACA,YAAIC,YAAYX,MAAMY,IAAtB;AACA,YAAID,UAAUE,OAAV,CAAkB,qBAAlB,MAA6C,CAAC,CAAlD,EAAqD;AACjDF,wBAAYA,YAAY,cAAxB;AACH,SAFD,MAEO;AACHA,wBAAY,mCAAZ;AACAR,kBAAMf,MAAN,GAAe,KAAf;AACH;AACD,aAAK0B,QAAL,CAAcZ,KAAd,EAAqBS,SAArB;AACH,KAtEI;AAwELG,YAxEK,oBAwEIN,KAxEJ,EAwEWG,SAxEX,EAwEsB;AACvB,YAAI,CAAC,CAAD,KAAOA,UAAUE,OAAV,CAAkB,qBAAlB,CAAX,EAAqD;AACnDxC,eAAG0C,MAAH,CAAUC,IAAV,CAAeL,SAAf,EAA0B,UAASM,GAAT,EAAcC,OAAd,EAAuB;AAC/CD,wBAAQT,MAAMW,YAAN,CAAmB,WAAnB,EAAgCC,WAAhC,GAA8C,IAAI/C,GAAGgD,WAAP,CAAmBH,OAAnB,CAAtD;AACD,aAFD;AAGD,SAJD,MAIO;AACL7C,eAAG0C,MAAH,CAAUO,OAAV,CAAkBX,SAAlB,EAA6BtC,GAAGgD,WAAhC,EAA6C,UAASJ,GAAT,EAAcG,WAAd,EAA2B;AACtE,oBAAI,CAACH,GAAL,EAAU;AACRT,0BAAMW,YAAN,CAAmB,WAAnB,EAAgCC,WAAhC,GAA8CA,WAA9C;AACD,iBAFD,MAEO;AACLd,4BAAQC,GAAR,CAAY,cAAZ,EAA4BU,GAA5B;AACD;AACF,aAND;AAOD;AACF,KAtFE;AAwFLM,gBAxFK,0BAwFS;AACV,YAAIzB,OAAO,IAAX;AACA,gBAAQ,KAAKL,YAAb;AACI,iBAAK,CAAL;AAAQ;AACR;AACI;AACH;AACD,iBAAK,CAAL;AAAQ;AACR;AACI+B,yBAAKC,GAAL,CAASC,QAAT,CAAkB,CAAlB,EAAqB5B,KAAKN,MAA1B;AACA;AACH;AACD,iBAAK,CAAL;AAAQ;AACR;AACIgC,yBAAKG,cAAL,CAAoBC,QAApB,CAA6B;AACzBC,8BAAK1D,IAAI2D,cAAJ,CAAmBC;AADC,qBAA7B;AAGA;AACH;AACD;AACA,iBAEC;AApBL;AAsBH;AAhHI;;AAkHL;AAlHJ","file":"unlock_item.js","sourceRoot":"../../../../../../assets/script/ui/unlock","sourcesContent":["var els = require(\"../../core/els.js\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        product_icon : cc.Node,\n\n        user_icon_l : cc.Node,\n        user_name_l : cc.Label,\n\n        user_icon_r : cc.Node,\n        user_name_r : cc.Label,\n\n        button_title: cc.Label,\n\n        button_nodes: [cc.Node] // 0 : 已经领取 1: 可领取 2: 分享\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.user_name_l.string = '';\n        this.user_name_r.string = '';\n    },\n\n    init(_data, _i) {\n        this._index = _i;\n        this.button_state = 2;\n        if (_data) {\n            this._itemId = _data[\"itemId\"];\n            if (parseInt(_data[\"getDianmond\"]) === 1){ // 可以领取\n                this.button_state = 1;\n            } else { // 已经领取完毕\n                this.button_state = 0;\n            }\n            let _users = _data[\"users\"];\n            if (_users.length < 2) {\n                this.button_state = 2;\n            }\n            let self = this;\n            _users.forEach(function (_user, i) {\n                let _icon = i === 0 ? self.user_icon_l : self.user_icon_r;\n                let _name = i === 0 ? self.user_name_l : self.user_name_r;\n                self.setUserInfo(_user, _icon, _name);\n            });\n        }\n        this.update_button();\n    },\n\n    update_button(){\n        console.log(\"update_button\", this.button_state);\n        let self = this;\n        this.button_nodes.forEach(function (_node, i) {\n            _node.active = false;\n            if (i === parseInt(self.button_state)) {\n                _node.active = true;\n            }\n        });\n    },\n\n    setUserInfo(_user, _icon, _name) {\n        _name.active = true;\n        _name.string = _user.name;\n        let _imageUrl = _user.purl;\n        if (_imageUrl.indexOf(\"https://wx.qlogo.cn\") !== -1) {\n            _imageUrl = _imageUrl + \"?aaa=aaa.png\";\n        } else {\n            _imageUrl = \"image/prop_icons/invited_icon.png\";\n            _name.string = \"已邀请\";\n        }\n        this.setImage(_icon, _imageUrl);\n    },\n\n    setImage(_node, _imageUrl) {\n        if (-1 !== _imageUrl.indexOf(\"https://wx.qlogo.cn\")) {\n          cc.loader.load(_imageUrl, function(err, texture) {\n            err || (_node.getComponent(\"cc.Sprite\").spriteFrame = new cc.SpriteFrame(texture));\n          });\n        } else {\n          cc.loader.loadRes(_imageUrl, cc.SpriteFrame, function(err, spriteFrame) {\n            if (!err) {\n              _node.getComponent('cc.Sprite').spriteFrame = spriteFrame;\n            } else {\n              console.log('loadResError', err);\n            }\n          });\n        }\n      },\n\n    button_click(){\n        let self = this;\n        switch (this.button_state) {\n            case 0: // 已经领取\n            {\n                break;\n            }\n            case 1: // 可领取\n            {\n                tywx.MSG.addItems(7, self._index);\n                break;\n            }\n            case 2: // 分享\n            {\n                tywx.ShareInterface.shareMsg({\n                    type:els.ELS_SHRAE_TYPE.UNLOCK_GIFT_PROP\n                });\n                break;\n            }\n            default:\n            {\n\n            }\n        }\n    },\n\n    // update (dt) {},\n});\n"]}