{"version":3,"sources":["els_view_magic_bottle.js"],"names":["ELSEvent","require","els","cc","Class","extends","Component","properties","nodeProgressBar","Node","nodeGiftBox","onLoad","currentProgress","maxProgress","posStart","posEnd","dis","position","y","progressTo","start","setProgress","value","console","log","opacity","parseInt","cur_pos_y","aim_pos_y","self","stopAllActions","runAction","sequence","moveTo","p","callFunc","isCallFull","tywx","NotificationCenter","trigger","ELS_EVENT_MAGIC_BOTTLE_FULL","ret","is_full","main","UIManager","game","gameNode","getComponent","is_over","yanhua","active","is_endless_over","model","mconf","isEndless","isShowingEndlessLevelEnd","is_show_hp","currentStatus","ELS_GAME_STATE","HOMEPAGE"],"mappings":"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","file":"els_view_magic_bottle.js","sourceRoot":"../../../../../assets/script/ui","sourcesContent":["let ELSEvent = require('../core/ElsEvents.js');\nlet els = require('../core/els.js');\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        nodeProgressBar: cc.Node,\n        nodeGiftBox: cc.Node,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.currentProgress = 0;\n        this.maxProgress = 100;\n        this.posStart = -72;\n        this.posEnd = 42;\n        this.dis = this.posEnd - this.posStart;\n        this.nodeProgressBar.position.y = this.posStart;\n        this.progressTo(0);\n    },\n\n    start () {\n\n    },\n\n    // update (dt) {},\n    setProgress(value){\n        console.log('els_view_magic_bottle/setProgress',value);\n        this.currentProgress = value > 100 ? 100 : value;\n        this.nodeGiftBox.opacity = parseInt((this.currentProgress / 100) * 255);\n    },\n    progressTo(value){\n        console.log('els_view_magic_bottle/progressTo',value);\n        this.setProgress(value);\n        let cur_pos_y = this.nodeProgressBar.position.y;\n        let aim_pos_y = this.posStart + (value/this.maxProgress) * this.dis;\n        let dis = aim_pos_y - cur_pos_y;\n        if(dis > 0){\n            let self = this;\n            this.nodeProgressBar.stopAllActions();\n            this.nodeProgressBar.runAction(\n                cc.sequence(\n                    cc.moveTo(0.2,cc.p(0,aim_pos_y)),\n                    cc.callFunc(()=>{\n                        if(self.isCallFull()){\n                            //! 满了\n                            tywx.NotificationCenter.trigger(ELSEvent.ELS_EVENT_MAGIC_BOTTLE_FULL,self.currentProgress);\n                            self.progressTo(0);\n                        }\n                    })\n                )\n            );\n        }\n        else{\n            console.log('els_view_magic_bottle/els_view_magic_bottle','bottle animation failed, force to progress.');\n            this.nodeProgressBar.position = cc.p(0,parseInt(aim_pos_y));\n            // 动画结束可能不执行，所以，在这里添加一个判断\n            if(this.isCallFull()){\n                //! 满了\n                tywx.NotificationCenter.trigger(ELSEvent.ELS_EVENT_MAGIC_BOTTLE_FULL,this.currentProgress);\n                this.progressTo(0);\n            }\n        }\n        \n    },\n    isCallFull(){\n        let ret = false;\n        let is_full = this.currentProgress === this.maxProgress; // 能量是否满了\n        let main = tywx.UIManager.game.gameNode.getComponent('main');\n        let is_over = main.yanhua.active; // 当前关卡是否已经结束\n        let is_endless_over = tywx.UIManager.game.model.mconf.isEndless && tywx.UIManager.game.isShowingEndlessLevelEnd;\n        let is_show_hp = tywx.UIManager.game.model.currentStatus === els.ELS_GAME_STATE.HOMEPAGE; // 是否在homePage界面\n        ret = is_full && !is_over && !is_show_hp && !is_endless_over;\n        console.log('els_view_magic_bottle/isCallFull',`is_full:${is_full},is_over:${is_over}, is_show_hp:${is_show_hp}`);\n        return ret;\n    }\n});\n"]}