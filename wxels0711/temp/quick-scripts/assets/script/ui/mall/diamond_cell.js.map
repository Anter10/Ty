{"version":3,"sources":["diamond_cell.js"],"names":["cc","Class","extends","Component","properties","count_label","Label","price_label","free_tag","Node","onDestroy","tywx","NotificationCenter","ignoreScope","init","_data","_index","data","undefined","active","node","position","v2","string","UserInfo","rewardInfo","listen","EventType","CMD_ELSWX","_MsgRewardInfo","MSG","getRewardInfo","_price","_count","params","result","action","CMD_ACTION_REWARD_INFO","diamond_cell_btn_click","sys","os","OS_IOS","wx","showToast","title","duration","self","TuyooSDK","rechargeOrder","SystemInfo","gameId","AdManager","showVidelAd","showAward","loader","loadRes","err","prefab","preFabNode","instantiate","parent","UIManager","getCurrentUI"],"mappings":"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","file":"diamond_cell.js","sourceRoot":"../../../../../../assets/script/ui/mall","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        count_label: cc.Label,\n        price_label: cc.Label,\n\n        free_tag: cc.Node\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onDestroy() {\n        tywx.NotificationCenter.ignoreScope(this);\n    },\n\n    init(_data, _index) {\n\n        this.data = undefined;\n        this.free_tag.active = false;\n        this.price_label.node.position = cc.v2(0, 14);\n        this._index = _index;\n        if (!_data) {\n            // TODO: 免费广告获取钻石 每次一个\n            this.data = _data;\n            if (this._index === 1) {\n                this.price_label.string = \"邀请\";\n                this.count_label.string = \"钻石x10\";\n                return;\n            }\n            this.free_tag.active = true;\n            this.price_label.string = \"免费\";\n            this.count_label.string = \"钻石x1\";\n            this.price_label.node.position = cc.v2(20, 14);\n            if (!tywx.UserInfo.rewardInfo) {\n                tywx.NotificationCenter.listen(tywx.EventType.CMD_ELSWX, this._MsgRewardInfo, this);\n                tywx.MSG.getRewardInfo();\n            } else {\n                this.count_label.string = \"钻石x\" + tywx.UserInfo.rewardInfo[\"oneRewardDiamond\"];\n            }\n        } else { // 其他购买\n            this.data = _data;\n            let _price = \"¥\" + _data[\"price\"];\n            this.price_label.string = _price;\n\n            let _count = _data[\"displayName\"];\n            this.count_label.string = _count;\n        }\n    },\n\n    _MsgRewardInfo(params) {\n        if (params.result.action === tywx.EventType.CMD_ACTION_REWARD_INFO) {\n            tywx.UserInfo.rewardInfo = params.result;\n            if (this.count_label) this.count_label.string = params.result[\"oneRewardDiamond\"];\n        }\n    },\n\n    diamond_cell_btn_click() {\n        if (this.data) {\n            if (cc.sys.os === cc.sys.OS_IOS) {\n                wx.showToast({\n                    title: 'iOS无法支付',\n                    duration: 1000,\n                });\n                return;\n            }\n            // tywx.TYPay.purchase(this.data[\"productId\"], this.data[\"price\"], this.data[\"displayName\"], \"1\");\n            // params prodId:商品ID, prodName:商品名称, prodCount:购买数量\n            // prodPrice:价格  单位元,\n            // chargeType:支付方式 wxapp.iap,\n            // gameId:子游戏id,\n            // appInfo:透传参数,\n            // mustcharge:是否支付 默认填 1\n            // \n            let self = this;\n            tywx.TuyooSDK.rechargeOrder({\n                \"prodId\": self.data[\"productId\"],\n                \"prodName\": self.data[\"displayName\"],\n                \"prodCount\": 1,\n                \"prodPrice\": self.data[\"price\"],\n                \"gameId\": tywx.SystemInfo.gameId,\n                \"chargeType\": \"wxapp.iap\",\n                \"appInfo\": \"\",\n                \"mustcharge\": 1\n            });\n        } else { // 广告 免费获取一个\n            if (this._index === 0) {\n                tywx.AdManager.showVidelAd();\n            } else {\n                this.showAward();\n            }\n\n        }\n    },\n\n\n\n    showAward() {\n        let self = this;\n        cc.loader.loadRes('prefab/diamond_award/award', function(err, prefab) {\n            var preFabNode = cc.instantiate(prefab);\n            preFabNode.parent = tywx.UIManager.getCurrentUI();\n        });\n    },\n    // update (dt) {},\n});"]}