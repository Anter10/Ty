{"version":3,"sources":["mall.js"],"names":["ELSEvent","require","cc","Class","extends","Component","properties","mall_btn_nodes","Node","my_btn_nodes","diamond_btn_nodes","mall_content","page_view","PageView","my_page_view","diamond_page_view","diamond_label","Label","mall_cell","Prefab","item_cell","diamond_cell","page_prefab","x_node","onLoad","active","page_views","i","c","instantiate","position","console","log","parent","push","curIndex","btn_nodes","select_page_view","getComponent","tywx","NotificationCenter","listen","ELS_EVENT_UPDATE_BAG","_onMsgItem","ELS_EVENT_UPDATE_ITEMS","_onMsgUpdateBag","MSG","getBagInfo","start","diamond_btn_click","mall_btn_click","load_product_config","params","update_Bag","StoreList","getStoreList","Timer","setTimer","update_UI","UserInfo","bag","string","diamond","_items","forEach","_item","tag","items","_i","item_cells","_pageIndex","parseInt","_page","undefined","getPages","length","width","height","addPage","_x","_y","_cell","_data","init","v2","_item_cell","update_select","ps","_itemid","kindID","split","product_tag","node","_length","ds","sys","os","OS_IOS","my_btn_click","_index","self","_list","selectBtn","dismiss_UI","removeFromParent","destroyAllChildren","destroy","trigger","ELS_EVENT_CLEARN_MALL","_type","onDestroy","ignoreScope"],"mappings":"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","file":"mall.js","sourceRoot":"../../../../../../assets/script/ui/mall","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\nvar ELSEvent = require(\"../../core/ElsEvents.js\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        mall_btn_nodes: [cc.Node], // 0:select 1:nomal\n        my_btn_nodes: [cc.Node], // 0:select 1:nomal\n        diamond_btn_nodes: [cc.Node], // 0:select 1:nomal\n\n        mall_content: cc.Node,\n\n        page_view: cc.PageView, // 商城\n        my_page_view: cc.PageView, // 我的\n        diamond_page_view: cc.PageView, // 钻石\n\n        diamond_label: cc.Label, // 钻石数\n\n        mall_cell: cc.Prefab,\n        item_cell: cc.Prefab,\n        diamond_cell: cc.Prefab,\n\n        page_prefab: cc.Prefab,\n\n        x_node: cc.Node\n\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n        this.diamond_label.active = false;\n        this.page_views = [];\n        for (let i = 0; i < 3; i++) {\n            let c = cc.instantiate(this.page_prefab);\n            c.position = this.x_node.position;\n            console.log(c.position);\n            c.parent = this.mall_content;\n            this.page_views.push(c);\n        }\n\n        this.curIndex = 0; // 当前界面标识  0: 商城 1: 我的背包 2: 钻石\n\n        this.btn_nodes = [this.mall_btn_nodes, this.my_btn_nodes, this.diamond_btn_nodes];\n\n        this.select_page_view(this.curIndex);\n\n        this.page_view = this.page_views[0].getComponent(\"cc.PageView\");\n        this.my_page_view = this.page_views[1].getComponent(\"cc.PageView\");\n        this.diamond_page_view = this.page_views[2].getComponent(\"cc.PageView\");\n\n        tywx.NotificationCenter.listen(ELSEvent.ELS_EVENT_UPDATE_BAG, this._onMsgItem, this);\n        tywx.NotificationCenter.listen(ELSEvent.ELS_EVENT_UPDATE_ITEMS, this._onMsgUpdateBag, this);\n        tywx.MSG.getBagInfo();\n    },\n\n    start() {\n        \n        if (this.curIndex === 2) {\n            this.diamond_btn_click();\n        } else {\n            this.mall_btn_click();\n        }\n        this.load_product_config();\n    },\n\n    _onMsgItem(params) {\n        this.update_Bag();\n    },\n\n    load_product_config() {\n\n        if (!tywx.StoreList) {\n            tywx.MSG.getStoreList();\n            // TODO: 获取到实际配置后显示\n            tywx.Timer.setTimer(this, this.load_product_config, 1);\n        } else {\n            this.update_UI();\n        }\n\n        if (tywx.UserInfo.bag) {\n            this.update_Bag();\n        } else {\n            tywx.MSG.getBagInfo();\n        }\n    },\n\n    update_Bag() {\n        this.diamond_label.active = true;\n        this.diamond_label.string = tywx.UserInfo.diamond;\n\n        let _items = [];\n        tywx.UserInfo.bag.forEach(function(_item) {\n\n            let tag = false;\n            tywx.StoreList.items.forEach(function(_i) {\n                if (_i[\"kindId\"] === _item[\"kindID\"]) {\n                    tag = true;\n                }\n            });\n            if (_item['kindID'] !== 1014 && tag) {\n                _items.push(_item);\n            }\n        });\n        this.item_cells = [];\n        for (let i = 0; i < _items.length; i++) {\n            let _pageIndex = parseInt(i / 4); // 每页4个\n            let _page = undefined;\n            if (this.my_page_view.getPages().length > _pageIndex) {\n                _page = this.my_page_view.getPages()[_pageIndex];\n            } else {\n                _page = new cc.Node();\n                _page.width = 540;\n                _page.height = 699;\n                this.my_page_view.addPage(_page);\n            }\n            let _x = i % 2 === 0 ? -124.5 : 124.5;\n            let _y = i % 4 < 2 ? 173.5 : -154.5;\n            let _cell = cc.instantiate(this.item_cell);\n            let _data = _items[i];\n            tywx.StoreList.items.forEach(function(_i) {\n                if (_i[\"kindId\"] === _data[\"kindID\"]) {\n                    _data[\"item\"] = _i;\n                }\n            });\n            if (!_data[\"item\"]) return;\n            _cell.getComponent(\"item_cell\").init(_data);\n            _cell.position = cc.v2(_x, _y);\n            this.item_cells.push(_cell);\n            _cell.parent = _page;\n        }\n    },\n\n    _onMsgUpdateBag() {\n        this.item_cells.forEach(function(_item_cell) {\n            _item_cell.getComponent(\"item_cell\").update_select();\n        });\n    },\n\n    update_UI() {\n        for (let i = 0; i < tywx.StoreList.ps.length; i++) {\n            let _pageIndex = parseInt(i / 4); // 每页4个\n            let _page;\n            if (this.page_view.getPages().length > _pageIndex) {\n                _page = this.page_view.getPages()[_pageIndex];\n            } else {\n                _page = new cc.Node();\n                _page.width = 540;\n                _page.height = 699;\n                this.page_view.addPage(_page);\n            }\n            let _x = i % 2 === 0 ? -124.5 : 124.5;\n            let _y = i % 4 < 2 ? 173.5 : -154.5;\n            let _cell = cc.instantiate(this.mall_cell);\n            _cell.getComponent(\"product_cell\").init(tywx.StoreList.ps[i]);\n            _cell.position = cc.v2(_x, _y);\n            tywx.UserInfo.bag.forEach(function(_item) {\n                let _itemid = tywx.StoreList.ps[i][\"content\"][\"items\"][0][\"itemId\"] || \"\";\n                if (_item.kindID === _itemid.split(':')[1]) {\n                    _cell.getComponent(\"product_cell\").product_tag.node.active = true;\n                }\n            });\n            _cell.parent = _page;\n        }\n\n        let _length = tywx.StoreList.ds.length + 2;\n        if (cc.sys.os === cc.sys.OS_IOS) {\n            _length = 2;\n        }\n\n        for (let i = 0; i < _length; i++) {\n            let _pageIndex = parseInt(i / 4); // 每页4个\n            let _page;\n            if (this.diamond_page_view.getPages().length > _pageIndex) {\n                _page = this.diamond_page_view.getPages()[_pageIndex];\n            } else {\n                _page = new cc.Node();\n                _page.width = 540;\n                _page.height = 699;\n                this.diamond_page_view.addPage(_page);\n            }\n            let _x = i % 2 === 0 ? -124.5 : 124.5;\n            let _y = i % 4 < 2 ? 173.5 : -154.5;\n            let _cell = cc.instantiate(this.diamond_cell);\n            if (i - 2 >= 0) {\n                _cell.getComponent(\"diamond_cell\").init(tywx.StoreList.ds[i - 2], i);\n            } else {\n                _cell.getComponent(\"diamond_cell\").init(undefined, i);\n            }\n            _cell.position = cc.v2(_x, _y);\n            _cell.parent = _page;\n        }\n    },\n\n    // button event\n    mall_btn_click() {\n        this.curIndex = 0;\n        this.select_page_view();\n    },\n\n    my_btn_click() {\n        this.curIndex = 1;\n        this.select_page_view();\n    },\n\n    diamond_btn_click() {\n        this.curIndex = 2;\n        this.select_page_view();\n    },\n\n    select_page_view() {\n\n        let _index = this.curIndex;\n        let self = this;\n        this.page_views.forEach(function(page_view, i) {\n            page_view.active = false;\n            if (i === _index) {\n                page_view.active = true;\n            }\n        });\n\n        this.btn_nodes.forEach(function(_list, i) {\n            self.selectBtn(_list, false);\n            if (i === _index) {\n                self.selectBtn(_list, true);\n            }\n        })\n\n    },\n\n    dismiss_UI() {\n        this.node.active = false;\n        this.node.removeFromParent();\n        this.node.destroyAllChildren();\n        this.node.destroy();\n        tywx.NotificationCenter.trigger(ELSEvent.ELS_EVENT_CLEARN_MALL);\n    },\n\n    selectBtn(_list, _type) {\n        _list[0].active = _type;\n        _list[1].active = !_type;\n    },\n\n    onDestroy() {\n        tywx.NotificationCenter.ignoreScope(this);\n    },\n\n    // update (dt) {},\n});"]}