{"version":3,"sources":["product_cell.js"],"names":["ElsUtils","require","cc","Class","extends","Component","properties","product_name","Label","product_icon","Sprite","product_count","product_price","product_tag","init","_data","canPay","node","active","_product_info","updateCell","getComponent","string","checkPF","productId","hasPF","pic","setImage","_itemId","ret","i","tywx","UserInfo","bag","length","_i","indexOf","_node","_productId","ELS_PRODUCT_CONFIG","TY20016D0000003","url","scale","rotation","TY20082D0000101","TY20016D0000004","TY20016D0000005","TY20082D0000201","TY20082D0000202","TY20082D0000203","TY20082D0000204","_item","console","log","purl","loader","loadRes","SpriteFrame","err","spriteFrame","showAward","self","prefab","preFabNode","instantiate","parent","UIManager","getCurrentUI","buy_btn_click","wx","showToast","title","duration","parseInt","diamond","priceDiamond","Util","wechatShowModal","params","confirm","MSG","transformProduct"],"mappings":"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","file":"product_cell.js","sourceRoot":"../../../../../../assets/script/ui/mall","sourcesContent":["var ElsUtils = require(\"../../core/ElsUtils.js\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        product_name : cc.Label,\n        product_icon : cc.Sprite,\n        product_count: cc.Label,\n        product_price: cc.Label,\n        product_tag  : cc.Sprite,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {\n    //\n    // },\n\n    init(_data) {\n        if (!_data) {\n            return;\n        }\n        this.canPay = true;\n        this.product_tag.node.active = false;\n        this._product_info = _data;\n        this.updateCell();\n    },\n\n    updateCell(){\n        this.product_name.getComponent(\"cc.Label\").string = this._product_info[\"displayName\"];\n        if (ElsUtils.checkPF(this._product_info.productId)) {\n            this.product_count.getComponent(\"cc.Label\").string = \"\";\n            if (this.hasPF(this._product_info[\"content\"][\"items\"][0][\"itemId\"])) {\n                this.product_tag.node.active = true;\n                this.canPay = false;\n            }\n        } else {\n            this.product_count.getComponent(\"cc.Label\").string = \"\";\n        }\n\n        this.product_price.getComponent(\"cc.Label\").string = this._product_info[\"priceDiamond\"];\n        let pic = this._product_info[\"pic\"];\n        this.setImage(this.product_icon, this._product_info.productId);\n    },\n\n    hasPF(_itemId) {\n        let ret = false;\n        for (let i = 0; i < tywx.UserInfo.bag.length; i ++) {\n            let _i = tywx.UserInfo.bag[i];\n            if (_itemId.indexOf(_i[\"kindID\"]+\"\") !== -1) {\n               ret = true;\n               break;\n           }\n        }\n        return ret;\n    },\n\n    setImage(_node, _productId) {\n        let ELS_PRODUCT_CONFIG = {\n            // TODO:res/raw-assets/resources/\n            TY20016D0000003: { // 玫瑰\n                url: \"image/prop_icons/daoju03\",\n                scale:0.4,\n                rotation:0\n            },\n            TY20082D0000101: { // 道具大礼包\n                url: \"image/prop_icons/item_box\",\n                scale:1,\n                rotation:0\n            },\n            TY20016D0000004: { // 导弹\n                url: \"image/prop_icons/FangKuai_daodan\",\n                scale:1,\n                rotation:0\n            },\n            TY20016D0000005: { // 锤子\n                url: \"image/prop_icons/FangKuai_chueizi\",\n                scale:0.9,\n                rotation:0\n            },\n            1019: { // 魔法棒\n                url: \"image/prop_icons/FangKuai_mobang\",\n                scale:0.6,\n                rotation:-25\n            },\n            TY20082D0000201: { // 乐高积木皮肤\n                url: \"image/prop_icons/pifu00\",\n                scale:1,\n                rotation:0\n            },\n            TY20082D0000202: { // 七彩水晶皮肤\n                url: \"image/prop_icons/pifu02\",\n                scale:1,\n                rotation:0\n            },\n            TY20082D0000203: { // 瑰丽宝石皮肤\n                url: \"image/prop_icons/pifu03\",\n                scale:1,\n                rotation:0\n            },\n            TY20082D0000204: { // 瑰丽宝石皮肤\n                url: \"image/prop_icons/pifu04\",\n                scale:1,\n                rotation:0\n            },\n        };\n        let _item = ELS_PRODUCT_CONFIG[_productId + ''];\n        if (!_item) {\n            console.log(\"local config not exist!!\");\n            return;\n        }\n\n        let purl = _item[\"url\"];\n        _node.node.rotation = _item[\"rotation\"];\n        _node.node.scale = _item[\"scale\"];\n        cc.loader.loadRes(purl, cc.SpriteFrame, function (err, spriteFrame) {\n            if (!err) {\n                _node.getComponent('cc.Sprite').spriteFrame = spriteFrame;\n            }\n            else{\n                console.log('loadResError',err);\n            }\n        });\n    },\n\n    showAward(){\n        let self = this;\n        cc.loader.loadRes('prefab/diamond_award/award', function (err, prefab) {\n            var preFabNode = cc.instantiate(prefab);\n            preFabNode.parent = tywx.UIManager.getCurrentUI();\n        });\n    },\n\n    buy_btn_click(){\n      // TODO: 购买商品\n        console.log(\"buy_btn_click\");\n        if (!this.canPay) {\n            wx.showToast({\n                title: '已经拥有了',\n                duration: 1000\n            });\n            return;\n        }\n        let self = this;\n        if (parseInt(tywx.UserInfo.diamond) - parseInt(this._product_info.priceDiamond) < 0){\n            tywx.Util.wechatShowModal(\"钻石不够啦,邀请好友可获得钻石哦,去邀请?\", true, \"邀请\", \n                function(params){ // \n                    if (params.confirm) {\n                        console.log(\"to invalid\");\n                        self.showAward();\n                    } else {\n                        console.log(\"to cancel\");\n                    }\n                }\n            );\n            return;\n        }\n        tywx.MSG.transformProduct(\"TY20082D0000000\", this._product_info.productId, 1);\n    },\n\n    // update (dt) {},\n});\n"]}