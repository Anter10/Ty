{"version":3,"sources":["diamond_award_cell.js"],"names":["els","require","cc","Class","extends","Component","properties","nickname","Label","icon","Sprite","button","Button","rewardState","btn_Nodes","Node","init","_data","data","setImage","onLoad","i","length","active","node","on","buttonClick","updateState","console","log","isListen","tywx","NotificationCenter","listen","EventType","CMD_ELSWX","_MsgRewardInfo","MSG","addRewardDiamond","userId","ShareInterface","shareMsg","type","ELS_SHRAE_TYPE","HOME_REWARD","_node","_imageUrl","indexOf","setContentSize","loader","load","err","texture","getComponent","spriteFrame","SpriteFrame","params","result","action","CMD_ACTION_ADD_DIAMOND","status","reason","Util","wechatShowModal","count","onDestroy","ignoreScope"],"mappings":"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","file":"diamond_award_cell.js","sourceRoot":"../../../../../../assets/script/ui/diamond_award","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\nvar els = require(\"../../core/els.js\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        nickname:cc.Label,\n        icon:cc.Sprite,\n        button:cc.Button,\n        rewardState:0,\n        btn_Nodes:[cc.Node] // 0: 领取 1: 邀请 2: 领取\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    init(_data){\n        this.data = _data;\n        if (_data[\"data\"]){\n            this.setImage(this.icon, _data[\"data\"][\"purl\"]);\n        }\n        this.rewardState = _data[\"state\"];\n    },\n\n    onLoad () {\n        \n        for (let i = 0; i < this.btn_Nodes.length; i ++) {\n            this.btn_Nodes[i].active = false;\n        }\n        this.button.node.on(\"click\", this.buttonClick, this);\n        this.updateState();\n    },\n\n    buttonClick (){\n        \n      if (this.rewardState === 2) {\n          return;\n      }\n      if (this.rewardState === 0) { // 领取\n      //  TODO: 领取成功后 readyState = 2 刷新状态\n          if (!this.data) {\n              console.log(\"数据不存在\", \"userid\");\n              return;\n          }\n          console.log(\"领取\");\n          if (!this.isListen) {\n            tywx.NotificationCenter.listen(tywx.EventType.CMD_ELSWX, this._MsgRewardInfo, this);\n            this.isListen = true;\n          }\n          \n          tywx.MSG.addRewardDiamond(2, this.data.data.userId);\n      }\n      if (this.rewardState === 1) { // 邀请\n          console.log(\"邀请\");\n          tywx.ShareInterface.shareMsg({\n            type:els.ELS_SHRAE_TYPE.HOME_REWARD\n        });\n      }\n    },\n\n    updateState(){\n        for (let i = 0; i < this.btn_Nodes.length; i ++) {\n            if (i === this.rewardState) {\n                this.btn_Nodes[i].active = true;\n            }else  {\n                this.btn_Nodes[i].active = false;\n            }\n        }\n    },\n\n    setImage(_node, _imageUrl) {\n        if (_imageUrl.indexOf(\"https://wx.qlogo\") !== -1) {\n            _imageUrl = _imageUrl + \"?aaa=aaa.png\";\n        }\n        _node.node.setContentSize(123, 123);\n        cc.loader.load(_imageUrl, function (err, texture) {\n            if (!err) {\n                _node.getComponent('cc.Sprite').spriteFrame = new cc.SpriteFrame(texture);\n            }\n        });\n    },\n\n    _MsgRewardInfo(params){\n        if (params.result.action === tywx.EventType.CMD_ACTION_ADD_DIAMOND) {\n            if (params.result.status === 1 && params.result.reason === 2){// 邀请奖励领取成功\n                this.rewardState = 2;\n                this.updateState();\n                tywx.Util.wechatShowModal(\"领取成功 获得钻石x\"+params.result.count, false, \"确定\");\n            }\n        }\n    },\n\n    onDestroy(){\n        tywx.NotificationCenter.ignoreScope(this);\n    },\n});\n"]}