{"version":3,"sources":["OpenData.js"],"names":["cc","Class","extends","Component","properties","display","Sprite","start","tex","Texture2D","openDataContext","wx","getOpenDataContext","openDataCanvas","canvas","width","height","methodName","showTag","showQQHIn","openId","position","size","rotation","font","window","postMessage","method","data","showQQHWin","showBeyond","type","cleanOpenData","_updateSubDomainCanvas","texF","SpriteFrame","sharedCanvas","initWithElement","handleLoadedTexture","spriteFrame","update","onDestroy"],"mappings":";;;;;;AACAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;AAELC,gBAAY;AACRC,iBAASL,GAAGM;AADJ,KAFP;AAKLC,SALK,mBAKI;AACL,aAAKC,GAAL,GAAW,IAAIR,GAAGS,SAAP,EAAX;AACA,YAAIC,kBAAkBC,GAAGC,kBAAH,EAAtB;AACA,YAAIC,iBAAiBH,gBAAgBI,MAArC;AACAD,uBAAeE,KAAf,GAAwB,GAAxB;AACAF,uBAAeG,MAAf,GAAwB,IAAxB;AACA,aAAKC,UAAL,GAAkB,EAAlB;AACA,aAAKC,OAAL,GAAe,CAAf;AACH,KAbI;;;AAeL;AACAC,aAhBK,qBAgBKC,MAhBL,EAgBaC,QAhBb,EAgBuBC,IAhBvB,EAgB6BC,QAhB7B,EAgBuCC,IAhBvC,EAgB6C;AAC9C,YAAIP,aAAa,WAAjB;AACA,aAAKA,UAAL,GAAkBA,UAAlB;AACA,YAAG,CAACQ,OAAOd,EAAX,EAAc;AACX;AACA;AACF;AACD,YAAID,kBAAkBC,GAAGC,kBAAH,EAAtB;AACAF,wBAAgBgB,WAAhB,CAA4B;AACxBC,oBAASV,UADe;AAExBW,kBAAO;AACHR,wBAAQA,MADL;AAEHC,0BAAUA,QAFP;AAGHC,sBAAMA,IAHH;AAIHC,0BAAUA,QAJP;AAKHC,sBAAKA;AALF;AAFiB,SAA5B;AAUH,KAlCI;;;AAoCL;AACAK,cArCK,sBAqCMT,MArCN,EAqCc;AACf,YAAIH,aAAa,YAAjB;AACA,aAAKA,UAAL,GAAkBA,UAAlB;AACA,YAAG,CAACQ,OAAOd,EAAX,EAAc;AACX;AACA;AACF;AACD,YAAID,kBAAkBC,GAAGC,kBAAH,EAAtB;AACAF,wBAAgBgB,WAAhB,CAA4B;AACxBC,oBAASV,UADe;AAExBW,kBAAO;AACHR,wBAAOA;AADJ;AAFiB,SAA5B;AAMH,KAnDI;;;AAqDL;AACAU,cAtDK,sBAsDMC,IAtDN,EAsDY;AACb,YAAId,aAAa,YAAjB;AACA,aAAKA,UAAL,GAAkBA,UAAlB;AACA,YAAG,CAACQ,OAAOd,EAAX,EAAc;AACX;AACF;AACD,YAAID,kBAAkBC,GAAGC,kBAAH,EAAtB;AACAF,wBAAgBgB,WAAhB,CAA4B;AACxBC,oBAASV,UADe;AAExBW,kBAAK;AACDG,sBAAKA;AADJ;AAFmB,SAA5B;AAMH,KAnEI;AAqELC,iBArEK,2BAqEW;AACZ,YAAIf,aAAa,eAAjB;AACA,aAAKA,UAAL,GAAkBA,UAAlB;AACA,YAAG,CAACQ,OAAOd,EAAX,EAAc;AACX;AACA;AACF;AACD,YAAID,kBAAkBC,GAAGC,kBAAH,EAAtB;AACAF,wBAAgBgB,WAAhB,CAA4B;AACxBC,oBAASV;AADe,SAA5B;AAGH,KAhFI;;;AAkFL;AACAgB,0BAnFK,oCAmFqB;AACtB,YAAI,CAAC,KAAKzB,GAAV,EAAe;AACX;AACH;AACD,YAAI,CAAC,KAAK0B,IAAV,EAAgB;AACZ,iBAAKA,IAAL,GAAY,IAAIlC,GAAGmC,WAAP,CAAmB,KAAK3B,GAAxB,CAAZ;AACH;AACD,YAAIE,kBAAkBC,GAAGC,kBAAH,EAAtB;AACA,YAAIwB,eAAe1B,gBAAgBI,MAAnC;AACA,aAAKN,GAAL,CAAS6B,eAAT,CAAyBD,YAAzB;AACA,aAAK5B,GAAL,CAAS8B,mBAAT;AACA,aAAKjC,OAAL,CAAakC,WAAb,GAA2B,KAAKL,IAAhC;AACH,KA/FI;AAiGLM,UAjGK,oBAiGK;AACN,aAAKtB,OAAL;AACA,YAAI,KAAKA,OAAL,GAAe,EAAf,KAAsB,CAA1B,EAA6B;AACzB,iBAAKe,sBAAL;AACH;AACJ,KAtGI;AAwGLQ,aAxGK,uBAwGO;AACR,aAAKT,aAAL;AACH;AA1GI,CAAT","file":"OpenData.js","sourceRoot":"../../../../../assets/script/ui","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n    properties: {\n        display: cc.Sprite\n    },\n    start () {\n        this.tex = new cc.Texture2D();\n        let openDataContext = wx.getOpenDataContext();\n        let openDataCanvas = openDataContext.canvas;\n        openDataCanvas.width  = 720;\n        openDataCanvas.height = 1280;\n        this.methodName = \"\";\n        this.showTag = 0;\n    },\n\n    // 悄悄话进入\n    showQQHIn(openId, position, size, rotation, font) {\n        let methodName = \"drawQQHIn\";\n        this.methodName = methodName;\n        if(!window.wx){\n           //防止在浏览器中报错\n           return;\n        }\n        let openDataContext = wx.getOpenDataContext();\n        openDataContext.postMessage({\n            method : methodName,\n            data : {\n                openId: openId,\n                position: position,\n                size: size,\n                rotation: rotation,\n                font:font,\n            },\n        });\n    },\n\n    // 悄悄话胜利\n    showQQHWin(openId) {\n        let methodName = \"showQQHWin\";\n        this.methodName = methodName;\n        if(!window.wx){\n           //防止在浏览器中报错\n           return;\n        }\n        let openDataContext = wx.getOpenDataContext();\n        openDataContext.postMessage({\n            method : methodName,\n            data : {\n                openId:openId\n            }\n        });\n    },\n\n    // 超越好友\n    showBeyond(type) {\n        let methodName = \"showBeyond\";\n        this.methodName = methodName;\n        if(!window.wx){\n           return;\n        }\n        let openDataContext = wx.getOpenDataContext();\n        openDataContext.postMessage({\n            method : methodName,\n            data:{\n                type:type\n            }\n        });\n    },\n\n    cleanOpenData() {\n        let methodName = \"cleanOpenData\";\n        this.methodName = methodName;\n        if(!window.wx){\n           //防止在浏览器中报错\n           return;\n        }\n        let openDataContext = wx.getOpenDataContext();\n        openDataContext.postMessage({\n            method : methodName\n        });\n    },\n\n    // 刷新开放数据域的纹理\n    _updateSubDomainCanvas () {\n        if (!this.tex) {\n            return;\n        }\n        if (!this.texF) {\n            this.texF = new cc.SpriteFrame(this.tex);\n        }\n        var openDataContext = wx.getOpenDataContext();\n        var sharedCanvas = openDataContext.canvas;\n        this.tex.initWithElement(sharedCanvas);\n        this.tex.handleLoadedTexture();\n        this.display.spriteFrame = this.texF;\n    },\n\n    update () {\n        this.showTag ++;\n        if (this.showTag % 30 === 0) {\n            this._updateSubDomainCanvas();\n        }\n    },\n\n    onDestroy() {\n        this.cleanOpenData();\n    }\n\n});"]}