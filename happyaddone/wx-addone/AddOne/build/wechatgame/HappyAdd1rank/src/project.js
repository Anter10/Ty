require=function o(r,c,s){function l(t,e){if(!c[t]){if(!r[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(d)return d(t,!0);var a=new Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a}var i=c[t]={exports:{}};r[t][0].call(i.exports,function(e){return l(r[t][1][e]||e)},i,i.exports,o,r,c,s)}return c[t].exports}for(var d="function"==typeof require&&require,e=0;e<s.length;e++)l(s[e]);return l}({friendicon:[function(e,t,n){"use strict";cc._RF.push(t,"df1312uJO5DOpgdFArNGVZn","friendicon"),cc.Class({extends:cc.Component,properties:{friendmsd:cc.Node,nameLabel:cc.Label,scoreLabel:cc.Label,iconSprite:cc.Sprite},onLoad:function(){},start:function(){}}),cc._RF.pop()},{}],rankitem:[function(e,t,n){"use strict";cc._RF.push(t,"93486w69BJG5rxHNI3FISIF","rankitem");var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};cc.Class({extends:cc.Component,properties:{pmLabel:cc.Label,allPmicon:{default:[],type:cc.Sprite},imageIcon:cc.Sprite,nickLabel:cc.Label,scoreLabel:cc.Label},updateData:function(e){this.data=e,this.updateView(this.data)},updateView:function(e){console.log("更新数据 = "+JSON.stringify(e)),e.pm<3?(this.pmLabel.node.active=!1,this.allPmicon[e.pm].node.active=!0):this.pmLabel.string=e.pm+1,this.nickLabel.string=this.stringSlice(e.nickname,13),this.scoreLabel.string=null==e.KVDataList[0]?0:e.KVDataList[0].value+"分",this.createIcon(this.imageIcon,e.avatarUrl,500*(e.pm+1))},stringSlice:function(e,t){if(!e)return e;for(var n,a=0,i=0,o=0;o<e.length;o++){var r=e.charCodeAt(o);(i+=0<=r&&r<=128?1:2)<=t-2&&a++}return i<=t?n=e.slice(0):(n=e.slice(0,a),n+=".."),n},createIcon:function(n,e,t){var a=n;console.log("index = "+t),setTimeout(function(){try{var t=wx.createImage();t.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(t),e.handleLoadedTexture(),a.spriteFrame=new cc.SpriteFrame(e),console.log("加载失败___c1 "+(void 0===t?"undefined":i(t))+n._gycname)}catch(e){console.log("加载失败___v "+e),a.node.active=!1}},t.src=e}catch(e){console.log("加载失败____ddd "+e),a.node.active=!1}},t)},start:function(){}}),cc._RF.pop()},{}],ranklist:[function(e,t,n){"use strict";cc._RF.push(t,"280c3rsZJJKnZ9RqbALVwtK","ranklist");var a="x1",s=function(e,t,n){console.log(e)},h={},i=1,o=2,r=3,c=4,l=5,d=6;cc.Class({extends:cc.Component,properties:{gameranklist:cc.ScrollView,showloading:cc.Label,rankItem:cc.Prefab,gamerank:cc.Node,titleLabel:cc.Label,content:cc.Node,friendmsd:cc.Node,nameLabel:cc.Label,scoreLabel:cc.Label,iconSprite:cc.Sprite},start:function(){var t=this;wx.onMessage(function(e){t.showloading.node.active=!0,s("当前玩家给子域的数据 = "+JSON.stringify(e)),e.method==i?(t.titleLabel.string="  好友排行榜",t.getFriendData()):e.method==o?(t.titleLabel.string="群组排行榜",t.getGroupFriendData(e.shareTicket)):e.method==r?t.getUserInfoData():e.method==c?t.submitScore(e.score):e.method==l?(h.x=e.posx,h.y=e.posy,t.storeFriends(e.score,e.isrestart)):e.method==d&&t.hideUi(e.rank,e.friendicon)})},hideUi:function(e,t){this.gamerank.active=e,this.friendmsd.active=t},submitScore:function(t){var n=this;wx.getUserCloudStorage({keyList:[a],success:function(e){s("setUserCloudStorage"),n.showloading.node.active=!1,0!=e.KVDataList.length&&e.KVDataList[0].value>t||window.wx.setUserCloudStorage({KVDataList:[{key:a,value:""+t}],success:function(e){s("setUserCloudStorage")},fail:function(e){s("setUserCloudStorage")},complete:function(e){s("setUserCloudStorage")}})},fail:function(e){s("getUserCloudStorage")},complete:function(e){s("getUserCloudStorage")}})},getUserInfoData:function(){wx.getUserInfo({openIdList:["selfOpenId"],lang:"zh_CN",success:function(e){s(JSON.stringify(e));wx.getSharedCanvas().getContext("2d")},fail:function(e){s(JSON.stringify(arguments));wx.getSharedCanvas().getContext("2d")}})},getFriendData:function(e,t){var u=this,f=t,g=this,m=e;1==m?g.gamerank.active=!1:g.friendmsd.active=!1,wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){u.showloading.node.active=!1;var d=e.data[0];wx.getFriendCloudStorage({keyList:[a],success:function(e){var t=e.data;if(t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value}),1!=m){g.gamerank.active=!0,g.gameranklist.content.removeAllChildren();for(var n=20,a=0;a<t.length;a++){var i=t[a];0==(i.pm=a)&&(n=55);var o=cc.instantiate(u.rankItem);o.getComponent("rankitem").updateData(i),o.setPosition(0,-80*a-n),u.gameranklist.content.addChild(o,122)}if(t.length<=8)u.content.getComponent(cc.Layout).resizeMode=cc.Layout.ResizeMode.NONE}else if(1==m){for(var r=null,c=t.length-1;0<=c;c--){var s=t[c],l=null==s.KVDataList[0]?0:s.KVDataList[0].value;if(0<l-f&&d.avatarUrl!=s.avatarUrl){(r=s).score=l,s.avatarUrl;break}}h.x,h.y,g.friendmsd.active=!0,null!=r&&(g.friendmsd.active=!0,g.nameLabel.string=r.nickname,g.scoreLabel.string=r.score,g.createIcon(g.iconSprite,r.avatarUrl))}},fail:function(e){g.showloading.string="数据加载失败，请检测网络，谢谢。"}})},fail:function(e){g.showloading.string="数据加载失败，请检测网络，谢谢。"}})},setDataToLocalStorage:function(e,t){try{s("wx setStorage = "+wx.setStorage),wx&&wx.setStorage&&(window.wx.setStorage({key:e,data:t+""}),s("存储数据成功"+t))}catch(e){s("存储数据失败")}},storeFriends:function(e,t){1==t&&"",this.getFriendData(!0,e)},getGroupFriendData:function(e){var r=this,c=this,t=e;c.friendmsd.active=!1,c.gamerank.active=!0,wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){s("success",e.data);e.data[0];c.friendmsd.active=!1,wx.getGroupCloudStorage({shareTicket:t,keyList:[a],success:function(e){s("群组数据 = "),c.friendmsd.active=!1;var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value}),r.showloading.node.active=!1,c.gameranklist.content.removeAllChildren();var n=35;c.gamerank.active=!0;for(var a=0;a<t.length;a++){var i=t[a];i.pm=a;var o=cc.instantiate(r.rankItem);o.getComponent("rankitem").updateData(i),0==a&&(n=55),o.setPosition(0,-80*a-n),r.gameranklist.content.addChild(o,122)}t.length<=7&&(r.content.getComponent(cc.Layout).resizeMode=cc.Layout.ResizeMode.NONE)},fail:function(e){s("得到群组数据失败")}})},fail:function(e){}})},onLoad:function(){s("Hvj")},createIcon:function(n,a,e){var i=n;try{var o=wx.createImage();o.src=a,o.onload=function(e){try{var t=new cc.Texture2D;t.initWithElement(o),t.handleLoadedTexture(),i.spriteFrame=new cc.SpriteFrame(t),s(a+" ni/ "+n.node.width+" == "+t.width+" "+n.node.y)}catch(e){s("图片加载失败")}}}catch(e){}}}),cc._RF.pop()},{}]},{},["friendicon","rankitem","ranklist"]);