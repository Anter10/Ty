{"version":3,"sources":["ShareInterface.js"],"names":["tywx","ShareInterface","OnShareAppMessageInfo","ShareTimeStamp","IsWaitingCallback","setOnShareAppMessageInfo","title","imageUrl","sharePointId","shareSchemeId","getOnShareAppMessageInfo","getRandomOnShareAppMessageInfo","shareKeys","_key","PropagateInterface","_cachedShareConfig","push","length","randomIndex","Math","floor","random","sharePointKey","sharePointInfo","config","shareContent","sharePicUrl","share","successCallback","failCallback","extraInfo","IsWechatPlatform","BiLog","clickStat","clickStatEventType","clickStatEventTypeUserShare","query","UserInfo","userId","userName","Date","parse","wx","shareAppMessage","success","result","fail","complete","err","LOGE","JSON","stringify","share2","getTime","CurrentShareParams","console","log","shareBack","time_stack","wait_time","shareParams","ado","Configs","ShareLimit","min_time","max_time","onShareAppMessageInit","onShareAppMessage","shareTickets","groupMsgInfos"],"mappings":"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","file":"ShareInterface.js","sourceRoot":"../../../../../assets/Script/CommonFrame","sourcesContent":["/**\n * Created by xiaochuntian on 2018/5/3.\n */\n\ntywx.ShareInterface = {\n    OnShareAppMessageInfo: null,   //右上角转发对应的分享点信息\n    ShareTimeStamp: 0,\n    IsWaitingCallback: false,\n\n    /**\n     * 设置右上角\"转发\"对应的分享信息\n     * @param title\n     * @param imageUrl\n     * @param sharePointId\n     * @param shareSchemeId\n     */\n    setOnShareAppMessageInfo: function(title, imageUrl, sharePointId, shareSchemeId){\n        this.OnShareAppMessageInfo = {\n            title: title,\n            imageUrl: imageUrl,\n            sharePointId: sharePointId,\n            shareSchemeId: shareSchemeId\n        }\n    },\n\n    /**\n     * 获取右上角\"转发\"对应的分享信息\n     * @returns {null}\n     */\n    getOnShareAppMessageInfo: function() {\n        return this.OnShareAppMessageInfo;\n    },\n\n    /**\n     * 随机获取一个分享点作为\"转发\"对应的分享信息\n     * @returns {*}\n     */\n    getRandomOnShareAppMessageInfo: function() {\n        var shareKeys = [];\n\n        for(var _key in tywx.PropagateInterface._cachedShareConfig){\n            shareKeys.push(_key);\n        }\n        if(shareKeys && shareKeys.length > 0) {\n            var randomIndex = (Math.floor(Math.random()*10000))%shareKeys.length;\n            var sharePointKey = shareKeys[randomIndex];\n            var sharePointInfo = tywx.PropagateInterface._cachedShareConfig[sharePointKey];\n            if(sharePointInfo && sharePointInfo.length > 0) {\n                randomIndex = (Math.floor(Math.random()*10000))%sharePointInfo.length;\n                var config = {\n                    title: sharePointInfo[randomIndex].shareContent,\n                    imageUrl: sharePointInfo[randomIndex].sharePicUrl,\n                    sharePointId: sharePointInfo[randomIndex].sharePointId,\n                    shareSchemeId: sharePointInfo[randomIndex].shareSchemeId\n                }\n                return config;\n            }\n        }\n        return null;\n    },\n\n    /**\n     * 根据分享信息调用分享接口,并封装了必要的打点和处理\n     * @param title\n     * @param imageUrl\n     * @param sharePointId\n     * @param shareSchemeId\n     * @param successCallback\n     * @param failCallback\n     * @param extraInfo 额外信息\n     */\n    share: function(title, imageUrl, sharePointId, shareSchemeId, successCallback, failCallback, extraInfo) {\n        try {\n            if (tywx.IsWechatPlatform()) {\n                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare, [sharePointId, 1, shareSchemeId]);\n                let query = 'inviteCode=' + tywx.UserInfo.userId + '&sourceCode=' + sharePointId + \"&inviteName=\" + tywx.UserInfo.userName + \"&imageType=\" + shareSchemeId + \"&extraInfo=\" + (extraInfo ? extraInfo : ''); \n                tywx.ShareInterface.ShareTimeStamp = Date.parse(new Date());\n                wx.shareAppMessage({\n                    title: title,\n                    imageUrl: imageUrl,\n                    query: query,\n                    success: function (result) {\n                        //分享成功相关处理\n                        if (successCallback) {\n                            successCallback(result);\n                        }\n                        tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare, [sharePointId, 2, shareSchemeId]);\n                    },\n                    fail: function (result) {\n                        //分享失败相关处理\n                        if (failCallback) {\n                            failCallback(result);\n                        }\n                    },\n                    complete: function () {\n                    }\n                });\n            }\n        }\n        catch(err) {\n            tywx.LOGE(\"error:\", \"tywx.ShareInterface.share——\" + JSON.stringify(err));\n        }\n    },\n\n    share2: function(title, imageUrl, sharePointId, shareSchemeId, successCallback, failCallback, extraInfo) {\n        try {\n            if (tywx.IsWechatPlatform()) {\n                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare, [sharePointId, 1, shareSchemeId]);\n                let query = 'inviteCode=' + tywx.UserInfo.userId + '&sourceCode=' + sharePointId + \"&inviteName=\" + tywx.UserInfo.userName + \"&imageType=\" + shareSchemeId + \"&extraInfo=\" + (extraInfo ? extraInfo : ''); \n                tywx.ShareInterface.ShareTimeStamp = new Date().getTime();\n                tywx.ShareInterface.IsWaitingCallback = true;\n                tywx.ShareInterface.CurrentShareParams = {\n                    title: title,\n                    imageUrl: imageUrl,\n                    sharePointId: sharePointId,\n                    shareSchemeId: shareSchemeId,\n                    successCallback: successCallback,\n                    failCallback: failCallback,\n                    extraInfo: extraInfo\n                };\n                wx.shareAppMessage({\n                    title: title,\n                    imageUrl: imageUrl,\n                    query: query,\n                    success: function (result) {\n                        console.log(\"share success\");\n                        // //分享成功相关处理\n                        // if (successCallback) {\n                        //     successCallback(result);\n                        // }\n                        // tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare, [sharePointId, 2, shareSchemeId]);\n                    },\n                    fail: function (result) {\n                        console.log(\"share fail\");\n                        //分享失败相关处理\n                        // if (failCallback) {\n                        //     failCallback(result);\n                        // }\n                    },\n                    complete: function () {\n                        console.log(\"share complete\");\n                    }\n                });\n            }\n        }\n        catch(err) {\n            tywx.LOGE(\"error:\", \"tywx.ShareInterface.share——\" + JSON.stringify(err));\n        }\n    },\n    shareBack: function(){\n        let time_stack = new Date().getTime();\n        let wait_time = time_stack - tywx.ShareInterface.ShareTimeStamp;\n        let shareParams = tywx.ShareInterface.CurrentShareParams;\n        let [min_time, max_time] = tywx.ado.Configs.ShareLimit || [500, 2000];\n        if(shareParams){\n            if(wait_time >= min_time && wait_time <= max_time){\n                shareParams.successCallback && shareParams.successCallback(null);\n                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare, [shareParams.sharePointId, 2, shareParams.shareSchemeId]);\n           }\n           else{\n                shareParams.failCallback && shareParams.failCallback();   \n           }\n        }\n        tywx.ShareInterface.IsWaitingCallback = false;\n        tywx.ShareInterface.CurrentShareParams = null;\n    }\n};\n\ntywx.onShareAppMessageInit = function() {\n    try{\n        if(tywx.IsWechatPlatform()) {\n            wx.onShareAppMessage(function (result) {\n                /**\n                 * 获取转发信息,手动设置过则使用设置信息,否则随机获取一个分享点信息\n                 */\n                var config = tywx.ShareInterface.getOnShareAppMessageInfo();\n                if(config == null) {\n                    config = tywx.ShareInterface.getRandomOnShareAppMessageInfo();\n                }\n                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare,[config.sharePointId, 1, config.shareSchemeId]);\n                return {\n                    title: config.title,\n                    imageUrl : config.imageUrl,\n                    query : \"inviteCode=\"+tywx.UserInfo.userId+\"&sourceCode=\"+config.sharePointId+\"&inviteName=\"+tywx.UserInfo.userName+\"&imageType=\"+config.shareSchemeId,\n                    success : function (shareTickets,groupMsgInfos) {\n                        tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare,[config.sharePointId, 2, config.shareSchemeId]);\n                    },\n                    fail : function () {\n\n                    },\n                    complete : function () {\n                    }\n                }\n            });\n        };\n    }\n    catch(err) {\n        tywx.LOGE(\"error:\", \"tywx.ShareInterface.share——\" + JSON.stringify(err));\n    }\n};\n\ntywx.onShareAppMessageInit();"]}