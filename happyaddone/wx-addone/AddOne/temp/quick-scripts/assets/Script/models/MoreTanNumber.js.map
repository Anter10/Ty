{"version":3,"sources":["MoreTanNumber.js"],"names":["cc","Class","extends","Component","properties","showNumber","type","Label","default","shareNode","Node","numberBj","rootNode","yellowNumberLabel","curhcScoreLabel","curgzupNumberLabel","curgzItemNameLabel","showdbSprite","Sprite","backSprite","spriteFrames","SpriteFrame","setShowNumber","shownum","score","name","string","setDbByIndex","storePhoto","hadstorephotonumber","tywx","ado","Utils","showWXToast","contentsize","width","height","console","log","JSON","stringify","game","canvas","cw","ch","is_ipx","ds","size","dcs","rate_width","rate_height","d_x","d_y","rate_x","rate_y","w","h","x","y","node","position","self","toTempFilePath","destWidth","destHeight","quality","fileType","success","res","saveImage2PhoneByUrl","tempFilePath","storesuccall","fail","playAni","uiAni","close","showWXBanner","active","clossc","setCloseCall","init","commonScaleIn","onLoad","getComponent","setShareConfig","Constants","ShareConfig","FREE_GIFT_SHARE","on","event","btnRefreshBgPhotoCallback","getShareComponent","setStoreSucCallBack","succall","num","spriteFrame","photo_urls","config","CDNImages","MergeBigNumPhotos","showPicIndex","length","pngurl","SystemInfo","cdnPath","sprite","getChildByName","refreshSpriteByUrl"],"mappings":"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","file":"MoreTanNumber.js","sourceRoot":"../../../../../assets/Script/models","sourcesContent":[" cc.Class({\n     extends: cc.Component,\n\n     properties: {\n         showNumber: {\n             type: cc.Label,\n             default: null,\n         },\n         shareNode: {\n             type: cc.Node,\n             default: null,\n         },\n         numberBj: {\n             type: cc.Node,\n             default: null,\n         },\n        rootNode: {\n              type: cc.Node,\n              default: null,\n         },\n         yellowNumberLabel: {\n             default: null,\n             type: cc.Label\n         },\n\n         curhcScoreLabel: {\n             default: null,\n             type: cc.Label\n         },\n\n        curgzupNumberLabel: {\n            default: null,\n            type: cc.Label\n        },\n\n        curgzItemNameLabel: {\n            default: null,\n            type: cc.Label\n        },\n\n         showdbSprite: {\n             type: cc.Sprite,\n             default: null,\n         },\n         backSprite: {\n             type: cc.Sprite,\n             default: null,\n         },\n\n         spriteFrames: {\n             default: [],\n             type: cc.SpriteFrame,\n         }\n\n     },\n    \n     /**\n      * @description 刷新当前的试图\n      * @param {Number} shownum 当前合出来的偶数\n      * @param {Number} score 玩家当前的得分\n      * @param {String} 道具名称\n      */\n     setShowNumber: function (shownum, score, name) {\n         this.showNumber.string = shownum;\n         this.setDbByIndex(shownum, score, name);\n     },\n\n     /**\n      * @description 保存照片\n      */\n     storePhoto: function () {\n        if(this.hadstorephotonumber){\n           tywx.ado.Utils.showWXToast(\"已经保存成功\",500);\n           return;\n        }\n       \n        // this.hadstorephotonumber = true;\n        var contentsize = {width: this.numberBj.width, height: this.numberBj.height}\n        console.log(\"contentsize  + \" + JSON.stringify(contentsize));\n        let [cw,ch]                  = [cc.game.canvas.width, cc.game.canvas.height];\n        let is_ipx                   = ch / cw >= 1.9;                                                 // * 是否是2:1屏幕\n        let ds                       = cc.size(720, 1280);\n        let dcs = cc.size(contentsize.width, contentsize.height);\n        let [rate_width,rate_height] = [dcs.width / ds.width, dcs.height / ds.height];\n        let [d_x, d_y]               = [(ds.width - dcs.width) / 2, (ds.height - dcs.height) / 2 - 102];\n        let [rate_x,rate_y]          = [d_x / ds.width,d_y / ds.height];\n\n        let w = cw * rate_width;\n        let h = is_ipx ? w * (dcs.height / dcs.width) : ch * rate_height;\n        let x = cw * rate_x;\n        let y = is_ipx ?  (ch - h) / 2 - this.showdbSprite.node.position.y: ch * rate_y ;\n        var self = this;\n        canvas.toTempFilePath({\n            x: x,\n            y: y,\n            width: w, \n            height: h,\n            destWidth: contentsize.width,\n            destHeight: contentsize.height,\n            quality:1,\n            fileType:\"jpg\",\n            success: function success(res) {\n                //console.log(res);\n                tywx.ado.Utils.saveImage2PhoneByUrl(res.tempFilePath,function(){\n                    self.hadstorephotonumber = true;\n                    self.storesuccall && self.storesuccall();\n                    tywx.ado.Utils.showWXToast(\"领取成功\",1000);\n                }, function(){\n                    self.hadstorephotonumber = false;\n                    tywx.ado.Utils.showWXToast(\"保存图片失败\"); \n                });\n            },\n            fail: function fail(res) {\n                self.hadstorephotonumber = false;\n                tywx.ado.Utils.showWXToast(\"保存图片失败\"); \n            }\n        });\n     },\n\n    \n     /**\n      * @description 播放当前界面的动画\n      */\n     playAni: function () {\n         //  this.node.getComponent(cc.Animation).play(\"huode1\");\n         this.uiAni();\n     },\n     \n     /**\n      * @description 关闭当前的界面\n      */\n     close: function () {\n        tywx.ado.Utils.showWXBanner();\n         this.node.active = false;\n         this.hadstorephotonumber = false;\n         if (this.clossc) {\n             this.clossc();\n         }\n     },\n     \n     /**\n      * @description 设置关闭后的回调函数\n      * @param {Function} clossc 关闭回调函数\n      */\n     setCloseCall: function (clossc) {\n         this.clossc = clossc;\n     },\n    \n     /**\n      * @description 手动初始化已经存储图片的开关\n      */\n     init:function(){\n        this.hadstorephotonumber = false;\n     },\n     \n     /**\n      * @description 播放界面通用动画\n      */\n     uiAni:function(){\n         tywx.ado.Utils.commonScaleIn(this.rootNode);\n     },\n    \n   \n    /**\n      * @description 页面加载完成后的逻辑处理\n      */\n     onLoad() {\n         this.hadstorephotonumber = false;\n         // 设置分享点\n         this.shareNode.getComponent(\"ShareButton\").setShareConfig(tywx.ado.Constants.ShareConfig.FREE_GIFT_SHARE);\n         this.backSprite.node.on('touchstart', function (event) {\n             return true;\n         });\n         this.btnRefreshBgPhotoCallback();\n     },\n    \n     /**\n      * @description 得到当前界面的分享按钮的脚本组件\n      */\n     getShareComponent: function () {\n         return this.shareNode.getComponent(\"ShareButton\");\n     },\n     \n      \n     \n     /**\n      * @description 设置当前保存图片成功后的回调函数\n      * @param {Function} succall 保存图片成功的回调函数\n      */\n     setStoreSucCallBack: function(succall){\n         this.storesuccall = succall;\n     },\n\n     /**\n      * @description 刷新当前页面的显示 保罗合出的最大数 和 当前得分 以及底板的显示 和当前得到的道具名称\n      * @param {Number} num 当前合出的最大数\n      * @param {Number} score 当前玩家的得分\n      * @param {Number} name 当前道具的名称\n      */\n     setDbByIndex: function (num, score, name) {\n         if (num == 8) {\n             this.showdbSprite.spriteFrame = this.spriteFrames[0];\n         } else if (num == 9) {\n             this.showdbSprite.spriteFrame = this.spriteFrames[1];\n         } else {\n             this.showdbSprite.spriteFrame = this.spriteFrames[2];\n         }\n         this.yellowNumberLabel.string = num;\n         this.curhcScoreLabel.string = score;\n         this.curgzupNumberLabel.string = num;\n         this.curgzItemNameLabel.string = name;\n     },\n\n     btnRefreshBgPhotoCallback(){\n        let photo_urls = tywx.config.CDNImages.MergeBigNumPhotos;\n        if (!this.showPicIndex || this.showPicIndex > (photo_urls.length - 1)) {\n            this.showPicIndex = 0;\n        }\n        let pngurl = tywx.SystemInfo.cdnPath + 'share_pyq/addone/' +\n            photo_urls[this.showPicIndex];\n        console.log(\"cdnpngurl = \" + pngurl);\n        let sprite = this.rootNode.getChildByName('numberbj1').getComponent(cc.Sprite);\n        tywx.ado.Utils.refreshSpriteByUrl(sprite, pngurl);\n        this.showPicIndex = this.showPicIndex + 1;\n     }\n\n\n\n });"]}