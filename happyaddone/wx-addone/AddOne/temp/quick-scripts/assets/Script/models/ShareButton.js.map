{"version":3,"sources":["ShareButton.js"],"names":["cc","Class","extends","Component","properties","onLoad","data","start","setShareData","setShareConfig","config","shareConfig","setSuccessCall","successCall","successCallBack","setReactCall","reactcall","setErrorCall","errorCall","errorCallBack","setShareGroupCall","sgroupCall","shareGroupCallBack","shareMiniApp","self","tywx","IsWechatPlatform","window","wx","showShareMenu","withShareTicket","msg","ado","Utils","getRandomShareConfigByShareTag","shareContent","sharePicUrl","sharePointId","shareSchemeId","ShareInterface","share","res","LOGE","JSON","stringify","shareTickets","undefined","length","Constants","ShareConfig","RANK_SHARE","share2GroupByTicket","showWXModal"],"mappings":"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","file":"ShareButton.js","sourceRoot":"../../../../../assets/Script/models","sourcesContent":[" /*\n    游戏分享prefab\n    游戏的分享操作的主要逻辑在这个module里面编写\n    created by gyc on 2018-08-08.\n*/\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n      \n    },\n\n      /*\n        调用: 场景加载完成后的回调\n        功能: 场景加载完成后的一些UI逻辑处理\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 系统自带\n    */\n    onLoad () {\n        this.data = {};\n    },\n    /*\n        调用: 组件开始调用的时候调用\n        功能: 组件开始调用的时候的逻辑处理\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 系统自带\n    */\n    start () {\n\n    },\n    \n    /*\n        调用: 使用此model分享功能的时候 手动调用刷新分享的数据\n        功能: 设置即将要分享的数据\n        参数: [\n            data: 分享的数据\n        ]\n        返回值:[\n            无\n        ]\n        思路: 系统自带\n    */\n    setShareData:function(data){\n        this.data = data;\n    },\n    /**\n     * @description 设置分享配置\n     * @author lu ning\n     * @date 2018-08-23\n     * @param {Array<any>} config config[0]=tag;config[1]=是否强制分享到群,boolean\n     */\n    setShareConfig(config){\n        this.shareConfig = config;\n    },\n\n        /*\n        调用: 使用此model分享功能的时候 \n        功能: 手动设置分享成功后的回调函数\n        参数: [\n            successCall: 分享成功后的回调方法 类型Function\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n   setSuccessCall: function(successCall){\n        this.successCallBack = successCall;\n   },\n\n\n    /*\n        调用: 使用此model分享功能的时候 \n        功能: 手动设置分享成功后的回调函数\n        参数: [\n            successCall: 分享成功后的回调方法 类型Function\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n    setReactCall: function(reactcall){\n        this.reactcall = reactcall;\n    },\n\n     /*\n        调用: 使用此model分享功能的时候 \n        功能: 手动设置分享失败后的回调函数\n        参数: [\n            errorCall: 分享失败后的回调方法 类型Function\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n    setErrorCall: function(errorCall){\n        this.errorCallBack = errorCall;\n    },\n\n    /*\n        调用: 使用此model分享功能的时候 \n        功能: 手动设置分享失败后的回调函数\n        参数: [\n            errorCall: 分享失败后的回调方法 类型Function\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n    setShareGroupCall: function(sgroupCall){\n        this.shareGroupCallBack = sgroupCall;\n    },\n    \n\n\n    /*\n        调用: 使用此model分享功能的时候 \n        功能: 给好友或者群分享小程序的相关信息\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n    shareMiniApp:function(){\n        var self = this;\n        if(this.reactcall){\n           self.successCallBack(this);\n        }else{\n            if(tywx.IsWechatPlatform()){\n                window.wx.showShareMenu({withShareTicket: true});\n                let msg = tywx.ado.Utils.getRandomShareConfigByShareTag(this.shareConfig[0]);\n                if(!msg){\n                    msg = {};\n                    msg.shareContent = \"你知道\" + \"1 吗？\";\n                    msg.sharePicUrl = \"https://marketqn.nalrer.cn/teris/share_image/jiayi/jy03.jpg\";\n                    msg.sharePointId = \"766\";\n                    msg.shareSchemeId = \"1155\";\n                }\n                if(msg){\n                    tywx.ShareInterface.share(\n                        msg.shareContent,\n                        msg.sharePicUrl,\n                        msg.sharePointId,\n                        msg.shareSchemeId,\n                        (res) => {\n                            tywx.LOGE(\"分享成功后的数据\"+JSON.stringify(res));\n                            // * is share to group\n                            if(self.shareConfig && self.shareConfig[1]){\n                                // * froce share to group\n                                if (res.shareTickets !== undefined && res.shareTickets.length > 0) {\n                                    if(self.shareConfig[0] === tywx.ado.Constants.ShareConfig.RANK_SHARE[0]){\n                                        self.shareGroupCallBack && self.shareGroupCallBack(res);                                                \n                                    }\n                                    else{\n                                        tywx.ado.Utils.share2GroupByTicket(\n                                            self.shareConfig[0], \n                                            res, \n                                            ()=>{ // * success callback\n                                                self.shareGroupCallBack && self.shareGroupCallBack(res);\n                                            },\n                                            ()=>{ // * failed callback\n                                                tywx.ado.Utils.showWXModal('请分享到不同群');\n                                                self.errorCallBack && self.errorCallBack(null);                                           \n                                            }\n                                        );\n                                    }\n                                }\n                                else{\n                                    // * failed\n                                    tywx.ado.Utils.showWXModal('请分享到群');\n                                    self.errorCallBack && self.errorCallBack(null);\n                                }\n                            }\n                            else{\n                                // * success\n                                self.successCallBack && self.successCallBack(res);\n                            }                          \n                         \n                        },\n                        function(data){\n                            tywx.LOGE(\"分享成功后的数2据\"+JSON.stringify(data));\n                            self.errorCallBack && self.errorCallBack(data);\n                        }\n                    );\n               }\n           }\n        }\n    }\n    // update (dt) {},\n});\n"]}