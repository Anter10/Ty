{"version":3,"sources":["LuckBox.js"],"names":["cc","Class","extends","Component","properties","luckboard","default","type","Node","luckitem","Prefab","luckitems","allframe","SpriteFrame","mflqBtn","hideLabel","Label","showLabel","close","tywx","ado","Utils","showWXBanner","node","active","lqCall","toggleChecked","toggle","isChecked","string","getComponent","setShareConfig","Constants","ShareConfig","GIFT_GIFT_BOX_SHARE","setButtonCallType","GIFT_GIFT_SHARE_BOX_SHARE","onLoad","allitem","GameCenterConfig","items","ti","length","item","instantiate","itemsceipt","setParent","setItem","selectitem","parent","push","allluckitems","row","column","bottom","padingleft","margin","width","self","mflq","config","auditing","setReactCall","setSuccessCall","gamecenter","giveItems","produceItem","setShareGroupCall","init","select","unselected","hideOtherSelected","selectItem","itemindex","tdata","getData","id","itemIndex","data","isSelected","produceitem","name","num"],"mappings":"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","file":"LuckBox.js","sourceRoot":"../../../../../assets/Script/models","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        luckboard: {\n            default: null,\n            type: cc.Node,\n        },\n        luckitem: {\n            default: null,\n            type: cc.Prefab,\n        },\n        luckitems: {\n            default: [],\n            type: cc.Node,\n        },\n        allframe: {\n            default: [],\n            type: cc.SpriteFrame,\n        },\n        mflqBtn: {\n            default: null,\n            type: cc.Node,\n        },\n        hideLabel: {\n            default: null,\n            type: cc.Label,\n        },\n        showLabel: {\n            default: null,\n            type: cc.Label,\n        }\n\n    },\n\n\n    close: function () {\n        // this.luckitems[0].getComponent(\"luckitem\").selected();\n        tywx.ado.Utils.showWXBanner();\n        this.node.active = false;\n    },\n\n    lqCall: function () {\n\n    },\n\n    /**\n     * @description 复选框点击回调\n     * @param {Object} toggle 复选框本身\n     */\n    toggleChecked: function (toggle) {\n        if (toggle.isChecked) {\n            this.hideLabel.string = \"看视频领取\";\n            this.showLabel.string = \"看视频领取\";\n            this.mflqBtn.getComponent(\"ShareButton\").setShareConfig(tywx.ado.Constants.ShareConfig.GIFT_GIFT_BOX_SHARE);\n            this.mflqBtn.getComponent(\"ShareButton\").setButtonCallType(2);\n        } else {\n            this.hideLabel.string = \"分享领取\";\n            this.showLabel.string = \"分享领取\";\n            this.mflqBtn.getComponent(\"ShareButton\").setShareConfig(tywx.ado.Constants.ShareConfig.GIFT_GIFT_SHARE_BOX_SHARE);\n            this.mflqBtn.getComponent(\"ShareButton\").setButtonCallType(1);\n        }\n    },\n\n    onLoad() {\n        // 显示当前的所有道具\n        var allitem = tywx.ado.Constants.GameCenterConfig.allitem;\n        var items = [];\n        for (var ti = 0; ti < allitem.length; ti++) {\n            var item = cc.instantiate(this.luckitem);\n            let itemsceipt = item.getComponent(\"luckitem\");\n            itemsceipt.setParent(this);\n            itemsceipt.setItem(allitem[ti], this.allframe[ti]);\n            if (ti == 0) {\n                this.selectitem = itemsceipt;\n            }\n            item.parent = this.luckitems[ti];\n            // if (ti < allitem.length - 1){\n            //     itemsceipt.select();\n            // }\n            items.push(item);\n        }\n       \n        this.allluckitems = items;\n\n        var [row, column, bottom, padingleft, margin, width] = [0, 0, 120, 60, 80, 162];\n\n        // this.selectitem.select();\n\n        var self = this;\n        // 设置免费领取的回调\n        let mflq = this.mflqBtn.getComponent(\"ShareButton\");\n        if (tywx.config.auditing == true) {\n            mflq.setReactCall(true);\n        } else {\n            mflq.setReactCall(false);\n        }\n        mflq.setSuccessCall(function () {\n            tywx.gamecenter.giveItems(false, self.produceItem());\n            self.close();\n        });\n        mflq.setShareGroupCall(function () {\n            tywx.gamecenter.giveItems(false, self.produceItem());\n            self.close();\n        });\n        this.init();\n    },\n\n    /** \n     * @description 初始化\n     */\n    init: function () {\n         for (var ti = 0; ti < this.allluckitems.length; ti++) {\n             let itemsceipt = this.allluckitems[ti].getComponent(\"luckitem\");\n             if (ti < (this.allluckitems.length - 1)) {\n                 itemsceipt.select();\n             }else{\n                 itemsceipt.unselected();\n             }\n        }\n        this.hideLabel.string = \"分享领取\";\n        this.showLabel.string = \"分享领取\";\n        this.mflqBtn.getComponent(\"ShareButton\").setShareConfig(tywx.ado.Constants.ShareConfig.GIFT_GIFT_SHARE_BOX_SHARE);\n        this.mflqBtn.getComponent(\"ShareButton\").setButtonCallType(1);\n    },\n\n    /**\n     * @description 点击道具回调\n     */\n    hideOtherSelected: function (selectItem) {\n        for (var itemindex = 0; itemindex < this.allluckitems.length; itemindex++) {\n            var item = this.allluckitems[itemindex];\n            let itemsceipt = item.getComponent(\"luckitem\");\n            var tdata = itemsceipt.getData();\n            // console.log(\"tdata = \"+JSON.stringify(tdata));\n            if (tdata != \"undefined\" && tdata.id != selectItem.getData().id) {\n                itemsceipt.select();\n            }\n        }\n        selectItem.unselected();\n        this.selectitem = selectItem;\n    },\n\n    /** \n     * @description 成功后所给道具逻辑\n     */\n    produceItem: function () {\n        var allitem = [];\n        for (var itemIndex = 0; itemIndex < this.allluckitems.length; itemIndex++) {\n            var item = this.allluckitems[itemIndex];\n            let itemsceipt = item.getComponent(\"luckitem\");\n            var data = itemsceipt.getData();\n            if (itemsceipt.isSelected()) {\n                var produceitem = {};\n                produceitem.id = data.id;\n                produceitem.name = data.name;\n                produceitem.num = 1;\n                allitem.push(produceitem);\n            }\n        }\n        return allitem;\n    }\n\n});"]}