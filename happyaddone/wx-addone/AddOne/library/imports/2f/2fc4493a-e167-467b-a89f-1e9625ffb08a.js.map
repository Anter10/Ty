{"version":3,"sources":["../../../../../assets/Script/models/assets/Script/models/AudioManager.js"],"names":["_instance","LOCAL_MUTE_KEY","AudioManager","bgMusicContext","isMute","bgMusicCache","Map","soundsCache","tywx","ado","Utils","loadItem","sounds_config","Configs","SOUNDS","music_config","default","MUSICS","sound_keys","Reflect","ownKeys","music_keys","self","forEach","has","sound_key","addSound2CacheByUrl","music_key","addMusic2CacheByUrl","url","is_play","tmp_sound_context","wx","createInnerAudioContext","src","autoPlay","loop","volume","set","play","e","cc","error","tmp_music_context","stopMusic","get","tmp_context","stop","is_mute","saveItem","module","exports","getInstance"],"mappings":"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","file":"AudioManager.js","sourceRoot":"../../../../../assets/Script/models","sourcesContent":["/**\n * @file: AudioManager.js\n * @description: 声音管理器\n * @author: lu ning\n * @email: luning@tuyoogame.com\n * @date: 2018-08-22\n*/\nlet _instance = null;  //! 单例，私有\nlet LOCAL_MUTE_KEY = 'ado_mute';\nlet AudioManager = class{\n\n    /**\n     * @description\n     * @author lu ning\n     * @date 2018-08-22\n     * @static\n     * @returns\n     */\n    static getInstance(){\n        if(!_instance) _instance = new AudioManager();\n        return _instance;\n    }\n    constructor(){\n        this.bgMusicContext = null;\n        this.isMute = false; //* 是否静音\n        this.bgMusicCache = new Map();\n        this.soundsCache = new Map();\n\n        this.isMute = tywx.ado.Utils.loadItem(LOCAL_MUTE_KEY,false);\n    }\n    /**\n     * @description 资源预加载\n     * @author lu ning\n     * @date 2018-08-23\n     */\n    loadAudioRes(){\n        let sounds_config = tywx.ado.Configs.SOUNDS;\n        let music_config = tywx.ado.Configs.default.MUSICS;\n        let sound_keys = Reflect.ownKeys(sounds_config);\n        let music_keys = Reflect.ownKeys(music_config);\n        let self = this;\n        sound_keys.forEach(sound_key=>{\n            if(!self.soundsCache.has(sounds_config[sound_key])){\n                self.addSound2CacheByUrl(sounds_config[sound_key]);\n            }\n        });\n        music_keys.forEach(music_key=>{\n            if(!self.bgMusicCache.has(music_config[music_key])){\n                self.addMusic2CacheByUrl(music_config[music_key]);\n            }\n        });\n    }\n    /**\n     * @description 根据url添加声音资源到缓存池\n     * @author lu ning\n     * @date 2018-08-23\n     * @param {String} url 路径\n     * @param {boolean} [is_play=false] 是否播放\n     */\n    addSound2CacheByUrl(url, is_play = false){\n        try{\n            let tmp_sound_context = wx.createInnerAudioContext();\n            tmp_sound_context.src = url;\n            tmp_sound_context.autoPlay = false;\n            tmp_sound_context.loop = false;\n            tmp_sound_context.volume = 1.0;\n            this.soundsCache.set(url,tmp_sound_context);\n            is_play && tmp_sound_context.play();\n        }catch(e){\n            cc.error(`addSound2CacheByUrl error ${url}`);\n        }\n    }\n    /**\n     * @description 添加背景音乐到缓存池\n     * @author lu ning\n     * @date 2018-08-23\n     * @param {String} url 路径\n     * @param {boolean} [is_play=false] 是否播放\n     */\n    addMusic2CacheByUrl(url, is_play = false){\n        try{\n            let tmp_music_context = wx.createInnerAudioContext();\n            tmp_music_context.src = url;\n            tmp_music_context.autoPlay = false;\n            tmp_music_context.loop = true; //* 所有的背景音乐都默认循环\n            tmp_music_context.volume = 1.0;\n            this.bgMusicCache.set(url, tmp_music_context);\n            if(is_play){\n                tmp_music_context.play();\n                this.bgMusicContext = tmp_music_context;\n            }\n        }\n        catch(e){\n            cc.error(`addMusic2CacheByUrl error ${url}`);\n        }\n    }\n    /**\n     * * 播放背景音乐 \n     *\n     * @param {String} url 背景音乐url\n     * @param {boolean} [loop=true] 是否循环 废弃\n     * @param {number} [valume=1.0] 音量 废弃\n     */\n    playMusic(url, loop = true, volume = 1.0){\n        this.stopMusic();\n        if(this.isMute) return; //! 静音\n        if(this.bgMusicCache.has(url)){\n            this.bgMusicContext = this.bgMusicCache.get(url);\n            this.bgMusicContext.play();\n        }\n        else{\n            this.addMusic2CacheByUrl(url, true);\n        }\n    }\n    /**\n     * @description 播放声效\n     * @author lu ning\n     * @date 2018-08-23\n     * @param {String} url\n     */\n    playSound(url){\n        if (this.isMute) return; //! 静音\n        if(this.soundsCache.has(url)){\n            let tmp_context = this.soundsCache.get(url);\n            tmp_context.play();\n        }\n        else{\n            this.addSound2CacheByUrl(url, true);\n        }\n    }\n    /**\n     * * 停止播放背景音乐\n     *\n     */\n    stopMusic(){\n        if(this.bgMusicContext){\n            this.bgMusicContext.stop();\n        }\n        this.bgMusicContext = null;\n    }\n    setIsMute(is_mute){\n        this.isMute = is_mute;\n        tywx.ado.Utils.saveItem(LOCAL_MUTE_KEY,this.isMute,false);\n    }\n    getIsMute(){ return this.isMute;}\n\n};\n\nmodule.exports = AudioManager.getInstance();\n"]}