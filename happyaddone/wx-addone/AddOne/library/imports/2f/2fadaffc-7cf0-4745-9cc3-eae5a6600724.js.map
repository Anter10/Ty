{"version":3,"sources":["../../../../../assets/Script/models/assets/Script/models/ShareButton.js"],"names":["cc","Class","extends","Component","properties","onLoad","data","start","setShareData","setShareConfig","config","shareConfig","setSuccessCall","successCall","successCallBack","setReactCall","reactcall","setErrorCall","errorCall","errorCallBack","setShareGroupCall","sgroupCall","shareGroupCallBack","showWXVideo","self","tywx","IsWechatPlatform","param","success","res","fail","ado","Utils","showWXModal","error_callback","Constants","ShareConfig","GIFT_GIFT_BOX_SHARE","RECOVER_GAME_SHARE","content","end_str","showErrorGfitPop","shareMiniApp","window","wx","showShareMenu","withShareTicket","msg","getRandomShareConfigByShareTag","shareContent","sharePicUrl","sharePointId","shareSchemeId","ShareInterface","share","LOGE","JSON","stringify","shareTickets","undefined","length","RANK_SHARE","share2GroupByTicket"],"mappings":"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","file":"ShareButton.js","sourceRoot":"../../../../../assets/Script/models","sourcesContent":[" /*\n    游戏分享prefab\n    游戏的分享操作的主要逻辑在这个module里面编写\n    created by gyc on 2018-08-08.\n*/\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n      \n    },\n\n      /*\n        调用: 场景加载完成后的回调\n        功能: 场景加载完成后的一些UI逻辑处理\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 系统自带\n    */\n    onLoad () {\n        this.data = {};\n    },\n    /*\n        调用: 组件开始调用的时候调用\n        功能: 组件开始调用的时候的逻辑处理\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 系统自带\n    */\n    start () {\n\n    },\n    \n    /*\n        调用: 使用此model分享功能的时候 手动调用刷新分享的数据\n        功能: 设置即将要分享的数据\n        参数: [\n            data: 分享的数据\n        ]\n        返回值:[\n            无\n        ]\n        思路: 系统自带\n    */\n    setShareData:function(data){\n        this.data = data;\n    },\n    /**\n     * @description 设置分享配置\n     * @author lu ning\n     * @date 2018-08-23\n     * @param {Array<any>} config config[0]=tag;config[1]=是否强制分享到群,boolean\n     */\n    setShareConfig(config){\n        this.shareConfig = config;\n    },\n\n        /*\n        调用: 使用此model分享功能的时候 \n        功能: 手动设置分享成功后的回调函数\n        参数: [\n            successCall: 分享成功后的回调方法 类型Function\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n   setSuccessCall: function(successCall){\n        this.successCallBack = successCall;\n   },\n\n\n    /*\n        调用: 使用此model分享功能的时候 \n        功能: 手动设置分享成功后的回调函数\n        参数: [\n            successCall: 分享成功后的回调方法 类型Function\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n    setReactCall: function(reactcall){\n        this.reactcall = reactcall;\n    },\n\n     /*\n        调用: 使用此model分享功能的时候 \n        功能: 手动设置分享失败后的回调函数\n        参数: [\n            errorCall: 分享失败后的回调方法 类型Function\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n    setErrorCall: function(errorCall){\n        this.errorCallBack = errorCall;\n    },\n\n    /*\n        调用: 使用此model分享功能的时候 \n        功能: 手动设置分享失败后的回调函数\n        参数: [\n            errorCall: 分享失败后的回调方法 类型Function\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n    setShareGroupCall: function(sgroupCall){\n        this.shareGroupCallBack = sgroupCall;\n    },\n    \n    \n    /**\n     * @description 播放微信视频广告\n     */\n    showWXVideo: function(){\n        var self = this;\n        if (this.reactcall) {\n            self.successCallBack(this);\n        } else {\n            if (tywx.IsWechatPlatform()) {\n\n                var param = {\n                    success:function(res){\n                         self.shareGroupCallBack && self.shareGroupCallBack(res);\n                    },\n                    fail: function (res) {\n                         tywx.ado.Utils.showWXModal('观看视频失败');\n                         self.errorCallBack && self.errorCallBack(null);\n                    },\n                    error_callback: ()=>{\n                        if(self.shareConfig === tywx.ado.Constants.ShareConfig.GIFT_GIFT_BOX_SHARE\n                            || self.shareConfig === tywx.ado.Constants.ShareConfig.RECOVER_GAME_SHARE)\n                        {\n                            let content = \n                                self.shareConfig === tywx.ado.Constants.ShareConfig.RECOVER_GAME_SHARE \n                                ? '免费复活机会' : '如意宝箱';\n                            let end_str = self.shareConfig === tywx.ado.Constants.ShareConfig.RECOVER_GAME_SHARE \n                            ? '一次' : '一个';\n                            content = `<color=#ffffff>赠送</c><color=#ff0000>${content}</color><color=#ffffff>${end_str}</c>`;\n                            tywx.ado.Utils.showErrorGfitPop(()=>{\n                                self.shareGroupCallBack && self.shareGroupCallBack(null);\n                            },content);\n                        }\n                    }\n                }\n                tywx.ado.Utils.showWXVideo(param);\n            }\n        }\n    },\n\n\n    /*\n        调用: 使用此model分享功能的时候 \n        功能: 给好友或者群分享小程序的相关信息\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n    shareMiniApp:function(){\n        var self = this;\n        if(this.reactcall){\n           self.successCallBack(this);\n        }else{\n            if(tywx.IsWechatPlatform()){\n                window.wx.showShareMenu({withShareTicket: true});\n                let msg = tywx.ado.Utils.getRandomShareConfigByShareTag(this.shareConfig[0]);\n                if(!msg){\n                    msg = {};\n                    msg.shareContent = \"你知道\" + \"1 吗？\";\n                    msg.sharePicUrl = \"https://marketqn.nalrer.cn/teris/share_image/jiayi/jy03.jpg\";\n                    msg.sharePointId = \"766\";\n                    msg.shareSchemeId = \"1155\";\n                }\n                if(msg){\n                    tywx.ShareInterface.share(\n                        msg.shareContent,\n                        msg.sharePicUrl,\n                        msg.sharePointId,\n                        msg.shareSchemeId,\n                        (res) => {\n                            tywx.LOGE(\"分享成功后的数据\"+JSON.stringify(res));\n                            // * is share to group\n                            if(self.shareConfig && self.shareConfig[1]){\n                                // * froce share to group\n                                if (res.shareTickets !== undefined && res.shareTickets.length > 0) {\n                                    if(self.shareConfig[0] === tywx.ado.Constants.ShareConfig.RANK_SHARE[0]){\n                                        self.shareGroupCallBack && self.shareGroupCallBack(res);                                                \n                                    }\n                                    else{\n                                        tywx.ado.Utils.share2GroupByTicket(\n                                            self.shareConfig[0], \n                                            res, \n                                            ()=>{ // * success callback\n                                                self.shareGroupCallBack && self.shareGroupCallBack(res);\n                                            },\n                                            ()=>{ // * failed callback\n                                                tywx.ado.Utils.showWXModal('请分享到不同群');\n                                                self.errorCallBack && self.errorCallBack(null);                                           \n                                            }\n                                        );\n                                    }\n                                }\n                                else{\n                                    // * failed\n                                    tywx.ado.Utils.showWXModal('请分享到群');\n                                    self.errorCallBack && self.errorCallBack(null);\n                                }\n                            }\n                            else{\n                                // * success\n                                self.successCallBack && self.successCallBack(res);\n                            }                          \n                         \n                        },\n                        function(data){\n                            tywx.LOGE(\"分享成功后的数2据\"+JSON.stringify(data));\n                            self.errorCallBack && self.errorCallBack(data);\n                        }\n                    );\n               }\n           }\n        }\n    }\n    // update (dt) {},\n});\n"]}