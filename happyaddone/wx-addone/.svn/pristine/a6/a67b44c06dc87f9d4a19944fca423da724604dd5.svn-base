{"version":3,"sources":["../../../../../assets/Script/models/assets/Script/models/MoreTanNumber.js"],"names":["cc","Class","extends","Component","properties","showNumber","type","Label","default","shareNode","Node","rootNode","yellowNumberLabel","curhcScoreLabel","curgzupNumberLabel","curgzItemNameLabel","showdbSprite","Sprite","backSprite","spriteFrames","SpriteFrame","setShowNumber","shownum","score","name","string","setDbByIndex","storePhoto","hadstorephotonumber","tywx","ado","Utils","showWXToast","game","canvas","width","height","cw","ch","is_ipx","ds","size","dcs","rate_width","rate_height","d_x","d_y","rate_x","rate_y","w","h","x","y","node","position","self","toTempFilePath","destWidth","destHeight","success","res","saveImage2PhoneByUrl","tempFilePath","storesuccall","fail","playAni","uiAni","close","showWXBanner","active","clossc","setCloseCall","init","commonScaleIn","onLoad","getComponent","setShareConfig","Constants","ShareConfig","FREE_GIFT_SHARE","on","event","getShareComponent","setStoreSucCallBack","succall","num","spriteFrame"],"mappings":"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","file":"MoreTanNumber.js","sourceRoot":"../../../../../assets/Script/models","sourcesContent":[" cc.Class({\n     extends: cc.Component,\n\n     properties: {\n         showNumber: {\n             type: cc.Label,\n             default: null,\n         },\n         shareNode: {\n             type: cc.Node,\n             default: null,\n         },\n        rootNode: {\n              type: cc.Node,\n              default: null,\n         },\n         yellowNumberLabel: {\n             default: null,\n             type: cc.Label\n         },\n\n         curhcScoreLabel: {\n             default: null,\n             type: cc.Label\n         },\n\n        curgzupNumberLabel: {\n            default: null,\n            type: cc.Label\n        },\n\n        curgzItemNameLabel: {\n            default: null,\n            type: cc.Label\n        },\n\n         showdbSprite: {\n             type: cc.Sprite,\n             default: null,\n         },\n         backSprite: {\n             type: cc.Sprite,\n             default: null,\n         },\n\n         spriteFrames: {\n             default: [],\n             type: cc.SpriteFrame,\n         }\n\n     },\n    \n     /**\n      * @description 刷新当前的试图\n      * @param {Number} shownum 当前合出来的偶数\n      * @param {Number} score 玩家当前的得分\n      * @param {String} 道具名称\n      */\n     setShowNumber: function (shownum, score, name) {\n         this.showNumber.string = shownum;\n         this.setDbByIndex(shownum, score, name);\n     },\n\n     /**\n      * @description 保存照片\n      */\n     storePhoto: function () {\n        if(this.hadstorephotonumber){\n           tywx.ado.Utils.showWXToast(\"已经保存成功\",500);\n           return;\n        }\n        // this.hadstorephotonumber = true;\n        let [cw,ch]                  = [cc.game.canvas.width, cc.game.canvas.height];\n        let is_ipx                   = ch / cw >= 1.9;                                                 // * 是否是2:1屏幕\n        let ds                       = cc.size(720, 1280);\n        let dcs                      = cc.size(516, 818);\n        let [rate_width,rate_height] = [dcs.width / ds.width, dcs.height / ds.height];\n        let [d_x, d_y]               = [(ds.width - dcs.width) / 2, (ds.height - dcs.height) / 2 - 102];\n        let [rate_x,rate_y]          = [d_x / ds.width,d_y / ds.height];\n\n        let w = cw * rate_width;\n        let h = is_ipx ? w * (dcs.height / dcs.width) : ch * rate_height;\n        let x = cw * rate_x;\n        let y = is_ipx ?  (ch - h) / 2 - this.showdbSprite.node.position.y: ch * rate_y ;\n        var self = this;\n        canvas.toTempFilePath({\n            x: x,\n            y: y,\n            width: w, \n            height: h,\n            destWidth: 516,\n            destHeight: 818,\n            success: function success(res) {\n                //console.log(res);\n                tywx.ado.Utils.saveImage2PhoneByUrl(res.tempFilePath,function(){\n                    self.hadstorephotonumber = true;\n                    self.storesuccall && self.storesuccall();\n                    tywx.ado.Utils.showWXToast(\"领取成功\",1000);\n                }, function(){\n                    self.hadstorephotonumber = false;\n                    tywx.ado.Utils.showWXToast(\"保存图片失败\"); \n                });\n            },\n            fail: function fail(res) {\n                self.hadstorephotonumber = false;\n                tywx.ado.Utils.showWXToast(\"保存图片失败\"); \n            }\n        });\n     },\n\n    \n     /**\n      * @description 播放当前界面的动画\n      */\n     playAni: function () {\n         //  this.node.getComponent(cc.Animation).play(\"huode1\");\n         this.uiAni();\n     },\n     \n     /**\n      * @description 关闭当前的界面\n      */\n     close: function () {\n        tywx.ado.Utils.showWXBanner();\n         this.node.active = false;\n         this.hadstorephotonumber = false;\n         if (this.clossc) {\n             this.clossc();\n         }\n     },\n     \n     /**\n      * @description 设置关闭后的回调函数\n      * @param {Function} clossc 关闭回调函数\n      */\n     setCloseCall: function (clossc) {\n         this.clossc = clossc;\n     },\n    \n     /**\n      * @description 手动初始化已经存储图片的开关\n      */\n     init:function(){\n        this.hadstorephotonumber = false;\n     },\n     \n     /**\n      * @description 播放界面通用动画\n      */\n     uiAni:function(){\n         tywx.ado.Utils.commonScaleIn(this.rootNode);\n     },\n    /**\n      * @description 页面加载完成后的逻辑处理\n      */\n     onLoad() {\n         this.hadstorephotonumber = false;\n         // 设置分享点\n         this.shareNode.getComponent(\"ShareButton\").setShareConfig(tywx.ado.Constants.ShareConfig.FREE_GIFT_SHARE);\n         this.backSprite.node.on('touchstart', function (event) {\n             return true;\n         });\n         \n     },\n    \n     /**\n      * @description 得到当前界面的分享按钮的脚本组件\n      */\n     getShareComponent: function () {\n         return this.shareNode.getComponent(\"ShareButton\");\n     },\n     \n      \n     \n     /**\n      * @description 设置当前保存图片成功后的回调函数\n      * @param {Function} succall 保存图片成功的回调函数\n      */\n     setStoreSucCallBack: function(succall){\n         this.storesuccall = succall;\n     },\n\n     /**\n      * @description 刷新当前页面的显示 保罗合出的最大数 和 当前得分 以及底板的显示 和当前得到的道具名称\n      * @param {Number} num 当前合出的最大数\n      * @param {Number} score 当前玩家的得分\n      * @param {Number} name 当前道具的名称\n      */\n     setDbByIndex: function (num, score, name) {\n         if (num == 8) {\n             this.showdbSprite.spriteFrame = this.spriteFrames[0];\n         } else if (num == 9) {\n             this.showdbSprite.spriteFrame = this.spriteFrames[1];\n         } else {\n             this.showdbSprite.spriteFrame = this.spriteFrames[2];\n         }\n         this.yellowNumberLabel.string = num;\n         this.curhcScoreLabel.string = score;\n         this.curgzupNumberLabel.string = num;\n         this.curgzItemNameLabel.string = name;\n     }\n\n\n\n });"]}