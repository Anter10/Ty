require=function o(c,r,s){function l(t,e){if(!r[t]){if(!c[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(d)return d(t,!0);var a=new Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a}var i=r[t]={exports:{}};c[t][0].call(i.exports,function(e){return l(c[t][1][e]||e)},i,i.exports,o,c,r,s)}return r[t].exports}for(var d="function"==typeof require&&require,e=0;e<s.length;e++)l(s[e]);return l}({friendicon:[function(e,t,n){"use strict";cc._RF.push(t,"df1312uJO5DOpgdFArNGVZn","friendicon"),cc.Class({extends:cc.Component,properties:{friendmsd:cc.Node,nameLabel:cc.Label,scoreLabel:cc.Label,iconSprite:cc.Sprite},onLoad:function(){},start:function(){}}),cc._RF.pop()},{}],index:[function(e,t,n){"use strict";cc._RF.push(t,"f6f5cGjhcpDobN9qvpNfUWv","index"),wx.onMessage(function(e){Log("当前玩家给子域的数据 = "+JSON.stringify(e)),e.method==PTypes.friends?cc.director.loadScene("ranklist"):e.method==PTypes.group?cc.director.loadScene("ranklist"):e.method==PTypes.userinfo||(e.method==PTypes.submitscore?cc.director.loadScene("ranklist"):e.method==PTypes.storefris?cc.director.loadScene("friends"):e.method==PTypes.hideUi&&cc.director.loadScene("ranklist"))}),cc._RF.pop()},{}],rankitem:[function(e,t,n){"use strict";cc._RF.push(t,"93486w69BJG5rxHNI3FISIF","rankitem");var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};cc.Class({extends:cc.Component,properties:{pmLabel:cc.Label,allPmicon:{default:[],type:cc.Sprite},imageIcon:cc.Sprite,nickLabel:cc.Label,scoreLabel:cc.Label},updateData:function(e){this.data=e,this.updateView(this.data)},updateView:function(e){console.log("更新数据 = "+JSON.stringify(e)),e.pm<3?(this.pmLabel.node.active=!1,this.allPmicon[e.pm].node.active=!0):this.pmLabel.string=e.pm+1,this.nickLabel.string=this.stringSlice(e.nickname,13),this.scoreLabel.string=null==e.KVDataList[0]?0:e.KVDataList[0].value+"分",this.createIcon(this.imageIcon,e.avatarUrl,500*(e.pm+1))},stringSlice:function(e,t){if(!e)return e;for(var n,a=0,i=0,o=0;o<e.length;o++){var c=e.charCodeAt(o);(i+=0<=c&&c<=128?1:2)<=t-2&&a++}return i<=t?n=e.slice(0):(n=e.slice(0,a),n+=".."),n},createIcon:function(n,e,t){var a=n;console.log("index = "+t),setTimeout(function(){try{var t=wx.createImage();t.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(t),e.handleLoadedTexture(),a.spriteFrame=new cc.SpriteFrame(e),console.log("加载失败___c1 "+(void 0===t?"undefined":i(t))+n._gycname)}catch(e){console.log("加载失败___v "+e),a.node.active=!1}},t.src=e}catch(e){console.log("加载失败____ddd "+e),a.node.active=!1}},t)},start:function(){}}),cc._RF.pop()},{}],ranklist:[function(e,t,n){"use strict";cc._RF.push(t,"280c3rsZJJKnZ9RqbALVwtK","ranklist");var a=1,i=2,o=3,c=4,r=5,s=6;cc.Class({extends:cc.Component,properties:{gameranklist:cc.ScrollView,showloading:cc.Label,rankItem:cc.Prefab,gamerank:cc.Node,titleLabel:cc.Label,content:cc.Node,friendmsd:cc.Node,nameLabel:cc.Label,scoreLabel:cc.Label,iconSprite:cc.Sprite},start:function(){var t=this;wx.onMessage(function(e){t.showloading.node.active=!0,console.log("当前玩家给子域的数据 = "+JSON.stringify(e)),e.method==a?(t.titleLabel.string="  好友排行榜",t.getFriendData()):e.method==i?(t.titleLabel.string="群组排行榜",t.getGroupFriendData(e.shareTicket)):e.method==o?t.getUserInfoData():e.method==c?t.submitScore(e.score):e.method==r?t.storeFriends(e.score,e.isrestart,e):e.method==s&&t.hideUi(e.rank,e.friendicon)})},hideUi:function(e,t){},submitScore:function(t){var n=this;wx.getUserCloudStorage({keyList:["x1"],success:function(e){n.showloading.node.active=!1,0!=e.KVDataList.length&&e.KVDataList[0].value>t||window.wx.setUserCloudStorage({KVDataList:[{key:"x1",value:""+t}],success:function(e){},fail:function(e){},complete:function(e){}})},fail:function(e){},complete:function(e){}})},getUserInfoData:function(){wx.getUserInfo({openIdList:["selfOpenId"],lang:"zh_CN",success:function(e){wx.getSharedCanvas().getContext("2d")},fail:function(e){wx.getSharedCanvas().getContext("2d")}})},getFriendData:function(e,t,n){var d=this,u=t,f=this,g=e;1==g?(f.gamerank.active=!1,f.friendmsd.active=!0):f.friendmsd.active=!1,wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){d.showloading.node.active=!1;e.data[0];wx.getFriendCloudStorage({keyList:["x1"],success:function(e){var t=e.data;if(t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value}),1!=g){f.gamerank.active=!0,f.friendmsd.active=!1,f.gameranklist.content.removeAllChildren();for(var n=20,a=0;a<t.length;a++){var i=t[a];0==(i.pm=a)&&(n=55);var o=cc.instantiate(d.rankItem);o.getComponent("rankitem").updateData(i),o.setPosition(0,-80*a-n),d.gameranklist.content.addChild(o,122)}if(t.length<=8)d.content.getComponent(cc.Layout).resizeMode=cc.Layout.ResizeMode.NONE}else if(1==g){for(var c=null,r=t.length-1;0<=r;r--){var s=t[r],l=null==s.KVDataList[0]?0:s.KVDataList[0].value;if(0<l-u){(c=s).score=l,s.avatarUrl;break}}null!=c?(f.friendmsd.active=!0,f.nameLabel.string=c.nickname,f.scoreLabel.string=c.score,f.createIcon(f.iconSprite,c.avatarUrl)):f.friendmsd.active=!1}},fail:function(e){f.showloading.string="数据加载失败，请检测网络，谢谢。"}})},fail:function(e){f.showloading.string="数据加载失败，请检测网络，谢谢。"}})},setDataToLocalStorage:function(e,t){try{wx&&wx.setStorage&&window.wx.setStorage({key:e,data:t+""})}catch(e){}},storeFriends:function(e,t,n){1==t&&"",this.getFriendData(!0,e,n)},getGroupFriendData:function(e){var c=this,r=this,t=e;r.friendmsd.active=!1,wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){e.data[0];wx.getGroupCloudStorage({shareTicket:t,keyList:["x1"],success:function(e){var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value}),c.showloading.node.active=!1,r.gameranklist.content.removeAllChildren();for(var n=35,a=0;a<t.length;a++){var i=t[a];i.pm=a;var o=cc.instantiate(c.rankItem);o.getComponent("rankitem").updateData(i),0==a&&(n=55),o.setPosition(0,-80*a-n),c.gameranklist.content.addChild(o,122)}t.length<=8&&(c.content.getComponent(cc.Layout).resizeMode=cc.Layout.ResizeMode.NONE)},fail:function(e){}})},fail:function(e){}})},onLoad:function(){},createIcon:function(e,t){var n=e;try{var a=wx.createImage();a.src=t,a.onload=function(e){try{var t=new cc.Texture2D;t.initWithElement(a),t.handleLoadedTexture(),n.spriteFrame=new cc.SpriteFrame(t)}catch(e){}}}catch(e){}}}),cc._RF.pop()},{}]},{},["friendicon","index","rankitem","ranklist"]);