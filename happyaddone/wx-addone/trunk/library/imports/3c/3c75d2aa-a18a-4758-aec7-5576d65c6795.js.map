{"version":3,"sources":["../../../../../assets/Script/CommonFrame/assets/Script/CommonFrame/ShareInterface.js"],"names":["tywx","ShareInterface","OnShareAppMessageInfo","setOnShareAppMessageInfo","title","imageUrl","sharePointId","shareSchemeId","getOnShareAppMessageInfo","getRandomOnShareAppMessageInfo","shareKeys","_key","PropagateInterface","_cachedShareConfig","push","length","randomIndex","Math","floor","random","sharePointKey","sharePointInfo","config","shareContent","sharePicUrl","share","successCallback","failCallback","extraInfo","IsWechatPlatform","BiLog","clickStat","clickStatEventType","clickStatEventTypeUserShare","query","UserInfo","userId","userName","wx","shareAppMessage","success","result","fail","complete","err","LOGE","JSON","stringify","onShareAppMessageInit","onShareAppMessage","shareTickets","groupMsgInfos"],"mappings":"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","file":"ShareInterface.js","sourceRoot":"../../../../../assets/Script/CommonFrame","sourcesContent":["/**\n * Created by xiaochuntian on 2018/5/3.\n */\n\ntywx.ShareInterface = {\n    OnShareAppMessageInfo: null,   //右上角转发对应的分享点信息\n\n    /**\n     * 设置右上角\"转发\"对应的分享信息\n     * @param title\n     * @param imageUrl\n     * @param sharePointId\n     * @param shareSchemeId\n     */\n    setOnShareAppMessageInfo: function(title, imageUrl, sharePointId, shareSchemeId){\n        this.OnShareAppMessageInfo = {\n            title: title,\n            imageUrl: imageUrl,\n            sharePointId: sharePointId,\n            shareSchemeId: shareSchemeId\n        }\n    },\n\n    /**\n     * 获取右上角\"转发\"对应的分享信息\n     * @returns {null}\n     */\n    getOnShareAppMessageInfo: function() {\n        return this.OnShareAppMessageInfo;\n    },\n\n    /**\n     * 随机获取一个分享点作为\"转发\"对应的分享信息\n     * @returns {*}\n     */\n    getRandomOnShareAppMessageInfo: function() {\n        var shareKeys = [];\n\n        for(var _key in tywx.PropagateInterface._cachedShareConfig){\n            shareKeys.push(_key);\n        }\n        if(shareKeys && shareKeys.length > 0) {\n            var randomIndex = (Math.floor(Math.random()*10000))%shareKeys.length;\n            var sharePointKey = shareKeys[randomIndex];\n            var sharePointInfo = tywx.PropagateInterface._cachedShareConfig[sharePointKey];\n            if(sharePointInfo && sharePointInfo.length > 0) {\n                randomIndex = (Math.floor(Math.random()*10000))%sharePointInfo.length;\n                var config = {\n                    title: sharePointInfo[randomIndex].shareContent,\n                    imageUrl: sharePointInfo[randomIndex].sharePicUrl,\n                    sharePointId: sharePointInfo[randomIndex].sharePointId,\n                    shareSchemeId: sharePointInfo[randomIndex].shareSchemeId\n                }\n                return config;\n            }\n        }\n        return null;\n    },\n\n    /**\n     * 根据分享信息调用分享接口,并封装了必要的打点和处理\n     * @param title\n     * @param imageUrl\n     * @param sharePointId\n     * @param shareSchemeId\n     * @param successCallback\n     * @param failCallback\n     * @param extraInfo 额外信息\n     */\n    share: function(title, imageUrl, sharePointId, shareSchemeId, successCallback, failCallback, extraInfo) {\n        try {\n            if (tywx.IsWechatPlatform()) {\n                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare, [sharePointId, 1, shareSchemeId]);\n                let query = 'inviteCode=' + tywx.UserInfo.userId + '&sourceCode=' + sharePointId + \"&inviteName=\" + tywx.UserInfo.userName + \"&imageType=\" + shareSchemeId + \"&extraInfo=\" + (extraInfo ? extraInfo : ''); \n                wx.shareAppMessage({\n                    title: title,\n                    imageUrl: imageUrl,\n                    query: query,\n                    success: function (result) {\n                        //分享成功相关处理\n                        if (successCallback) {\n                            successCallback(result);\n                        }\n                        tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare, [sharePointId, 2, shareSchemeId]);\n                    },\n                    fail: function (result) {\n                        //分享失败相关处理\n                        if (failCallback) {\n                            failCallback(result);\n                        }\n                    },\n                    complete: function () {\n                    }\n                });\n            }\n        }\n        catch(err) {\n            tywx.LOGE(\"error:\", \"tywx.ShareInterface.share——\" + JSON.stringify(err));\n        }\n    }\n};\n\ntywx.onShareAppMessageInit = function() {\n    try{\n        if(tywx.IsWechatPlatform()) {\n            wx.onShareAppMessage(function (result) {\n                /**\n                 * 获取转发信息,手动设置过则使用设置信息,否则随机获取一个分享点信息\n                 */\n                var config = tywx.ShareInterface.getOnShareAppMessageInfo();\n                if(config == null) {\n                    config = tywx.ShareInterface.getRandomOnShareAppMessageInfo();\n                }\n                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare,[config.sharePointId, 1, config.shareSchemeId]);\n                return {\n                    title: config.title,\n                    imageUrl : config.imageUrl,\n                    query : \"inviteCode=\"+tywx.UserInfo.userId+\"&sourceCode=\"+config.sharePointId+\"&inviteName=\"+tywx.UserInfo.userName+\"&imageType=\"+config.shareSchemeId,\n                    success : function (shareTickets,groupMsgInfos) {\n                        tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare,[config.sharePointId, 2, config.shareSchemeId]);\n                    },\n                    fail : function () {\n\n                    },\n                    complete : function () {\n                    }\n                }\n            });\n        };\n    }\n    catch(err) {\n        tywx.LOGE(\"error:\", \"tywx.ShareInterface.share——\" + JSON.stringify(err));\n    }\n};\n\ntywx.onShareAppMessageInit();"]}