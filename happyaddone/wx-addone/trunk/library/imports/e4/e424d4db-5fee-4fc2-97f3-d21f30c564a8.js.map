{"version":3,"sources":["../../../../../assets/Script/models/assets/Script/models/UIManager.js"],"names":["_instance","LOADING_PREFAB","tywx","ado","ResConfig","PrefabConfig","PREFAB_LOADING","UIManager","prefabCache","Map","loadingInstance","config","args","showUIByName","prefab_name","is_init","script_name","root_node","cc","director","getScene","getChildByName","self","has","loader","loadRes","err","prefab","set","instantiatePrefab2Parent","error","get","parent","tmp_node","instantiate","console","log","tmp_script","getComponent","init","destroy","canvas","node","active","resetLoading","module","exports","getInstance"],"mappings":"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","file":"UIManager.js","sourceRoot":"../../../../../assets/Script/models","sourcesContent":["/**\n * @file: UIManager.js\n * @description: UI管理器,传入prefab名字，自动加载并显示，第一次会比较慢，需要加载资源\n * @author: lu ning\n * @email: luning@tuyoogame.com\n * @date: 2018-08-25\n*/\nlet _instance = null;\nlet LOADING_PREFAB = tywx.ado.ResConfig.PrefabConfig.PREFAB_LOADING;\nlet UIManager = class{\n    static getInstance(){\n        if(!_instance) _instance = new UIManager();\n        return _instance;\n    }\n\n    constructor(){\n        this.prefabCache = new Map();\n        this.loadingInstance = null;\n    }\n    /**\n     * @description 根据配置文件显示UI\n     * @author lu ning\n     * @date 2018-08-25\n     * @param {Array<any>} config ['loading',false,'']\n     * @param {any} [args=null]\n     */\n    showUIByConfig(config, args = null){\n        this.showUIByName(config[0],config[1],config[2],args);\n    }\n    /**\n     * @description 显示UI控件\n     * @author lu ning\n     * @date 2018-08-25\n     * @param {String} prefab_name\n     * @param {boolean} [is_init=false]\n     * @param {string} [script_name='']\n     * @param {any} [args=null]\n     */\n    showUIByName(prefab_name, is_init = false, script_name = '', args = null){\n        let root_node = cc.director.getScene().getChildByName('Canvas');\n        let self = this;\n        if(!this.prefabCache.has(prefab_name)){\n            cc.loader.loadRes(`prefabs/${prefab_name}`,(err,prefab)=>{\n                if(!err){\n                    self.prefabCache.set(prefab_name, prefab);\n                    self.instantiatePrefab2Parent(prefab, root_node, is_init, script_name, args);\n                }\n                else{\n                    cc.error(`load prefab failed ${prefab_name} ${err}`);\n                }\n            });\n        }\n        else{\n            this.instantiatePrefab2Parent(this.prefabCache.get(prefab_name), root_node, is_init, script_name, args);\n        }\n        \n    }\n     /**\n     * @description 实例化控件，添加到当前场景Canvas的最上层\n     * @author lu ning\n     * @date 2018-08-25\n     * @param {cc.Prefab} prefab\n     * @param {cc.Node} parent\n     * @param {boolean} [is_init=false]\n     * @param {string} [script_name='']\n     * @param {any} [args=null]\n     * @returns {cc.Node}\n     */\n    instantiatePrefab2Parent(prefab, parent, is_init = false, script_name = '', args = null){\n        // this.showLoading();\n        let tmp_node = cc.instantiate(prefab);\n        tmp_node.parent = parent;\n        console.log(\"root_node parent  \"+parent);\n        if(is_init){\n            let tmp_script = tmp_node.getComponent(script_name);\n            if(tmp_script && tmp_script.init){\n                tmp_script.init(args);\n            }\n        }\n        // this.hideLoading();\n        return tmp_node;\n    }\n    /**\n     * @description 重置loading, 切换场景后需要重置\n     * @author lu ning\n     * @date 2018-08-25\n     */\n    resetLoading(){\n        if(this.loadingInstance){\n            this.loadingInstance.destroy();\n            this.loadingInstance = null;\n        }\n        let canvas = cc.director.getScene().getChildByName('Canvas');\n        let root_node = canvas.node;\n        let self = this;\n        if(!this.prefabCache.has(LOADING_PREFAB)){\n            cc.loader.loadRes(`prefabs/${LOADING_PREFAB}`,(err,prefab)=>{\n                if(!err){\n                    self.prefabCache.set(LOADING_PREFAB, prefab);\n                    self.loadingInstance = cc.instantiate(prefab);\n                    self.loadingInstance.parent = root_node;\n                }\n                else{\n                    cc.error(`load prefab failed ${LOADING_PREFAB} ${err}`);\n                }\n            });\n        }\n        else{\n            this.loadingInstance = cc.instantiate(this.prefabCache.get(LOADING_PREFAB));\n            this.loadingInstance.parent = root_node;\n        }\n    }\n    /**\n     * @description 显示loading控件\n     * @author lu ning\n     * @date 2018-08-25\n     */\n    showLoading(){\n        if(this.loadingInstance){\n            this.loadingInstance.active = true;\n        }\n        else{\n            this.resetLoading();\n        }\n    }\n    /**\n     * @description 隐藏loading控件\n     * @author lu ning\n     * @date 2018-08-25\n     */\n    hideLoading(){\n        if(this.loadingInstance){\n            this.loadingInstance.active = false;\n        }\n        else{\n            this.resetLoading();\n        }\n    }\n};\n\nmodule.exports = UIManager.getInstance();"]}