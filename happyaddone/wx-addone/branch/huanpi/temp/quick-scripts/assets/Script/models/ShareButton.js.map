{"version":3,"sources":["ShareButton.js"],"names":["cc","Class","extends","Component","properties","callButton","default","type","Button","onLoad","data","console","log","button","start","setShareData","setShareConfig","config","shareConfig","setSuccessCall","successCall","successCallBack","setButtonCallType","calltype","node","on","callBack","tywx","ado","isMinGanIP","showWXVideo","shareMiniApp","setReactCall","reactcall","setErrorCall","errorCall","errorCallBack","setShareGroupCall","sgroupCall","shareGroupCallBack","self","IsWechatPlatform","param","success","res","fail","Utils","showWXModal","error_callback","Constants","ShareConfig","GIFT_GIFT_BOX_SHARE_VIDEO","RECOVER_GAME_SHARE_VIDEO","content","RECOVER_GAME_SHARE","end_str","showErrorGfitPop","OPEN_RED_PACKET_SHARE_VIDEO","FREE_DOUBLE_SCORE_SHARE_VIDEO","FREE_GIFT_SHARE_VIDEO","window","wx","showShareMenu","withShareTicket","msg","getRandomShareConfigByShareTag","shareContent","sharePicUrl","sharePointId","shareSchemeId","ShareInterface","share","LOGE","JSON","stringify","shareTickets","undefined","length","RANK_SHARE","share2GroupByTicket"],"mappings":"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","file":"ShareButton.js","sourceRoot":"../../../../../assets/Script/models","sourcesContent":[" /*\n    游戏分享prefab\n    游戏的分享操作的主要逻辑在这个module里面编写\n    created by gyc on 2018-08-08.\n*/\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        callButton:{\n            default: null,\n            type: cc.Button,\n        }\n    },\n\n      /*\n        调用: 场景加载完成后的回调\n        功能: 场景加载完成后的一些UI逻辑处理\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 系统自带\n    */\n    onLoad () {\n        this.data = {};\n        console.log(\"this.button\" + this.button);\n    },\n    /*\n        调用: 组件开始调用的时候调用\n        功能: 组件开始调用的时候的逻辑处理\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 系统自带\n    */\n    start () {\n \n    },\n    \n    /*\n        调用: 使用此model分享功能的时候 手动调用刷新分享的数据\n        功能: 设置即将要分享的数据\n        参数: [\n            data: 分享的数据\n        ]\n        返回值:[\n            无\n        ]\n        思路: 系统自带\n    */\n    setShareData:function(data){\n        this.data = data;\n    },\n    /**\n     * @description 设置分享配置\n     * @author lu ning\n     * @date 2018-08-23\n     * @param {Array<any>} config config[0]=tag;config[1]=是否强制分享到群,boolean\n     */\n    setShareConfig(config){\n        this.shareConfig = config;\n    },\n\n        /*\n        调用: 使用此model分享功能的时候 \n        功能: 手动设置分享成功后的回调函数\n        参数: [\n            successCall: 分享成功后的回调方法 类型Function\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n   setSuccessCall: function(successCall){\n        this.successCallBack = successCall;\n   },\n   \n   /** \n    * @description 切换按钮的调用类型 \n    * @param {Number} calltype  1 分享 2 视频\n   */\n   setButtonCallType: function (calltype) {\n         if(!this.calltype){\n            this.callButton.node.on('click', this.callBack, this);\n         }\n         this.calltype = calltype;\n   },\n\n   callBack:function(){\n       if (tywx.ado.isMinGanIP || this.calltype == 2) {\n           this.showWXVideo();\n       } else if (this.calltype == 1) {\n           this.shareMiniApp();\n       }\n   },\n\n\n  \n\n    /*\n        调用: 使用此model分享功能的时候 \n        功能: 手动设置分享成功后的回调函数\n        参数: [\n            successCall: 分享成功后的回调方法 类型Function\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n    setReactCall: function(reactcall){\n        this.reactcall = reactcall;\n    },\n\n     /*\n        调用: 使用此model分享功能的时候 \n        功能: 手动设置分享失败后的回调函数\n        参数: [\n            errorCall: 分享失败后的回调方法 类型Function\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n    setErrorCall: function(errorCall){\n        this.errorCallBack = errorCall;\n    },\n\n    /*\n        调用: 使用此model分享功能的时候 \n        功能: 手动设置分享失败后的回调函数\n        参数: [\n            errorCall: 分享失败后的回调方法 类型Function\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n    setShareGroupCall: function(sgroupCall){\n        this.shareGroupCallBack = sgroupCall;\n    },\n    \n    \n    /**\n     * @description 播放微信视频广告\n     */\n    showWXVideo: function(){\n        var self = this;\n        if (this.reactcall) {\n            self.successCallBack(this);\n        } else {\n            if (tywx.IsWechatPlatform()) {\n\n                var param = {\n                    success:function(res){\n                         self.shareGroupCallBack && self.shareGroupCallBack(res);\n                    },\n                    fail: function (res) {\n                         tywx.ado.Utils.showWXModal('观看视频失败');\n                         self.errorCallBack && self.errorCallBack(null);\n                    },\n                    error_callback: ()=>{\n                        if (self.shareConfig === tywx.ado.Constants.ShareConfig.GIFT_GIFT_BOX_SHARE_VIDEO\n                            || self.shareConfig === tywx.ado.Constants.ShareConfig.RECOVER_GAME_SHARE_VIDEO)\n                        {\n                            let content = \n                                self.shareConfig === tywx.ado.Constants.ShareConfig.RECOVER_GAME_SHARE \n                                ? '免费复活机会' : '如意宝箱';\n                            let end_str = self.shareConfig === tywx.ado.Constants.ShareConfig.RECOVER_GAME_SHARE \n                            ? '一次' : '一个';\n                            content = `<color=#ffffff>赠送</c><color=#ff0000>${content}</color><color=#ffffff>${end_str}</c>`;\n                            tywx.ado.Utils.showErrorGfitPop(()=>{\n                                self.shareGroupCallBack && self.shareGroupCallBack(null);\n                            },content);\n                        } else if (self.shareConfig === tywx.ado.Constants.ShareConfig.OPEN_RED_PACKET_SHARE_VIDEO ||\n                            self.shareConfig === tywx.ado.Constants.ShareConfig.FREE_DOUBLE_SCORE_SHARE_VIDEO) {\n                            let content =\n                                self.shareConfig === tywx.ado.Constants.ShareConfig.OPEN_RED_PACKET_SHARE_VIDEO ?\n                                '免费红包' : '免费双倍加分';\n                            let end_str = self.shareConfig === tywx.ado.Constants.ShareConfig.FREE_DOUBLE_SCORE_SHARE_VIDEO ?\n                                '一个' : '一次';\n                            content = `<color=#ffffff>赠送</c><color=#ff0000>${content}</color><color=#ffffff>${end_str}</c>`;\n                            tywx.ado.Utils.showErrorGfitPop(() => {\n                                self.shareGroupCallBack && self.shareGroupCallBack(null);\n                            }, content);\n                        } else if (self.shareConfig === tywx.ado.Constants.ShareConfig.FREE_GIFT_SHARE_VIDEO){\n                            let content = '免费道具';\n                            let end_str = \"一个\";\n                            content = `<color=#ffffff>赠送</c><color=#ff0000>${content}</color><color=#ffffff>${end_str}</c>`;\n                            tywx.ado.Utils.showErrorGfitPop(() => {\n                                self.shareGroupCallBack && self.shareGroupCallBack(null);\n                            }, content);\n                        }\n\n                        \n                    }\n                }\n                tywx.ado.Utils.showWXVideo(param);\n            }\n        }\n    },\n\n\n    /*\n        调用: 使用此model分享功能的时候 \n        功能: 给好友或者群分享小程序的相关信息\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 逻辑需要\n    */\n    shareMiniApp:function(){\n        var self = this;\n        console.log(\"当前分享\" + this.reactcall);\n        if(this.reactcall){\n           self.successCallBack(this);\n        }else{\n            if(tywx.IsWechatPlatform()){\n                window.wx.showShareMenu({withShareTicket: true});\n                let msg = tywx.ado.Utils.getRandomShareConfigByShareTag(this.shareConfig[0]);\n                if(!msg){\n                    msg = {};\n                    msg.shareContent = \"你知道\" + \"+1 吗？\";\n                    msg.sharePicUrl = \"https://marketqn.nalrer.cn/teris/share_image/jiayi/jy03.jpg\";\n                    msg.sharePointId = \"766\";\n                    msg.shareSchemeId = \"1155\";\n                }\n                if(msg){\n                    tywx.ShareInterface.share(\n                        msg.shareContent,\n                        msg.sharePicUrl,\n                        msg.sharePointId,\n                        msg.shareSchemeId,\n                        (res) => {\n                            tywx.LOGE(\"分享成功后的数据\"+JSON.stringify(res));\n                            // * is share to group\n                            if(self.shareConfig && self.shareConfig[1]){\n                                // * froce share to group\n                                if (res.shareTickets !== undefined && res.shareTickets.length > 0) {\n                                    if(self.shareConfig[0] === tywx.ado.Constants.ShareConfig.RANK_SHARE[0]){\n                                        self.shareGroupCallBack && self.shareGroupCallBack(res);                                                \n                                    }\n                                    else{\n                                        tywx.ado.Utils.share2GroupByTicket(\n                                            self.shareConfig[0], \n                                            res, \n                                            ()=>{ // * success callback\n                                                self.shareGroupCallBack && self.shareGroupCallBack(res);\n                                            },\n                                            ()=>{ // * failed callback\n                                                tywx.ado.Utils.showWXModal('请分享到不同群');\n                                                self.errorCallBack && self.errorCallBack(null);                                           \n                                            }\n                                        );\n                                    }\n                                }\n                                else{\n                                    // * failed\n                                    tywx.ado.Utils.showWXModal('请分享到群');\n                                    self.errorCallBack && self.errorCallBack(null);\n                                }\n                            }\n                            else{\n                                // * success\n                                self.successCallBack && self.successCallBack(res);\n                            }                          \n                         \n                        },\n                        function(data){\n                            tywx.LOGE(\"分享成功后的数2据\"+JSON.stringify(data));\n                            self.errorCallBack && self.errorCallBack(data);\n                        }\n                    );\n               }\n           }\n        }\n    }\n    // update (dt) {},\n});\n"]}